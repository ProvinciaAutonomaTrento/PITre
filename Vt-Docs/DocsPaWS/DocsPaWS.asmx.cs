using System;
using System.Collections;
using System.ComponentModel;
using System.Web.Services;
using System.Xml.Serialization;
using System.Xml;
using System.Configuration;
using System.Data;

using DocsPaVO.amministrazione;
using System.Web;
using System.Collections.Generic;
using DocsPaVO.Deleghe;
using DocsPaVO.utente;
using DocsPaVO.ricerche;
using DocsPaVO.PrjDocImport;
using log4net;
using DocsPaVO.fascicolazione;
using DocsPaVO.Grid;
using DocsPaVO.Grids;
using DocsPaVO.utente.Repertori.RequestAndResponse;
using DocsPaVO.Validations;
using DocsPaVO.ProfilazioneDinamicaLite;
using DocsPaVO.Interoperabilita.Semplificata;
using DocsPaVO.Deposito;
using DocsPaVO.Notification;
using System.Linq;
using DocsPaVO.rubrica;
using DocsPaVO.InstanceAccess;
using DocsPaConservazione;

namespace DocsPaWS
{
    /// <summary>
    /// </remarks>
    [WebServiceBinding(ConformsTo = WsiProfiles.BasicProfile1_1)]
    [WebService(Namespace = "http://localhost")]
    public class DocsPaWebService : System.Web.Services.WebService
    {

        private class FileJSON
        {
            public string name;
            public string fullPath;
            public string extension;
            public string content;
        }

        protected static string path;
        private ILog logger = LogManager.GetLogger(typeof(DocsPaWebService));

        public static string Path { get { return path; } }

        /// <summary>
        /// </summary>
        public DocsPaWebService()
        {
            path = this.Server.MapPath("");
            InitializeComponent();
        }

        #region Archive

        //#region WSDepositoPerIntegrazioni
        ///// <summary>
        ///// Controlla l'esistenza di un idrpofile su un altro db (deposito)
        ///// </summary>
        ///// <param name="idprofile">idprofile del doc</param>
        ///// <returns></returns>
        //[WebMethod]
        //public virtual Int32 IsIDdocInArchive(Int32 idprofile)
        //{
        //    try
        //    {
        //        if (!string.IsNullOrEmpty(DocsPaUtils.Configuration.InitConfigurationKeys.GetValue("0", "BE_WEB_URL_DEPOSITO_SERVICE")))
        //        {
        //            DepositoServiceConsumer.DepositoServiceConsumer _dc = new DepositoServiceConsumer.DepositoServiceConsumer(DocsPaUtils.Configuration.InitConfigurationKeys.GetValue("0", "BE_WEB_URL_DEPOSITO_SERVICE"));
        //            return _dc.IsIDdocInArchive(idprofile);
        //        }
        //        else
        //            return 0;
        //    }
        //    catch (Exception e)
        //    {
        //        logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.IsIDdocInArchive", e);
        //        return 0;
        //    }
        //}

        //#endregion

        #region ARCHIVE_Disposal_TMP_Update

        /// <summary>
        /// Update tabelle temporanee scarto
        /// </summary>
        /// <param name="Disposal_ID"></param>
        /// <param name="listSystemID"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual Boolean Update_ARCHIVE_TempProjectDisposal(Int32 Disposal_ID, string listProjectsID)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.Update_ARCHIVE_TempProjectDisposal(Disposal_ID, listProjectsID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.Update_ARCHIVE_TempProjectDisposal", e);
                return false;
            }
        }

        /// <summary>
        /// Update tabelle temporanee scarto
        /// </summary>
        /// <param name="Disposal_ID"></param>
        /// <param name="listSystemID"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual Boolean Update_ARCHIVE_TempProfileDisposal(Int32 Disposal_ID, string listProfilesID)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.Update_ARCHIVE_TempProfileDisposal(Disposal_ID, listProfilesID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.Update_ARCHIVE_TempProfileDisposal", e);
                return false;
            }
        }

        #endregion

        #region ARCHIVE_JOB_Disposal

        /// <summary>
        /// Returns an instance of List<ARCHIVE_JOB_Transfer>.
        /// </summary>
        /// <results>Returns a strongly typed list of ARCHIVE_JOB_Disposal. </results>
        [WebMethod]
        public virtual void InsertARCHIVE_JOB_Disposal(Int32 Disposal_ID, Int32 jobType_ID, ref Int32 system_ID)
        {
            try
            {
                BusinessLogic.Deposito.ArchiveManager.InsertARCHIVE_JOB_Disposal(Disposal_ID, jobType_ID, ref system_ID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.InsertARCHIVE_JOB_Disposal", e);
            }

        }
        /// <summary>
        /// Returns an instance of List<ARCHIVE_JOB_Disposal>.
        /// </summary>
        /// <results>Returns a strongly typed list of ARCHIVE_JOB_Disposal. </results>
        [WebMethod]
        public virtual List<ARCHIVE_JOB_Disposal> GetARCHIVE_JOB_DisposalByDisposal_ID(Int32 Disposal_ID)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.GetARCHIVE_JOB_DisposalByDisposal_ID(Disposal_ID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.GetARCHIVE_JOB_DisposalByDisposal_ID", e);
                return null;
            }
        }
        #endregion

        #region ARCHIVE_View_Documents_Disposal

        /// <summary>
        /// Returns an instance of List<ARCHIVE_View_Documents_Policy>.
        /// Per questioni di tempo devo usare questo oggetto anche per gli scarti.
        /// </summary>
        /// <param name="system_ID">The database automatically generates this value. </param>
        /// <results>Returns a strongly typed list of ARCHIVE_View_Documents_Policy. </results>
        [WebMethod]
        public virtual List<ARCHIVE_View_Documents_Policy> GetAllARCHIVE_View_Documents_Disposal(Int32 Disposal_ID)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.GetAllARCHIVE_View_Documents_Disposal(Disposal_ID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.GetAllARCHIVE_View_Documents_Disposal", e);
                return null;
            }
        }

        #endregion

        #region ARCHIVE_View_Projects_Disposal

        /// <summary>
        /// Returns an instance of List<ARCHIVE_View_Projects_Policy>.
        /// Per questioni di tempo devo usare questo oggetto anche per gli scarti.
        /// </summary>
        /// <param name="system_ID">The database automatically generates this value. </param>
        /// <results>Returns a strongly typed list of ARCHIVE_View_Projects_Policy. </results>
        [WebMethod]
        public virtual List<ARCHIVE_View_Projects_Policy> GetAllARCHIVE_View_Projects_Disposal(Int32 Disposal_ID)
        {

            try
            {
                return BusinessLogic.Deposito.ArchiveManager.GetAllARCHIVE_View_Projects_Disposal(Disposal_ID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.GetAllARCHIVE_View_Projects_Disposal", e);
                return null;
            }
        }

        #endregion

        #region Archive_Disposal
        /// <summary>
        /// Returns an instance of List<ARCHIVE_DisposalForSearch>.
        /// </summary>
        /// <param name="system_ID">The database automatically generates this value. </param>
        /// <results>Returns a strongly typed list of ARCHIVE_DisposalForSearch. </results>
        [WebMethod]
        public virtual List<ARCHIVE_DisposalForSearch> GetAllARCHIVE_DisposalFilterForSearch(String st_indefinizione, String st_analisicompletata, String st_proposto,
                                                                              String st_approvato, String st_inesecuzione, String st_effettuato, String st_inerrore, Int32 Finger)
        {

            try
            {
                return BusinessLogic.Deposito.ArchiveManager.GetAllARCHIVE_DisposalFilterForSearch(st_indefinizione, st_analisicompletata, st_proposto,
                                                                               st_approvato, st_inesecuzione, st_effettuato, st_inerrore, Finger);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.GetAllARCHIVE_TransferFilterForSearch", e);
                return null;
            }
        }

        /// <summary>
        /// Returns an instance of List<ARCHIVE_Disposal>.
        /// </summary>
        /// <param name="system_ID">The database automatically generates this value. </param>
        /// <results>Returns a strongly typed list of ARCHIVE_Disposal. </results>
        [WebMethod]
        public virtual List<ARCHIVE_Disposal> GetARCHIVE_DisposalBySystem_ID(Int32 system_ID)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.GetARCHIVE_DisposalBySystem_ID(system_ID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.GetARCHIVE_DisposalBySystem_ID", e);
                return null;
            }
        }
        /// <summary>
        /// Returns all instances of ARCHIVE_Disposal.
        /// </summary>
        /// <results>Returns a strongly typed list of ARCHIVE_Disposal. </results>
        [WebMethod]
        public virtual List<ARCHIVE_Disposal> GetAllARCHIVE_Disposal()
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.GetAllARCHIVE_Disposal();
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.GetAllARCHIVE_Disposal", e);
                return null;
            }
        }
        /// <summary>
        /// Deletes an instance of ARCHIVE_Disposal based on System_ID.
        /// </summary>
        /// <param name="system_ID">The database automatically generates this value. </param>
        /// <results>'true' if the instance was deleted, otherwise, 'false'. </results>
        [WebMethod]
        public virtual Boolean DeleteARCHIVE_Disposal(Int32 system_ID)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.DeleteARCHIVE_Disposal(system_ID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.DeleteARCHIVE_Disposal", e);
                return false;
            }
        }
        /// <summary>
        /// Updates an instance of ARCHIVE_Disposal.
        /// </summary>
        /// <param name="note">This is not a required field. </param>
        /// <param name="system_ID">The database automatically generates this value. </param>
        /// <results>'true' if the instance was updated, otherwise, 'false'. </results>
        [WebMethod]
        public virtual Boolean UpdateARCHIVE_Disposal(String description, String note, Int32 system_ID, Int32 iD_Amministrazione)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.UpdateARCHIVE_Disposal(description, note, system_ID, iD_Amministrazione);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.UpdateARCHIVE_Disposal", e);
                return false;
            }
        }
        /// <summary>
        /// Updates an instance of ARCHIVE_Disposal if the original data has not changed.
        /// </summary>
        /// <param name="description_Original">This field is used for optimistic concurrency management. It should contain the original value of 'description_Original'. </param>
        /// <param name="note">This is not a required field. </param>
        /// <param name="note_Original">This field is used for optimistic concurrency management. It should contain the original value of 'note_Original'. This is not a required field. </param>
        /// <param name="system_ID">The database automatically generates this value. </param>
        /// <results>'true' if the instance was updated, otherwise, 'false'. </results>
        [WebMethod]
        public virtual Boolean UpdateARCHIVE_DisposalOriginal(String description, String description_Original, String note,
                                                                String note_Original, Int32 system_ID, Int32 id_Amministrazione, Int32 id_Amministrazione_Original)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.UpdateARCHIVE_DisposalOriginal(description, description_Original, note, note_Original,
                                                                                            id_Amministrazione, id_Amministrazione_Original, system_ID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.UpdateARCHIVE_Disposal", e);
                return false;
            }
        }
        /// <summary>
        /// Persists a new instance of ARCHIVE_Disposal to the database.
        /// </summary>
        /// <param name="note">This is not a required field. </param>
        /// <param name="system_ID">Returns the value of system_ID. The database automatically generates this value. </param>
        [WebMethod]
        public virtual void InsertARCHIVE_Disposal(String description, String note, ref Int32 system_ID, Int32 iD_Amministrazione, Int32 transferStateType_ID)
        {
            try
            {
                BusinessLogic.Deposito.ArchiveManager.InsertARCHIVE_Disposal(description, note, ref system_ID, iD_Amministrazione, transferStateType_ID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.InsertARCHIVE_DisposalState", e);
            }
        }

        #endregion

        #region Archive_Disposal_state
        /// <summary>
        /// Returns all instances of ARCHIVE_DisposalState.
        /// </summary>
        /// <results>Returns a strongly typed list of ARCHIVE_DisposalState. </results>
        [WebMethod]
        public virtual List<DocsPaVO.Deposito.ARCHIVE_DisposalState> GetAllARCHIVE_DisposalState()
        {
            try
            {

                return BusinessLogic.Deposito.ArchiveManager.GetAllARCHIVE_DisposalState();
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.GetAll", e);
                return null;
            }
        }
        /// <summary>
        /// Returns an instance of List<ARCHIVE_DisposalState>.
        /// </summary>
        /// <param name="system_ID">The database automatically generates this value. </param>
        /// <results>Returns a strongly typed list of ARCHIVE_DisposalState. </results>
        [WebMethod]
        public virtual List<DocsPaVO.Deposito.ARCHIVE_DisposalState> GetARCHIVE_DisposalStateBySystem_ID(Int32 System_ID)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.GetARCHIVE_DisposalStateBySystem_ID(System_ID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.GetARCHIVE_DisposalStateBySystem_ID", e);
                return null;
            }
        }
        /// <summary>
        /// Relates ARCHIVE_Disposal to ARCHIVE_DisposalState.
        /// Returns a collection of ARCHIVE_DisposalState based on the following criteria: Disposal_ID.
        /// </summary>
        /// <results>Returns a strongly typed list of ARCHIVE_DisposalState. </results>
        [WebMethod]
        public virtual List<DocsPaVO.Deposito.ARCHIVE_DisposalState> GetARCHIVE_DisposalStateByDisposal_ID(Int32 Disposal_ID)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.GetARCHIVE_DisposalStateByDisposal_ID(Disposal_ID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.GetARCHIVE_DisposalStateByDisposal_ID", e);
                return null;
            }
        }
        /// <summary>
        /// Returns a collection of ARCHIVE_DisposalState based on the following criteria: DisposalStateType_ID.
        /// </summary>
        /// <results>Returns a strongly typed list of ARCHIVE_DisposalState. </results>
        [WebMethod]
        public virtual List<DocsPaVO.Deposito.ARCHIVE_DisposalState> GetARCHIVE_DisposalStateByDisposalStateType_ID(Int32 DisposalStateType_ID)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.GetARCHIVE_DisposalStateByDisposalStateType_ID(DisposalStateType_ID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.GetARCHIVE_DisposalStateByDisposalStateType_ID", e);
                return null;
            }
        }
        /// <summary>
        /// Deletes an instance of ARCHIVE_DisposalState based on System_ID.
        /// </summary>
        /// <param name="system_ID">The database automatically generates this value. </param>
        /// <results>'true' if the instance was deleted, otherwise, 'false'. </results>
        [WebMethod]
        public virtual Boolean DeleteARCHIVE_DisposalState(Int32 system_ID)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.DeleteARCHIVE_DisposalState(system_ID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.DeleteARCHIVE_DisposalState", e);
                return false;
            }
        }
        /// <summary>
        /// Deletes an instance of ARCHIVE_DisposalState based on Disposal_ID.
        /// </summary>
        /// <results>'true' if the instance was deleted, otherwise, 'false'. </results>
        [WebMethod]
        public virtual Boolean DeleteARCHIVE_DisposalStateByDisposal_ID(Int32 transfer_ID)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.DeleteARCHIVE_DisposalStateByDisposal_ID(transfer_ID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.DeleteARCHIVE_DisposalStateByDisposal_ID", e);
                return false;
            }
        }
        /// <summary>
        /// Updates an instance of ARCHIVE_DisposalState.
        /// </summary>
        /// <param name="system_ID">The database automatically generates this value. </param>
        /// <results>'true' if the instance was updated, otherwise, 'false'. </results>
        [WebMethod]
        public virtual Boolean UpdateARCHIVE_DisposalState(Int32 Disposal_ID, Int32 DisposalStateType_ID, Int32 system_ID)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.UpdateARCHIVE_DisposalState(Disposal_ID, DisposalStateType_ID, system_ID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.DeleteARCHIVE_DisposalStateByDisposal_ID", e);
                return false;
            }
        }
        /// <summary>
        /// Updates an instance of ARCHIVE_DisposalState if the original data has not changed.
        /// </summary>
        /// <param name="transfer_ID_Original">This field is used for optimistic concurrency management. It should contain the original value of 'transfer_ID_Original'. </param>
        /// <param name="transferStateType_ID_Original">This field is used for optimistic concurrency management. It should contain the original value of 'transferStateType_ID_Original'. </param>
        /// <param name="dateTime_Original">This field is used for optimistic concurrency management. It should contain the original value of 'dateTime_Original'. </param>
        /// <param name="system_ID">The database automatically generates this value. </param>
        /// <results>'true' if the instance was updated, otherwise, 'false'. </results>
        [WebMethod]
        public virtual Boolean UpdateARCHIVE_DisposalStateOriginal(Int32 Disposal_ID, Int32 Disposal_ID_Original, Int32 DisposalStateType_ID, Int32 DisposalStateType_ID_Original, Int32 system_ID)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.UpdateARCHIVE_DisposalState(Disposal_ID, Disposal_ID_Original, DisposalStateType_ID, DisposalStateType_ID_Original, system_ID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.sp_ARCHIVE_Update_DisposalState", e);
                return false;
            }
        }
        /// <summary>
        /// Persists a new instance of ARCHIVE_DisposalState to the database.
        /// </summary>
        /// <param name="system_ID">Returns the value of system_ID. The database automatically generates this value. </param>
        [WebMethod]
        public virtual void InsertARCHIVE_DisposalState(Int32 Disposal_ID, Int32 DisposalStateType_ID, ref Int32 system_ID)
        {
            try
            {
                BusinessLogic.Deposito.ArchiveManager.InsertARCHIVE_DisposalState(Disposal_ID, DisposalStateType_ID, ref system_ID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.InsertARCHIVE_DisposalState", e);
            }
        }


        #endregion

        #region ARCHIVE_DisposalStateType

        /// <summary>
        /// Returns all instances of ARCHIVE_DisposalStateType.
        /// </summary>
        /// <results>Returns a strongly typed list of ARCHIVE_DisposalStateType. </results>
        [WebMethod]
        public virtual List<ARCHIVE_DisposalStateType> GetAllARCHIVE_DisposalStateType()
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.GetAllARCHIVE_DisposalStateType();
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.GetAllARCHIVE_DisposalStateType", e);
                return null;
            }
        }
        /// <summary>
        /// Returns an instance of List<ARCHIVE_DisposalStateType>.
        /// </summary>
        /// <results>Returns a strongly typed list of ARCHIVE_DisposalStateType. </results>
        [WebMethod]
        public virtual List<ARCHIVE_DisposalStateType> GetARCHIVE_DisposalStateTypeBySystem_ID(Int32 system_ID)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.GetARCHIVE_DisposalStateTypeBySystem_ID(system_ID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.GetARCHIVE_DisposalStateTypeBySystem_ID", e);
                return null;
            }
        }
        /// <summary>
        /// Deletes an instance of ARCHIVE_DisposalStateType based on System_ID.
        /// </summary>
        /// <results>'true' if the instance was deleted, otherwise, 'false'. </results>
        [WebMethod]
        public virtual Boolean DeleteARCHIVE_DisposalStateType(Int32 system_ID)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.DeleteARCHIVE_DisposalStateType(system_ID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.DeleteARCHIVE_DisposalStateType", e);
                return false;

            }
        }
        /// <summary>
        /// Deletes all instances of ARCHIVE_DisposalStateType.
        /// </summary>
        /// <results>The number of items deleted. </results>
        [WebMethod]
        public virtual Int32 DeleteAllARCHIVE_DisposalStateType()
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.DeleteAllARCHIVE_DisposalStateType();
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.DeleteAllARCHIVE_DisposalStateType", e);
                return -1;

            }
        }
        /// <summary>
        /// Updates an instance of ARCHIVE_DisposalStateType.
        /// </summary>
        /// <results>'true' if the instance was updated, otherwise, 'false'. </results>
        [WebMethod]
        public virtual Boolean UpdateARCHIVE_DisposalStateType(String name, Int32 system_ID)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.UpdateARCHIVE_DisposalStateType(name, system_ID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.UpdateARCHIVE_DisposalStateType", e);
                return false;

            }
        }
        /// <summary>
        /// Updates an instance of ARCHIVE_DisposalStateType if the original data has not changed.
        /// </summary>
        /// <param name="name_Original">This field is used for optimistic concurrency management. It should contain the original value of 'name_Original'. </param>
        /// <results>'true' if the instance was updated, otherwise, 'false'. </results>
        [WebMethod]
        public virtual Boolean UpdateARCHIVE_DisposalStateTypeOriginal(String name, String name_Original, Int32 system_ID)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.UpdateARCHIVE_DisposalStateType(name, name_Original, system_ID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.UpdateARCHIVE_DisposalStateType", e);
                return false;

            }
        }
        /// <summary>
        /// Persists a new instance of ARCHIVE_DisposalStateType to the database.
        /// </summary>
        [WebMethod]
        public virtual Boolean InsertARCHIVE_DisposalStateType(Int32 system_ID, String name)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.InsertARCHIVE_DisposalStateType(system_ID, name);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.InsertARCHIVE_DisposalStateType", e);
                return false;

            }
        }


        #endregion

        #region ARCHIVE_AUTH_RESULT

        [WebMethod]
        public virtual List<ARCHIVE_AUTH_Authorization_Result> GetAllARCHIVE_Authorization_Result()
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.GetAllARCHIVE_Authorization_Result();
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.GetAllARCHIVE_Authorization_Result", e);
                return null;
            }
        }

        #endregion

        #region ARCHIVE_AUTH_DocumentInGrid

        [WebMethod]
        public virtual List<ARCHIVE_AUTH_grid_project> GetAllARCHIVE_GridProject()
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.GetAllARCHIVE_GridProject();
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.GetAllARCHIVE_GridProject", e);
                return null;
            }
        }

        #endregion

        #region ARCHIVE_AUTH_DocumentInGrid


        [WebMethod]
        public virtual List<ARCHIVE_AUTH_grid_document> GetAllARCHIVE_GridDocument()
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.GetAllARCHIVE_GridDocument();
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.GetAllARCHIVE_GridDocument", e);
                return null;
            }
        }

        #endregion

        #region ARCHIVE_AUTH_OBJECT

        /// <summary>
        /// Returns an instance of List<ARCHIVE_JOB_Transfer>.
        /// </summary>
        /// <results>Returns a strongly typed list of ARCHIVE_AUTH_AuthorizedObject. </results>
        [WebMethod]
        public virtual List<ARCHIVE_AUTH_AuthorizedObject> GetARCHIVE_AutorizedObjectBySystem_ID(Int32 system_id)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.GetARCHIVE_AutorizedObjectBySystem_ID(system_id);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.GetARCHIVE_AutorizedObjectBySystem_ID", e);
                return null;
            }
        }

        /// <summary>
        /// Returns all instance of List<ARCHIVE_JOB_Transfer>.
        /// </summary>
        /// <results>Returns a strongly typed list of ARCHIVE_AUTH_AuthorizationARCHIVE_AUTH_Authorization. </results>
        [WebMethod]
        public virtual List<ARCHIVE_AUTH_AuthorizedObject> GetALLARCHIVE_AutorizedObject()
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.GetALLARCHIVE_AutorizedObject();
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.GetALLARCHIVE_AutorizedObject", e);
                return null;
            }
        }

        /// <summary>
        /// Deletes an instance of Autorizations based on System_ID.
        /// </summary>
        /// <param name="system_ID">The database automatically generates this value. </param>
        /// <results>'true' if the instance was deleted, otherwise, 'false'. </results>
        [WebMethod]
        public virtual Boolean DeleteARCHIVE_AutorizedObject_BySystem_ID(Int32 system_ID)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.DeleteARCHIVE_AutorizedObject_BySystem_ID(system_ID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.DeleteARCHIVE_AutorizedObject_BySystem_ID", e);
                return false;
            }
        }

        /// <summary>
        /// Returns an instance of List<ARCHIVE_JOB_Transfer>.
        /// </summary>
        /// <results>Returns a strongly typed list of ARCHIVE_JOB_Transfer. </results>
        [WebMethod]
        public virtual void InsertARCHIVE_AutorizedObject(Int32 Authorization_ID, Int32 Project_ID, Int32 profile_ID, ref Int32 system_ID)
        {
            try
            {
                BusinessLogic.Deposito.ArchiveManager.InsertARCHIVE_AutorizedObject(Authorization_ID, Project_ID, profile_ID, ref system_ID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.InsertARCHIVE_AutorizedObject", e);
            }

        }

        [WebMethod]
        public virtual Boolean UpdateARCHIVE_AutorizedObject(Int32 Authorization_ID, Int32 Project_ID, Int32 profile_ID, ref Int32 system_ID)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.UpdateARCHIVE_AutorizedObject(Authorization_ID, Project_ID, profile_ID, ref system_ID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.UpdateARCHIVE_AutorizedObject", e);
                return false;
            }
        }

        #endregion

        #region ARCHIVE_AUTH

        /// <summary>
        /// Returns an instance of List<ARCHIVE_JOB_Transfer>.
        /// </summary>
        /// <results>Returns a strongly typed list of ARCHIVE_AUTH_AuthorizationARCHIVE_AUTH_Authorization. </results>
        [WebMethod]
        public virtual List<ARCHIVE_AUTH_Authorization> GetARCHIVE_AutorizationBySystem_ID(Int32 system_id)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.GetARCHIVE_AutorizationBySystem_ID(system_id);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.GetARCHIVE_AutorizationBySystem_ID", e);
                return null;
            }
        }

        /// <summary>
        /// Returns all instance of List<ARCHIVE_JOB_Transfer>.
        /// </summary>
        /// <results>Returns a strongly typed list of ARCHIVE_AUTH_AuthorizationARCHIVE_AUTH_Authorization. </results>
        [WebMethod]
        public virtual List<ARCHIVE_AUTH_Authorization> GetALLARCHIVE_Autorizations()
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.GetALLARCHIVE_Autorizations();
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.GetALLARCHIVE_Autorizations", e);
                return null;
            }
        }

        /// <summary>
        /// Deletes an instance of Autorizations based on System_ID.
        /// </summary>
        /// <param name="system_ID">The database automatically generates this value. </param>
        /// <results>'true' if the instance was deleted, otherwise, 'false'. </results>
        [WebMethod]
        public virtual Boolean DeleteARCHIVE_Autorizations_BySystem_ID(Int32 system_ID)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.DeleteARCHIVE_Autorizations_BySystem_ID(system_ID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.DeleteARCHIVE_Autorizations_BySystem_ID", e);
                return false;
            }
        }

        /// <summary>
        /// Returns an instance of List<ARCHIVE_JOB_Transfer>.
        /// </summary>
        /// <results>Returns a strongly typed list of ARCHIVE_JOB_Transfer. </results>
        [WebMethod]
        public virtual void InsertARCHIVE_Authorization(Int32 People_ID, String StartDate, String EndDate, String note, String profileList,
                                                        String projectList, ref Int32 system_ID)
        {
            try
            {
                BusinessLogic.Deposito.ArchiveManager.InsertARCHIVE_Authorization(People_ID, StartDate, EndDate, note, profileList, projectList, ref system_ID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.InsertARCHIVE_Authorization", e);
            }

        }

        [WebMethod]
        public virtual Boolean UpdateARCHIVE_Authorization(Int32 People_ID, String StartDate, String EndDate, String note, String profileList,
                                                        String projectList, ref Int32 system_ID)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.UpdateARCHIVE_Authorization(People_ID, StartDate, EndDate, note, profileList, projectList, ref system_ID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.UpdateARCHIVE_TransferUpdateARCHIVE_Authorization", e);
                return false;
            }
        }

        #endregion

        #region ARCHIVE_LOG_TransferAndPolicy
        /// <summary>
        /// Returns an instance of List<ARCHIVE_JOB_TransferPolicy>.
        /// </summary>
        /// <results>Returns a strongly typed list of ARCHIVE_JOB_TransferPolicy, related to a transfer. </results>
        [WebMethod]
        public virtual List<ARCHIVE_JOB_TransferPolicy> GetARCHIVE_JOB_TransferPolicyByTransfer_ID(Int32 transfer_ID)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.GetARCHIVE_JOB_TransferPolicyByTransfer_ID(transfer_ID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.GetARCHIVE_JOB_TransferPolicyByTransfer_ID", e);
                return null;
            }
        }

        /// <summary>
        /// Returns an instance of List<ARCHIVE_Result_Transfer>.
        /// </summary>
        /// <param name="system_ID">The database automatically generates this value. </param>
        /// <results>Returns a strongly typed list of ARCHIVE_Result_Transfer. </results>
        [WebMethod]
        public virtual List<ARCHIVE_LOG_TransferAndPolicy> GetARCHIVE_LOG_TransferAndPolicy(String ListaVersamentoIDANDPolicyID)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.GetARCHIVE_LOG_TransferAndPolicy(ListaVersamentoIDANDPolicyID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.GetARCHIVE_LOG_TransferAndPolicy", e);
                return null;
            }
        }
        #endregion

        #region ARCHIVE_JOB_Transfer

        /// <summary>
        /// Returns an instance of List<ARCHIVE_JOB_Transfer>.
        /// </summary>
        /// <results>Returns a strongly typed list of ARCHIVE_JOB_Transfer. </results>
        [WebMethod]
        public virtual void InsertARCHIVE_JOB_Transfer(Int32 transfer_ID, Int32 jobType_ID, ref Int32 system_ID)
        {
            try
            {
                BusinessLogic.Deposito.ArchiveManager.InsertARCHIVE_JOB_Transfer(transfer_ID, jobType_ID, ref system_ID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.InsertARCHIVE_JOB_Transfer", e);
            }

        }

        /// <summary>
        /// Returns an instance of List<ARCHIVE_JOB_Transfer>.
        /// </summary>
        /// <results>Returns a strongly typed list of ARCHIVE_JOB_Transfer. </results>
        [WebMethod]
        public virtual List<ARCHIVE_JOB_Transfer> GetARCHIVE_JOB_TransferByTransfer_ID(Int32 transfer_ID)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.GetARCHIVE_JOB_TransferByTransfer_ID(transfer_ID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.GetARCHIVE_JOB_TransferByTransfer_ID", e);
                return null;
            }
        }

        #endregion

        #region ARCHIVE_JOB_TransferPolicy

        /// <summary>
        /// Returns an instance of List<ARCHIVE_JOB_TransferPolicy>.
        /// </summary>
        /// <results>Returns a strongly typed list of ARCHIVE_JOB_TransferPolicy. </results>
        [WebMethod]
        public virtual List<ARCHIVE_JOB_TransferPolicy> GetARCHIVE_JOB_TransferPolicyByTransferPolicy_ID(Int32 transferPolicy_ID)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.GetARCHIVE_JOB_TransferPolicyByTransferPolicy_ID(transferPolicy_ID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.GetARCHIVE_JOB_TransferPolicyByTransferPolicy_ID", e);
                return null;
            }
        }

        /// <summary>
        /// Returns an instance of List<ARCHIVE_JOB_TransferPolicy>.
        /// </summary>
        /// <results>Returns a strongly typed list of ARCHIVE_JOB_TransferPolicy. </results>
        [WebMethod]
        public virtual void InsertARCHIVE_JOB_TransferPolicy(Int32 transferPolicy_ID, Int32 jobType_ID, ref Int32 system_ID)
        {
            try
            {
                BusinessLogic.Deposito.ArchiveManager.InsertARCHIVE_JOB_TransferPolicy(transferPolicy_ID, jobType_ID, ref system_ID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.InsertARCHIVE_JOB_TransferPolicy", e);
            }

        }
        #endregion

        #region Utility di Search & porting Transfer Policy
        /// <summary>
        /// ritorna un'array dei tipi atto associati a un id amministrazione passatoper paramentro, e tutti quelli non associati
        /// ad un id amministrazione.
        /// </summary>
        /// <param name="idAmministrazione"></param>
        /// <returns>ritorna un'array dei tipi atto </returns>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.documento.TipologiaAtto))]
        public virtual ArrayList ARCHIVE_GetTipologiaAtto(string idAmministrazione)
        {
            ArrayList result = null;

            try
            {
                result = BusinessLogic.Documenti.DocManager.getTipologiaAtto(idAmministrazione);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ARCHIVE_DocumentoGetTipologiaAtto", e);
                result = null;
            }
            return result;
        }
        /// <summary>
        /// Chiamata per lo start della ricerca dei documenti in base alla policy che abbiamo inserito.
        /// </summary>
        /// <param name="system_ID"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual bool StartSearchForTransferPolicy(Int32 system_ID)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.StartSearchForTransferPolicy(system_ID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.StartSearchForTransferPolicy", e);
                return false;
            }
        }

        /// <summary>
        /// Chiamata per lo start dell'analisi del trasferimento.
        /// </summary>
        /// <param name="system_ID"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual bool StartAnalysisForTransfer(Int32 system_ID)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.StartAnalysisForTransfer(system_ID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.StartAnalysisForTransfer", e);
                return false;
            }
        }

        /// <summary>
        /// avvia la ricerca di una lista di policy rappresentanta da una stringa di id policy passata per parametro
        /// </summary>
        /// <param name="ListSystemID"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual bool StartSearchForTransferPolicyList(string ListSystemID)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.StartSearchForTransferPolicyList(ListSystemID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.StartSearchForTransferPolicyList", e);
                return false;
            }
        }

        /// <summary>
        /// avvia la ricerca asincrona di una lista di policy rappresentanta da una stringa di id policy passata per parametro
        /// </summary>
        /// <param name="ListSystemID"></param>
        /// <returns>Returns a strongly typed List of Int32 </returns>
        [WebMethod]
        public virtual List<Int32> StartAsyncSearchForTransferPolicyList(string ListSystemID)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.StartAsyncSearchForTransferPolicyList(ListSystemID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.StartAsyncSearchForTransferPolicyList", e);
                return null;
            }
        }

        /// <summary>
        /// avvia l'analisi asincrona di una lista di policy rappresentanta da una stringa di id policy passata per parametro
        /// </summary>
        /// <param name="ListSystemID"></param>
        /// <returns>Returns a strongly typed List of Int32 </returns>
        [WebMethod]
        public virtual List<Int32> StartAsyncAnalisysForTransferPolicyList(string ListSystemID)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.StartAsyncAnalysisForTransferPolicyList(ListSystemID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.StartAsyncAnalisysForTransferPolicyList", e);
                return null;
            }
        }

        /// <summary>
        /// Returns an instance of List<ARCHIVE_TransferForSearch>.
        /// </summary>
        /// <param name="system_ID">The database automatically generates this value. </param>
        /// <results>Returns a strongly typed list of ARCHIVE_TransferForSearch. </results>
        [WebMethod]
        public virtual List<ARCHIVE_TransferForSearch> GetAllARCHIVE_TransferFilterForSearch(String st_indefinizione, String st_analisicompletata, String st_proposto,
                                                                              String st_approvato, String st_inesecuzione, String st_effettuato, String st_inerrore, Int32 Finger)
        {

            try
            {
                return BusinessLogic.Deposito.ArchiveManager.GetAllARCHIVE_TransferFilterForSearch(st_indefinizione, st_analisicompletata, st_proposto,
                                                                               st_approvato, st_inesecuzione, st_effettuato, st_inerrore, Finger);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.GetAllARCHIVE_TransferFilterForSearch", e);
                return null;
            }
        }

        #endregion

        #region Achive_transfer_policy


        /// <summary>
        /// Deletes many instances of ARCHIVE_TransferPolicy based on System_ID.
        /// </summary>
        /// <param name="ListSystemID">The database automatically generates this value. </param>
        /// <results>'true' if the instance was deleted, otherwise, 'false'. </results>
        [WebMethod]
        public virtual Boolean DeleteARCHIVE_TransferPolicyList(String ListSystemID)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.DeleteARCHIVE_TransferPolicyList(ListSystemID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.DeleteARCHIVE_TransferPolicyList", e);
                return false;
            }
        }
        /// <summary>
        /// Returns an instance of List<ARCHIVE_TransferPolicy>.
        /// </summary>
        /// <param name="system_ID">The database automatically generates this value. </param>
        /// <results>Returns a strongly typed list of ARCHIVE_TransferPolicy. </results>
        [WebMethod]
        public virtual List<ARCHIVE_TransferPolicy> GetARCHIVE_TransferPolicyBySystem_ID(Int32 system_ID)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.GetARCHIVE_TransferPolicyBySystem_ID(system_ID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.GetARCHIVE_TransferPolicyBySystem_ID", e);
                return null;
            }
        }

        /// <summary>
        /// Returns all instances of ARCHIVE_TransferPolicy.
        /// </summary>
        /// <results>Returns a strongly typed list of ARCHIVE_TransferPolicy. </results>
        [WebMethod]
        public virtual List<ARCHIVE_TransferPolicy> GetAllARCHIVE_TransferPolicy()
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.GetAllARCHIVE_TransferPolicy();
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.GetAllARCHIVE_TransferPolicy", e);
                return null;
            }
        }
        /// <summary>
        /// Relates ARCHIVE_TransferPolicyType to ARCHIVE_TransferPolicy.
        /// Returns a collection of ARCHIVE_TransferPolicy based on the following criteria: TransferPolicyType_ID.
        /// </summary>
        /// <results>Returns a strongly typed list of ARCHIVE_TransferPolicy. </results>
        [WebMethod]
        public virtual List<ARCHIVE_TransferPolicy> GetARCHIVE_TransferPolicyByTransferPolicyType_ID(Int32 transferPolicyType_ID)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.GetARCHIVE_TransferPolicyByTransferPolicyType_ID(transferPolicyType_ID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.GetARCHIVE_TransferPolicyByTransferPolicyType_ID", e);
                return null;
            }
        }

        /// <summary>
        /// Returns a collection of ARCHIVE_TransferPolicy based on the following criteria: Transfer_ID.
        /// </summary>
        /// <param name="transfer_ID">This is not a required field. </param>
        /// <results>Returns a strongly typed list of ARCHIVE_TransferPolicy. </results>
        [WebMethod]
        public virtual List<ARCHIVE_TransferPolicy> GetARCHIVE_TransferPolicyByTransfer_ID(Int32? transfer_ID)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.GetARCHIVE_TransferPolicyByTransfer_ID(transfer_ID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.GetARCHIVE_TransferPolicyByTransfer_ID", e);
                return null;
            }
        }

        /// <summary>
        /// Deletes an instance of ARCHIVE_TransferPolicy based on System_ID.
        /// </summary>
        /// <param name="system_ID">The database automatically generates this value. </param>
        /// <results>'true' if the instance was deleted, otherwise, 'false'. </results>
        [WebMethod]
        public virtual Boolean DeleteARCHIVE_TransferPolicy(Int32 system_ID)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.DeleteARCHIVE_TransferPolicy(system_ID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.DeleteARCHIVE_TransferPolicy", e);
                return false;
            }
        }

        ///// <summary>
        ///// Deletes many instances of ARCHIVE_TransferPolicy based on System_ID.
        ///// </summary>
        ///// <param name="ListSystemID">The database automatically generates this value. </param>
        ///// <results>'true' if the instance was deleted, otherwise, 'false'. </results>
        //[WebMethod]
        //public virtual Boolean DeleteARCHIVE_TransferPolicyList(String ListSystemID)
        //{
        //    try
        //    {
        //        return BusinessLogic.Deposito.ArchiveManager.DeleteARCHIVE_TransferPolicyList(ListSystemID);
        //    }
        //    catch (Exception e)
        //    {
        //        logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.DeleteARCHIVE_TransferPolicyList", e);
        //        return false;
        //    }
        //}

        /// <summary>
        /// Deletes all instances of ARCHIVE_TransferPolicy.
        /// </summary>
        /// <results>The number of items deleted. </results>
        [WebMethod]
        public virtual Int32 DeleteAllARCHIVE_TransferPolicy()
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.DeleteAllARCHIVE_TransferPolicy();
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.DeleteAllARCHIVE_TransferPolicy", e);
                return -1;
            }
        }
        /// <summary>
        /// Deletes an instance of ARCHIVE_TransferPolicy based on TransferPolicyType_ID.
        /// </summary>
        /// <results>'true' if the instance was deleted, otherwise, 'false'. </results>
        [WebMethod]
        public virtual Boolean DeleteARCHIVE_TransferPolicyByTransferPolicyType_ID(Int32 transferPolicyType_ID)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.DeleteARCHIVE_TransferPolicyByTransferPolicyType_ID(transferPolicyType_ID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.DeleteARCHIVE_TransferPolicyByTransferPolicyType_ID", e);
                return false;
            }
        }
        /// <summary>
        /// Massive Updates an instance of ARCHIVE_TransferPolicy.
        /// </summary>
        /// <param name="aRCHIVE_TransferPolicy">The original instance of aRCHIVE_TransferPolicy. </param>
        /// <results>'true' if the instance was updated, otherwise, 'false'. </results>
        [WebMethod]
        public virtual Boolean UpdateARCHIVE_TransferPolicyMassive(List<ARCHIVE_TransferPolicy> aRCHIVE_TransferPolicy)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.UpdateARCHIVE_TransferPolicyMassive(aRCHIVE_TransferPolicy);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.UpdateARCHIVE_TransferPolicy", e);
                return false;
            }
        }
        /// <summary>
        /// Updates an instance of ARCHIVE_TransferPolicy.
        /// </summary>
        /// <param name="aRCHIVE_TransferPolicy">The instance of aRCHIVE_TransferPolicy to persist. </param>
        /// <results>'true' if the instance was updated, otherwise, 'false'. </results>
        [WebMethod]
        public virtual Boolean UpdateARCHIVE_TransferPolicy(ARCHIVE_TransferPolicy aRCHIVE_TransferPolicy)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.UpdateARCHIVE_TransferPolicy(aRCHIVE_TransferPolicy);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.UpdateARCHIVE_TransferPolicy", e);
                return false;
            }
        }


        /// <summary>
        /// Updates an instance of ARCHIVE_TransferPolicy.
        /// </summary>
        /// <param name="aRCHIVE_TransferPolicy">The instance of aRCHIVE_TransferPolicy to persist. </param>
        /// <param name="aRCHIVE_TransferPolicy_Original">The original instance of aRCHIVE_TransferPolicy. </param>
        /// <results>'true' if the instance was updated, otherwise, 'false'. </results>
        [WebMethod]
        public virtual Boolean UpdateARCHIVE_TransferPolicyOriginal(ARCHIVE_TransferPolicy aRCHIVE_TransferPolicy, ARCHIVE_TransferPolicy aRCHIVE_TransferPolicy_Original)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.UpdateARCHIVE_TransferPolicy(aRCHIVE_TransferPolicy, aRCHIVE_TransferPolicy_Original);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.UpdateARCHIVE_TransferPolicyOriginal", e);
                return false;
            }
        }
        /// <summary>
        /// Persists a new instance of ARCHIVE_TransferPolicy to the database.
        /// </summary>
        /// <param name="aRCHIVE_TransferPolicy">The instance of aRCHIVE_TransferPolicy to persist. </param>
        /// <returns name="system_id">return the system_id of ARCHIVETransferPolicy</returns>
        [WebMethod]
        public virtual int InsertARCHIVE_TransferPolicy(ARCHIVE_TransferPolicy aRCHIVE_TransferPolicy)
        {
            try
            {
                int system_id = 0;
                system_id = BusinessLogic.Deposito.ArchiveManager.InsertARCHIVE_TransferPolicy(aRCHIVE_TransferPolicy);
                return system_id;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.InsertARCHIVE_TransferPolicy", e);
                return 0;
            }
        }

        /// <summary>
        /// Persists a new instance, or update an existing istance of ARCHIVE_TransferPolicy to the database, with all profileType associated.
        /// </summary>
        /// <param name="aRCHIVE_TransferPolicy">The instance of aRCHIVE_TransferPolicy to persist. </param>
        /// <param name="isA">true if type of policy is in arrivo</param>
        /// <param name="isP">true if type of policy is in partenza</param>
        /// <param name="isI">true if type of policy is interno</param>
        /// <param name="isNonProt">true if type of policy is non protcollato</param>
        /// <param name="isStRegProt">true if type of policy is stampa registro protocollo</param>
        /// <param name="isStRep">true if type of policy is stampa repertorio</param>
        /// <returns name="system_id">return the system_id of ARCHIVETransferPolicy</returns>
        [WebMethod]
        public virtual int Insert_UpdateARCHIVE_TransferPolicyAndProfileType(ARCHIVE_TransferPolicy aRCHIVE_TransferPolicy, bool isA, bool isP,
                                                        bool isI, bool isNonProt, bool isStRegProt, bool isStRep)
        {
            try
            {
                int system_id = 0;
                system_id = BusinessLogic.Deposito.ArchiveManager.Insert_UpdateARCHIVE_TransferPolicy(aRCHIVE_TransferPolicy, isA, isP,
                                                         isI, isNonProt, isStRegProt, isStRep);
                return system_id;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.InsertARCHIVE_TransferPolicy", e);
                return 0;
            }
        }

        #endregion

        #region ARCHIVE_Profile_TransferPolicy

        /// <summary>
        /// Returns an instance of List<ARCHIVE_Profile_TransferPolicy>.
        /// </summary>
        /// <param name="TransferPolicy_ID">The database automatically generates this value. </param>
        /// <results>Returns a strongly typed list of ARCHIVE_Profile_TransferPolicy. </results>
        [WebMethod]
        public virtual List<ARCHIVE_Profile_TransferPolicy> GetARCHIVE_Profile_TransferPolicyByTransferPolicy_ID(Int32 TransferPolicy_ID)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.GetARCHIVE_Profile_TransferPolicyByTransferPolicy_ID(TransferPolicy_ID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.GetARCHIVE_Profile_TransferPolicyByTransferPolicy_ID", e);
                return null;
            }
        }

        /// <summary>
        /// Returns an instance of List<ARCHIVE_Profile_TransferPolicy>.
        /// </summary>
        /// <param name="TransferPolicyList">The database automatically generates this value. </param>
        /// <results>Returns a strongly typed list of ARCHIVE_Profile_TransferPolicy. </results>
        [WebMethod]
        public virtual List<ARCHIVE_Profile_TransferPolicy> GetARCHIVE_Profile_TransferPolicyByTransferPolicyList(string TransferPolicyList)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.GetARCHIVE_Profile_TransferPolicyByTransferPolicyList(TransferPolicyList);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.GetARCHIVE_Profile_TransferPolicyByTransferPolicyList", e);
                return null;
            }
        }

        /// <summary>
        /// Returns an instance of List<ARCHIVE_Profile_TransferPolicy>.
        /// </summary>
        /// <param name="TransferPolicyList">The database automatically generates this value. </param>
        /// <results>Returns a strongly typed list of ARCHIVE_Profile_TransferPolicy. </results>
        [WebMethod]
        public virtual Boolean UpdateARCHIVE_Profile_TransferPolicyByProfileList(string ProfileList, Int32 TransferID)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.UpdateARCHIVE_Profile_TransferPolicyByProfileList(ProfileList, TransferID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.UpdateARCHIVE_Profile_TransferPolicyByProfileList", e);
                return false;
            }
        }

        #endregion

        #region Archive_Transfer


        /// <summary>
        /// Returns an instance of List<ARCHIVE_Transfer>.
        /// </summary>
        /// <param name="system_ID">The database automatically generates this value. </param>
        /// <results>Returns a strongly typed list of ARCHIVE_Transfer. </results>
        [WebMethod]
        public virtual List<ARCHIVE_Transfer> GetARCHIVE_TransferBySystem_ID(Int32 system_ID)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.GetARCHIVE_TransferBySystem_ID(system_ID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.GetARCHIVE_TransferBySystem_ID", e);
                return null;
            }
        }
        /// <summary>
        /// Returns all instances of ARCHIVE_Transfer.
        /// </summary>
        /// <results>Returns a strongly typed list of ARCHIVE_Transfer. </results>
        [WebMethod]
        public virtual List<ARCHIVE_Transfer> GetAllARCHIVE_Transfer()
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.GetAllARCHIVE_Transfer();
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.GetAllARCHIVE_Transfer", e);
                return null;
            }
        }
        /// <summary>
        /// Deletes an instance of ARCHIVE_Transfer based on System_ID.
        /// </summary>
        /// <param name="system_ID">The database automatically generates this value. </param>
        /// <results>'true' if the instance was deleted, otherwise, 'false'. </results>
        [WebMethod]
        public virtual Boolean DeleteARCHIVE_Transfer(Int32 system_ID)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.DeleteARCHIVE_Transfer(system_ID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.DeleteARCHIVE_Transfer", e);
                return false;
            }
        }
        /// <summary>
        /// Updates an instance of ARCHIVE_Transfer.
        /// </summary>
        /// <param name="note">This is not a required field. </param>
        /// <param name="system_ID">The database automatically generates this value. </param>
        /// <results>'true' if the instance was updated, otherwise, 'false'. </results>
        [WebMethod]
        public virtual Boolean UpdateARCHIVE_Transfer(String description, String note, Int32 system_ID, Int32 iD_Amministrazione)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.UpdateARCHIVE_Transfer(description, note, system_ID, iD_Amministrazione);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.UpdateARCHIVE_Transfer", e);
                return false;
            }
        }
        /// <summary>
        /// Updates an instance of ARCHIVE_Transfer if the original data has not changed.
        /// </summary>
        /// <param name="description_Original">This field is used for optimistic concurrency management. It should contain the original value of 'description_Original'. </param>
        /// <param name="note">This is not a required field. </param>
        /// <param name="note_Original">This field is used for optimistic concurrency management. It should contain the original value of 'note_Original'. This is not a required field. </param>
        /// <param name="system_ID">The database automatically generates this value. </param>
        /// <results>'true' if the instance was updated, otherwise, 'false'. </results>
        [WebMethod]
        public virtual Boolean UpdateARCHIVE_TransferOriginal(String description, String description_Original, String note,
                                                                String note_Original, Int32 system_ID, Int32 id_Amministrazione, Int32 id_Amministrazione_Original)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.UpdateARCHIVE_TransferOriginal(description, description_Original, note, note_Original,
                                                                                            id_Amministrazione, id_Amministrazione_Original, system_ID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.UpdateARCHIVE_Transfer", e);
                return false;
            }
        }
        /// <summary>
        /// Persists a new instance of ARCHIVE_Transfer to the database.
        /// </summary>
        /// <param name="note">This is not a required field. </param>
        /// <param name="system_ID">Returns the value of system_ID. The database automatically generates this value. </param>
        [WebMethod]
        public virtual void InsertARCHIVE_Transfer(String description, String note, ref Int32 system_ID, Int32 iD_Amministrazione, Int32 transferStateType_ID)
        {
            try
            {
                BusinessLogic.Deposito.ArchiveManager.InsertARCHIVE_Transfer(description, note, ref system_ID, iD_Amministrazione, transferStateType_ID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.InsertARCHIVE_TransferState", e);
            }
        }

        #endregion

        #region Archive_Transfer_state
        /// <summary>
        /// Returns all instances of ARCHIVE_TransferState.
        /// </summary>
        /// <results>Returns a strongly typed list of ARCHIVE_TransferState. </results>
        [WebMethod]
        public virtual List<DocsPaVO.Deposito.ARCHIVE_TransferState> GetAllARCHIVE_TransferState()
        {
            try
            {

                return BusinessLogic.Deposito.ArchiveManager.GetAllARCHIVE_TransferState();
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.GetAll", e);
                return null;
            }
        }
        /// <summary>
        /// Returns an instance of List<ARCHIVE_TransferState>.
        /// </summary>
        /// <param name="system_ID">The database automatically generates this value. </param>
        /// <results>Returns a strongly typed list of ARCHIVE_TransferState. </results>
        [WebMethod]
        public virtual List<DocsPaVO.Deposito.ARCHIVE_TransferState> GetARCHIVE_TransferStateBySystem_ID(Int32 System_ID)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.GetARCHIVE_TransferStateBySystem_ID(System_ID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.GetARCHIVE_TransferStateBySystem_ID", e);
                return null;
            }
        }
        /// <summary>
        /// Relates ARCHIVE_Transfer to ARCHIVE_TransferState.
        /// Returns a collection of ARCHIVE_TransferState based on the following criteria: Transfer_ID.
        /// </summary>
        /// <results>Returns a strongly typed list of ARCHIVE_TransferState. </results>
        [WebMethod]
        public virtual List<DocsPaVO.Deposito.ARCHIVE_TransferState> GetARCHIVE_TransferStateByTransfer_ID(Int32 Transfer_ID)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.GetARCHIVE_TransferStateByTransfer_ID(Transfer_ID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.GetARCHIVE_TransferStateByTransfer_ID", e);
                return null;
            }
        }
        /// <summary>
        /// Returns a collection of ARCHIVE_TransferState based on the following criteria: TransferStateType_ID.
        /// </summary>
        /// <results>Returns a strongly typed list of ARCHIVE_TransferState. </results>
        [WebMethod]
        public virtual List<DocsPaVO.Deposito.ARCHIVE_TransferState> GetARCHIVE_TransferStateByTransferStateType_ID(Int32 transferStateType_ID)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.GetARCHIVE_TransferStateByTransferStateType_ID(transferStateType_ID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.GetARCHIVE_TransferStateByTransferStateType_ID", e);
                return null;
            }
        }
        /// <summary>
        /// Deletes an instance of ARCHIVE_TransferState based on System_ID.
        /// </summary>
        /// <param name="system_ID">The database automatically generates this value. </param>
        /// <results>'true' if the instance was deleted, otherwise, 'false'. </results>
        [WebMethod]
        public virtual Boolean DeleteARCHIVE_TransferState(Int32 system_ID)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.DeleteARCHIVE_TransferState(system_ID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.DeleteARCHIVE_TransferState", e);
                return false;
            }
        }
        /// <summary>
        /// Deletes an instance of ARCHIVE_TransferState based on Transfer_ID.
        /// </summary>
        /// <results>'true' if the instance was deleted, otherwise, 'false'. </results>
        [WebMethod]
        public virtual Boolean DeleteARCHIVE_TransferStateByTransfer_ID(Int32 transfer_ID)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.DeleteARCHIVE_TransferStateByTransfer_ID(transfer_ID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.DeleteARCHIVE_TransferStateByTransfer_ID", e);
                return false;
            }
        }
        /// <summary>
        /// Updates an instance of ARCHIVE_TransferState.
        /// </summary>
        /// <param name="system_ID">The database automatically generates this value. </param>
        /// <results>'true' if the instance was updated, otherwise, 'false'. </results>
        [WebMethod]
        public virtual Boolean UpdateARCHIVE_TransferState(Int32 transfer_ID, Int32 transferStateType_ID, Int32 system_ID)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.UpdateARCHIVE_TransferState(transfer_ID, transferStateType_ID, system_ID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.DeleteARCHIVE_TransferStateByTransfer_ID", e);
                return false;
            }
        }
        /// <summary>
        /// Updates an instance of ARCHIVE_TransferState if the original data has not changed.
        /// </summary>
        /// <param name="transfer_ID_Original">This field is used for optimistic concurrency management. It should contain the original value of 'transfer_ID_Original'. </param>
        /// <param name="transferStateType_ID_Original">This field is used for optimistic concurrency management. It should contain the original value of 'transferStateType_ID_Original'. </param>
        /// <param name="dateTime_Original">This field is used for optimistic concurrency management. It should contain the original value of 'dateTime_Original'. </param>
        /// <param name="system_ID">The database automatically generates this value. </param>
        /// <results>'true' if the instance was updated, otherwise, 'false'. </results>
        [WebMethod]
        public virtual Boolean UpdateARCHIVE_TransferStateOriginal(Int32 transfer_ID, Int32 transfer_ID_Original, Int32 transferStateType_ID, Int32 transferStateType_ID_Original, Int32 system_ID)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.UpdateARCHIVE_TransferState(transfer_ID, transfer_ID_Original, transferStateType_ID, transferStateType_ID_Original, system_ID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.sp_ARCHIVE_Update_TransferState", e);
                return false;
            }
        }
        /// <summary>
        /// Persists a new instance of ARCHIVE_TransferState to the database.
        /// </summary>
        /// <param name="system_ID">Returns the value of system_ID. The database automatically generates this value. </param>
        [WebMethod]
        public virtual void InsertARCHIVE_TransferState(Int32 transfer_ID, Int32 transferStateType_ID, ref Int32 system_ID)
        {
            try
            {
                BusinessLogic.Deposito.ArchiveManager.InsertARCHIVE_TransferState(transfer_ID, transferStateType_ID, ref system_ID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.InsertARCHIVE_TransferState", e);
            }
        }


        #endregion

        #region ARCHIVE_TransferPolicy_ProfileType

        /// <summary>
        /// Deletes an instance of ARCHIVE_TransferPolicy_ProfileType based on TransferPolicy_ID and ProfileType.
        /// </summary>
        /// <param name="TransferPolicy_ID"> </param>
        /// <param name="ProfileType"></param>
        /// <results>'true' if the instance was deleted, otherwise, 'false'. </results>
        [WebMethod]
        public virtual Boolean DeleteARCHIVE_TransferPolicy_ProfileType(Int32 TransferPolicy_ID, Int32 ProfileType)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.DeleteARCHIVE_TransferPolicy_ProfileType(TransferPolicy_ID, ProfileType);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.DeleteARCHIVE_TransferPolicy_ProfileType", e);
                return false;
            }
        }

        /// <summary>
        /// Deletes an instance of ARCHIVE_TransferPolicy_ProfileType based on TransferPolicy_ID and ProfileType.
        /// </summary>
        /// <param name="TransferPolicy_ID"> </param>
        /// <param name="ProfileType"></param>
        /// <results>'true' if the instance was deleted, otherwise, 'false'. </results>
        [WebMethod]
        public virtual Boolean InsertARCHIVE_TransferPolicy_ProfileType(Int32 TransferPolicy_ID, Int32 ProfileType)
        {
            try
            {
                Boolean result;
                result = BusinessLogic.Deposito.ArchiveManager.InsertARCHIVE_TransferPolicy_ProfileType(TransferPolicy_ID, ProfileType);
                return result;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.InsertARCHIVE_TransferPolicy_ProfileType", e);
                return false;
            }
        }

        /// <summary>
        /// Returns an instance of List<ARCHIVE_TransferPolicy_ProfileType>.
        /// </summary>
        /// <param name="system_ID">The database automatically generates this value. </param>
        /// <results>Returns a strongly typed list of ARCHIVE_TransferPolicy_ProfileType. </results>
        [WebMethod]
        public virtual List<DocsPaVO.Deposito.ARCHIVE_TransferPolicy_ProfileType> GetARCHIVE_TransferPolicy_ProfileTypeByTransferPolicy_ID(Int32 TransferPolicy_ID)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.GetARCHIVE_TransferPolicy_ProfileTypeByTransferPolicyID(TransferPolicy_ID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.GetARCHIVE_TransferPolicy_ProfileTypeBySystem_ID", e);
                return null;
            }
        }

        #endregion

        #region ARCHIVE_TransferStateType

        /// <summary>
        /// Returns all instances of ARCHIVE_TransferStateType.
        /// </summary>
        /// <results>Returns a strongly typed list of ARCHIVE_TransferStateType. </results>
        [WebMethod]
        public virtual List<ARCHIVE_TransferStateType> GetAllARCHIVE_TransferStateType()
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.GetAllARCHIVE_TransferStateType();
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.GetAllARCHIVE_TransferStateType", e);
                return null;
            }
        }
        /// <summary>
        /// Returns an instance of List<ARCHIVE_TransferStateType>.
        /// </summary>
        /// <results>Returns a strongly typed list of ARCHIVE_TransferStateType. </results>
        [WebMethod]
        public virtual List<ARCHIVE_TransferStateType> GetARCHIVE_TransferStateTypeBySystem_ID(Int32 system_ID)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.GetARCHIVE_TransferStateTypeBySystem_ID(system_ID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.GetARCHIVE_TransferStateTypeBySystem_ID", e);
                return null;
            }
        }
        /// <summary>
        /// Deletes an instance of ARCHIVE_TransferStateType based on System_ID.
        /// </summary>
        /// <results>'true' if the instance was deleted, otherwise, 'false'. </results>
        [WebMethod]
        public virtual Boolean DeleteARCHIVE_TransferStateType(Int32 system_ID)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.DeleteARCHIVE_TransferStateType(system_ID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.DeleteARCHIVE_TransferStateType", e);
                return false;

            }
        }
        /// <summary>
        /// Deletes all instances of ARCHIVE_TransferStateType.
        /// </summary>
        /// <results>The number of items deleted. </results>
        [WebMethod]
        public virtual Int32 DeleteAllARCHIVE_TransferStateType()
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.DeleteAllARCHIVE_TransferStateType();
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.DeleteAllARCHIVE_TransferStateType", e);
                return -1;

            }
        }
        /// <summary>
        /// Updates an instance of ARCHIVE_TransferStateType.
        /// </summary>
        /// <results>'true' if the instance was updated, otherwise, 'false'. </results>
        [WebMethod]
        public virtual Boolean UpdateARCHIVE_TransferStateType(String name, Int32 system_ID)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.UpdateARCHIVE_TransferStateType(name, system_ID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.UpdateARCHIVE_TransferStateType", e);
                return false;

            }
        }
        /// <summary>
        /// Updates an instance of ARCHIVE_TransferStateType if the original data has not changed.
        /// </summary>
        /// <param name="name_Original">This field is used for optimistic concurrency management. It should contain the original value of 'name_Original'. </param>
        /// <results>'true' if the instance was updated, otherwise, 'false'. </results>
        [WebMethod]
        public virtual Boolean UpdateARCHIVE_TransferStateTypeOriginal(String name, String name_Original, Int32 system_ID)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.UpdateARCHIVE_TransferStateType(name, name_Original, system_ID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.UpdateARCHIVE_TransferStateType", e);
                return false;

            }
        }
        /// <summary>
        /// Persists a new instance of ARCHIVE_TransferStateType to the database.
        /// </summary>
        [WebMethod]
        public virtual Boolean InsertARCHIVE_TransferStateType(Int32 system_ID, String name)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.InsertARCHIVE_TransferStateType(system_ID, name);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.InsertARCHIVE_TransferStateType", e);
                return false;

            }
        }


        #endregion

        #region ARCHIVE_View_Documents_Policy

        /// <summary>
        /// Returns an instance of List<ARCHIVE_View_Documents_Policy>.
        /// </summary>
        /// <param name="system_ID">The database automatically generates this value. </param>
        /// <results>Returns a strongly typed list of ARCHIVE_View_Documents_Policy. </results>
        [WebMethod]
        public virtual List<ARCHIVE_View_Documents_Policy> GetAllARCHIVE_View_Documents_Policy(String transferPolicyList)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.GetAllARCHIVE_View_Documents_Policy(transferPolicyList);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.GetAllARCHIVE_View_Documents_Policy", e);
                return null;
            }
        }

        #endregion

        #region ARCHIVE_View_Projects_Policy

        /// <summary>
        /// Returns an instance of List<ARCHIVE_View_Projects_Policy>.
        /// </summary>
        /// <param name="system_ID">The database automatically generates this value. </param>
        /// <results>Returns a strongly typed list of ARCHIVE_View_Projects_Policy. </results>
        [WebMethod]
        public virtual List<ARCHIVE_View_Projects_Policy> GetAllARCHIVE_View_Projects_Policy(String transferPolicyList)
        {

            try
            {
                return BusinessLogic.Deposito.ArchiveManager.GetAllARCHIVE_View_Projects_Policy(transferPolicyList);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.GetAllARCHIVE_View_Projects_Policy", e);
                return null;
            }
        }

        #endregion

        #region ARCHIVE_View_Policy

        /// <summary>
        /// Returns an instance of List<ARCHIVE_View_Projects_Policy>.
        /// </summary>
        /// <param name="system_ID">The database automatically generates this value. </param>
        /// <results>Returns a strongly typed list of ARCHIVE_View_Projects_Policy. </results>
        [WebMethod]
        public virtual List<ARCHIVE_View_Policy> GetAllARCHIVE_View_Policy(Int32 transferID)
        {

            try
            {
                return BusinessLogic.Deposito.ArchiveManager.GetAllARCHIVE_View_Policy(transferID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.GetAllARCHIVE_View_Policy", e);
                return null;
            }
        }

        /// <summary>
        /// Returns an instance of List<ARCHIVE_Result_Transfer>.
        /// </summary>
        /// <param name="system_ID">The database automatically generates this value. </param>
        /// <results>Returns a strongly typed list of ARCHIVE_Result_Transfer. </results>
        [WebMethod]
        public virtual List<ARCHIVE_Result_Transfer> GetAllARCHIVE_Result_Transfer(String transferList)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.GetAllARCHIVE_Result_Transfer(transferList);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.GetAllARCHIVE_Result_Transfer", e);
                return null;
            }
        }

        #endregion

        #region ARCHIVE_View_FascDocReport/Dispose

        /// <summary>
        /// Returns an instance of List<ARCHIVE_View_FascReport>.
        /// </summary>
        /// <param name="transferPolicy_ID">The database automatically generates this value. </param>
        /// <results>Returns a strongly typed list of ARCHIVE_View_FascReport. </results>
        [WebMethod]
        public virtual List<ARCHIVE_View_FascReport> GetARCHIVE_View_FascReportByTransfer_ID(Int32 transfer_ID)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.GetARCHIVE_View_FascReportByTransfer_ID(transfer_ID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.GetARCHIVE_View_FascReportByTransfer_ID", e);
                return null;
            }
        }

        /// <summary>
        /// Returns an instance of List<ARCHIVE_View_DocReport>.
        /// </summary>
        /// <param name="transferPolicy_ID">The database automatically generates this value. </param>
        /// <results>Returns a strongly typed list of ARCHIVE_View_DocReport. </results>
        [WebMethod]
        public virtual List<ARCHIVE_View_DocReport> GetARCHIVE_View_DocReportByTransfer_ID(Int32 transfer_ID)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.GetARCHIVE_View_DocReportByTransfer_ID(transfer_ID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.GetARCHIVE_View_DocReportByTransfer_ID", e);
                return null;
            }
        }

        /// <summary>
        /// Returns an instance of List<ARCHIVE_View_FascReportDisposal>.
        /// </summary>
        /// <param name="transferPolicy_ID">The database automatically generates this value. </param>
        /// <results>Returns a strongly typed list of ARCHIVE_View_FascReportDisposal. </results>
        [WebMethod]
        public virtual List<ARCHIVE_View_FascReportDisposal> GetARCHIVE_View_FascReportByDisposal_ID(Int32 Disposal_ID)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.GetARCHIVE_View_FascReportByDisposal_ID(Disposal_ID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.GetARCHIVE_View_FascReportByDisposal_ID", e);
                return null;
            }
        }

        /// <summary>
        /// Returns an instance of List<ARCHIVE_View_DocReportDisposal>.
        /// </summary>
        /// <param name="transferPolicy_ID">The database automatically generates this value. </param>
        /// <results>Returns a strongly typed list of ARCHIVE_View_DocReportDisposal. </results>
        [WebMethod]
        public virtual List<ARCHIVE_View_DocReportDisposal> GetARCHIVE_View_DocReportByDisposal_ID(Int32 Disposal_ID)
        {
            try
            {
                return BusinessLogic.Deposito.ArchiveManager.GetARCHIVE_View_DocReportByDisposal_ID(Disposal_ID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Deposito.ArchiveManager.GetARCHIVE_View_DocReportByDisposal_ID", e);
                return null;
            }
        }




        #endregion


        #endregion

        #region Diagnostics
        /// <summary>
        /// Controllo della connessione al database
        /// </summary>
        [WebMethod]
        public bool CheckDatabaseConnection(out string exceptionMessage)
        {
            bool result = true; // Presume successo
            exceptionMessage = null;

            try
            {
                BusinessLogic.Diagnostics.Database database = new BusinessLogic.Diagnostics.Database();
                result = database.CheckConnectionString(out exceptionMessage);

                if (result)
                {
                    result = database.CheckConnectionOpening(out exceptionMessage);
                }
            }
            catch (Exception)
            {
                result = false;
            }

            return result;
        }

        /// <summary>
        /// Controllo della connessione alla tabella DPA_Amministra
        /// </summary>
        [WebMethod]
        public bool CheckDPA_Amministra(out string exceptionMessage)
        {
            bool result = true; // Presume successo
            exceptionMessage = null;

            try
            {
                BusinessLogic.Diagnostics.Database database = new BusinessLogic.Diagnostics.Database();
                result = database.CheckDPA_Amministra(out exceptionMessage);
            }
            catch (Exception)
            {
                result = false;
            }

            return result;
        }
        #endregion

        #region Component Designer generated code

        //Required by the Web Services Designer 
        private IContainer components = null;

        /// <summary>
        /// Required method for Designer support - do not modify
        /// the contents of this method with the code editor.
        /// </summary>
        private void InitializeComponent()
        {
        }

        /// <summary>
        /// Clean up any resources being used.
        /// </summary>
        protected override void Dispose(bool disposing)
        {
            if (disposing && components != null)
            {
                components.Dispose();
            }
            base.Dispose(disposing);
        }

        #endregion

        #region Funzioni generali
        /// <summary>
        /// 		/// 
        /// </summary>
        /// <returns></returns>
        [WebMethod]
        public bool IsInternalProtocolEnabled(string idAmm)
        {
            //return BusinessLogic.Application.ProtocollazioneInterna.Enabled;

#if TRACE_WS
			DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
            return BusinessLogic.Documenti.ProtoManager.IsProtoIntEnabled(idAmm);
#if TRACE_WS
			pt.WriteLogTracer("IsInternalProtocolEnabled");
#endif

        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual DocsPaVO.utente.Utente SimpleLogin(string login)
        {
            DocsPaVO.utente.Utente utente = null;

            DocsPaVO.utente.UserLogin.LoginResult loginResult;

            try
            {
                string sessionID = Guid.NewGuid().ToString("N");

                DocsPaVO.utente.UserLogin userLogin = new DocsPaVO.utente.UserLogin();
                userLogin.AcquireData(login);

                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                string ipaddress = "";

                utente = BusinessLogic.Utenti.Login.loginMethod(userLogin, out loginResult, true,
                                                                sessionID, out ipaddress);

                if (utente != null)
                {
                    BusinessLogic.UserLog.UserLog.WriteLog(
                                            utente.userId,
                                            utente.idPeople,
                                            utente.idAmministrazione,
                                            ((DocsPaVO.utente.Corrispondente)(utente)).idAmministrazione,
                                            "LOGIN",
                                            utente.systemId,
                                            utente.systemId,
                                            DocsPaVO.Logger.CodAzione.Esito.OK, null);
                }

#if TRACE_WS
				pt.WriteLogTracer("Login");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore durante la Login.", e);

                loginResult = DocsPaVO.utente.UserLogin.LoginResult.APPLICATION_ERROR;

                if (utente != null)
                    BusinessLogic.UserLog.UserLog.WriteLog(
                            null,
                            utente.idPeople,
                            null,
                            null,
                            "LOGIN",
                            null,
                            utente.systemId,
                            DocsPaVO.Logger.CodAzione.Esito.KO, null);

                utente = null;
            }

            return utente;
        }

        /// <summary>
        /// </summary>
        [WebMethod(MessageName = "LoginUtente")]
        public virtual DocsPaVO.utente.UserLogin.LoginResult Login(DocsPaVO.utente.UserLogin login,
            out DocsPaVO.utente.Utente utente, bool forced, string webSessionId, out string ipAddress)
        {
            SetUserId(login.UserName);
            utente = null;
            ipAddress = "";
            DocsPaVO.utente.UserLogin.LoginResult loginResult = DocsPaVO.utente.UserLogin.LoginResult.OK;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                utente = BusinessLogic.Utenti.Login.loginMethod(login, out loginResult, forced,
                    webSessionId, out ipAddress);

#if TRACE_WS
				pt.WriteLogTracer("Login");
#endif
                //Celeste								
                if (utente != null)
                {
                    BusinessLogic.UserLog.UserLog.WriteLog(utente.userId, utente.idPeople, login.IdAmministrazione, ((DocsPaVO.utente.Corrispondente)(utente)).idAmministrazione, "LOGIN", utente.systemId, utente.systemId, DocsPaVO.Logger.CodAzione.Esito.OK, null);
                    // implemento il metodo per la scrittura nella apposita tabella DPA_UA_INFO dei dati relativi al browser utente


                    if (login.BrowserInfo != null)
                        BusinessLogic.Utenti.Login.AddBrowserInfo(login, utente.idPeople);
                }
                //Fine Celeste
            }
            catch (Exception e)
            {
                logger.Debug("Errore durante la Login.", e);
                loginResult = DocsPaVO.utente.UserLogin.LoginResult.APPLICATION_ERROR;
                //Celeste
                if (utente != null)
                    utente = new Utente();
                utente.idPeople = "0"; utente.systemId = "1";
                BusinessLogic.UserLog.UserLog.WriteLog(null, utente.idPeople, null, null, "LOGIN", null, utente.systemId, DocsPaVO.Logger.CodAzione.Esito.KO, null);
                //Fine Celeste
                utente = null;
            }

            return loginResult;
        }

        [WebMethod()]
        public bool copyFileInCache(byte[] stream, DocsPaVO.documento.FileRequest fileRequest, DocsPaVO.utente.InfoUtente infoUtente)
        {
            SetUserId(infoUtente);
            return BusinessLogic.Documenti.CacheFileManager.copyFileInCacheConLimite(stream, fileRequest, infoUtente);
        }
        /// <summary>
        /// Validazione della sessione web
        /// </summary>
        [WebMethod]
        public virtual DocsPaVO.utente.UserLogin.ValidationResult ValidateLogin(string userID, string idAmm, string webSessionId)
        {
            SetUserId(userID);
            DocsPaVO.utente.UserLogin.ValidationResult result = DocsPaVO.utente.UserLogin.ValidationResult.APPLICATION_ERROR;

            try
            {
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif

                result = BusinessLogic.Utenti.Login.ValidateLogin(userID, idAmm, webSessionId);

#if TRACE_WS
				pt.WriteLogTracer("Login");
#endif
            }
            catch (Exception exception)
            {
                logger.Debug("Errore durante la validazione della sessione.", exception);
                result = DocsPaVO.utente.UserLogin.ValidationResult.APPLICATION_ERROR;
            }

            return result;
        }

        /// <summary>
        /// Disconnette l'utente attualmente connesso in DocsPa 3.0
        /// </summary>
        /// 		/// <remarks>
        /// Metodi per l'autenticazione e la disconnessione
        /// </remarks>
        /// <param name="idAmm">
        /// Identificativo univoco dell'amministrazione di appartenenza dell'utente connesso
        /// </param>
        /// <param name="userId">
        /// Identificativo alfabetico dell'utente connesso
        /// </param>
        /// <returns>
        /// Valore booleano: true se il logoff si  concluso correttamente, false se  avvenuto un errore
        /// </returns>
        /// <exception cref=">System.Exception">
        /// Eccezione generica sollevata in caso di qualsiasi errore
        /// </exception>
        /// <example>
        /// <code>
        /// hello world
        /// </code>
        /// </example>
        [WebMethod(MessageName = "LogoffUtente")]
        public virtual bool Logoff(string userId, string idAmm, string sessionId, string dst)
        {
            SetUserId(userId);
            bool result = true; // Presume successo

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                BusinessLogic.Utenti.Login.logoff(userId, idAmm, sessionId, dst);
#if TRACE_WS
				pt.WriteLogTracer("Logoff");
#endif
                BusinessLogic.UserLog.UserLog.WriteLog(userId, null, null, idAmm, "LOGOFF", null, null, DocsPaVO.Logger.CodAzione.Esito.OK, null);
            }
            catch (Exception e)
            {
                logger.Debug("Errore durante il Logoff.", e);
                result = false;
                BusinessLogic.UserLog.UserLog.WriteLog(userId, null, null, idAmm, null, sessionId, null, DocsPaVO.Logger.CodAzione.Esito.KO, null);
            }

            return result;
        }

        [WebMethod(MessageName = "logoff")]
        public virtual bool LogoffRDE(DocsPaVO.utente.InfoUtente infoUtente)
        {
            SetUserId(infoUtente);
            bool result = false;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                BusinessLogic.Utenti.Login.logoff_RDE(infoUtente.userId, "");
#if TRACE_WS
				pt.WriteLogTracer("Logoff");
#endif
                //Celeste
                //BusinessLogic.UserLog.UserLog.WriteLog(infoUtente.userId,null,null,null,"LOGOFF",null,null, DocsPaVO.Logger.CodAzione.Esito.OK);
                //Fine Celeste			
                result = true;
            }
            catch (Exception e)
            {
                logger.Debug("Errore durante il Logoff.", e);
                result = false;
                //Celeste 
                //BusinessLogic.UserLog.UserLog.WriteLog(infoUtente.userId,null,null,infoUtente.idAmministrazione,null,"", infoUtente.userId, DocsPaVO.Logger.CodAzione.Esito.KO);
                //Fine Celeste
            }

            return result;
        }

        [WebMethod]
        public virtual bool DisconnettiUtente(string userId, string codiceAmm)
        {
            bool result = true; // Presume successo

            try
            {
                BusinessLogic.Utenti.Login.disconnettiUtente(userId, codiceAmm);
            }
            catch (Exception e)
            {
                logger.Debug("Errore durante la disconnessione dell'utente.", e);
                result = false;
            }

            return result;
        }

        [WebMethod]
        public virtual int NumUtentiAttivi(string codiceAmm)
        {
            int result = 0;

            try
            {
                result = BusinessLogic.Utenti.Login.NumUtentiAttivi(codiceAmm);
            }
            catch (Exception e)
            {
                logger.Debug("Errore durante la lettura del numero di utenti connessi.", e);
                result = 0;
            }
            return result;
        }

        [WebMethod]
        public virtual int NumUtentiConnessi(string codiceAmm)
        {
            int result = 0;

            try
            {
                result = BusinessLogic.Utenti.Login.NumUtentiConnessi(codiceAmm);
            }
            catch (Exception e)
            {
                logger.Debug("Errore durante la lettura del numero di utenti connessi.", e);
                result = 0;
            }
            return result;
        }


        [WebMethod]
        public virtual string ElencoUtentiConnessi(string codiceAmm)
        {
            string result = null;

            try
            {
                result = BusinessLogic.Utenti.Login.ElencoUtentiConnessi(codiceAmm);
            }
            catch (Exception e)
            {
                logger.Debug("Errore durante la lettura degli utenti connessi.", e);
                result = null;
            }

            return result;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual DocsPaVO.utente.Registro RegistriCambiaStato(DocsPaVO.utente.InfoUtente infoutente, DocsPaVO.utente.Registro registro)
        {
            SetUserId(infoutente);
            DocsPaVO.utente.Registro result = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Utenti.RegistriManager.cambiaStato(infoutente.idPeople, infoutente.idCorrGlobali, registro);
#if TRACE_WS
				pt.WriteLogTracer("RegistriCambiaStato");
#endif
                //Celeste
                if (result != null)
                    BusinessLogic.UserLog.UserLog.WriteLog(infoutente, "REGISTRICAMBIASTATO", registro.systemId, string.Format("{0} {1} - {2} {3}  {4} {5}", "Cod. Registro", result.codice, "Stato", result.stato, "Registro", result.codRegistro), DocsPaVO.Logger.CodAzione.Esito.OK);
                //Fine Celeste
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: RegistriCambiaStato", e);

                result = null;
                //Celeste
                BusinessLogic.UserLog.UserLog.WriteLog(infoutente, "REGISTRICAMBIASTATO", registro.systemId, string.Format("{0} {1} - {2} {3}  {4} {5}", "Cod. Registro", result.codice, "Stato", result.stato, "Registro", result.codRegistro), DocsPaVO.Logger.CodAzione.Esito.KO);
                //Fine Celeste
            }

            return result;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual DocsPaVO.utente.Registro RegistriModifica(DocsPaVO.utente.Registro registro, DocsPaVO.utente.InfoUtente infoUtente)
        {
            SetUserId(infoUtente);
            DocsPaVO.utente.Registro result = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Utenti.RegistriManager.modificaRegistro(registro, infoUtente);

#if TRACE_WS
				pt.WriteLogTracer("RegistriModifica");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: RegistriModifica", e);

                result = null;
            }

            return result;
        }


        /// <summary>
        /// </summary>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.utente.Registro))]
        public virtual ArrayList UtenteGetRegistri(string idCorrGlobali)
        {
            ArrayList result = null;
            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Utenti.RegistriManager.getRegistri(idCorrGlobali);
#if TRACE_WS
				pt.WriteLogTracer("UtenteGetRegistri");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: UtenteGetRegistri", e);

                result = null;
            }
            return result;
        }

        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.utente.Registro))]
        public virtual ArrayList UtenteGetRegistriNoFiltroAOO(string idAmm, out bool filtroAOO)
        {
            filtroAOO = false;
            ArrayList result = null;
            try
            {
                if (System.Configuration.ConfigurationManager.AppSettings["NO_FILTRO_AOO"] != null && System.Configuration.ConfigurationManager.AppSettings["NO_FILTRO_AOO"] == "1")
                {
                    filtroAOO = true;
                    result = BusinessLogic.Utenti.RegistriManager.getRegistriNoFiltroAOO(idAmm);
                }
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: UtenteGetRegistriNoFiltroAOO", e);
                result = null;
            }
            return result;
        }

        /* ABBATANGELI GIANLUIGI - INIZIO
         * servizi che gestiscono Applicazioni esterne */
        /// <summary>
        /// </summary>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.utente.ExtApplication))]
        public virtual ArrayList GetExtApplications()
        {
            ArrayList result = null;
            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = DocsPaDB.Query_DocsPAWS.GestioneApplicazioni.GetExtApplications();
#if TRACE_WS
				pt.WriteLogTracer("GetApplicazioni");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetExtApplications", e);

                result = null;
            }
            return result;
        }

        /// <summary>
        /// Elimino dall'utente l'applicazione
        /// </summary>
        /// <param name="tipoRuolo"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.Validations.ValidationResultInfo ExtAppDeleteUte(string idApplicazione, string idUtente)
        {

            ValidationResultInfo retValue = new DocsPaVO.Validations.ValidationResultInfo { Value = false };

            try
            {
                if (DocsPaDB.Query_DocsPAWS.GestioneApplicazioni.DeleteRelExtApp_Ute(idApplicazione, idUtente))
                {
                    retValue.Value = true;
                }

            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmUpdateTipoRuolo", e);
                retValue.BrokenRules.Add(new DocsPaVO.Validations.BrokenRule { Level = DocsPaVO.Validations.BrokenRule.BrokenRuleLevelEnum.Error, Description = e.Message });
            }

            return retValue;
        }

        /// <summary>
        /// Aggiunge una applicazione all'utente
        /// </summary>
        /// <param name="tipoRuolo"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.Validations.ValidationResultInfo ExtAppAddUte(string idApplicazione, string idUtente)
        {

            ValidationResultInfo retValue = new DocsPaVO.Validations.ValidationResultInfo { Value = false };

            try
            {
                if (DocsPaDB.Query_DocsPAWS.GestioneApplicazioni.CreateRelExtApp_Ute(idApplicazione, idUtente))
                {
                    retValue.Value = true;
                }

            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmUpdateTipoRuolo", e);
                retValue.BrokenRules.Add(new DocsPaVO.Validations.BrokenRule { Level = DocsPaVO.Validations.BrokenRule.BrokenRuleLevelEnum.Error, Description = e.Message });
            }

            return retValue;
        }

        /* ABBATANGELI GIANLUIGI - FINE */

        //        /// <summary>
        //        /// </summary>
        //        [WebMethod]
        //        public virtual bool UtenteChangePassword(string newPassword, DocsPaVO.utente.Utente utente) 
        //        {
        //            bool result = false; 

        //            try 
        //            {
        //                //gestione tracer
        //#if TRACE_WS
        //                DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
        //#endif
        //                result = BusinessLogic.Utenti.Login.cambiaPassword(newPassword, utente);
        //#if TRACE_WS
        //                pt.WriteLogTracer("UtenteChangePassword");
        //#endif
        //            } 
        //            catch(Exception e) 
        //            {
        //                logger.Debug("Errore in DocsPaWS.asmx - metodo: UtenteChangePassword",e);
        //            }

        //            return result;
        //        }	

        #endregion

        #region Documenti
        #region DO_GetConnectionString
        [WebMethod]
        public virtual string doucmentoGetDocType()
        {
            string doc_type = "";
            try
            {
                doc_type = System.Configuration.ConfigurationManager.AppSettings["DOC_TYPE"];
                if (!(doc_type != null && !doc_type.Equals("")))
                {
                    doc_type = "LETTERA"; //default
                }
                return doc_type;
            }
            catch (Exception ex)
            {
                logger.Debug("Errore nel recupero della doc_type - metodo: doucmentoGetDocType", ex);
                return doc_type;
            }
        }
        #endregion

        [WebMethod]
        public string getAccessRightDocBySystemID(string idprofile, DocsPaVO.utente.InfoUtente infoUtente)
        {
            SetUserId(infoUtente);
            try
            {
                return BusinessLogic.Documenti.DocManager.getAccessRightDocBySystemID(idprofile, infoUtente);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getAccessRightFascBySystemID", e);
                return null;
            }
        }


        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.ExternalServices.FornitoreFattAttiva))]
        public ArrayList FattElAttiveGetFornitori(DocsPaVO.utente.InfoUtente infoUtente)
        {
            ArrayList result = null;

            try
            {
                result = BusinessLogic.Amministrazione.SistemiEsterni.FattElAttiveGetFornitori(infoUtente.idAmministrazione);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FattElAttiveGetFornitori", e);
                result = null;
            }
            return result;
        }


        [WebMethod]
        public string DocumentoGetTipoProto(string docNumber)
        {
            string result = null;
            try
            {
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                BusinessLogic.Documenti.DocManager dm = new BusinessLogic.Documenti.DocManager();
                result = dm.documentoGetTipoProto(docNumber);
#if TRACE_WS
				pt.WriteLogTracer("DocumentoGetTipoProto");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoGetTipoProto", e);
            }
            return result;
        }


        /// <summary>
        /// </summary>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.documento.InfoDocumento))]
        public virtual ArrayList DocumentoGetQueryDocumento(string idGruppo, string idPeople, DocsPaVO.filtri.FiltroRicerca[][] queryList)
        {
            ArrayList objListaInfoDocumenti = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                objListaInfoDocumenti = BusinessLogic.Documenti.InfoDocManager.getQuery(idGruppo, idPeople, queryList);
#if TRACE_WS
				pt.WriteLogTracer("DocumentoGetQueryDocumento");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoGetQueryDocumento", e);

                objListaInfoDocumenti = null;
            }

            return objListaInfoDocumenti;
        }

        #region paginazione DocumentoGetQueryDocumento
        /// <summary>
        /// 
        /// </summary>
        [WebMethod] // [WebMethod(CacheDuration=60,BufferResponse=true)]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.documento.InfoDocumento))]
        public virtual ArrayList DocumentoGetQueryDocumentoPaging(string idGruppo, string idPeople, DocsPaVO.filtri.FiltroRicerca[][] queryList, bool comingPopUp, bool grigi, int numPage, bool security, out int numTotPage, out int nRec, bool getIdProfilesList, out List<SearchResultInfo> idProfileList)
        {
            List<SearchResultInfo> toSet = new List<SearchResultInfo>();
            ArrayList objListaInfoDocumenti = null;
            numTotPage = 0;
            nRec = 0;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                int pageSize = 0;
                if (comingPopUp)
                    pageSize = 10;
                else
                    pageSize = 20;
                objListaInfoDocumenti = BusinessLogic.Documenti.InfoDocManager.getQueryPaging(idGruppo, idPeople, queryList, grigi, numPage, pageSize, security, out numTotPage, out nRec, getIdProfilesList, out toSet, false);

#if TRACE_WS
				pt.WriteLogTracer("DocumentoGetQueryDocumentoPaging");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoGetQueryDocumentoPaging", e);

                objListaInfoDocumenti = null;
            }
            idProfileList = toSet;
            return objListaInfoDocumenti;
        }

        [WebMethod]
        public virtual int DocumentoGetNumDocInRisposta(string idGruppo, string idPeople, DocsPaVO.filtri.FiltroRicerca[][] queryList, bool security)
        {
            int numDocInRisposta = 0;
            try
            {
                numDocInRisposta = BusinessLogic.Documenti.InfoDocManager.getNumDocInRisposta(idGruppo, idPeople, queryList, security);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoGetNumDocInRisposta", e);
            }
            return numDocInRisposta;
        }

        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.documento.InfoDocumento))]
        public virtual ArrayList FullTextSearch(DocsPaVO.utente.InfoUtente infoUtente, ref DocsPaVO.ricerche.FullTextSearchContext context)
        {
            SetUserId(infoUtente);
            ArrayList retValue = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                retValue = BusinessLogic.Documenti.InfoDocManager.FullTextSearch(infoUtente, ref context);
#if TRACE_WS
				pt.WriteLogTracer("FullTextSearch");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FullTextSearch", e);
            }

            return retValue;
        }

        [WebMethod]
        public virtual int FullTextSearchMaxRows(DocsPaVO.utente.InfoUtente infoUtente)
        {
            SetUserId(infoUtente);
            int retValue = 0;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                retValue = BusinessLogic.Documenti.InfoDocManager.FullTextSearchMaxRows(infoUtente);
#if TRACE_WS
				pt.WriteLogTracer("FullTextSearch");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FullTextMaxRows", e);
            }

            return retValue;
        }

        [WebMethod] // [WebMethod(CacheDuration=60,BufferResponse=true)]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.documento.InfoDocumento))]
        public virtual ArrayList DocumentoGetQueryFullTextDocumentoPaging(
            string testo,
            string idRegistro,
            DocsPaVO.utente.InfoUtente infoUtente,
            DocsPaVO.filtri.FiltroRicerca[][] queryList,
            int numPage,
            out int numTotPage,
            out int nRec)
        {
            SetUserId(infoUtente);
            ArrayList objListaInfoDocumenti = null;

            numTotPage = 0;
            nRec = 0;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                objListaInfoDocumenti = BusinessLogic.Documenti.InfoDocManager.RicercaFullText(testo, idRegistro, infoUtente, queryList, numPage, out numTotPage, out nRec);

#if TRACE_WS
				pt.WriteLogTracer("DocumentoGetQueryFullTextDocumentoPaging");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoGetQueryFullTextDocumentoPaging", e);

                objListaInfoDocumenti = null;
            }
            return objListaInfoDocumenti;
        }

        #endregion

        #region Metodo Commentato
        //		[WebMethod]
        //		public virtual Int32 DocumentoGetCountQueryDocumento(DocsPaVO.filtri.FiltroRicerca[][] queryList, DocsPaVO.utente.InfoUtente infoUtente) 
        //		{
        //			Int32 res = -1;
        //
        ////			try 
        ////			{				
        ////				res = -1;//documenti.Ricerca.countSearch(queryList, co);
        ////			} 
        ////			catch(Exception e) 
        ////			{
        ////				//ErrorHandler.throwFault(e.Message,"F_System",Context.Request.Url.AbsoluteUri);
        ////				
        ////			} 
        //
        //			return res;
        //		}
        #endregion


        /// <summary>
        /// getfile con segnatura in visualizzazione, solo su pdf
        /// </summary>
        /// <param name="fileRequest"></param>
        /// <param name="sch"></param>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual DocsPaVO.documento.FileDocumento DocumentoGetFileConSegnaturaUsingLC(DocsPaVO.documento.FileRequest fileRequest, DocsPaVO.documento.SchedaDocumento sch, DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.documento.labelPdf position, bool Forced)
        {
            SetUserId(infoUtente);
            logger.Info("BEGIN");
            DocsPaVO.documento.FileDocumento fileDocumento = null;

            try
            {
                //percorso XML 
                string xmlPath = this.Server.MapPath("XML/labelPdf.xml");
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                if (!Forced)
                {
                    fileDocumento = BusinessLogic.Documenti.FileManager.getFileConSegnatura(fileRequest, sch, infoUtente, xmlPath, position, true);
                    if (fileDocumento != null)
                        BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOGETFILE", fileRequest.docNumber, string.Format("{0} {1} {2} {3}", "Visualizzazione Doc. con segnatura nr.", fileRequest.docNumber, "Ver.", fileRequest.version), DocsPaVO.Logger.CodAzione.Esito.OK);
                }
                else
                {
                    fileDocumento = BusinessLogic.Documenti.FileManager.getVoidFileConSegnatura(fileRequest, sch, infoUtente, xmlPath, position);
                    if (fileDocumento != null)
                        BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOGETFILE", "0", string.Format("{0} {1} {2} {3}", "Stampa su foglio A4 segnatura nr.", sch.protocollo.segnatura, "", ""), DocsPaVO.Logger.CodAzione.Esito.OK);
                }


#if TRACE_WS
				pt.WriteLogTracer("DocumentoGetFile");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoGetFile", e);
                fileDocumento = null;
                //Celeste
                if (!Forced)
                {
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOGETFILE", fileRequest.docNumber, string.Format("{0} {1} {2} {3}", "Visualizzazione Doc. con segnatura nr.", fileRequest.docNumber, "Ver.", fileRequest.version), DocsPaVO.Logger.CodAzione.Esito.KO);
                }
                else
                {
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOGETFILE", "0", string.Format("{0} {1} {2} {3}", "Stampa su foglio A4 segnatura nr.", sch.protocollo.segnatura, "", ""), DocsPaVO.Logger.CodAzione.Esito.KO);
                }
                //Fine Celeste
            }
            logger.Info("END");
            return fileDocumento;
        }


        /// <summary>
        /// getfile con segnatura in visualizzazione, solo su pdf
        /// </summary>
        /// <param name="fileRequest"></param>
        /// <param name="sch"></param>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual DocsPaVO.documento.FileDocumento DocumentoGetFileConSegnatura(DocsPaVO.documento.FileRequest fileRequest, DocsPaVO.documento.SchedaDocumento sch, DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.documento.labelPdf position, bool Forced)
        {
            SetUserId(infoUtente);
            logger.Info("BEGIN");
            DocsPaVO.documento.FileDocumento fileDocumento = null;

            try
            {
                //percorso XML 
                string xmlPath = this.Server.MapPath("XML/labelPdf.xml");
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                if (!Forced)
                {
                    fileDocumento = BusinessLogic.Documenti.FileManager.getFileConSegnatura(fileRequest, sch, infoUtente, xmlPath, position, false);
                    if (fileDocumento != null)
                        BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOGETFILE", fileRequest.docNumber, string.Format("{0} {1} {2} {3}", "Visualizzazione Doc. con segnatura nr.", fileRequest.docNumber, "Ver.", fileRequest.version), DocsPaVO.Logger.CodAzione.Esito.OK);
                }
                else
                {
                    fileDocumento = BusinessLogic.Documenti.FileManager.getVoidFileConSegnatura(fileRequest, sch, infoUtente, xmlPath, position);
                    if (fileDocumento != null)
                        BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOGETFILE", "0", string.Format("{0} {1} {2} {3}", "Stampa su foglio A4 segnatura nr.", sch.protocollo.segnatura, "", ""), DocsPaVO.Logger.CodAzione.Esito.OK);
                }

                //ABBATANGELI LINEARIZZAZIONE
                if (fileDocumento != null && BusinessLogic.Documenti.FileManager.getEstensioneIntoSignedFile(fileDocumento.fullName).ToUpper() == "PDF")
                {
                    fileDocumento = BusinessLogic.Documenti.FileManager.LinearizzePDFContent(fileDocumento);
                }
                //FINE LINEARIZZAZIONE

#if TRACE_WS
				pt.WriteLogTracer("DocumentoGetFile");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoGetFile", e);
                fileDocumento = null;
                //Celeste
                if (!Forced)
                {
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOGETFILE", fileRequest.docNumber, string.Format("{0} {1} {2} {3}", "Visualizzazione Doc. con segnatura nr.", fileRequest.docNumber, "Ver.", fileRequest.version), DocsPaVO.Logger.CodAzione.Esito.KO);
                }
                else
                {
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOGETFILE", "0", string.Format("{0} {1} {2} {3}", "Stampa su foglio A4 segnatura nr.", sch.protocollo.segnatura, "", ""), DocsPaVO.Logger.CodAzione.Esito.KO);
                }
                //Fine Celeste
            }
            logger.Info("END");
            return fileDocumento;
        }

        /// <summary>
        /// Reperimento di un file e conversione in pdf inline mediante
        /// il convertitore correntemente configurato
        /// </summary>
        /// <param name="fileRequest"></param>
        /// <param name="infoUtente"></param>
        /// <param name="isConverted">True se il file  stato convertito in pdf</param>
        /// <returns></returns>
        [WebMethod]
        public virtual DocsPaVO.documento.FileDocumento DocumentoGetFileAsPdfFormat(DocsPaVO.documento.FileRequest fileRequest, DocsPaVO.utente.InfoUtente infoUtente, out bool isConverted)
        {
            SetUserId(infoUtente);
            logger.Info("BEGIN");
            DocsPaVO.documento.FileDocumento fileDocumento = null;
            isConverted = false;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                fileDocumento = BusinessLogic.Documenti.FileManager.getFile(fileRequest, infoUtente, true, true, out isConverted);
#if TRACE_WS
				pt.WriteLogTracer("DocumentoGetFile");
#endif
                //Celeste
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOGETFILE", fileRequest.docNumber, string.Format("{0} {1} {2} {3}", "Visualizzazione Doc. nr.", fileRequest.docNumber, "Ver.", fileRequest.version), DocsPaVO.Logger.CodAzione.Esito.OK);
                //Fine Celeste
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoGetFileAsPdfFormat", e);
                fileDocumento = null;
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOGETFILE", fileRequest.docNumber, string.Format("{0} {1} {2} {3}", "Visualizzazione Doc. in pdf nr.", fileRequest.docNumber, "Ver.", fileRequest.version), DocsPaVO.Logger.CodAzione.Esito.KO);
            }
            logger.Info("END");
            return fileDocumento;
        }


        /// <summary>
        /// Reperimento mimetype da un nome di file
        /// </summary>
        /// <param name="fileName"></param>
        /// <returns></returns>
        [WebMethod]
        public string GetMimeType(string fileName)
        {
            try
            {
                return BusinessLogic.Documenti.FileManager.getContentType(fileName);
            }
            catch (Exception ex)
            {
                string errorMessage = string.Format("Errore in DocsPaWS.GetMimeType: {0}", ex.Message);
                logger.Debug(errorMessage);

                throw new ApplicationException(errorMessage);
            }
        }

        /// <summary>
        /// 
        /// </summary>
        /// <param name="fileRequest"></param>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual DocsPaVO.documento.FileDocumento VerificaValiditaFirma(DocsPaVO.documento.FileRequest fileRequest, DocsPaVO.utente.InfoUtente infoUtente)
        {
            SetUserId(infoUtente);
            DocsPaVO.documento.FileDocumento fileDocumento = null;

            //
            try
            {

#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                DateTime dataRif = BusinessLogic.Documenti.FileManager.dataRiferimentoValitaDocumento(fileRequest, infoUtente);
                bool con;
                fileDocumento = BusinessLogic.Documenti.FileManager.getFile(fileRequest, infoUtente, false, false, out con);
                BusinessLogic.Documenti.FileManager.VerifyFileSignature(fileDocumento, dataRif);

                DocsPaVO.Logger.CodAzione.Esito esito = DocsPaVO.Logger.CodAzione.Esito.OK;
                string risultato = "Non Definito";
                if (fileDocumento.signatureResult.StatusCode == -100)
                {
                    esito = DocsPaVO.Logger.CodAzione.Esito.KO;
                    risultato = "Errore di connesione al servizio CRL";
                }

                if (fileDocumento.signatureResult.StatusCode != 0)
                {
                    risultato = "Verifica con errori: " + BusinessLogic.Documenti.FileManager.getExtCheckErrors(fileDocumento);
                }
                if (fileDocumento.signatureResult.StatusCode == 0)
                    risultato = "Verifica OK";

                bool revokedPresent = BusinessLogic.Documenti.FileManager.revokedCertArePresent(fileDocumento);
                if (revokedPresent)
                    risultato = "Sono presenti Certificati Revocati";
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOVERIFICACRL", fileRequest.docNumber, string.Format("{0} {1} {2} {3} {4} Esito: {5}", "Verifica CRL alla data", dataRif.ToLongDateString(), fileRequest.docNumber, "Ver.", fileRequest.version, risultato), esito);

                //aggiorno la CI documento
                BusinessLogic.Documenti.FileManager.processFileInformationCRLUpdate(fileRequest, infoUtente, fileDocumento, dataRif);
#if TRACE_WS
				pt.WriteLogTracer("VerificaValiditaFirma");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: VerificaValiditaFirma", e);
            }

            return fileDocumento;
        }

        /// <summary>
        /// 
        /// </summary>
        /// <param name="fileRequest"></param>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual DateTime GetDataRiferimentoValitaDocumento(DocsPaVO.documento.FileRequest fileRequest, DocsPaVO.utente.InfoUtente infoUtente)
        {
            return BusinessLogic.Documenti.FileManager.dataRiferimentoValitaDocumento(fileRequest, infoUtente);
        }


        /// <summary>
        /// 
        /// </summary>
        /// <param name="fileRequest"></param>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual DocsPaVO.documento.CertificateInfo CertificateGetInfo(DocsPaVO.documento.CertificateInfo certInfo, DocsPaVO.utente.InfoUtente infoUtente)
        {
            SetUserId(infoUtente);
            try
            {
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                BusinessLogic.Documenti.DigitalSignature.VerifySignature v = new BusinessLogic.Documenti.DigitalSignature.VerifySignature();
                return v.VerifyCertificate_External(certInfo);
#if TRACE_WS
				pt.WriteLogTracer("VerificaValiditaFirma");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: VerificaValiditaFirma", e);
                return certInfo;
            }

        }

        /// <summary>
        /// 
        /// </summary>
        /// <param name="certInfo"></param>
        /// <param name="infoUtente"></param>
        /// /// <param name="componentType"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual DocsPaVO.documento.CertificateInfo VerifyCertificateExpired(DocsPaVO.documento.CertificateInfo certInfo, DocsPaVO.utente.InfoUtente infoUtente)
        {
            SetUserId(infoUtente);
            try
            {
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                //PDZ il tipo componente potrebbe cambiare lato FE
                //DocsPaVO.SmartClient.SmartClientConfigurations smartClientConfigurations = BusinessLogic.SmartClient.SmartClientManager.GetConfigurationsPerUser(infoUtente);
                //if (smartClientConfigurations == null)
                //    throw new Exception("COMPONENT TYPE NOT FOUND");
                BusinessLogic.Documenti.DigitalSignature.VerifySignature verifySignature = new BusinessLogic.Documenti.DigitalSignature.VerifySignature();
                return verifySignature.VerifyCertificateExpired(certInfo);
#if TRACE_WS
				pt.WriteLogTracer("VerificaScadenzaFirma");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: VerificaScadenzaFirma", e);
                return certInfo;
            }

        }


        /// <summary>
        /// 
        /// </summary>
        /// <param name="fileRequest"></param>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual DocsPaVO.documento.FileDocumento VerificaValiditaFirmaAllaData(DocsPaVO.documento.FileRequest fileRequest, DocsPaVO.utente.InfoUtente infoUtente, DateTime dataDiVerifica)
        {
            SetUserId(infoUtente);
            DocsPaVO.documento.FileDocumento fileDocumento = null;

            try
            {

#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                bool con;
                fileDocumento = BusinessLogic.Documenti.FileManager.getFile(fileRequest, infoUtente, false, false, out con);
                BusinessLogic.Documenti.FileManager.VerifyFileSignature(fileDocumento, dataDiVerifica);

                //aggiorno la CI documento solo e solo se la data di riferimento  la stessa..
                DateTime dataRif = BusinessLogic.Documenti.FileManager.dataRiferimentoValitaDocumento(fileRequest, infoUtente);
                //if (dataRif.Date == dataDiVerifica.Date)
                BusinessLogic.Documenti.FileManager.processFileInformationCRLUpdate(fileRequest, infoUtente, fileDocumento, dataDiVerifica);

                DocsPaVO.Logger.CodAzione.Esito esito = DocsPaVO.Logger.CodAzione.Esito.OK;
                string risultato = "Non Definito";
                if (fileDocumento.signatureResult.StatusCode == -100)
                {
                    esito = DocsPaVO.Logger.CodAzione.Esito.KO;
                    risultato = "Errore di connessione al servizio CRL";
                }

                if (fileDocumento.signatureResult.StatusCode != 0)
                {
                    risultato = "Verifica con errori: " + BusinessLogic.Documenti.FileManager.getExtCheckErrors(fileDocumento);
                }
                if (fileDocumento.signatureResult.StatusCode == 0)
                    risultato = "Verifica OK";

                bool revokedPresent = BusinessLogic.Documenti.FileManager.revokedCertArePresent(fileDocumento);
                if (revokedPresent)
                    risultato = "Sono presenti Certificati Revocati";

                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOVERIFICACRL", fileRequest.docNumber, string.Format("{0} {1} {2} {3} {4}  Esito:{5}", "Verifica CRL alla data", dataDiVerifica.ToLongDateString(), fileRequest.docNumber, "Ver.", fileRequest.version, risultato), esito);

#if TRACE_WS
				pt.WriteLogTracer("VerificaValiditaFirma");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: VerificaValiditaFirma", e);
            }

            return fileDocumento;
        }


        /// <summary>
        /// 
        /// </summary>
        /// <param name="fileRequest"></param>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual DocsPaVO.documento.FileDocumento DocumentoGetFile(DocsPaVO.documento.FileRequest fileRequest, DocsPaVO.utente.InfoUtente infoUtente)
        {
            SetUserId(infoUtente);
            DocsPaVO.documento.FileDocumento fileDocumento = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                fileDocumento = BusinessLogic.Documenti.FileManager.getFile(fileRequest, infoUtente);
#if TRACE_WS
				pt.WriteLogTracer("DocumentoGetFile");
#endif
                //Celeste
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOGETFILE", fileRequest.docNumber, string.Format("{0} {1} {2} {3}", "Visualizzazione Doc. nr.", fileRequest.docNumber, "Ver.", fileRequest.version), DocsPaVO.Logger.CodAzione.Esito.OK);
                //Fine Celeste
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoGetFile", e);
                fileDocumento = null;
                //Celeste
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOGETFILE", fileRequest.versionId, string.Format("{0} {1} {2} {3}", "Visualizzazione Doc. nr.", fileRequest.docNumber, "Ver.", fileRequest.version), DocsPaVO.Logger.CodAzione.Esito.KO);
                //Fine Celeste
            }

            return fileDocumento;
        }

        /// <summary>
        /// 
        /// </summary>
        /// <param name="fileRequest"></param>
        /// <param name="infoUtente"></param>
        /// <param name="msgErr"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual DocsPaVO.documento.FileDocumento DocumentoGetFileDoc(DocsPaVO.documento.FileRequest fileRequest, DocsPaVO.utente.InfoUtente infoUtente, out string msgErr)
        {
            SetUserId(infoUtente);
            logger.Info("BEGIN");
            DocsPaVO.documento.FileDocumento fileDocumento = null;
            msgErr = string.Empty;
            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                fileDocumento = BusinessLogic.Documenti.FileManager.getFile(fileRequest, infoUtente);
#if TRACE_WS
				pt.WriteLogTracer("DocumentoGetFile");
#endif

                //ABBATANGELI LINEARIZZAZIONE
                if (BusinessLogic.Documenti.FileManager.getEstensioneIntoSignedFile(fileDocumento.fullName).ToUpper() == "PDF")
                {
                    fileDocumento = BusinessLogic.Documenti.FileManager.LinearizzePDFContent(fileDocumento);
                }
                //FINE LINEARIZZAZIONE

                //Celeste
                if (fileDocumento != null)
                {
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOGETFILE", fileRequest.docNumber, string.Format("{0} {1} {2} {3}", "Visualizzazione Doc. nr.", fileRequest.docNumber, "Ver.", fileRequest.version), DocsPaVO.Logger.CodAzione.Esito.OK);
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTO_VISUAL", fileRequest.docNumber, "Documento visualizzato da " + infoUtente.userId, DocsPaVO.Logger.CodAzione.Esito.OK);
                    msgErr = "OK";
                }
                else
                {
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOGETFILE", fileRequest.docNumber, string.Format("{0} {1} {2} {3}", "Visualizzazione Doc. nr.", fileRequest.docNumber, "Ver.", fileRequest.version), DocsPaVO.Logger.CodAzione.Esito.KO);
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTO_VISUAL", fileRequest.docNumber, "Documento visualizzato da " + infoUtente.userId, DocsPaVO.Logger.CodAzione.Esito.KO);
                    msgErr = "Non  stato possibile visualizzare il documento. Consultare il log per maggiori dettagli";
                }
                //Fine Celeste
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoGetFile", e);
                fileDocumento = null;
                msgErr = "Errore: " + e.Message;

                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOGETFILE", fileRequest.versionId, string.Format("{0} {1} {2} {3}", "Visualizzazione Doc. nr.", fileRequest.docNumber, "Ver.", fileRequest.version), DocsPaVO.Logger.CodAzione.Esito.KO);
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTO_VISUAL", fileRequest.docNumber, "Documento visualizzato da " + infoUtente.userId, DocsPaVO.Logger.CodAzione.Esito.KO);
            }


            logger.Info("END");
            return fileDocumento;
        }

        /// <summary>
        /// Restituisce l'anteprima pdf di n pagine
        /// </summary>
        /// <param name="fileRequest"></param>
        /// <param name="infoUtente"></param>
        /// <param name="firstPg"></param>
        /// <param name="lastPg"></param>
        /// <param name="msgErr"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual DocsPaVO.documento.FileDocumentoAnteprima DocumentoGetAnteprimaFilePdf(DocsPaVO.documento.FileRequest fileRequest, int firstPg, int lastPg, DocsPaVO.documento.SchedaDocumento sch, DocsPaVO.documento.labelPdf position, DocsPaVO.utente.InfoUtente infoUtente, out string msgErr)
        {
            SetUserId(infoUtente);
            logger.Info("BEGIN");
            DocsPaVO.documento.FileDocumentoAnteprima fileDocumento = null;
            msgErr = string.Empty;
            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                //Per evitare situazioni anomale...
                if (firstPg == 0 && lastPg == 0) firstPg = 1;

                fileDocumento = BusinessLogic.Documenti.FileManager.getPreviewFilePdf(fileRequest, firstPg, lastPg, sch, position, infoUtente);
#if TRACE_WS
				pt.WriteLogTracer("DocumentoGetFile");
#endif
                //LINEARIZZAZIONE
                fileDocumento = BusinessLogic.Documenti.FileManager.LinearizzePDFContent(fileDocumento);

                //Celeste
                if (fileDocumento != null)
                {
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOGETANTEPRIMAFILE", fileRequest.docNumber, string.Format("{0} {1} {2} {3}", "Visualizzazione anteprima Doc. nr.", fileRequest.docNumber, "Ver.", fileRequest.version), DocsPaVO.Logger.CodAzione.Esito.OK);
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTO_ANTEPRIMA", fileRequest.docNumber, "Anteprima documento visualizzato da " + infoUtente.userId, DocsPaVO.Logger.CodAzione.Esito.OK);
                    msgErr = "OK";
                }
                else
                {
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOGETANTEPRIMAFILE", fileRequest.docNumber, string.Format("{0} {1} {2} {3}", "Visualizzazione anteprima Doc. nr.", fileRequest.docNumber, "Ver.", fileRequest.version), DocsPaVO.Logger.CodAzione.Esito.KO);
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTO_ANTEPRIMA", fileRequest.docNumber, "Anteprima documento visualizzato da " + infoUtente.userId, DocsPaVO.Logger.CodAzione.Esito.KO);
                    msgErr = "Non  stato possibile visualizzare l'anteprima del documento. Consultare il log per maggiori dettagli";
                }
                //Fine Celeste
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoGetAnteprimaFilePdf", e);
                fileDocumento = null;
                msgErr = "Errore: " + e.Message;

                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOGETANTEPRIMAFILE", fileRequest.versionId, string.Format("{0} {1} {2} {3}", "Visualizzazione anteprima Doc. nr.", fileRequest.docNumber, "Ver.", fileRequest.version), DocsPaVO.Logger.CodAzione.Esito.KO);
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTO_ANTEPRIMA", fileRequest.docNumber, "Anteprima documento visualizzato da " + infoUtente.userId, DocsPaVO.Logger.CodAzione.Esito.KO);
            }

            logger.Info("END");
            return fileDocumento;
        }

        /// <summary>
        /// 
        /// </summary>
        /// <param name="fileRequest"></param>
        /// <param name="infoUtente"></param>
        /// <param name="msgErr"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual DocsPaVO.documento.FileDocumento DocumentoGetFileDocAsEML(DocsPaVO.documento.FileRequest fileRequest, DocsPaVO.utente.InfoUtente infoUtente, out string msgErr)
        {
            SetUserId(infoUtente);
            logger.Info("BEGIN");
            DocsPaVO.documento.FileDocumento fileDocumento = null;
            msgErr = string.Empty;
            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                fileDocumento = BusinessLogic.Documenti.FileManager.getFileAsEML(fileRequest, infoUtente);
#if TRACE_WS
				pt.WriteLogTracer("DocumentoGetFile");
#endif
                //Celeste
                if (fileDocumento != null)
                {
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOGETFILE", fileRequest.docNumber, string.Format("{0} {1} {2} {3}", "Visualizzazione Doc. nr.", fileRequest.docNumber, "Ver.", fileRequest.version), DocsPaVO.Logger.CodAzione.Esito.OK);
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTO_VISUAL", fileRequest.docNumber, "Documento visualizzato da " + infoUtente.userId, DocsPaVO.Logger.CodAzione.Esito.OK);
                    msgErr = "OK";
                }
                else
                {
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOGETFILE", fileRequest.docNumber, string.Format("{0} {1} {2} {3}", "Visualizzazione Doc. nr.", fileRequest.docNumber, "Ver.", fileRequest.version), DocsPaVO.Logger.CodAzione.Esito.KO);
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTO_VISUAL", fileRequest.docNumber, "Documento visualizzato da " + infoUtente.userId, DocsPaVO.Logger.CodAzione.Esito.KO);
                    msgErr = "Non  stato possibile visualizzare il documento. Consultare il log per maggiori dettagli";
                }
                //Fine Celeste
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoGetFileDocAsEML", e);
                fileDocumento = null;
                msgErr = "Errore: " + e.Message;

                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOGETFILE", fileRequest.versionId, string.Format("{0} {1} {2} {3}", "Visualizzazione Doc. nr.", fileRequest.docNumber, "Ver.", fileRequest.version), DocsPaVO.Logger.CodAzione.Esito.KO);
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTO_VISUAL", fileRequest.docNumber, "Documento visualizzato da " + infoUtente.userId, DocsPaVO.Logger.CodAzione.Esito.KO);
            }


            logger.Info("END");
            return fileDocumento;
        }

        /// <summary>
        /// ritorna in FileDocumento, ma privo del content, solo informazioni sul tipo e dimensione
        /// </summary>
        /// <param name="fileRequest"></param>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual DocsPaVO.documento.FileDocumento DocumentoGetInfoFile(DocsPaVO.documento.FileRequest fileRequest, DocsPaVO.utente.InfoUtente infoUtente)
        {
            SetUserId(infoUtente);
            DocsPaVO.documento.FileDocumento fileDocumento = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                fileDocumento = BusinessLogic.Documenti.FileManager.getInfoFile(fileRequest, infoUtente);
#if TRACE_WS
				pt.WriteLogTracer("DocumentoGetFile");
#endif
                //Celeste
                //BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOGETFILE", fileRequest.docNumber, string.Format("{0} {1} {2} {3}", "Doc. nr.", fileRequest.docNumber, "Ver.", fileRequest.version), DocsPaVO.Logger.CodAzione.Esito.OK);
                //Fine Celeste
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoGetFile", e);
                fileDocumento = null;
                //Celeste
                //BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOGETFILE", fileRequest.docNumber, string.Format("{0} {1} {2} {3}", "Doc. nr.", fileRequest.docNumber, "Ver.", fileRequest.version), DocsPaVO.Logger.CodAzione.Esito.KO);
                //Fine Celeste
            }

            return fileDocumento;
        }

        /// <summary>
        /// Reperimento di un oggetto FileDocumento
        /// con il contentuto del file firmato 
        /// (senza il check della validit della firma)
        /// </summary>
        /// <param name="fileRequest"></param>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual DocsPaVO.documento.FileDocumento DocumentoGetFileFirmato(DocsPaVO.documento.FileRequest fileRequest, DocsPaVO.utente.InfoUtente infoUtente)
        {
            SetUserId(infoUtente);
            DocsPaVO.documento.FileDocumento fileDocumento = null;

            try
            {
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                fileDocumento = BusinessLogic.Documenti.FileManager.getFileFirmato(fileRequest, infoUtente, false);
#if TRACE_WS
				pt.WriteLogTracer("DocumentoGetFile");
#endif
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOGETFILE", fileRequest.docNumber, string.Format("{0} {1} {2} {3}", "Visualizzazione Doc. nr.", fileRequest.docNumber, "Ver.", fileRequest.version), DocsPaVO.Logger.CodAzione.Esito.OK);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoGetFileFirmato", e);
                fileDocumento = null;
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOGETFILE", fileRequest.docNumber, string.Format("{0} {1} {2} {3}", "Doc. firmato nr.", fileRequest.docNumber, "Ver.", fileRequest.version), DocsPaVO.Logger.CodAzione.Esito.KO);
            }

            return fileDocumento;
        }

        /// <summary>
        /// 
        /// </summary>
        /// <param name="fileRequest"></param>
        /// <param name="fileDocument"></param>
        /// <param name="infoUtente"></param>
        /// <param name="errorMessage"></param>
        /// <returns></returns>
        [WebMethod]
        public bool DocumentoPutFileNoException(ref DocsPaVO.documento.FileRequest fileRequest,
                                DocsPaVO.documento.FileDocumento fileDocument,
                                DocsPaVO.utente.InfoUtente infoUtente,
                                out string errorMessage)
        {
            SetUserId(infoUtente);
            logger.Info("BEGIN");
            string isFirmato = " ";
            bool result = false;
            errorMessage = string.Empty;
            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Documenti.FileManager.putFile(ref fileRequest, fileDocument, infoUtente, out errorMessage);
#if TRACE_WS
				pt.WriteLogTracer("DocumentoPutFileNoException");
#endif

                if (result)
                {
                    if (DocsPaUtils.Functions.Functions.isDocumentoFirmato(fileRequest.fileName)) //se l'estensione  p7m
                        isFirmato = " Firmato ";
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOPUTFILE", fileRequest.docNumber, string.Format("{0} {1}", "Acquisito documento " + isFirmato + "N.ro:", fileRequest.docNumber), DocsPaVO.Logger.CodAzione.Esito.OK);

                    #region event FOLLOW_DOC_EXT_APP

                    //traccio l'evento FOLLOW_DOC_EXT_APP
                    string description = string.Empty;
                    string idDocMain = string.Empty;
                    string method = "FOLLOWDOCEXTAPP";
                    if (fileRequest.GetType() == typeof(DocsPaVO.documento.Allegato))
                    {
                        /*l'evento FOLLOW_DOC_EXT_APP scatta in seguito all'acquisizione del file
                        per uno degli allegati del documento.*/
                        idDocMain = BusinessLogic.Documenti.AllegatiManager.getIdDocumentoPrincipale(fileRequest as DocsPaVO.documento.Allegato);
                        description = "AddFileAttachDoc#Aggiunto file all'allegato " + fileRequest.descrizione + ", documento " + idDocMain;

                        //FATTURAZIONE ELETTRONICA
                        DocsPaDB.Query_DocsPAWS.Fatturazione fatt = new DocsPaDB.Query_DocsPAWS.Fatturazione();

                        if (BusinessLogic.Fatturazione.FatturazioneManager.IsFatturaElettronica(idDocMain, infoUtente.idAmministrazione))
                        {
                            //Aggiungo l'allegato al file xml
                            BusinessLogic.Fatturazione.FatturazioneManager.AddAllegatoToXMLFattura(idDocMain, fileDocument, fileRequest.descrizione, infoUtente);
                        }

                    }
                    else
                    {
                        //l'evento FOLLOW_DOC_EXT_APP scatta in seguito all'acquisizione del file per il doc principale
                        idDocMain = fileRequest.docNumber;
                        description = "AddFileDoc#Aggiunto file al documento " + idDocMain;
                    }
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente.userId, infoUtente.idPeople, infoUtente.idGruppo,
                        infoUtente.idAmministrazione, method, idDocMain, description, DocsPaVO.Logger.CodAzione.Esito.OK,
                        (infoUtente != null && infoUtente.delegato != null ? infoUtente.delegato : null), "1", null);

                    #endregion
                }
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoPutFileNoException", e);

                if (result)
                {
                    if (DocsPaUtils.Functions.Functions.isDocumentoFirmato(fileRequest.fileName)) //se l'estensione  p7m
                        isFirmato = " Firmato ";
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOPUTFILE", fileRequest.docNumber, string.Format("{0} {1}", "Acquisito documento " + isFirmato + "N.ro:", fileRequest.docNumber), DocsPaVO.Logger.CodAzione.Esito.KO);
                }
            }
            logger.Info("END");
            return result;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual DocsPaVO.documento.FileRequest DocumentoPutFile(DocsPaVO.documento.FileRequest fileRequest, DocsPaVO.documento.FileDocumento fileDocument, DocsPaVO.utente.InfoUtente infoUtente)
        {
            SetUserId(infoUtente);
            logger.Info("BEGIN");
            string isFirmato = " ";
            DocsPaVO.documento.FileRequest result = null;
            string errore = string.Empty;
            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Documenti.FileManager.putFile(fileRequest, fileDocument, infoUtente);
#if TRACE_WS
				pt.WriteLogTracer("DocumentoPutFile");
#endif

                if (result != null)
                {

                    if (DocsPaUtils.Functions.Functions.isDocumentoFirmato(result.fileName)) //se l'estensione  p7m
                    {
                        isFirmato = " Firmato ";
                    }
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOPUTFILE", fileRequest.docNumber, string.Format("{0} {1}", "Acquisito documento " + isFirmato + "N.ro:", fileRequest.docNumber), DocsPaVO.Logger.CodAzione.Esito.OK);

                    #region event FOLLOW_DOC_EXT_APP

                    //traccio l'evento FOLLOW_DOC_EXT_APP
                    string description = string.Empty;
                    string idDocMain = string.Empty;
                    string method = "FOLLOWDOCEXTAPP";
                    if (fileRequest.GetType() == typeof(DocsPaVO.documento.Allegato))
                    {
                        /*l'evento FOLLOW_DOC_EXT_APP scatta in seguito all'acquisizione del file
                        per uno degli allegati del documento.*/
                        idDocMain = BusinessLogic.Documenti.AllegatiManager.getIdDocumentoPrincipale(fileRequest as DocsPaVO.documento.Allegato);
                        description = "AddFileAttachDoc#Aggiunto file all'allegato " + fileRequest.descrizione + ", documento " + idDocMain;
                    }
                    else
                    {
                        //l'evento FOLLOW_DOC_EXT_APP scatta in seguito all'acquisizione del file per il doc principale
                        idDocMain = fileRequest.docNumber;
                        description = "AddFileDoc#Aggiunto file al documento " + idDocMain;
                    }
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente.userId, infoUtente.idPeople, infoUtente.idGruppo,
                        infoUtente.idAmministrazione, method, idDocMain, description, DocsPaVO.Logger.CodAzione.Esito.OK,
                        (infoUtente != null && infoUtente.delegato != null ? infoUtente.delegato : null), "1", null);

                    #endregion
                }
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoPutFile", e);

                if (result != null)
                {
                    if (DocsPaUtils.Functions.Functions.isDocumentoFirmato(result.fileName)) //se l'estensione  p7m
                    {
                        isFirmato = " Firmato ";
                    }
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOPUTFILE", fileRequest.docNumber, string.Format("{0} {1}", "Acquisito documento " + isFirmato + "N.ro:", fileRequest.docNumber), DocsPaVO.Logger.CodAzione.Esito.KO);
                }
            }
            logger.Info("END");

            return result;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual DocsPaVO.documento.FileRequest DocumentoPutFileImport(DocsPaVO.documento.FileRequest fileRequest, DocsPaVO.documento.FileDocumento fileDocument, DocsPaVO.utente.InfoUtente infoUtente, out string errorMsg)
        {
            SetUserId(infoUtente);
            logger.Info("BEGIN");
            string isFirmato = " ";
            DocsPaVO.documento.FileRequest result = null;
            string errore = string.Empty;
            errorMsg = string.Empty;
            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Documenti.FileManager.putFile(fileRequest, fileDocument, infoUtente);
#if TRACE_WS
				pt.WriteLogTracer("DocumentoPutFile");
#endif

                if (result != null)
                {

                    if (DocsPaUtils.Functions.Functions.isDocumentoFirmato(result.fileName)) //se l'estensione  p7m
                    {
                        isFirmato = " Firmato ";
                    }
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOPUTFILE", fileRequest.docNumber, string.Format("{0} {1}", "Acquisito documento " + isFirmato + "N.ro:", fileRequest.docNumber), DocsPaVO.Logger.CodAzione.Esito.OK);

                    #region event FOLLOW_DOC_EXT_APP

                    //traccio l'evento FOLLOW_DOC_EXT_APP
                    string description = string.Empty;
                    string idDocMain = string.Empty;
                    string method = "FOLLOWDOCEXTAPP";
                    if (fileRequest.GetType() == typeof(DocsPaVO.documento.Allegato))
                    {
                        /*l'evento FOLLOW_DOC_EXT_APP scatta in seguito all'acquisizione del file
                        per uno degli allegati del documento.*/
                        idDocMain = BusinessLogic.Documenti.AllegatiManager.getIdDocumentoPrincipale(fileRequest as DocsPaVO.documento.Allegato);
                        description = "AddFileAttachDoc#Aggiunto file all'allegato " + fileRequest.descrizione + ", documento " + idDocMain;
                    }
                    else
                    {
                        //l'evento FOLLOW_DOC_EXT_APP scatta in seguito all'acquisizione del file per il doc principale
                        idDocMain = fileRequest.docNumber;
                        description = "AddFileDoc#Aggiunto file al documento " + idDocMain;
                    }
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente.userId, infoUtente.idPeople, infoUtente.idGruppo,
                        infoUtente.idAmministrazione, method, idDocMain, description, DocsPaVO.Logger.CodAzione.Esito.OK,
                        (infoUtente != null && infoUtente.delegato != null ? infoUtente.delegato : null), "1", null);

                    #endregion
                }
            }
            catch (System.IO.PathTooLongException e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoPutFile", e);
                errorMsg = "NOME_FILE_TROPPO_LUNGO";
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoPutFile", e);

                if (result != null)
                {
                    if (DocsPaUtils.Functions.Functions.isDocumentoFirmato(result.fileName)) //se l'estensione  p7m
                    {
                        isFirmato = " Firmato ";
                    }
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOPUTFILE", fileRequest.docNumber, string.Format("{0} {1}", "Acquisito documento " + isFirmato + "N.ro:", fileRequest.docNumber), DocsPaVO.Logger.CodAzione.Esito.KO);
                }
            }
            logger.Info("END");

            return result;
        }



        [WebMethod]
        public virtual string DocumentoPutFileBatch(string DocumentoFileBatchXmlStream)
        {
            string retValue = string.Empty;

            try
            {
                string version = BusinessLogic.AcquisizioneMassiva.PutFileHelper.PutFile(DocumentoFileBatchXmlStream);

                if (string.IsNullOrEmpty(version))
                    retValue = "Y";
                else
                    retValue = "Y:" + version;
            }
            catch (Exception ex)
            {
                retValue = ex.Message;
            }

            return retValue;
        }

        /// <summary>
        /// 
        /// </summary>
        /// <param name="idCorrGlobali">system_id del corrispondete</param>
        /// <param name="flagListe">1, se le liste sono abilitato, 0 altrimenti</param>
        /// <param name="message">messaggio per esito dell'operazione</param>
        /// <returns></returns>
        [WebMethod]
        public bool CorrispondentiDeleteModifyCorrispondenteEsterno(DocsPaVO.utente.InfoUtente infoutente, DocsPaVO.utente.DatiModificaCorr datiModificaCorr, int flagListe, string action, out string message)
        {
            SetUserId(infoutente);
            bool result = false;

            message = String.Empty;
            string descAzione = "";
            try
            {
                if (action.Equals("D"))//se ho scelto di eliminare il corrispondente
                {
                    logger.Debug("DeleteCorrispondenteEsterno");
                    descAzione = "ELIMINAZIONE CORRISPONDENTE";
                    result = BusinessLogic.Utenti.UserManager.DeleteCorrispondenteEsterno(datiModificaCorr.idCorrGlobali, flagListe, infoutente, out message);
                    if (result)//OPERAZIONE ANDATA A BUON FINE
                    {
                        BusinessLogic.UserLog.UserLog.WriteLog(infoutente, "CORRISPONDENTIDELETECORRISPONDENTEESTERNO", datiModificaCorr.idCorrGlobali, descAzione, DocsPaVO.Logger.CodAzione.Esito.OK);
                    }
                    else
                    {
                        BusinessLogic.UserLog.UserLog.WriteLog(infoutente, "CORRISPONDENTIDELETECORRISPONDENTEESTERNO", datiModificaCorr.idCorrGlobali, "CANCELLAZIONE CORRISPONDENTE", DocsPaVO.Logger.CodAzione.Esito.KO);

                    }
                }

                if (action.Equals("M"))
                {
                    logger.Debug("ModifyCorrispondenteEsterno");
                    descAzione = "MODIFICA CORRISPONDENTE";
                    result = BusinessLogic.Utenti.UserManager.ModifyCorrispondenteEsterno(datiModificaCorr, infoutente, out message);

                    if (result)//OPERAZIONE ANDATA A BUON FINE
                    {
                        BusinessLogic.UserLog.UserLog.WriteLog(infoutente, "CORRISPONDENTIDELETECORRISPONDENTEESTERNO", datiModificaCorr.idCorrGlobali, descAzione, DocsPaVO.Logger.CodAzione.Esito.OK);
                    }
                    else
                    {
                        BusinessLogic.UserLog.UserLog.WriteLog(infoutente, "CORRISPONDENTIDELETECORRISPONDENTEESTERNO", datiModificaCorr.idCorrGlobali, descAzione, DocsPaVO.Logger.CodAzione.Esito.KO);
                    }
                }


            }
            catch (Exception e)
            {
                logger.Debug("Errore durante la cancellazione/modifica del corrispondente", e);

                BusinessLogic.UserLog.UserLog.WriteLog(infoutente, "CORRISPONDENTIDELETECORRISPONDENTEESTERNO", datiModificaCorr.idCorrGlobali, descAzione, DocsPaVO.Logger.CodAzione.Esito.KO);
            }

            return result;
        }

        /// <summary>
        /// 
        /// </summary>
        /// <param name="idCorrGlobali">system_id del corrispondete</param>
        /// <param name="flagListe">1, se le liste sono abilitato, 0 altrimenti</param>
        /// <param name="message">messaggio per esito dell'operazione</param>
        /// <param name="newIdCorr">id del nuovo corrispondente</param>
        /// <returns></returns>
        [WebMethod]
        public bool CorrispondentiDeleteModifyCorrispondenteEsternoWithId(DocsPaVO.utente.InfoUtente infoutente, DocsPaVO.utente.DatiModificaCorr datiModificaCorr, int flagListe, string action, out string newIdCorr, out string message)
        {
            SetUserId(infoutente);
            bool result = false;

            message = String.Empty;
            newIdCorr = String.Empty;
            string descAzione = "";
            try
            {
                if (action.Equals("D"))//se ho scelto di eliminare il corrispondente
                {
                    logger.Debug("DeleteCorrispondenteEsterno");
                    descAzione = "ELIMINAZIONE CORRISPONDENTE";
                    result = BusinessLogic.Utenti.UserManager.DeleteCorrispondenteEsterno(datiModificaCorr.idCorrGlobali, flagListe, infoutente, out message);
                    if (result)//OPERAZIONE ANDATA A BUON FINE
                    {
                        BusinessLogic.UserLog.UserLog.WriteLog(infoutente, "CORRISPONDENTIDELETECORRISPONDENTEESTERNO", datiModificaCorr.idCorrGlobali, descAzione, DocsPaVO.Logger.CodAzione.Esito.OK);
                    }
                    else
                    {
                        BusinessLogic.UserLog.UserLog.WriteLog(infoutente, "CORRISPONDENTIDELETECORRISPONDENTEESTERNO", datiModificaCorr.idCorrGlobali, "CANCELLAZIONE CORRISPONDENTE", DocsPaVO.Logger.CodAzione.Esito.KO);

                    }
                }

                if (action.Equals("M"))
                {
                    logger.Debug("ModifyCorrispondenteEsterno");
                    descAzione = "MODIFICA CORRISPONDENTE";
                    result = BusinessLogic.Utenti.UserManager.ModifyCorrispondenteEsterno(datiModificaCorr, infoutente, out newIdCorr, out message);

                    if (result)//OPERAZIONE ANDATA A BUON FINE
                    {
                        BusinessLogic.UserLog.UserLog.WriteLog(infoutente, "CORRISPONDENTIDELETECORRISPONDENTEESTERNO", datiModificaCorr.idCorrGlobali, descAzione, DocsPaVO.Logger.CodAzione.Esito.OK);
                    }
                    else
                    {
                        BusinessLogic.UserLog.UserLog.WriteLog(infoutente, "CORRISPONDENTIDELETECORRISPONDENTEESTERNO", datiModificaCorr.idCorrGlobali, descAzione, DocsPaVO.Logger.CodAzione.Esito.KO);
                    }
                }


            }
            catch (Exception e)
            {
                logger.Debug("Errore durante la cancellazione/modifica del corrispondente", e);

                BusinessLogic.UserLog.UserLog.WriteLog(infoutente, "CORRISPONDENTIDELETECORRISPONDENTEESTERNO", datiModificaCorr.idCorrGlobali, descAzione, DocsPaVO.Logger.CodAzione.Esito.KO);
            }

            return result;
        }

        /// <summary>
        /// Factory method di una nuova scheda documento
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <returns>
        /// Scheda documento predisposta per l'inserimento
        /// </returns>
        [WebMethod()]
        public DocsPaVO.documento.SchedaDocumento NewSchedaDocumento(DocsPaVO.utente.InfoUtente infoUtente)
        {
            try
            {
                SetUserId(infoUtente);
                return BusinessLogic.Documenti.DocManager.NewSchedaDocumento(infoUtente);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: NewSchedaDocumento", ex);
                return null;
            }
        }

        /// <summary>
        /// questo metodo ritorna una schedadocumento, settando la data vista sulle eventuali trasmisisoni del documento, cos facendo
        /// la trasmissione viene tolta dalla todolist
        /// </summary>
        [WebMethod]
        public virtual DocsPaVO.documento.SchedaDocumento DocumentoGetDettaglioDocumento(DocsPaVO.utente.InfoUtente infoutente, string idProfile, string docNumber)
        {
            SetUserId(infoutente);
            DocsPaVO.documento.SchedaDocumento schedaDocumento = null;
            string VarDescOggetto = string.Empty;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                schedaDocumento = BusinessLogic.Documenti.DocManager.getDettaglio(infoutente, idProfile, docNumber);
#if TRACE_WS
				pt.WriteLogTracer("DocumentoGetDettaglioDocumento");
#endif
                //Celeste 
                if (schedaDocumento != null)
                {
                    if (schedaDocumento.protocollo != null)
                        VarDescOggetto = string.Format("{0}{1} / {2}{3}", "N.ro Doc.:", schedaDocumento.docNumber, "Segnatura: ", schedaDocumento.protocollo.segnatura);
                    else
                        VarDescOggetto = string.Format("{0}{1}", "N.ro Doc.:", schedaDocumento.docNumber + " Creato il " + schedaDocumento.dataCreazione);

                    BusinessLogic.UserLog.UserLog.WriteLog(infoutente, "DOCUMENTOGETDETTAGLIODOCUMENTO", schedaDocumento.systemId, VarDescOggetto, DocsPaVO.Logger.CodAzione.Esito.OK);

                    if (schedaDocumento.documentoPrincipale == null || string.IsNullOrEmpty(schedaDocumento.documentoPrincipale.idProfile))
                    {
                        BusinessLogic.Documenti.DocManager.UpdateLastDocumentsView(idProfile, infoutente);
                    }
                }
                //Fine Celeste
            }
            catch (Exception e)
            {
                //Celeste 
                BusinessLogic.UserLog.UserLog.WriteLog(infoutente, "DOCUMENTOGETDETTAGLIODOCUMENTO", docNumber, VarDescOggetto, DocsPaVO.Logger.CodAzione.Esito.KO);
                //Fine Celeste

                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoGetDettaglioDocumento", e);
                schedaDocumento = null;
            }

            return schedaDocumento;
        }

        /// <summary>
        /// Estrae la lista degli ultimi documenti visualizzati
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public List<DocsPaVO.documento.DocumentoVisualizzato> GetLastDocumentsView(DocsPaVO.utente.InfoUtente infoUtente)
        {
            return BusinessLogic.Documenti.DocManager.GetLastDocumentsView(infoUtente);
        }

        /// <summary>
        /// questo metodo ritorna una schedadocumento, settando la data vista sulle eventuali trasmisisoni del documento, cos facendo
        /// la trasmissione viene tolta dalla todolist
        /// </summary>
        [WebMethod]
        public virtual DocsPaVO.documento.SchedaDocumento DocumentoGetDettaglioDocumentoNoSecurity(DocsPaVO.utente.InfoUtente infoutente, string idProfile, string docNumber)
        {
            SetUserId(infoutente);
            DocsPaVO.documento.SchedaDocumento schedaDocumento = null;
            string VarDescOggetto = string.Empty;

            try
            {
                schedaDocumento = BusinessLogic.Documenti.DocManager.getDettaglioNoSecurity(infoutente, idProfile);

                if (schedaDocumento != null)
                {
                    if (schedaDocumento.protocollo != null)
                        VarDescOggetto = string.Format("{0}{1} / {2}{3}", "N.ro Doc.:", schedaDocumento.docNumber, "Segnatura: ", schedaDocumento.protocollo.segnatura);
                    else
                        VarDescOggetto = string.Format("{0}{1}", "N.ro Doc.:", schedaDocumento.docNumber + " Creato il " + schedaDocumento.dataCreazione);

                    BusinessLogic.UserLog.UserLog.WriteLog(infoutente, "DOCUMENTOGETDETTAGLIODOCUMENTO", schedaDocumento.systemId, VarDescOggetto, DocsPaVO.Logger.CodAzione.Esito.OK);
                }
            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(infoutente, "DOCUMENTOGETDETTAGLIODOCUMENTO", docNumber, VarDescOggetto, DocsPaVO.Logger.CodAzione.Esito.KO);

                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoGetDettaglioDocumento", e);
                schedaDocumento = null;
            }

            return schedaDocumento;
        }


        /// <summary>
        /// questo metodo ritorna una schedadocumento,  NON settando la data vista sulle eventuali trasmisisoni del documento, cos facendo
        /// la trasmissione  NON viene tolta dalla todolist
        /// </summary>
        [WebMethod]
        public virtual DocsPaVO.documento.SchedaDocumento DocumentoGetDettaglioDocumentoNoDataVista(DocsPaVO.utente.InfoUtente infoutente, string idProfile, string docNumber)
        {
            SetUserId(infoutente);
            DocsPaVO.documento.SchedaDocumento schedaDocumento = null;
            string VarDescOggetto = string.Empty;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                // schedaDocumento = BusinessLogic.Documenti.DocManager.getDettaglioNoSecurity(infoutente, docNumber);
                DocsPaDB.Query_DocsPAWS.Documenti doc = new DocsPaDB.Query_DocsPAWS.Documenti();
                schedaDocumento = doc.GetDettaglio(infoutente, idProfile, docNumber, false);
                schedaDocumento.checkOutStatus = BusinessLogic.CheckInOut.CheckInOutServices.GetCheckOutStatus(schedaDocumento.systemId, schedaDocumento.docNumber, infoutente);
#if TRACE_WS
				pt.WriteLogTracer("DocumentoGetDettaglioDocumento");
#endif
                //Celeste 
                if (schedaDocumento != null)
                {
                    if (schedaDocumento.protocollo != null)
                        VarDescOggetto = string.Format("{0}{1} / {2}{3}", "N.ro Doc.:", schedaDocumento.docNumber, "Segnatura: ", schedaDocumento.protocollo.segnatura);
                    else
                        VarDescOggetto = string.Format("{0}{1}", "N.ro Doc.:", schedaDocumento.docNumber + " Creato il " + schedaDocumento.dataCreazione);

                    BusinessLogic.UserLog.UserLog.WriteLog(infoutente, "DOCUMENTOGETDETTAGLIODOCUMENTO", schedaDocumento.systemId, VarDescOggetto, DocsPaVO.Logger.CodAzione.Esito.OK);
                }
                //Fine Celeste
            }
            catch (Exception e)
            {
                //Celeste 
                BusinessLogic.UserLog.UserLog.WriteLog(infoutente, "DOCUMENTOGETDETTAGLIODOCUMENTO", docNumber, VarDescOggetto, DocsPaVO.Logger.CodAzione.Esito.KO);
                //Fine Celeste

                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoGetDettaglioDocumento", e);
                schedaDocumento = null;
            }

            return schedaDocumento;
        }


        /// <summary>
        /// </summary>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.documento.Oggetto))]
        public virtual ArrayList DocumentoGetListaOggetti(DocsPaVO.documento.QueryOggetto queryOggetto)
        {
            ArrayList listaOggetti = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                listaOggetti = BusinessLogic.Documenti.ProtoManager.getListaOggetti(queryOggetto);
#if TRACE_WS
				pt.WriteLogTracer("DocumentoGetListaOggetti");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoGetListaOggetti", e);

                listaOggetti = null;
            }

            return listaOggetti;
        }

        /// <summary>
        /// </summary>
        /// 

        [WebMethod]
        public virtual bool documentoCreaSegnaturaXML(DocsPaVO.documento.SchedaDocumento schedaDocumento,
                                                    DocsPaVO.utente.InfoUtente infoUtente,
                                                    DocsPaVO.utente.Ruolo ruolo,
                                                    bool confermaRic,
                                                    out string segnaturaXML)
        {
            SetUserId(infoUtente);
            bool esito = false;
            segnaturaXML = null;
            DocsPaVO.utente.Corrispondente mittente = null;
            try
            {


                //25/11/2009 se c' il mittente nel protocollo, allora inserisco quest'ultimo nella segnatura.xml.
                if (((DocsPaVO.documento.ProtocolloUscita)(schedaDocumento.protocollo)).mittente != null)
                    mittente = ((DocsPaVO.documento.ProtocolloUscita)(schedaDocumento.protocollo)).mittente;
                else
                    mittente = BusinessLogic.Utenti.UserManager.getCorrispondente(infoUtente.idCorrGlobali, false);

                //prendo il validatore
                string validator = this.Server.MapPath("XML/Segnatura.dtd");

                // scrivo segnatura.xml
                esito = BusinessLogic.Interoperabilit.InteroperabilitaInvioSegnatura.creaSegnaturaComplessiva(
                                        mittente,
                                        schedaDocumento.registro,
                                        schedaDocumento,
                                        confermaRic,
                                        validator,
                                        out segnaturaXML
                                        );

                if (!esito)
                    logger.Debug("Errore in DocsPaWS.asmx  - metodo: documentoCreaSegnaturaXML - Errore Creazione segnatura.xml ");
            }
            catch (Exception e)
            {
                logger.Debug("Errore in documentoCreaSegnaturaXML: ", e);
            }

            return esito;
        }

        [WebMethod]
        public virtual DocsPaVO.documento.SchedaDocumento AggiornaProtocollo(DocsPaVO.documento.SchedaDocumento schedaDocumento, DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.utente.Ruolo ruolo, out DocsPaVO.documento.ResultProtocollazione risultatoProtocollazione)
        {
            SetUserId(infoUtente);
            DocsPaVO.documento.SchedaDocumento result = null;
            string VarDescOggetto = string.Empty;
            string WebMethodName;
            risultatoProtocollazione = DocsPaVO.documento.ResultProtocollazione.OK;

            //Celeste
            if (schedaDocumento.systemId != null)
                WebMethodName = "DOCUMENTOPROTOCOLLA2";
            else
                WebMethodName = "DOCUMENTOPROTOCOLLA";
            //Fine Celeste

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Documenti.ProtoManager.protocollaPerAggiorna(schedaDocumento, ruolo, infoUtente, out risultatoProtocollazione);
                result = schedaDocumento;
#if TRACE_WS
				pt.WriteLogTracer("DocumentoProtocolla");
#endif

                //Celeste
                if (result != null)
                {
                    if (schedaDocumento.protocollo != null)
                        VarDescOggetto = string.Format("{0}{1} / {2}{3}", "N.ro Doc.: ", schedaDocumento.docNumber, "Segnatura: ", schedaDocumento.protocollo.segnatura);
                    else
                        VarDescOggetto = string.Format("{0}{1}", "N.ro Doc.: ", schedaDocumento.docNumber);

                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, WebMethodName, schedaDocumento.systemId, VarDescOggetto, DocsPaVO.Logger.CodAzione.Esito.OK);
                }
                //Fine Celeste
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoProtocolla", e);
                if (risultatoProtocollazione != DocsPaVO.documento.ResultProtocollazione.DOCUMENTO_GIA_PROTOCOLLATO)
                {
                    if (risultatoProtocollazione == null)
                        risultatoProtocollazione = DocsPaVO.documento.ResultProtocollazione.APPLICATION_ERROR;
                    result = null;
                }
                else
                {
                    risultatoProtocollazione = DocsPaVO.documento.ResultProtocollazione.DOCUMENTO_GIA_PROTOCOLLATO;
                    result = BusinessLogic.Documenti.DocManager.getDettaglio(infoUtente, schedaDocumento.systemId, schedaDocumento.docNumber);
                }

                //Celeste
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, WebMethodName, null, VarDescOggetto, DocsPaVO.Logger.CodAzione.Esito.KO);
                //Fine Celeste
            }

            return result;
        }


        [WebMethod]
        public virtual DocsPaVO.documento.SchedaDocumento DocumentoProtocolla(DocsPaVO.documento.SchedaDocumento schedaDocumento, DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.utente.Ruolo ruolo, out DocsPaVO.documento.ResultProtocollazione risultatoProtocollazione)
        {
            SetUserId(infoUtente);
            logger.Info("BEGIN");
            DocsPaVO.documento.SchedaDocumento result = null;
            string VarDescOggetto = string.Empty;
            string WebMethodName;
            risultatoProtocollazione = DocsPaVO.documento.ResultProtocollazione.OK;
            bool isPredisposed = schedaDocumento.systemId != null;
            //Celeste
            if (schedaDocumento.systemId != null)
                WebMethodName = "DOCUMENTOPROTOCOLLA2";
            else
                WebMethodName = "DOCUMENTOPROTOCOLLA";
            //Fine Celeste

            try
            {
                bool daRepertoriare = false;
                if (schedaDocumento.template != null && !string.IsNullOrEmpty(schedaDocumento.template.ID_TIPO_ATTO)
                    && schedaDocumento.template.ELENCO_OGGETTI != null && schedaDocumento.template.ELENCO_OGGETTI.Count > 0)
                {
                    DocsPaVO.ProfilazioneDinamica.OggettoCustom ogg = (from o in schedaDocumento.template.ELENCO_OGGETTI.Cast<DocsPaVO.ProfilazioneDinamica.OggettoCustom>()
                                                                       where o.TIPO.DESCRIZIONE_TIPO.Equals("Contatore") && o.REPERTORIO.Equals("1")
                                                                       && o.CONTATORE_DA_FAR_SCATTARE && string.IsNullOrEmpty(o.VALORE_DATABASE)
                                                                       select o).FirstOrDefault();
                    if (ogg != null)
                        daRepertoriare = true;
                }
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Documenti.ProtoManager.protocolla(schedaDocumento, ruolo, infoUtente, out risultatoProtocollazione);
                result = schedaDocumento;
#if TRACE_WS
				pt.WriteLogTracer("DocumentoProtocolla");
#endif

                //Celeste
                if (result != null)
                {
                    if (schedaDocumento.protocollo != null)
                        VarDescOggetto = string.Format("{0}{1} / {2}{3}", "N.ro Doc.: ", schedaDocumento.docNumber, "Segnatura: ", schedaDocumento.protocollo.segnatura);
                    else
                        VarDescOggetto = string.Format("{0}{1}", "N.ro Doc.: ", schedaDocumento.docNumber);

                    if (isPredisposed)
                        BusinessLogic.UserLog.UserLog.WriteLog(infoUtente.userId, infoUtente.idPeople, infoUtente.idGruppo, infoUtente.idAmministrazione, "RECORDPREDISPOSED", schedaDocumento.systemId,
                                    VarDescOggetto, DocsPaVO.Logger.CodAzione.Esito.OK, infoUtente.delegato, "1");
                    else
                        BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, WebMethodName, schedaDocumento.systemId, VarDescOggetto, DocsPaVO.Logger.CodAzione.Esito.OK);

                    if (!string.IsNullOrEmpty(schedaDocumento.systemId) && daRepertoriare)
                    {
                        string numRep = getSegnaturaRepertorioNoHTML(schedaDocumento.docNumber, AmmGetInfoAmmCorrente(infoUtente.idAmministrazione).Codice);
                        BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTO_REPERTORIATO", schedaDocumento.systemId, "Repertoriato documento: " + numRep, DocsPaVO.Logger.CodAzione.Esito.OK);
                    }

                    BusinessLogic.Documenti.DocManager.UpdateLastDocumentsView(result.systemId, infoUtente);
                    #region event FOLLOW_DOC_EXT_APP

                    //l'evento FOLLOW_DOC_EXT_APP scatta in seguito alla protocollazione  del documento
                    string description = "UpdMetaDataDoc#Eseguita la protocollazione del documento " + schedaDocumento.systemId;
                    string method = "FOLLOWDOCEXTAPP";
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente.userId, infoUtente.idPeople, infoUtente.idGruppo,
                        infoUtente.idAmministrazione, method, schedaDocumento.systemId, description, DocsPaVO.Logger.CodAzione.Esito.OK,
                        (infoUtente != null && infoUtente.delegato != null ? infoUtente.delegato : null), "1", null);

                    #endregion
                }
                //Fine Celeste
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoProtocolla", e);
                logger.Info("END");
                if (risultatoProtocollazione != DocsPaVO.documento.ResultProtocollazione.DOCUMENTO_GIA_PROTOCOLLATO)
                {
                    if (risultatoProtocollazione == null)
                        risultatoProtocollazione = DocsPaVO.documento.ResultProtocollazione.APPLICATION_ERROR;
                    result = null;
                }
                else
                {
                    risultatoProtocollazione = DocsPaVO.documento.ResultProtocollazione.DOCUMENTO_GIA_PROTOCOLLATO;
                    result = BusinessLogic.Documenti.DocManager.getDettaglio(infoUtente, schedaDocumento.systemId, schedaDocumento.docNumber);
                }

                //Celeste
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, WebMethodName, null, VarDescOggetto, DocsPaVO.Logger.CodAzione.Esito.KO);
                //Fine Celeste
            }
            logger.Info("END");
            return result;
        }


        #region protocollo emergenza

        [WebMethod]
        public virtual DocsPaVO.documento.resultProtoEmergenza documentoImportaProtocolloEmergenza(DocsPaVO.documento.ProtocolloEmergenza protoEmergenza, DocsPaVO.utente.InfoUtente infoUtente)
        {
            SetUserId(infoUtente);
            DocsPaVO.documento.resultProtoEmergenza res = null;
            try
            {
                //gestione tracer
#if TRACE_WS
					DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                res = BusinessLogic.Documenti.ProtocolloEmergenza.importaProtoEmergenza(protoEmergenza, infoUtente);
#if TRACE_WS
					pt.WriteLogTracer("DocumentoSetFlagDaInviare");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: documentoImportaProtocolloEmergenza", e);
                return res;
            }
            return res;
        }

        #endregion


        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual bool DocumentoExecAddLavoro(string idProfile, string tipoProto, DocsPaVO.fascicolazione.Fascicolo fasc, DocsPaVO.utente.InfoUtente infoUtente, string idRegistro)
        {
            SetUserId(infoUtente);
            bool result = true; // Presume successo

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                BusinessLogic.Documenti.areaLavoroManager.execAddLavoroMethod(idProfile, tipoProto, idRegistro, infoUtente, fasc);
#if TRACE_WS
				pt.WriteLogTracer("DocumentoExecAddLavoro");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoExecAddLavoro", e);

                result = false;
            }

            return result;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual bool DocumentoExecAnnullaProt(DocsPaVO.utente.InfoUtente infoUtente, ref DocsPaVO.documento.SchedaDocumento schedaDocumento, DocsPaVO.documento.ProtocolloAnnullato protAnn)
        {
            SetUserId(infoUtente);
            bool retValue = false;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                retValue = BusinessLogic.Documenti.ProtoManager.annullaProtocollo(infoUtente, ref schedaDocumento, protAnn);
                //Fine Celeste
#if TRACE_WS
				pt.WriteLogTracer("DocumentoExecAnnullaProt");
#endif

                if (retValue)
                {
                    //BusinessLogic.UserLog.UserLog.WriteLog ((infoUtente, "DOCUMENTOEXECANNULLAPROT", schedaDocumento.systemId, string.Format("{0}{1}", "Annullamento Protocollo con Segnatura: ", schedaDocumento.protocollo.segnatura), DocsPaVO.Logger.CodAzione.Esito.OK, infoUtente.delegato, "1");
                    //Modifica inserimento in log per notificare, nel nuovo centro notifiche, l'evento annullamento protocollo
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente.userId, infoUtente.idPeople, infoUtente.idGruppo, infoUtente.idAmministrazione, "DOCUMENTOEXECANNULLAPROT", schedaDocumento.systemId,
                                    string.Format("{0}{1}", "Annullamento Protocollo con Segnatura: ", schedaDocumento.protocollo.segnatura), DocsPaVO.Logger.CodAzione.Esito.OK, infoUtente.delegato, "1");

                    #region event FOLLOW_DOC_EXT_APP

                    //l'evento FOLLOW_DOC_EXT_APP scatta in seguito all' annullamento di un protocollo
                    string description = "CancelProto#Annullamento Protocollo con Segnatura: " + schedaDocumento.protocollo.segnatura;
                    string method = "FOLLOWDOCEXTAPP";
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente.userId, infoUtente.idPeople, infoUtente.idGruppo,
                        infoUtente.idAmministrazione, method, schedaDocumento.systemId, description, DocsPaVO.Logger.CodAzione.Esito.OK,
                        (infoUtente != null && infoUtente.delegato != null ? infoUtente.delegato : null), "1", null);

                    #endregion
                }
            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOEXECANNULLAPROT", protAnn.autorizzazione, string.Format("{0}{1}", "Annullamento Protocollo con Segnatura: ", schedaDocumento.protocollo.segnatura), DocsPaVO.Logger.CodAzione.Esito.KO);
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoExecAnnullaProt", e);
                retValue = false;
            }

            return retValue;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual DocsPaVO.areaLavoro.AreaLavoro DocumentoGetAreaLavoro(DocsPaVO.utente.Utente utente, DocsPaVO.utente.Ruolo ruolo, DocsPaVO.areaLavoro.TipoOggetto tipoObj, DocsPaVO.areaLavoro.TipoDocumento tipoDoc, DocsPaVO.areaLavoro.TipoFascicolo tipoFasc, string idRegistro, bool enableUffRef)
        {
            SetUserId(utente);
            DocsPaVO.areaLavoro.AreaLavoro al = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                al = BusinessLogic.Documenti.areaLavoroManager.getAreaLavoro(utente, ruolo, tipoObj, tipoDoc, tipoFasc, idRegistro, enableUffRef);
#if TRACE_WS
				pt.WriteLogTracer("DocumentoGetAreaLavoro");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoGetAreaLavoro", e);
                al = null;
            }

            return al;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual DocsPaVO.areaLavoro.AreaLavoro DocumentoGetAreaLavoroPaging(DocsPaVO.utente.Utente utente, DocsPaVO.utente.Ruolo ruolo, bool enableUffRef, DocsPaVO.areaLavoro.TipoOggetto tipoObj, DocsPaVO.areaLavoro.TipoDocumento tipoDoc, DocsPaVO.areaLavoro.TipoFascicolo tipoFasc, string chaDaProto, int numPage, out int numTotPage, out int nRec, string idRegistro)
        {
            SetUserId(utente);
            DocsPaVO.areaLavoro.AreaLavoro al = null;

            numTotPage = 0;
            nRec = 0;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                al = BusinessLogic.Documenti.areaLavoroManager.getAreaLavoroPaging(utente, ruolo, tipoObj, tipoDoc, tipoFasc, idRegistro, enableUffRef, chaDaProto, numPage, out numTotPage, out nRec);
#if TRACE_WS
				pt.WriteLogTracer("DocumentoGetAreaLavoroPaging");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoGetAreaLavoroPaging", e);
                al = null;
            }

            return al;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual DocsPaVO.areaLavoro.AreaLavoro DocumentoGetAreaLavoroPaging1(DocsPaVO.utente.Utente utente, DocsPaVO.utente.Ruolo ruolo, bool enableUffRef, DocsPaVO.areaLavoro.TipoOggetto tipoObj, DocsPaVO.areaLavoro.TipoDocumento tipoDoc, DocsPaVO.areaLavoro.TipoFascicolo tipoFasc, string chaDaProto, int numPage, DocsPaVO.filtri.FiltroRicerca[][] query, out int numTotPage, out int nRec, string idRegistro)
        {
            SetUserId(utente);
            DocsPaVO.areaLavoro.AreaLavoro al = null;

            numTotPage = 0;
            nRec = 0;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                al = BusinessLogic.Documenti.areaLavoroManager.getAreaLavoroPaging(utente, ruolo, tipoObj, tipoDoc, tipoFasc, idRegistro, enableUffRef, chaDaProto, numPage, out numTotPage, out nRec, query);
#if TRACE_WS
				pt.WriteLogTracer("DocumentoGetAreaLavoroPaging");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoGetAreaLavoroPaging", e);
                al = null;
            }

            return al;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual bool DocumentoCancellaAreaLavoro(string idPeople, string idRuoloInUO, string idProfile, DocsPaVO.fascicolazione.Fascicolo fasc)
        {
            bool result = true; // Presume successo

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                BusinessLogic.Documenti.areaLavoroManager.cancellaAreaLavoro(idPeople, idRuoloInUO, idProfile, fasc);
#if TRACE_WS
				pt.WriteLogTracer("DocumentoCancellaAreaLavoro");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoCancellaAreaLavoro", e);
                result = false;
            }

            return result;
        }

        /// <summary>
        /// 
        /// </summary>
        /// <param name="systemId"></param>
        /// <param name="tipoProto"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual bool DocumentoScollegaCollegamento(string systemId)
        {
            bool result = true; // Presume successo

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Documenti.CateneDocManager.updateProfilePerScollegamentoDoc(systemId);
#if TRACE_WS
				pt.WriteLogTracer("DocumentoCancellaAreaLavoro");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoScollegaCollegamento", e);
                result = false;
            }

            return result;
        }

        [WebMethod]
        public virtual DocsPaVO.documento.SchedaDocumento DocumentoInoltraDoc(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.utente.Ruolo ruolo, DocsPaVO.documento.SchedaDocumento schedaDocumento)
        {
            SetUserId(infoUtente);
            DocsPaVO.documento.SchedaDocumento result = null;
            try
            {
                //result = BusinessLogic.Documenti.DocSave.InoltraDoc(infoUtente, ruolo, schedaDocumento);

                result = BusinessLogic.Documenti.DocManager.InoltraSchedaDocumento(infoUtente, ruolo, schedaDocumento.systemId);

            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoInoltraDoc", e);
                result = null;
            }

            return result;
        }


        /// <summary>
        /// 
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <param name="idDocumento"></param>
        /// <param name="anno"></param>
        /// <param name="idRegistro"></param>
        /// <returns></returns>
        [WebMethod]
        public bool ModificaDocumentoStatoFinale(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.amministrazione.ModificaAclDocumentoStatoFinale[] infoModificheList)
        {
            SetUserId(infoUtente);
            bool retValue = false;

            string idFirstDocument = string.Empty;

            if (infoModificheList.Length > 0)
                idFirstDocument = infoModificheList[0].IdDocumento;

            try
            {
                retValue = BusinessLogic.Amministrazione.DocumentoStatoFinaleManager.ModificaDocumentoStatoFinale(infoUtente, infoModificheList);
            }
            catch (Exception ex)
            {
                retValue = false;
                throw DocsPaUtils.Exceptions.SoapExceptionFactory.Create(ex);
            }
            finally
            {
                BusinessLogic.UserLog.UserLog.WriteLog(
                    infoUtente,
                    "MODIFICADOCSTATOFINALE",
                    idFirstDocument,
                    string.Format("N Doc.: {0}{1}Modificati i diritti di lettura / scrittura sul documento in stato finale", idFirstDocument, Environment.NewLine),
                    (retValue ? DocsPaVO.Logger.CodAzione.Esito.OK : DocsPaVO.Logger.CodAzione.Esito.KO));
            }

            return retValue;
        }

        /// <summary>
        /// 
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <param name="idOggetto"></param>
        /// <param name="id_Aoo_RF"></param>
        /// <param name="annoDa"></param>
        /// <param name="annoA"></param>
        /// <param name="numeroDa"></param>
        /// <param name="numeroA"></param>
        /// <param name="sbloccati"></param>
        /// <returns></returns>
        [WebMethod]
        public DocsPaVO.amministrazione.DocumentoStatoFinale[] GetDocumentiStatoFinalePerTipologia(DocsPaVO.utente.InfoUtente infoUtente, string idOggetto, string id_Aoo_RF, string annoDa, string annoA, string numeroDa, string numeroA, bool sbloccati, string IdAmministrazione)
        {
            SetUserId(infoUtente);
            try
            {
                return BusinessLogic.Amministrazione.DocumentoStatoFinaleManager.GetDocumentiStatoFinale(infoUtente, idOggetto, id_Aoo_RF, annoDa, annoA, numeroDa, numeroA, sbloccati, IdAmministrazione);
            }
            catch (Exception ex)
            {
                throw DocsPaUtils.Exceptions.SoapExceptionFactory.Create(ex);
            }
        }

        [WebMethod]
        public DocsPaVO.amministrazione.DocumentoStatoFinale[] GetDocumentiStatoFinalePerContatore(DocsPaVO.utente.InfoUtente infoUtente, string idTemplates, string idOggetto, string id_Aoo_RF, string anno, string numero, bool sbloccati, string IdAmministrazione)
        {
            SetUserId(infoUtente);
            try
            {
                return BusinessLogic.Amministrazione.DocumentoStatoFinaleManager.GetDocumentiStatoFinale(infoUtente, idTemplates, idOggetto, id_Aoo_RF, anno, numero, sbloccati, IdAmministrazione);
            }
            catch (Exception ex)
            {
                throw DocsPaUtils.Exceptions.SoapExceptionFactory.Create(ex);
            }
        }

        /// <summary>
        /// 
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <param name="idTemplate"></param>
        /// <param name="anno"></param>
        /// <param name="sbloccati"></param>
        /// <returns></returns>
        [WebMethod]
        public DocsPaVO.amministrazione.DocumentoStatoFinale[] GetDocumentiStatoFinalePerTipologiaDocumento(DocsPaVO.utente.InfoUtente infoUtente, string idTemplate, string anno, bool sbloccati, string IdAmministrazione)
        {
            SetUserId(infoUtente);
            try
            {
                return BusinessLogic.Amministrazione.DocumentoStatoFinaleManager.GetDocumentiStatoFinale(infoUtente, idTemplate, anno, sbloccati, IdAmministrazione);
            }
            catch (Exception ex)
            {
                throw DocsPaUtils.Exceptions.SoapExceptionFactory.Create(ex);
            }
        }



        /// <summary>
        /// 
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <param name="idDocumento"></param>
        /// <param name="anno"></param>
        /// <param name="idRegistro"></param>
        /// <returns></returns>
        [WebMethod]
        public DocsPaVO.amministrazione.DocumentoStatoFinale[] GetDocumentiStatoFinale(
            DocsPaVO.utente.InfoUtente infoUtente,
            string idDocumento, string anno, string idRegistro, bool sbloccati, string IdTipologia, string IdAmministrazione, bool Protocollati)
        {
            SetUserId(infoUtente);
            try
            {
                return BusinessLogic.Amministrazione.DocumentoStatoFinaleManager.GetDocumentiStatoFinale(infoUtente, idDocumento, anno, idRegistro, sbloccati, IdTipologia, Protocollati, IdAmministrazione);
            }
            catch (Exception ex)
            {
                throw DocsPaUtils.Exceptions.SoapExceptionFactory.Create(ex);
            }
        }

        [WebMethod]
        public virtual DocsPaVO.documento.SchedaDocumento DocumentoRiproponiConCopiaDoc(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.utente.Ruolo ruolo, DocsPaVO.documento.SchedaDocumento schedaDocumento)
        {
            SetUserId(infoUtente);
            DocsPaVO.documento.SchedaDocumento result = null;
            try
            {
                result = BusinessLogic.Documenti.DocManager.CloneSchedaDocumento(infoUtente, schedaDocumento.systemId);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoRiproponiConCopiaDoc", e);
                result = null;
            }

            return result;
        }


        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual DocsPaVO.documento.SchedaDocumento DocumentoSaveDocumento(DocsPaVO.utente.Ruolo ruolo, DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.documento.SchedaDocumento schedaDocumento, bool enableUffRef, out bool daAggiornareUffRef)
        {
            SetUserId(infoUtente);
            DocsPaVO.documento.SchedaDocumento result = null;
            daAggiornareUffRef = false;
            try
            {

#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif

                bool docModOggetto = schedaDocumento.oggetto.daAggiornare;
                bool docModMitt = false;
                bool docModDest = false;
                bool docModDestCC = false;
                // INC000000576488
                // all'atto di primo salvataggio di un predisposto non deve essere loggato l'evento di inserimento di un mittente/destinatario
                bool predisponi = false;
                if (schedaDocumento != null && schedaDocumento.predisponiProtocollazione != null && schedaDocumento.predisponiProtocollazione)
                    predisponi = true;


                switch (schedaDocumento.tipoProto)
                {
                    case "A":
                        if (((DocsPaVO.documento.ProtocolloEntrata)schedaDocumento.protocollo).daAggiornareMittente)
                            docModMitt = true;
                        break;

                    case "P":
                        if (((DocsPaVO.documento.ProtocolloUscita)schedaDocumento.protocollo).daAggiornareMittente)
                            docModMitt = true;
                        if (((DocsPaVO.documento.ProtocolloUscita)schedaDocumento.protocollo).daAggiornareDestinatari)
                            docModDest = true;
                        if (((DocsPaVO.documento.ProtocolloUscita)schedaDocumento.protocollo).daAggiornareDestinatariConoscenza)
                            docModDestCC = true;
                        break;

                    case "I":
                        if (((DocsPaVO.documento.ProtocolloInterno)schedaDocumento.protocollo).daAggiornareMittente)
                            docModMitt = true;
                        if (((DocsPaVO.documento.ProtocolloInterno)schedaDocumento.protocollo).daAggiornareDestinatari)
                            docModDest = true;
                        if (((DocsPaVO.documento.ProtocolloInterno)schedaDocumento.protocollo).daAggiornareDestinatariConoscenza)
                            docModDestCC = true;
                        break;
                }
                bool daRepertoriare = false;
                if (schedaDocumento.template != null && !string.IsNullOrEmpty(schedaDocumento.template.ID_TIPO_ATTO)
                    && schedaDocumento.template.ELENCO_OGGETTI != null && schedaDocumento.template.ELENCO_OGGETTI.Count > 0)
                {
                    DocsPaVO.ProfilazioneDinamica.OggettoCustom ogg = (from o in schedaDocumento.template.ELENCO_OGGETTI.Cast<DocsPaVO.ProfilazioneDinamica.OggettoCustom>()
                                                                       where o.TIPO.DESCRIZIONE_TIPO.Equals("Contatore") && o.REPERTORIO.Equals("1")
                                                                       && o.CONTATORE_DA_FAR_SCATTARE && string.IsNullOrEmpty(o.VALORE_DATABASE)
                                                                       select o).FirstOrDefault();
                    if (ogg != null)
                        daRepertoriare = true;
                }
                result = BusinessLogic.Documenti.DocSave.save(infoUtente, schedaDocumento, enableUffRef, out daAggiornareUffRef, ruolo);

#if TRACE_WS
				pt.WriteLogTracer("DocumentoSaveDocumento");
#endif
                //Celeste
                if (result != null)
                {
                    if (docModOggetto || docModDest || docModMitt || docModDestCC)
                    {
                        if (docModOggetto)
                        {
                            if (schedaDocumento.tipoProto != "G")
                                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente.userId, infoUtente.idPeople, infoUtente.idGruppo, infoUtente.idAmministrazione, "MODIFIEDOBJECTPROTO", schedaDocumento.systemId,
                                    "Modifica oggetto del Protocollo " + schedaDocumento.protocollo.segnatura, DocsPaVO.Logger.CodAzione.Esito.OK, infoUtente.delegato, "1");
                            else
                                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente.userId, infoUtente.idPeople, infoUtente.idGruppo, infoUtente.idAmministrazione, "MODIFIEDOBJECTDOC", result.docNumber,
                                    "Modifica oggetto del Documento " + result.docNumber, DocsPaVO.Logger.CodAzione.Esito.OK, infoUtente.delegato, "0");
                        }
                        // INC000000576488
                        // all'atto di primo salvataggio di un predisposto non deve essere loggato l'evento di inserimento di un mittente/destinatario
                        if (!predisponi)
                        {
                            if (docModDest)
                                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOMODMITTDEST", schedaDocumento.systemId, "Modifica Destinatari sul Protocollo " + schedaDocumento.protocollo.segnatura, DocsPaVO.Logger.CodAzione.Esito.OK);
                            if (docModDestCC)
                                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOMODMITTDEST", schedaDocumento.systemId, "Modifica Destinatari CC sul Protocollo " + schedaDocumento.protocollo.segnatura, DocsPaVO.Logger.CodAzione.Esito.OK);
                            if (docModMitt)
                                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOMODMITTDEST", schedaDocumento.systemId, "Modifica Mittente sul Protocollo " + schedaDocumento.protocollo.segnatura, DocsPaVO.Logger.CodAzione.Esito.OK);
                        }
                        //if (docModMittInt)
                        //    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOMODMITTINT", schedaDocumento.systemId, "Modifica mittente intermedio sul Protocollo " + result.docNumber, DocsPaVO.Logger.CodAzione.Esito.OK);
                    }
                    else
                    {
                        if (schedaDocumento.tipoProto != "G")
                            BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOSAVEDOCUMENTO", schedaDocumento.systemId, string.Format("{0} {1}", "Aggiornamento Protocollo Numero ", schedaDocumento.protocollo.segnatura), DocsPaVO.Logger.CodAzione.Esito.OK);
                        else
                            BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOSAVEDOCUMENTO", schedaDocumento.systemId, string.Format("{0} {1}", "Aggiornamento Documento Numero ", result.docNumber), DocsPaVO.Logger.CodAzione.Esito.OK);
                    }

                    if (!string.IsNullOrEmpty(schedaDocumento.systemId) && daRepertoriare)
                    {
                        string numRep = getSegnaturaRepertorioNoHTML(schedaDocumento.docNumber, AmmGetInfoAmmCorrente(infoUtente.idAmministrazione).Codice);
                        BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTO_REPERTORIATO", schedaDocumento.systemId, "Repertoriato documento: " + numRep, DocsPaVO.Logger.CodAzione.Esito.OK);
                    }

                    if (result.template != null && result.template.CHA_ASSOC_MANUALE == "1" && result.template.DESCRIZIONE.ToUpper() == "FATTURA ELETTRONICA")
                    {
                        // Controllo se non viene da Tibco
                        bool daTibco = false;
                        if (result.autore != null && !string.IsNullOrEmpty(result.autore))
                        {
                            DocsPaVO.utente.Utente utaut = BusinessLogic.Utenti.UserManager.getUtenteById(result.autore);
                            if (utaut != null && !string.IsNullOrEmpty(utaut.userId) && utaut.userId.ToUpper() == "TIBCO")
                                daTibco = true;
                        }
                        // Estrazione allegati da fattura
                        if (!daTibco)
                            BusinessLogic.Amministrazione.SistemiEsterni.FattElEstrAllegatiFE(result, ruolo, infoUtente);
                    }

                    #region event FOLLOW_DOC_EXT_APP

                    //l'evento FOLLOW_DOC_EXT_APP scatta in seguito alla modifica dei metadati del documento
                    string description = "UpdMetaDataDoc#modificati i meta dati del documento " + schedaDocumento.systemId;
                    string method = "FOLLOWDOCEXTAPP";
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente.userId, infoUtente.idPeople, infoUtente.idGruppo,
                        infoUtente.idAmministrazione, method, schedaDocumento.systemId, description, DocsPaVO.Logger.CodAzione.Esito.OK,
                        (infoUtente != null && infoUtente.delegato != null ? infoUtente.delegato : null), "1", null);

                    #endregion
                }
                //Fine Celeste

            }
            catch (Exception e)
            {
                //Celeste 
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOSAVEDOCUMENTO", schedaDocumento.systemId, string.Format("{0} {1}", "N.ro Doc.", schedaDocumento.docNumber), DocsPaVO.Logger.CodAzione.Esito.KO);
                //Fine Celeste
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoSaveDocumento", e);
                result = null;
            }

            return result;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual DocsPaVO.documento.SchedaDocumento DocumentoAddDocGrigia(DocsPaVO.documento.SchedaDocumento schedaDocumento, DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.utente.Ruolo ruolo)
        {
            SetUserId(infoUtente);
            DocsPaVO.documento.SchedaDocumento result = null;
            logger.Info("BEGIN");
            try
            {
                bool daRepertoriare = false;
                if (schedaDocumento.template != null && !string.IsNullOrEmpty(schedaDocumento.template.ID_TIPO_ATTO)
                    && schedaDocumento.template.ELENCO_OGGETTI != null && schedaDocumento.template.ELENCO_OGGETTI.Count > 0)
                {
                    DocsPaVO.ProfilazioneDinamica.OggettoCustom ogg = (from o in schedaDocumento.template.ELENCO_OGGETTI.Cast<DocsPaVO.ProfilazioneDinamica.OggettoCustom>()
                                                                       where o.TIPO.DESCRIZIONE_TIPO.Equals("Contatore") && o.REPERTORIO.Equals("1")
                                                                       && o.CONTATORE_DA_FAR_SCATTARE && string.IsNullOrEmpty(o.VALORE_DATABASE)
                                                                       select o).FirstOrDefault();
                    if (ogg != null)
                        daRepertoriare = true;
                }
                //gestione tracer
#if TRACE_WS 
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Documenti.DocSave.addDocGrigia(schedaDocumento, infoUtente, ruolo);
#if TRACE_WS
				pt.WriteLogTracer("DocumentoAddDocGrigia");
#endif
                //Celeste			
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOADDDOCGRIGIA", schedaDocumento.systemId, string.Format("{0} {1}", "N.ro Doc.: ", schedaDocumento.docNumber), DocsPaVO.Logger.CodAzione.Esito.OK);
                //Fine Celeste

                //Se il documento  repertoriato scrivo il log
                if (schedaDocumento != null && !string.IsNullOrEmpty(schedaDocumento.systemId) && daRepertoriare)
                {
                    string numRep = getSegnaturaRepertorioNoHTML(schedaDocumento.docNumber, AmmGetInfoAmmCorrente(infoUtente.idAmministrazione).Codice);
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTO_REPERTORIATO", schedaDocumento.systemId, "Repertoriato documento: " + numRep, DocsPaVO.Logger.CodAzione.Esito.OK);
                }

                BusinessLogic.Documenti.DocManager.UpdateLastDocumentsView(result.systemId, infoUtente);
            }
            catch (Exception e)
            {
                //Celeste
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOADDDOCGRIGIA", schedaDocumento.systemId, string.Format("{0} {1}", "N.ro Doc.: ", schedaDocumento.docNumber), DocsPaVO.Logger.CodAzione.Esito.KO);
                //Fine Celeste
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoAddDocGrigia", e);
                result = null;
            }

            logger.Info("END");
            return result;
        }

        [WebMethod]
        public virtual bool DocumentoCambiaPersonalePrivato(string idProfile, string idGruppo)
        {
            bool result = false;
            try
            {
                result = BusinessLogic.Documenti.DocManager.CambiaPersonalePrivato(idProfile, idGruppo);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoCambiaPersonalePrivato", e);
                result = false;
            }

            return result;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.documento.DirittoOggetto))]
        public virtual ArrayList DocumentoGetVisibilita(DocsPaVO.utente.InfoUtente infoUtente, string idProfile, bool cercaRimossi)
        {
            SetUserId(infoUtente);
            ArrayList objListaDiritti = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                objListaDiritti = BusinessLogic.Utenti.DirittiManager.getListaDiritti(infoUtente, idProfile, cercaRimossi);
#if TRACE_WS
				pt.WriteLogTracer("DocumentoGetVisibilita");
#endif

            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoGetVisibilita", e);
                objListaDiritti = null;
            }

            return objListaDiritti;
        }

        /// <summary>
        /// Rimuove i diritti di visibilit ad un utente/ruolo per un dato documento
        /// </summary>
        /// <param name="docDiritto"></param>
        /// <param name="personOrGroup"></param>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual bool EditingACL(DocsPaVO.documento.DirittoOggetto docDiritto, string personOrGroup, DocsPaVO.utente.InfoUtente infoUtente)
        {
            SetUserId(infoUtente);
            bool result = true;
            string descrizione = "";
            try
            {
                result = BusinessLogic.Documenti.DocManager.EditingACL(out descrizione, docDiritto, personOrGroup, infoUtente);
                if (result)
                {
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "EDITINGACL", docDiritto.idObj, descrizione, DocsPaVO.Logger.CodAzione.Esito.OK);
                }
            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "EDITINGACL", docDiritto.idObj, descrizione, DocsPaVO.Logger.CodAzione.Esito.KO);
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: EditingACL", e);
                result = false;
            }
            return result;
        }

        /// <summary>
        /// Ripristina i diritti di visibilita per un ruolo/utente di un documento precedentemente revocati
        /// </summary>
        /// <param name="docDiritto"></param>
        /// <param name="personOrGroup"></param>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual bool RipristinaACL(DocsPaVO.documento.DirittoOggetto docDiritto, string personOrGroup, DocsPaVO.utente.InfoUtente infoUtente)
        {
            SetUserId(infoUtente);
            bool result = true;
            string descrizione = "";
            try
            {
                result = BusinessLogic.Documenti.DocManager.RipristinaACL(out descrizione, docDiritto, personOrGroup, infoUtente);
                if (result)
                {
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "EDITINGACL", docDiritto.idObj, descrizione, DocsPaVO.Logger.CodAzione.Esito.OK);
                }
            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "EDITINGACL", docDiritto.idObj, descrizione, DocsPaVO.Logger.CodAzione.Esito.KO);
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: RipristinaACL", e);
                result = false;
            }
            return result;
        }

        /// <summary>
        /// Verifica se per un dato documento/fascicolo ci sono dei diritti rimossi
        /// </summary>
        /// <param name="idProfile"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual int VerificaDeletedACL(string idObj, DocsPaVO.utente.InfoUtente infoUtente)
        {
            SetUserId(infoUtente);
            int result = -1;
            try
            {
                result = BusinessLogic.Documenti.DocManager.VerificaDeletedACL(idObj, infoUtente);

            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: VerificaDeletedACL", e);
                result = -1;
            }
            return result;
        }

        /// <summary>
        /// Verifica i diritti per un dato documento/fascicolo
        /// </summary>
        /// <param name="idObj"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual int VerificaACL(string tipoObj, string idObj, DocsPaVO.utente.InfoUtente infoUtente, out string errorMessage)
        {
            SetUserId(infoUtente);
            int result = -1;
            errorMessage = "";
            try
            {
                result = BusinessLogic.Documenti.DocManager.VerificaACL(tipoObj, idObj, infoUtente, out errorMessage);

            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: VerificaDeletedACL", e);
                result = -1;
            }
            return result;
        }



        [WebMethod]
        ///[return: XmlArray()]
        //[return: XmlArrayItem(typeof(DocsPaVO.trasmissione.infoToDoList))]
        public virtual bool RimuoviToDoListACL(string idTrasmUtente, string idTrasmSingola, string idPeople)
        {
            BusinessLogic.Trasmissioni.TrasmManager trasmManager = new BusinessLogic.Trasmissioni.TrasmManager();
            return trasmManager.RimuoviToDoListACL(idTrasmUtente, idTrasmSingola, idPeople);
        }

        /// <summary>
        /// Recupera la storia dei diritti rimossi, ceduti, revocati per un dato documento
        /// </summary>
        /// <param name="idProfile"></param>
        /// <returns></returns>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.documento.StoriaDirittoDocumento))]
        public virtual ArrayList DocumentoGetStoriaVisibilita(string idProfile, string tipoObj, DocsPaVO.utente.InfoUtente infoUtente)
        {
            SetUserId(infoUtente);
            ArrayList objListaDiritti = null;
            try
            {
                objListaDiritti = BusinessLogic.Utenti.DirittiManager.getListaStoriaDiritti(idProfile, tipoObj, infoUtente);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoGetStoriaVisibilita", e);
                objListaDiritti = null;
            }
            return objListaDiritti;
        }

        /// <summary>
        /// Rimuove i diritti di visibilit ad un utente/ruolo per un dato fascicolo
        /// </summary>
        /// <param name="fascDiritto"></param>
        /// <param name="personOrGroup"></param>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual bool EditingFascACL(DocsPaVO.fascicolazione.DirittoOggetto fascDiritto, string personOrGroup, DocsPaVO.utente.InfoUtente infoUtente)
        {
            SetUserId(infoUtente);
            bool result = true;
            string descrizione = "";
            try
            {
                result = BusinessLogic.Fascicoli.FascicoloManager.EditingFascACL(out descrizione, fascDiritto, personOrGroup, infoUtente);
                if (result)
                {
                    //BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "EDITINGACL", docDiritto.idObj, descrizione, DocsPaVO.Logger.CodAzione.Esito.OK);
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "EDITINGFASCACL", fascDiritto.idObj, descrizione, DocsPaVO.Logger.CodAzione.Esito.OK);
                }
            }
            catch (Exception e)
            {
                //BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "EDITINGACL", docDiritto.idObj, descrizione, DocsPaVO.Logger.CodAzione.Esito.KO);
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "EDITINGFASCACL", fascDiritto.idObj, descrizione, DocsPaVO.Logger.CodAzione.Esito.KO);
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: EditingFascACL", e);
                result = false;
            }
            return result;
        }

        /// <summary>
        /// Ripristina i diritti di visibilita per un ruolo/utente di un fascicolo precedentemente revocati
        /// </summary>
        /// <param name="fascDiritto"></param>
        /// <param name="personOrGroup"></param>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual bool RipristinaFascACL(DocsPaVO.fascicolazione.DirittoOggetto fascDiritto, string personOrGroup, DocsPaVO.utente.InfoUtente infoUtente)
        {
            SetUserId(infoUtente);
            bool result = true;
            string descrizione = "";
            try
            {
                result = BusinessLogic.Fascicoli.FascicoloManager.RipristinaFascACL(out descrizione, fascDiritto, personOrGroup, infoUtente);
                if (result)
                {
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "EDITINGFASCACL", fascDiritto.idObj, descrizione, DocsPaVO.Logger.CodAzione.Esito.OK);
                }
            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "EDITINGFASCACL", fascDiritto.idObj, descrizione, DocsPaVO.Logger.CodAzione.Esito.KO);
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: RipristinaFascACL", e);
                result = false;
            }
            return result;
        }


        #region Metodo Commentato
        //		[WebMethod]
        //		public virtual string DocumentoGetSegnaturaCampiVariabili(DocsPaVO.documento.SchedaDocumento schedaDocumento,string[] campiVariabili,DocsPaVO.utente.InfoUtente infoUtente)
        //		{
        //			//string[] campiVariabili=new string[]{"1","2"};
        //			//DocsPaDM.utils.CommonObjects co = new DocsPaDM.utils.CommonObjects(infoUtente, machineName);
        //			//return documenti.Protocollo.calcolaSegnaturaCampiVariabili(schedaDocumento,co,campiVariabili);
        //			return schedaDocumento.protocollo.segnatura;
        //		}
        #endregion

        /// <summary>
        /// </summary>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.documento.ParolaChiave))]
        public virtual ArrayList DocumentoGetParoleChiave(string idAmministrazione)
        {
            ArrayList objListaParole = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                objListaParole = BusinessLogic.Documenti.ParoleManager.getParoleChiaveMethod(idAmministrazione);
#if TRACE_WS
				pt.WriteLogTracer("DocumentoGetParoleChiave");
#endif

            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoGetParoleChiave", e);
                objListaParole = null;
            }

            return objListaParole;
        }


        #region DOCUMENTI RIMOSSI-CESTINATI

        /// <summary>
        /// Restituisce la lista di tutti i documenti in cestino
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.documento.InfoDocumento))]
        public virtual ArrayList DocumentoGetDocInCestino(DocsPaVO.utente.InfoUtente infoUtente)
        {
            SetUserId(infoUtente);
            ArrayList listaDoc = null;
            try
            {
                listaDoc = BusinessLogic.Documenti.DocManager.GetListaDocInCestino(infoUtente);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoGetDocInCestino", e);
                listaDoc = null;
            }
            return listaDoc;

        }

        /// <summary>
        /// Restituisce la lista dei documenti in cestino in base al filtro impostato
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <param name="filtriRicerca"></param>
        /// <returns></returns>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.documento.InfoDocumento))]
        public virtual ArrayList DocumentoGetDocInCestinoFiltro(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.filtri.FiltroRicerca[][] filtriRicerca)
        {
            SetUserId(infoUtente);
            ArrayList listaDoc = null;
            try
            {
                listaDoc = BusinessLogic.Documenti.DocManager.GetListaDocInCestino(infoUtente, filtriRicerca);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoGetDocInCestino", e);
                listaDoc = null;
            }
            return listaDoc;

        }

        [WebMethod]
        public virtual string VerificaDirittiCestinaDocumento(DocsPaVO.utente.InfoUtente infoutente, DocsPaVO.documento.SchedaDocumento schedaDoc)
        {
            SetUserId(infoutente);
            string result = "";
            try
            {
                result = BusinessLogic.Documenti.DocManager.VerificaDiritti(infoutente, schedaDoc);
            }
            catch (Exception e)
            {
                logger.Debug(e.ToString());
            }
            return result;
        }

        /// <summary>
        /// Cestina i documenti grigi e predisposti alla protocollazione
        /// </summary>
        /// <param name="infoutente"></param>
        /// <param name="schedaDoc"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual bool DocumentoExecCestina(DocsPaVO.utente.InfoUtente infoutente, DocsPaVO.documento.SchedaDocumento schedaDoc, string tipoDoc, string note, out string errorMsg)
        {
            SetUserId(infoutente);
            errorMsg = string.Empty;
            bool result = true;
            try
            {
                result = BusinessLogic.Documenti.DocManager.CestinaDocumento(infoutente, schedaDoc, tipoDoc, note, out errorMsg);
                BusinessLogic.UserLog.UserLog.WriteLog(infoutente, "DOCUMENTOEXECRIMUOVISCHEDA", schedaDoc.systemId, string.Format("{0} {1}", "Spostamento in cestino del Doc. N.ro:", schedaDoc.docNumber), DocsPaVO.Logger.CodAzione.Esito.OK);
                if (result)
                {
                    #region event FOLLOW_DOC_EXT_APP

                    //traccio l'evento FOLLOW_DOC_EXT_APP
                    string method = "FOLLOWDOCEXTAPP";
                    string description = "RemovedDoc#Spostamento in cestino del Doc. N.ro:" + schedaDoc.docNumber; ;
                    BusinessLogic.UserLog.UserLog.WriteLog(infoutente.userId, infoutente.idPeople, infoutente.idGruppo,
                        infoutente.idAmministrazione, method, schedaDoc.docNumber, description, DocsPaVO.Logger.CodAzione.Esito.OK,
                        (infoutente != null && infoutente.delegato != null ? infoutente.delegato : null), "1");

                    #endregion
                }
            }
            catch (Exception e)
            {
                logger.Debug(e.ToString());
                BusinessLogic.UserLog.UserLog.WriteLog(infoutente, "DOCUMENTOEXECRIMUOVISCHEDA", schedaDoc.systemId, string.Format("{0} {1}", "Spostamento in cestino del Doc. N.ro:", schedaDoc.docNumber), DocsPaVO.Logger.CodAzione.Esito.KO);
            }
            return result;
        }


        /// <summary>
        /// Riattiva un documento grigio o predisposto
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <param name="numDoc"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual bool DocumentoRiattivaDoc(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.documento.InfoDocumento infoDocumento)
        {
            SetUserId(infoUtente);
            bool result = false;
            try
            {
                result = BusinessLogic.Documenti.DocManager.RiattivaDocumento(infoUtente, infoDocumento);
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTORIATTIVADOC", infoDocumento.docNumber, string.Format("{0} {1}", "Riattivazione del Doc. N.ro:", infoDocumento.docNumber), DocsPaVO.Logger.CodAzione.Esito.OK);
            }
            catch (Exception e)
            {
                logger.Debug(e.ToString());
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTORIATTIVADOC", infoDocumento.docNumber, string.Format("{0} {1}", "Riattivazione del Doc. N.ro:", infoDocumento.docNumber), DocsPaVO.Logger.CodAzione.Esito.KO);
            }
            return result;
        }

        /// <summary>
        /// Rimuove fisicamente tutti o un filtro di documenti grigi o predisposti fisicamente
        /// </summary>
        /// <param name="docInCestino"></param>
        /// <param name="infoUtente"></param>
        /// <param name="ListaDoc"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual bool SvuotaCestino(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.documento.InfoDocumento[] ListaDoc, out bool docInCestino)
        {
            bool result = false;
            docInCestino = false;
            try
            {
                SetUserId(infoUtente);
                result = BusinessLogic.Documenti.DocManager.SvuotaCestino(out docInCestino, infoUtente, ListaDoc);
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "SVUOTACESTINO", "0", string.Format("{0} ", "Svuotato cestino"), DocsPaVO.Logger.CodAzione.Esito.OK);
            }

            catch (Exception e)
            {
                logger.Debug(e.ToString());
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "SVUOTACESTINO", "0", string.Format("{0} ", "Svuotato cestino"), DocsPaVO.Logger.CodAzione.Esito.KO);
            }
            return result;
        }

        /// <summary>
        /// Elimina fisicamente un singolo documento grigio o predisposto
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <param name="infoDoc"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual bool EliminaDoc(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.documento.InfoDocumento infoDoc)
        {
            SetUserId(infoUtente);
            bool result = false;
            try
            {
                result = BusinessLogic.Documenti.DocManager.EliminaDoc(infoUtente, infoDoc);
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "ELIMINADOC", infoDoc.docNumber, string.Format("{0} {1}", "Eliminato documento numero: ", infoDoc.docNumber), DocsPaVO.Logger.CodAzione.Esito.OK);
            }

            catch (Exception e)
            {
                logger.Debug(e.ToString());
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "ELIMINADOC", infoDoc.docNumber, string.Format("{0} {1}", "Eliminato documento numero:", infoDoc.docNumber), DocsPaVO.Logger.CodAzione.Esito.KO);

                throw DocsPaUtils.Exceptions.SoapExceptionFactory.Create(e);
            }
            return result;
        }

        /// <summary>
        /// Vecchio WebMethod --> NON SI UTILIZZA PIU'
        /// Rimuove un dato documento grigio senza trasmission, n in area lavoro etc
        /// </summary>
        /// <param name="infoutente"></param>
        /// <param name="schedaDoc"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual string DocumentoExecRimuoviScheda(DocsPaVO.utente.InfoUtente infoutente, DocsPaVO.documento.SchedaDocumento schedaDoc)
        {
            SetUserId(infoutente);
            //bool result = true; // Presume successo
            string result = "";
            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Documenti.DocManager.ExecRimuoviSchedaMethod(infoutente, schedaDoc);
#if TRACE_WS
				pt.WriteLogTracer("DocumentoExecRimuoviScheda");
#endif
                //Celeste
                BusinessLogic.UserLog.UserLog.WriteLog(infoutente, "DOCUMENTOEXECRIMUOVISCHEDA", schedaDoc.systemId, string.Format("{0} {1}", "N.ro Doc.:", schedaDoc.docNumber), DocsPaVO.Logger.CodAzione.Esito.OK);
                //Fine Celeste
            }
            catch (Exception e)
            {
                logger.Debug(e.ToString());
                //result = false;
                //Celeste 
                BusinessLogic.UserLog.UserLog.WriteLog(infoutente, "DOCUMENTOEXECRIMUOVISCHEDA", schedaDoc.systemId, string.Format("{0} {1}", "N.ro Doc.:", schedaDoc.docNumber), DocsPaVO.Logger.CodAzione.Esito.KO);
                //Fine Celeste
            }
            return result;
        }

        #endregion

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual string AllegatoIsPEC(string version_id)
        {
            string retValue = string.Empty;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                retValue = BusinessLogic.Documenti.AllegatiManager.getIsAllegatoPEC(version_id);
#if TRACE_WS
				pt.WriteLogTracer("DocumentoGetAllegati");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AllegatoIsPEC", e);
                logger.Debug(e.ToString());
                retValue = null;
            }
            return retValue;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual string AllegatoIsIS(string version_id)
        {
            string retValue = string.Empty;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                retValue = BusinessLogic.Documenti.AllegatiManager.getIsAllegatoIS(version_id);
#if TRACE_WS
				pt.WriteLogTracer("DocumentoGetAllegati");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AllegatoIsPEC", e);
                logger.Debug(e.ToString());
                retValue = null;
            }
            return retValue;
        }


        /// <summary>
        /// </summary>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.documento.Allegato))]
        public virtual ArrayList DocumentoGetAllegati(string docNumber, string filterAllegatiPec, string simplifiedInteroperabilityId = "")
        {
            ArrayList result = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Documenti.AllegatiManager.getAllegati(docNumber, filterAllegatiPec, simplifiedInteroperabilityId);
#if TRACE_WS
				pt.WriteLogTracer("DocumentoGetAllegati");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoGetAllegati", e);
                logger.Debug(e.ToString());
                result = null;
            }
            return result;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual DocsPaVO.documento.Allegato DocumentoAggiungiAllegato(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.documento.Allegato allegato)
        {
            SetUserId(infoUtente);
            string schedaDocnumber = allegato.docNumber;
            DocsPaVO.documento.Allegato res = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                res = BusinessLogic.Documenti.AllegatiManager.aggiungiAllegato(infoUtente, allegato);
#if TRACE_WS
				pt.WriteLogTracer("DocumentoAggiungiAllegato");
#endif
                //Celeste
                if (res != null)
                {
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOAGGIUNGIALLEGATO", allegato.docNumber, string.Format("{0}{1}{2}{3}{4}{5}", "Aggiunto al N.ro Doc.: ", schedaDocnumber, " il N.ro Allegato: ", res.versionLabel, " con Id: ", allegato.docNumber), DocsPaVO.Logger.CodAzione.Esito.OK);
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCNEWALLEGATO", schedaDocnumber, string.Format("{0}{1}{2}{3}", "Aggiunto al N.ro Doc.: ", schedaDocnumber, " il N.ro Allegato: ", res.versionLabel), DocsPaVO.Logger.CodAzione.Esito.OK);
                }
                //Fine Celeste
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoAggiungiAllegato", e);
                res = null;
                //Celeste
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOAGGIUNGIALLEGATO", allegato.docNumber, string.Format("{0}{1}{2}{3}", "Aggiunto al N.ro Doc.: ", schedaDocnumber, " il N.ro Allegato: ", res.versionLabel), DocsPaVO.Logger.CodAzione.Esito.KO);
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCNEWALLEGATO", schedaDocnumber, string.Format("{0}{1}{2}{3}", "Aggiunto al N.ro Doc.: ", schedaDocnumber, " il N.ro Allegato: ", res.versionLabel), DocsPaVO.Logger.CodAzione.Esito.KO);
                //Fine Celeste
            }

            return res;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual bool DocumentoModificaAllegato(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.documento.Allegato allegato, string idDocumentoPrincipale)
        {
            SetUserId(infoUtente);
            bool result = true; // Presume successo

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                BusinessLogic.Documenti.AllegatiManager.modificaAllegato(infoUtente, allegato);
#if TRACE_WS
				pt.WriteLogTracer("DocumentoModificaAllegato");
#endif
                #region event FOLLOW_DOC_EXT_APP
                if (!string.IsNullOrEmpty(idDocumentoPrincipale))
                {
                    //l'evento FOLLOW_DOC_EXT_APP scatta in seguito alla modifica dei metadati del documento
                    string description = "UpdMetaDataDoc#modificati i meta dati dell'allegato " + allegato.docNumber + " con descrizione " + allegato.descrizione + " del documento " + idDocumentoPrincipale;
                    string method = "FOLLOWDOCEXTAPP";
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente.userId, infoUtente.idPeople, infoUtente.idGruppo,
                        infoUtente.idAmministrazione, method, idDocumentoPrincipale, description, DocsPaVO.Logger.CodAzione.Esito.OK,
                        (infoUtente != null && infoUtente.delegato != null ? infoUtente.delegato : null), "1", null);
                }
                #endregion

            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoModificaAllegato", e);
                result = false;
            }

            return result;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual bool DocumentoRimuoviVersione(DocsPaVO.documento.FileRequest fileRequest, DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.documento.SchedaDocumento schedaDocumento)
        {
            SetUserId(infoUtente);
            bool result = false;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                if (schedaDocumento != null && schedaDocumento.protocollo != null && !string.IsNullOrEmpty(schedaDocumento.protocollo.segnatura))
                {
                    result = false;
                }
                else
                {
                    result = BusinessLogic.Documenti.VersioniManager.removeVersion(fileRequest, infoUtente);
                }
#if TRACE_WS
				pt.WriteLogTracer("DocumentoRimuoviVersione");
#endif
                if (result)
                {
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTORIMUOVIVERSIONE", schedaDocumento.docNumber, string.Format("{0}{1}", "Rimozione versione al doc: ", schedaDocumento.docNumber), DocsPaVO.Logger.CodAzione.Esito.OK);

                    #region event FOLLOW_DOC_EXT_APP

                    //traccio l'evento FOLLOW_DOC_EXT_APP
                    string description = string.Empty;
                    string idDocMain = string.Empty;
                    string method = "FOLLOWDOCEXTAPP";
                    if (schedaDocumento.documentoPrincipale != null)
                    {
                        /*l'evento FOLLOW_DOC_EXT_APP scatta in seguito all'eliminazione di una delle versioni di uno degli 
                         * allegati del documento.
                         */
                        idDocMain = schedaDocumento.documentoPrincipale.docNumber;
                        description = "RemovedVersionAttachDoc#Rimossa una versione dell'allegato " + fileRequest.docNumber +
                            " associato al documento " + idDocMain;
                    }
                    else
                    {
                        //l'evento FOLLOW_DOC_EXT_APP scatta in seguito all'eliminazione di una delle versioni del documento
                        idDocMain = fileRequest.docNumber;
                        description = "RemoveVersionDoc#Rimossa una versione del documento " + idDocMain;
                    }
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente.userId, infoUtente.idPeople, infoUtente.idGruppo,
                        infoUtente.idAmministrazione, method, idDocMain, description, DocsPaVO.Logger.CodAzione.Esito.OK,
                        (infoUtente != null && infoUtente.delegato != null ? infoUtente.delegato : null), "1", null);

                    #endregion

                }
            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTORIMUOVIVERSIONE", schedaDocumento.docNumber, string.Format("{0}{1}", "Rimozione versione al doc: ", schedaDocumento.docNumber), DocsPaVO.Logger.CodAzione.Esito.KO);
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoRimuoviVersione ", e);
                result = false;
            }

            return result;
        }

        [WebMethod]
        public virtual ImportResult DocumentoRimuoviVersioniDaGrigio(string idProfile, DocsPaVO.utente.InfoUtente infoUtente, BusinessLogic.Documenti.RemoveVersionType type)
        {
            SetUserId(infoUtente);
            ImportResult result = new ImportResult();
            try
            {
                result = BusinessLogic.Documenti.VersioniManager.RemoveOldVersionsFromGrey(idProfile, infoUtente, type);
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTORIMUOVIVERSIONE", idProfile, string.Format("{0}{1}", "Rimozione versione al doc: ", idProfile), DocsPaVO.Logger.CodAzione.Esito.OK);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx - metodo: DocumentoRimuoviVersioniDaGrigio ", e);
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTORIMUOVIVERSIONE", idProfile, string.Format("{0}{1}", "Rimozione versione al doc: ", idProfile), DocsPaVO.Logger.CodAzione.Esito.KO);
                result = null;
            }
            return result;
        }

        [WebMethod]
        public virtual ImportResult DocumentoRimuoviVersioniDaGrigioAM(string idProfile, DocsPaVO.utente.InfoUtente infoUtente, BusinessLogic.Documenti.RemoveVersionType type)
        {
            SetUserId(infoUtente);
            ImportResult result = new ImportResult();
            try
            {
                result = BusinessLogic.Documenti.VersioniManager.RemoveOldVersionsFromGrey(idProfile, infoUtente, type);
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTORIMUOVIVERSIONE", idProfile, string.Format("{0}{1}", "Azione Massiva - Rimozione versione al doc: ", idProfile), DocsPaVO.Logger.CodAzione.Esito.OK);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx - metodo: DocumentoRimuoviVersioniDaGrigio ", e);
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTORIMUOVIVERSIONE", idProfile, string.Format("{0}{1}", "Azione Massiva - Rimozione versione al doc: ", idProfile), DocsPaVO.Logger.CodAzione.Esito.KO);
                result = null;
            }
            return result;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual bool DocumentoRimuoviAllegato(DocsPaVO.documento.Allegato allegato, DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.documento.SchedaDocumento schedaDocumento)
        {
            SetUserId(infoUtente);
            bool result = false;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Documenti.AllegatiManager.rimuoviAllegato(allegato, infoUtente);
#if TRACE_WS
				pt.WriteLogTracer("DocumentoRimuoviVersione");
#endif
                if (result)
                {
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTORIMUOVIALLEGATO", schedaDocumento.docNumber, string.Format("{0}{1}{2}{3}", "Rimozione allegato ", allegato.descrizione, " al doc: ", schedaDocumento.docNumber), DocsPaVO.Logger.CodAzione.Esito.OK);

                    #region event FOLLOW_DOC_EXT_APP

                    //traccio l'evento FOLLOW_DOC_EXT_APP
                    string method = "FOLLOWDOCEXTAPP";
                    string description = "RemovedAttachDoc#Rimozione allegato " + allegato.descrizione + " al doc: " + schedaDocumento.docNumber;
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente.userId, infoUtente.idPeople, infoUtente.idGruppo,
                        infoUtente.idAmministrazione, method, schedaDocumento.docNumber, description, DocsPaVO.Logger.CodAzione.Esito.OK,
                        (infoUtente != null && infoUtente.delegato != null ? infoUtente.delegato : null), "1");

                    #endregion
                }
            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTORIMUOVIALLEGATO", schedaDocumento.docNumber, string.Format("{0}{1}{2}{3}", "Rimozione allegato ", allegato.descrizione, "al doc: ", schedaDocumento.docNumber), DocsPaVO.Logger.CodAzione.Esito.KO);
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoRimuoviAllegato", e);
                result = false;
            }

            return result;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual DocsPaVO.documento.FileRequest DocumentoAggiungiVersione(DocsPaVO.documento.FileRequest fileRequest, DocsPaVO.utente.InfoUtente infoUtente)
        {
            SetUserId(infoUtente);
            logger.Info("BEGIN");
            DocsPaVO.documento.FileRequest fileReq = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                fileReq = BusinessLogic.Documenti.VersioniManager.addVersion(fileRequest, infoUtente, false);
#if TRACE_WS
				pt.WriteLogTracer("DocumentoAggiungiVersione");
#endif
                //Celeste
                if (fileReq != null)
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOAGGIUNGIVERSIONE", fileReq.docNumber, string.Format("{0}{1}{2}{3}", "Aggiunta al N.ro Doc.: ", fileReq.docNumber, " la Ver. ", fileReq.version), DocsPaVO.Logger.CodAzione.Esito.OK);
                //Fine Celeste
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoAggiungiVersione", e);
                fileReq = null;
                //Celeste
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOAGGIUNGIVERSIONE", fileRequest.docNumber, string.Format("{0}{1}{2}{3}", "Aggiunta al N.ro Doc.: ", fileReq.docNumber, " la Ver. ", fileReq.version), DocsPaVO.Logger.CodAzione.Esito.KO);
                //Fine Celeste
            }
            logger.Info("END");

            /*
            //ABBATANGELI DA ELIMINARE test libro firma (NON DEVE ESSERE RILASCIATO!!! )
            string method2 = "DOC_SIGNATURE";
            string description2 = "Il documento  stato firmato";
            BusinessLogic.UserLog.UserLog.WriteLog(infoUtente.userId, infoUtente.idPeople, infoUtente.idGruppo, infoUtente.idAmministrazione, method2, fileRequest.docNumber,
                description2, DocsPaVO.Logger.CodAzione.Esito.OK, (infoUtente != null && infoUtente.delegato != null ? infoUtente.delegato : null), "1");
            */
            return fileReq;
        }

        /// <summary>
        /// 
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <param name="allegato"></param>
        /// <param name="documento"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual bool DocumentoScambiaAllegato(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.documento.Allegato allegato, DocsPaVO.documento.Documento documento)
        {
            SetUserId(infoUtente);
            bool result = true; // Presume successo

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Documenti.AllegatiManager.scambiaAllegatoDocumento(infoUtente, allegato, documento);

#if TRACE_WS
				pt.WriteLogTracer("DocumentoScambiaVersioni");
#endif
                if (result)
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "SCAMBIA_DOC", documento.docNumber, string.Format("{0} {1} {2} {3}", "Scambio del documento Nr. ", documento.docNumber, " con l'allegato ", allegato.versionLabel + " (" + allegato.descrizione + ")"), DocsPaVO.Logger.CodAzione.Esito.OK);
                else
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "SCAMBIA_DOC", documento.docNumber, string.Format("{0} {1} {2} {3}", "Scambio del documento Nr. ", documento.docNumber, " con l'allegato ", allegato.versionLabel), DocsPaVO.Logger.CodAzione.Esito.KO);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoScambiaAllegato", e);
                result = false;
            }

            return result;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual bool DocumentoModificaVersione(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.documento.FileRequest fileReq)
        {
            SetUserId(infoUtente);
            bool result = true; // Presume successo

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                BusinessLogic.Documenti.VersioniManager.modificaVersione(infoUtente, fileReq);
#if TRACE_WS
				pt.WriteLogTracer("DocumentoModificaVersione");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoModificaVersione", e);
                result = false;
            }

            return result;
        }

        /// <summary>
        /// Setta a 1 cha_segnatura se la versione contiene un documento in formato pdf, con segnatura impressa
        /// </summary>
        /// <returns>
        /// bool che indica l'esito dell'operazione di update
        /// </returns>
        [WebMethod]
        public virtual bool DocumentoVersioneConSegnatura(DocsPaVO.utente.InfoUtente infoUtente, string versionId)
        {
            SetUserId(infoUtente);
            bool result = true; // Presume successo

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                return BusinessLogic.Documenti.VersioniManager.ModifyVersionSegnatura(infoUtente, versionId);
#if TRACE_WS
				pt.WriteLogTracer("DocumentoVersioneConSegnatura");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoVersioneConSegnatura", e);
                result = false;
            }
            return false;
        }

        /// <summary>
        /// Informa se la versione ha associato un file con impressa la segnatura
        /// </summary>
        /// <returns>
        /// bool che indica se la versione ha associato un file con impressa segnatura o meno
        /// </returns>
        [WebMethod]
        public virtual bool IsVersionWithSegnature(DocsPaVO.utente.InfoUtente infoUtente, string versionId)
        {
            SetUserId(infoUtente);
            bool result = true; // Presume successo

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                return BusinessLogic.Documenti.VersioniManager.IsVersionWithSegnature(infoUtente, versionId);
#if TRACE_WS
				pt.WriteLogTracer("IsVersionWithSegnature");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: IsVersionWithSegnature", e);
                result = false;
            }
            return false;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.documento.TipologiaAtto))]
        public virtual ArrayList DocumentoGetTipologiaAtto()
        {
            ArrayList result = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Documenti.DocManager.getTipologiaAtto();
#if TRACE_WS
				pt.WriteLogTracer("DocumentoGetTipologiaAtto");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoGetTipologiaAtto", e);
                result = null;
            }
            return result;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(string))]
        public ArrayList GetVisibilitaRuoli(string docNumber, string idGruppi)
        {
            ArrayList result = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                BusinessLogic.Utenti.UserManager um = new BusinessLogic.Utenti.UserManager();
                result = um.getVisibilitaRuolo(docNumber, idGruppi);
#if TRACE_WS
				pt.WriteLogTracer("GetVisibilitaRuoli");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetVisibilitaRuoli", e);
                result = null;
            }
            return result;
        }

        #region Metodo Commentato
        //		[WebMethod]			
        //		[return:XmlArray()]
        //		[return:XmlArrayItem(typeof(DocsPaVO.documento.TipologiaCanale))]
        //		public virtual ArrayList DocumentoGetTipologiaCanale(DocsPaVO.utente.InfoUtente infoUtente) 
        //		{
        //			ArrayList result = null;
        //			
        //			try 
        //			{
        //				result = DocsPaWS.documenti.DocManager.getTipologiaCanale();			
        //			} 
        ////			catch(Exception e) 
        ////			{
        ////				ErrorHandler.throwFault(e.Message,e.failReason,Context.Request.Url.AbsoluteUri);
        ////			} 
        //			catch(Exception e) 
        //			{
        //				//ErrorHandler.throwFault(e.Message,"F_System",Context.Request.Url.AbsoluteUri);
        //				
        //				result = null;
        //			}
        //
        //			return result;
        //		}
        #endregion

        [WebMethod]
        public virtual DocsPaVO.Interoperabilita.SendDocumentResponse DocumentoSpedisciMail(DocsPaVO.documento.SchedaDocumento schedaDocumento, DocsPaVO.utente.InfoUtente infoUtente, string mailAddress, bool confermaRic)
        {
            SetUserId(infoUtente);
            DocsPaVO.Interoperabilita.SendDocumentResponse result = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Documenti.ProtocolloUscitaManager.spedisci(schedaDocumento, mailAddress, infoUtente, confermaRic);
#if TRACE_WS
				pt.WriteLogTracer("DocumentoSpedisci");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoSpedisciMail", e);
            }
            finally
            {
                // Scrittura log relativo alla spedizione del documento
                this.WriteLogSendDocument(schedaDocumento, infoUtente, result);
                if (BusinessLogic.Interoperabilit.InteroperabilitaUtils.Cfg_BacthInteroperabilita)
                    result = null;
            }

            return result;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual DocsPaVO.Interoperabilita.SendDocumentResponse DocumentoSpedisci(DocsPaVO.documento.SchedaDocumento schedaDocumento, DocsPaVO.utente.InfoUtente infoUtente, bool confermaRic)
        {
            SetUserId(infoUtente);
            DocsPaVO.Interoperabilita.SendDocumentResponse result = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Documenti.ProtocolloUscitaManager.spedisci(schedaDocumento, infoUtente, confermaRic);
#if TRACE_WS
				pt.WriteLogTracer("DocumentoSpedisci");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoSpedisci", e);
            }
            finally
            {
                // Scrittura log relativo alla spedizione del documento
                this.WriteLogSendDocument(schedaDocumento, infoUtente, result);
                if (BusinessLogic.Interoperabilit.InteroperabilitaUtils.Cfg_BacthInteroperabilita)
                    result = null;
            }

            return result;
        }

        /// <summary>
        /// Metodo per l'invio di una mail qual'ora la spedizione ha superato il limite consetito dei destinatari
        /// </summary>
        [WebMethod]
        public virtual void SendMailSupportForDocumentDelivery(DocsPaVO.documento.SchedaDocumento schedaDocumento, DocsPaVO.utente.Utente infoUtente, DocsPaVO.utente.Ruolo ruolo)
        {
            try
            {
                BusinessLogic.Spedizione.SpedizioneManager.SendMailSupportForDocumentDelivery(schedaDocumento, infoUtente, ruolo);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: SendMailSupportForDocumentDelivery", e);
            }
        }

        /// <summary>
        /// Scrittura log relativo alla spedizione di un documento
        /// </summary>
        /// <param name="schedaDocumento"></param>
        /// <param name="infoUtente"></param>
        /// <param name="sendDocumentResponse"></param>
        private void WriteLogSendDocument(DocsPaVO.documento.SchedaDocumento schedaDocumento,
            DocsPaVO.utente.InfoUtente infoUtente,
            DocsPaVO.Interoperabilita.SendDocumentResponse sendDocumentResponse)
        {
            SetUserId(infoUtente);
            DocsPaVO.Logger.CodAzione.Esito esito = DocsPaVO.Logger.CodAzione.Esito.OK;

            string logInfo = "Spedizione documento";
            logInfo += Environment.NewLine + " - Id documento: " + schedaDocumento.docNumber;
            if (schedaDocumento.protocollo != null)
                logInfo += Environment.NewLine + " - Segnatura: " + schedaDocumento.protocollo.segnatura;

            if (!sendDocumentResponse.SendSucceded)
            {
                foreach (DocsPaVO.Interoperabilita.SendDocumentResponse.SendDocumentMailResponse mailResponse in sendDocumentResponse.SendDocumentMailResponseList)
                {
                    if (!mailResponse.SendSucceded)
                    {
                        if (logInfo != string.Empty)
                            logInfo += ";" + Environment.NewLine;

                        logInfo += " - " + mailResponse.MailAddress;
                    }
                }

                logInfo += Environment.NewLine + Environment.NewLine + " - Errore nella spedizione dei documenti ai seguenti indirizzi:" + Environment.NewLine;
                esito = DocsPaVO.Logger.CodAzione.Esito.KO;
            }
            else
            {
                logInfo += Environment.NewLine + Environment.NewLine + " - Documento spedito correttamente a tutti i destinatari";
            }

            BusinessLogic.UserLog.UserLog.WriteLog(
                infoUtente.userId,
                infoUtente.idPeople,
                infoUtente.idGruppo,
                infoUtente.idAmministrazione,
                "INTEROPERABILITASPEDIZIONE",
                schedaDocumento.registro.systemId,
                logInfo,
                esito, null);
        }

        #region Metodo Commentato
        //		[WebMethod]
        //		[return:XmlArray()]
        //		[return:XmlArrayItem(typeof(DocsPaVO.documento.Applicazione))]
        //		public virtual System.Collections.ArrayList DocumentoGetApplicazioni(DocsPaVO.utente.InfoUtente infoUtente) 
        //		{
        //			ArrayList result = null;
        //			try 
        //			{
        //				result = FileManager.getApplicazioni(null);			
        //			} 
        ////			catch(Exception e) 
        ////			{
        ////				ErrorHandler.throwFault(e.Message,e.failReason,Context.Request.Url.AbsoluteUri);
        ////			} 
        //			catch(Exception e) 
        //			{
        //				//ErrorHandler.throwFault(e.Message,"F_System",Context.Request.Url.AbsoluteUri);
        //				
        //				result = null;
        //			}
        //
        //			return result;
        //		}
        #endregion

        [WebMethod]
        public virtual bool AppendDocumentoFirmato
            (string base64content,
            bool cofirma,
            ref DocsPaVO.documento.FileRequest fileRequest,
            DocsPaVO.utente.InfoUtente infoUtente)
        {
            SetUserId(infoUtente);
            bool retValue = false;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                retValue = BusinessLogic.Documenti.SignedFileManager.AppendDocumentoFirmato(base64content, cofirma, ref fileRequest, infoUtente);
#if TRACE_WS
				pt.WriteLogTracer("DocumentoVerificaFirma");
#endif
                //Emanuela 03/02/2014 MEV FONDIMPRESA: se la firma al documento  andata a buon fine, occorre prevedere
                //linvio  della notifica informativa connessa allevento di firma di un documento al ruolo proprietario
                if (retValue)
                {
                    string method = "DOC_SIGNATURE";
                    string description = "Il documento  stato firmato";

                    // Non viene settato nel FE
                    //if (massSignature.fileRequest.inLibroFirma)
                    if (BusinessLogic.LibroFirma.LibroFirmaManager.IsDocInLibroFirma(fileRequest.docNumber))
                    {
                        BusinessLogic.LibroFirma.LibroFirmaManager.AggiornaDataEsecuzioneElemento(fileRequest.docNumber, DocsPaVO.LibroFirma.TipoStatoElemento.FIRMATO.ToString());
                        BusinessLogic.LibroFirma.LibroFirmaManager.SalvaStoricoIstanzaProcessoFirmaByDocnumber(fileRequest.docNumber, description, infoUtente);
                    }

                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente.userId, infoUtente.idPeople, infoUtente.idGruppo, infoUtente.idAmministrazione, method, fileRequest.docNumber,
                        description, DocsPaVO.Logger.CodAzione.Esito.OK, (infoUtente != null && infoUtente.delegato != null ? infoUtente.delegato : null), "0");
                }
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AppendDocumentoFirmato", e);
            }

            return retValue;
        }

        [WebMethod]
        public virtual bool AppendContentFirmato
            (byte[] sigedContent,
            bool cofirma,
            ref DocsPaVO.documento.FileRequest fileRequest,
            DocsPaVO.utente.InfoUtente infoUtente)
        {
            SetUserId(infoUtente);
            bool retValue = false;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                retValue = BusinessLogic.Documenti.SignedFileManager.AppendDocumentoFirmato(sigedContent, cofirma, ref fileRequest, infoUtente);
#if TRACE_WS
				pt.WriteLogTracer("DocumentoVerificaFirma");
#endif
                //Emanuela 03/02/2014 MEV FONDIMPRESA: se la firma al documento  andata a buon fine, occorre prevedere
                //linvio  della notifica informativa connessa allevento di firma di un documento al ruolo proprietario
                if (retValue)
                {
                    string method = "DOC_SIGNATURE";
                    string description = "Il documento  stato firmato";

                    // Non viene settato nel FE
                    //if (massSignature.fileRequest.inLibroFirma)
                    if (BusinessLogic.LibroFirma.LibroFirmaManager.IsDocInLibroFirma(fileRequest.docNumber))
                    {
                        BusinessLogic.LibroFirma.LibroFirmaManager.AggiornaDataEsecuzioneElemento(fileRequest.docNumber, DocsPaVO.LibroFirma.TipoStatoElemento.FIRMATO.ToString());
                        BusinessLogic.LibroFirma.LibroFirmaManager.SalvaStoricoIstanzaProcessoFirmaByDocnumber(fileRequest.docNumber, description, infoUtente);
                    }

                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente.userId, infoUtente.idPeople, infoUtente.idGruppo, infoUtente.idAmministrazione, method, fileRequest.docNumber,
                        description, DocsPaVO.Logger.CodAzione.Esito.OK, (infoUtente != null && infoUtente.delegato != null ? infoUtente.delegato : null), "0");
                }
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AppendDocumentoFirmato", e);
            }

            return retValue;
        }
        //		/// <summary>
        //		/// </summary>
        //		[WebMethod]			
        //		public virtual DocsPaVO.documento.FirmaResult DocumentoVerificaFirma(string base64content,DocsPaVO.documento.FileRequest fileReq, bool cofirma, DocsPaVO.utente.InfoUtente infoUtente) 
        //		{
        //			DocsPaVO.documento.FirmaResult result = null;
        //
        //			try 
        //			{
        //				//gestione tracer
        //#if TRACE_WS
        //				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
        //#endif
        //				result = BusinessLogic.Documenti.VerificaFirma.verificaFirmaMethod(base64content,fileReq,infoUtente,cofirma,true);			
        //#if TRACE_WS
        //				pt.WriteLogTracer("DocumentoVerificaFirma");
        //#endif
        //			} 
        //			catch(Exception e) 
        //			{
        //				logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoVerificaFirma",e);
        //				result = null;
        //			}
        //
        //			return result;
        //		}

        /// <summary>
        /// </summary>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.documento.StoricoOggetto))]
        public virtual System.Collections.ArrayList DocumentoGetListaStoriciOggetto(string idProfile)
        {
            ArrayList result = null;
            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Documenti.Oggettario.getListaStoriciOggetto(idProfile);
#if TRACE_WS
				pt.WriteLogTracer("DocumentoGetListaStoriciOggetto");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoGetListaStoriciOggetto", e);
                result = null;
            }

            return result;
        }
        #region storico campi profilati
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.ProfilazioneDinamica.StoricoProfilati))]
        public virtual ArrayList DocumentoGetListaStoricoProfilati(string id_tipo_atto, string doc_number, string idGroup)
        {
            ArrayList result = new ArrayList();
            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.getListaStoricoAtto(id_tipo_atto, doc_number, idGroup);
#if TRACE_WS
				pt.WriteLogTracer("getListaStoricoAtto");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoGetListaStoricoOggetto", e);
                result = null;
            }

            return result;
        }

        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.ProfilazioneDinamica.StoricoProfilati))]
        public virtual ArrayList FascicoloGetListaStoricoProfilati(string id_tipo_fasc, string idProject)
        {
            ArrayList result = new ArrayList();
            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.ProfilazioneDinamica.ProfilazioneFascicoli.getListaStoricoFascicolo(id_tipo_fasc, idProject);
#if TRACE_WS
				pt.WriteLogTracer("getListaStoricoAtto");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicoloGetListaStoricoOggetto", e);
                result = null;
            }

            return result;
        }
        #endregion

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual DocsPaVO.documento.SchedaDocumento DocumentoSetFlagDaInviare(DocsPaVO.documento.SchedaDocumento schedaDocumento)
        {
            DocsPaVO.documento.SchedaDocumento result = null;
            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Documenti.FileManager.setFlagDaInviare(schedaDocumento);
#if TRACE_WS
				pt.WriteLogTracer("DocumentoSetFlagDaInviare");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoSetFlagDaInviare", e);
                result = null;
            }
            return result;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual DocsPaVO.documento.Oggetto DocumentoAddOggetto(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.documento.Oggetto oggetto, DocsPaVO.utente.Registro registro, ref string errMsg)
        {
            SetUserId(infoUtente);
            DocsPaVO.documento.Oggetto result = null;
            string idAmministrazione = infoUtente.idAmministrazione;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Documenti.Oggettario.inserisciOggetto(idAmministrazione, oggetto, registro, ref errMsg);
#if TRACE_WS
				pt.WriteLogTracer("DocumentoAddOggetto");
#endif
                if (result != null)
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOINSOGGETTO", oggetto.systemId, "Inserimento oggetto " + oggetto.descrizione + " in oggettario", DocsPaVO.Logger.CodAzione.Esito.OK);
            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOINSOGGETTO", oggetto.systemId, "Inserimento oggetto " + oggetto.descrizione + " in oggettario", DocsPaVO.Logger.CodAzione.Esito.KO);
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoAddOggetto", e);
                result = null;
            }

            return result;
        }

        ///// <summary>
        //      /// </summary>
        //      [WebMethod]
        //      public virtual DocsPaVO.documento.Oggetto DocumentoModOggetto(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.documento.Oggetto oggettoOld,DocsPaVO.documento.Oggetto oggettoNew, DocsPaVO.utente.Registro registro, ref string errMsg) 
        //      {
        //         DocsPaVO.documento.Oggetto result = null;
        //            string idAmministrazione = infoUtente.idAmministrazione;

        //         try 
        //         {
        //            //gestione tracer
        //#if TRACE_WS
        //            DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
        //#endif
        //            result = BusinessLogic.Documenti.Oggettario.ModificaOggettoNew(idAmministrazione, oggettoOld,oggettoNew, registro, ref errMsg);
        //#if TRACE_WS
        //            pt.WriteLogTracer("DocumentoAddOggetto");
        //#endif
        //                if (result != null)
        //                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOMODOGGETTO", oggetto.systemId, "Modifica oggetto " + oggetto.descrizione + " in oggettario", DocsPaVO.Logger.CodAzione.Esito.OK);
        //         }
        //         catch(Exception e) 
        //         {
        //            BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOMODOGGETTO", oggetto.systemId, "Modifica oggetto " + oggetto.descrizione + " in oggettario", DocsPaVO.Logger.CodAzione.Esito.KO);
        //                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoAddOggetto", e);
        //            result = null;
        //         }

        //         return result;
        //      }


        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual bool UpdateOggetto(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.documento.Oggetto oggetto)
        {
            SetUserId(infoUtente);
            bool result = false;
            string idAmministrazione = infoUtente.idAmministrazione;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Documenti.Oggettario.modificaOggetto(idAmministrazione, oggetto);
#if TRACE_WS
				pt.WriteLogTracer("DocumentoAddOggetto");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoAddOggetto", e);
                result = false;
            }

            return result;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual DocsPaVO.documento.ParolaChiave DocumentoAddParolaChiave(string idAmministrazione, DocsPaVO.documento.ParolaChiave parolaChiave)
        {
            DocsPaVO.documento.ParolaChiave result = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Documenti.ParoleManager.inserisciParolaChiave(idAmministrazione, parolaChiave);
#if TRACE_WS
				pt.WriteLogTracer("DocumentoAddParolaChiave");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoAddParolaChiave", e);
                result = null;
            }

            return result;
        }


        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual DocsPaVO.documento.TipologiaAtto DocumentoAddTipologiaAtto(DocsPaVO.documento.TipologiaAtto tipologiaAtto, DocsPaVO.utente.InfoUtente infoUtente)
        {
            SetUserId(infoUtente);
            DocsPaVO.documento.TipologiaAtto result = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Amministrazione.AmministraManager.InsertTipoAtto(tipologiaAtto, infoUtente);
#if TRACE_WS
				pt.WriteLogTracer("DocumentoAddParolaChiave");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoAddTipologiaAtto", e);
                result = null;
            }

            return result;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual bool DocumentoAnnullaPredisposizione(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.documento.SchedaDocumento schedaDocumento)
        {
            SetUserId(infoUtente);
            bool result = false;
            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Documenti.DocManager.annullaPredisposizione(infoUtente, schedaDocumento);
#if TRACE_WS
				pt.WriteLogTracer("DocumentoAnnullaPredisposizione");
#endif
                if (result != null)
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOANNULLAPRED", schedaDocumento.systemId, "Annullamento Predisposizione per il documento " + schedaDocumento.systemId, DocsPaVO.Logger.CodAzione.Esito.OK);
            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOANNULLAPRED", schedaDocumento.systemId, "Annullamento Predisposizione per il documento " + schedaDocumento.systemId, DocsPaVO.Logger.CodAzione.Esito.KO);
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoAnnullaPredisposizione", e);
            }

            return result;
        }

        /// <summary>
        /// Reperimento oggetto "InfoDocumento" relativamente
        /// al documento mittente al documento richiesto
        /// </summary>
        /// <param name="idGruppo"></param>
        /// <param name="idPeople"></param>
        /// <param name="docNumber"></param>
        /// <param name="tipoDocumento"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual DocsPaVO.documento.InfoDocumento DocumentoGetCatenaDocumentoMittente(string idGruppo, string idPeople, string docNumber, string tipoDocumento)
        {
            try
            {
                return BusinessLogic.Documenti.CateneDocManager.GetDocumentoMittente(idGruppo, idPeople, docNumber, tipoDocumento);
            }
            catch (Exception e)
            {
                string errorMessage = "Errore in DocsPaWS.asmx  - metodo: DocumentoGetCatenaDocumentoMittente";
                logger.Debug(errorMessage, e);
                throw new ApplicationException(errorMessage, e);
            }
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual DocsPaVO.documento.AnelloDocumentale DocumentoGetCatenaDoc(string idGruppo, string idPeople, string idProfile)
        {
            DocsPaVO.documento.AnelloDocumentale result = null;
            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Documenti.CateneDocManager.getCatenaDoc(idGruppo, idPeople, idProfile);
#if TRACE_WS
				pt.WriteLogTracer("DocumentoGetCatenaDoc");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoGetCatenaDoc", e);
                result = null;
            }
            return result;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual DocsPaVO.documento.RicercaDuplicati.EsitoRicercaDuplicatiEnum DocumentoCercaDuplicatiInfo(DocsPaVO.documento.SchedaDocumento schedaDocumento, string cercaDuplicati2, out DocsPaVO.documento.InfoProtocolloDuplicato[] datiProtDupl)
        {
            DocsPaVO.documento.RicercaDuplicati.EsitoRicercaDuplicatiEnum result = DocsPaVO.documento.RicercaDuplicati.EsitoRicercaDuplicatiEnum.NessunDuplicato; // Presume successo
            datiProtDupl = new DocsPaVO.documento.InfoProtocolloDuplicato[0];

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Documenti.ProtoManager.cercaDuplicati(schedaDocumento, cercaDuplicati2, out datiProtDupl);
#if TRACE_WS
				pt.WriteLogTracer("DocumentoCercaDuplicatiInfo");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoCercaDuplicatiInfo", e);
                result = DocsPaVO.documento.RicercaDuplicati.EsitoRicercaDuplicatiEnum.ErroreGenerico;
            }

            return result;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual bool DocumentoCercaDuplicati(DocsPaVO.documento.SchedaDocumento schedaDocumento)
        {
            bool result = true; // Presume successo

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Documenti.ProtoManager.cercaDuplicati(schedaDocumento);
#if TRACE_WS
				pt.WriteLogTracer("DocumentoCercaDuplicati");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoCercaDuplicati", e);
                result = false;
            }

            return result;
        }

        /// <summary>
        /// Reperimento del numero delle trasmissioni effettuate dal documento
        /// </summary>
        /// <param name="idProfile"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual int DocumentoGetCountTrasmissioniDocumento(int idProfile)
        {
            int retValue = 0;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                retValue = BusinessLogic.Documenti.DocManager.GetCountTrasmissioniDocumento(idProfile);
#if TRACE_WS
				pt.WriteLogTracer("DocumentoGetCountTrasmissioniDocumento");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoGetCountTrasmissioniDocumento", e);
                retValue = 0;
            }

            return retValue;
        }

        [WebMethod]
        public virtual bool DocumentoCheckUserVisibility(string docNumber, DocsPaVO.utente.InfoUtente infoUtente)
        {
            SetUserId(infoUtente);
            bool retValue = false;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                retValue = BusinessLogic.Documenti.DocManager.DocumentoCheckUserVisibility(docNumber, infoUtente);
#if TRACE_WS
				pt.WriteLogTracer("DocumentoCheckUserVisibility");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoCheckUserVisibility", e);
            }

            return retValue;
        }

        #endregion

        #region Gestione Mezzo Spedizione
        /// <summary>
        /// Aggiornamento di un mezzo di spedizione
        /// </summary>
        /// <param name="tipoRuolo"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.Validations.ValidationResultInfo AmmUpdateMezzoSpedizione(ref DocsPaVO.amministrazione.MezzoSpedizione m_sped)
        {
            DocsPaVO.Validations.ValidationResultInfo retValue = null;

            try
            {
                retValue = BusinessLogic.Amministrazione.MezziSpedizioneManager.UpdateMezzoSpedizione(m_sped);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmUpdateMezzoSpedizione", e);
            }

            return retValue;
        }

        /// <summary>
        /// Reperimento lista mezzo spedizione in amministrazione
        /// </summary>
        /// <param name="codiceAmministrazione"></param>
        /// <returns></returns>
        [WebMethod()]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.amministrazione.MezzoSpedizione))]
        public ArrayList AmmListaMezzoSpedizione(string idAmm, bool vediTutti)
        {
            ArrayList retValue = null;

            try
            {
                retValue = BusinessLogic.Amministrazione.MezziSpedizioneManager.ListaMezziSpedizione(idAmm, vediTutti);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmGetMezzoSpedizione", e);
            }

            return retValue;
        }

        /// <summary>
        /// Reperimento mezzo spedizione in amministrazione
        /// </summary>
        /// <param name="idMezzoSpedizione"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.amministrazione.MezzoSpedizione AmmGetMezzoSpedizione(string idMezzoSpedizione)
        {
            DocsPaVO.amministrazione.MezzoSpedizione retValue = null;

            try
            {
                retValue = BusinessLogic.Amministrazione.MezziSpedizioneManager.GetMezzoSpedizione(idMezzoSpedizione);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmGetMezzoSpedizione", e);
            }

            return retValue;
        }

        /// <summary>
        /// Inserimento di un nuovo mezzo di spedizione
        /// </summary>
        /// <param name="tipoRuolo"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.Validations.ValidationResultInfo AmmInsertMezzoSpedizione(DocsPaVO.utente.InfoUtente infoUtente, ref DocsPaVO.amministrazione.MezzoSpedizione m_sped, string idAmm)
        {
            DocsPaVO.Validations.ValidationResultInfo retValue = null;
            SetUserId(infoUtente);
            try
            {
                retValue = BusinessLogic.Amministrazione.MezziSpedizioneManager.InsertMezzoSpedizione(m_sped);
                //if (retValue != null)
                //    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMNEWTIPORUOLO", tipoRuolo.IDTipoRuolo, "Creazione tipo ruolo " + tipoRuolo.Codice, DocsPaVO.Logger.CodAzione.Esito.OK, idAmm);
            }
            catch (Exception e)
            {
                //BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMNEWTIPORUOLO", tipoRuolo.IDTipoRuolo, "Creazione tipo ruolo " + tipoRuolo.Codice, DocsPaVO.Logger.CodAzione.Esito.KO, idAmm);
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmInsertTipoRuolo", e);
            }

            return retValue;
        }

        /// <summary>
        /// Cancellazione di un mezzo di spedizione
        /// </summary>
        /// <param name="mezzo spedizione"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.Validations.ValidationResultInfo AmmDeleteMezzoSpedizione(DocsPaVO.utente.InfoUtente infoUtente, ref DocsPaVO.amministrazione.MezzoSpedizione m_sped, string idAmm)
        {
            DocsPaVO.Validations.ValidationResultInfo retValue = null;
            SetUserId(infoUtente);
            try
            {
                retValue = BusinessLogic.Amministrazione.MezziSpedizioneManager.DeleteMezzoSpedizione(m_sped);
                //if (retValue != null)
                //    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMDELTIPORUOLO", tipoRuolo.IDTipoRuolo, "Cancellazione tipo ruolo " + tipoRuolo.Codice, DocsPaVO.Logger.CodAzione.Esito.OK, idAmm);
            }
            catch (Exception e)
            {
                retValue.Value = false;
                //BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMDELTIPORUOLO", tipoRuolo.IDTipoRuolo, "Cancellazione tipo ruolo " + tipoRuolo.Codice, DocsPaVO.Logger.CodAzione.Esito.KO, idAmm);
                //logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmDeleteTipoRuolo", e);
            }
            return retValue;
        }

        /// <summary>
        /// Inserimento record nella tabella di collegamento tra mezzo di spedizione e documento
        /// </summary>
        /// <param name="idAmm"></param>
        /// <param name="idRuolo"></param>
        /// <param name="idUtente"></param>
        /// <param name="idDocumentTypes"></param>
        /// <param name="idCorrGlobali"></param>
        /// <returns>bool</returns>
        [WebMethod()]
        public bool collegaMezzoSpedizioneDocumento(DocsPaVO.utente.InfoUtente info, string idDocumentTypes, string idProfile)
        {
            SetUserId(info);
            bool retValue = false;

            try
            {
                retValue = BusinessLogic.Documenti.ProtoManager.collegaMezzoSpedizioneDocumento(info, idDocumentTypes, idProfile);
                if (retValue)
                    BusinessLogic.UserLog.UserLog.WriteLog(info, "DOCUMENTOSPEDIZIONE", idProfile, "Inserimento mezzo di spedizione al documento " + idProfile, DocsPaVO.Logger.CodAzione.Esito.OK);
            }
            catch (Exception e)
            {
                retValue = false;
                BusinessLogic.UserLog.UserLog.WriteLog(info, "DOCUMENTOSPEDIZIONE", idProfile, "Inserimento mezzo di spedizione al documento " + idProfile, DocsPaVO.Logger.CodAzione.Esito.KO);
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: collegaMezzoSpedizioneDocumento", e);
            }
            return retValue;
        }

        /// <summary>
        /// Inserimento record nella tabella di collegamento tra mezzo di spedizione e documento
        /// </summary>
        /// <param name="idAmm"></param>
        /// <param name="idRuolo"></param>
        /// <param name="idUtente"></param>
        /// <param name="idDocumentTypes"></param>
        /// <param name="idCorrGlobali"></param>
        /// <returns>bool</returns>
        [WebMethod()]
        public bool updateMezzoSpedizioneDocumento(DocsPaVO.utente.InfoUtente info, string oldDocumentTypes, string idDocumentTypes, string idProfile)
        {
            SetUserId(info);
            bool retValue = false;

            try
            {
                retValue = BusinessLogic.Documenti.ProtoManager.updateMezzoSpedizioneDocumento(info, oldDocumentTypes, idDocumentTypes, idProfile);
                //if (retValue)
                //    BusinessLogic.UserLog.UserLog.WriteLog(info, "DOCUMENTOSPEDIZIONE", idProfile, "Inserimento mezzo di spedizione al documento " + idProfile, DocsPaVO.Logger.CodAzione.Esito.OK);
            }
            catch (Exception e)
            {
                retValue = false;
                //BusinessLogic.UserLog.UserLog.WriteLog(info, "DOCUMENTOSPEDIZIONE", idProfile, "Inserimento mezzo di spedizione al documento " + idProfile, DocsPaVO.Logger.CodAzione.Esito.KO);
                //logger.Debug("Errore in DocsPaWS.asmx  - metodo: collegaMezzoSpedizioneDocumento", e);
            }
            return retValue;
        }

        /// <summary>
        /// Inserimento record nella tabella di collegamento tra mezzo di spedizione e documento
        /// </summary>
        /// <param name="idAmm"></param>
        /// <param name="idRuolo"></param>
        /// <param name="idUtente"></param>
        /// <param name="idDocumentTypes"></param>
        /// <param name="idCorrGlobali"></param>
        /// <returns>bool</returns>
        [WebMethod()]
        public bool deleteMezzoSpedizioneDocumento(DocsPaVO.utente.InfoUtente info, string idProfile)
        {
            SetUserId(info);
            bool retValue = false;

            try
            {
                retValue = BusinessLogic.Documenti.ProtoManager.deleteMezzoSpedizioneDocumento(info, idProfile);
                //if (retValue)
                //    BusinessLogic.UserLog.UserLog.WriteLog(info, "DOCUMENTOSPEDIZIONE", idProfile, "Inserimento mezzo di spedizione al documento " + idProfile, DocsPaVO.Logger.CodAzione.Esito.OK);
            }
            catch (Exception e)
            {
                retValue = false;
                //BusinessLogic.UserLog.UserLog.WriteLog(info, "DOCUMENTOSPEDIZIONE", idProfile, "Inserimento mezzo di spedizione al documento " + idProfile, DocsPaVO.Logger.CodAzione.Esito.KO);
                //logger.Debug("Errore in DocsPaWS.asmx  - metodo: collegaMezzoSpedizioneDocumento", e);
            }
            return retValue;
        }

        #endregion

        #region Fascicoli
        /// <summary>
        /// </summary>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.fascicolazione.Classificazione))]
        public virtual ArrayList FascicolazioneGetTitolario(string idAmministrazione, string idGruppo, string idPeople, DocsPaVO.utente.Registro registro, string codiceClassifica, bool getFigli)
        {
            ArrayList result = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Fascicoli.TitolarioManager.getTitolario(idAmministrazione, idGruppo, idPeople, registro, codiceClassifica, getFigli);
#if TRACE_WS
				pt.WriteLogTracer("FascicolazioneGetTitolario");
#endif
                return result;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneGetTitolario", e);
                result = null;
            }

            return result;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.fascicolazione.Classificazione))]
        public virtual ArrayList FascicolazioneGetTitolario2(string idAmministrazione, string idGruppo, string idPeople, DocsPaVO.utente.Registro registro, string codiceClassifica, bool getFigli, string idTitolario)
        {
            ArrayList result = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Fascicoli.TitolarioManager.getTitolario2(idAmministrazione, idGruppo, idPeople, registro, codiceClassifica, getFigli, idTitolario);
#if TRACE_WS
				pt.WriteLogTracer("FascicolazioneGetTitolario");
#endif
                return result;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneGetTitolario", e);
                result = null;
            }

            return result;
        }


        [WebMethod]
        public virtual DocsPaVO.utente.Registro GetRegistroBySistemId(string idRegistro)
        {
            DocsPaVO.utente.Registro result = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Utenti.RegistriManager.getRegistro(idRegistro);
#if TRACE_WS
				pt.WriteLogTracer("FascicolazioneNewTitolario");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetRegistroBySistemId", e);
                result = null;
            }

            return result;
        }

        [WebMethod]
        public virtual string FascicolazioneGetCodiceFiglioTitolario(string idAmministrazione, DocsPaVO.fascicolazione.Classificazione nodoTitolario)
        {
            string result = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Fascicoli.TitolarioManager.getCodiceFiglioTitolario(idAmministrazione, nodoTitolario);
#if TRACE_WS
				pt.WriteLogTracer("FascicolazioneGetCodiceFiglioTitolario");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneGetCodiceFiglioTitolario", e);
                result = null;
            }

            return result;
        }


        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual bool FascicolazioneCanRemoveFascicolo(string project_Id, out string nFasc)
        {
            bool result = false;
            nFasc = "";
            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Fascicoli.FolderManager.getCountSottofascDoc(project_Id, out nFasc);

#if TRACE_WS
				pt.WriteLogTracer("FascicolazioneCanRemoveFascicolo");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneCanRemoveFascicolo", e);
                result = false;
            }

            return result;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual bool FascicolazioneCanRemoveFascicoloPrincipale(string project_Id, out string nDoc)
        {
            bool result = false;
            nDoc = "";

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Fascicoli.FolderManager.getCountFullSottofascDoc(project_Id, out nDoc);

#if TRACE_WS
				pt.WriteLogTracer("FascicolazioneCanRemoveFascicoloPrincipale");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneCanRemoveFascicoloPrincipale", e);
                result = false;
            }

            return result;
        }

        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.fascicolazione.DirittoOggetto))]
        public virtual ArrayList FascicolazioneGetAutorizzazioniNodoTitolario(DocsPaVO.fascicolazione.Classificazione nodoTitolario)
        {
            ArrayList result = null;
            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Fascicoli.TitolarioManager.getAutorizzazioniNodoTitolario(nodoTitolario);
#if TRACE_WS
				pt.WriteLogTracer("FascicolazioneGetAutorizzazioniNodoTitolario");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneGetAutorizzazioniNodoTitolario", e);
                result = null;
            }

            return result;
        }

        [WebMethod]
        public virtual bool FascicolazioneSetAutorizzazioniNodoTitolario(DocsPaVO.fascicolazione.Classificazione nodoTitolario, DocsPaVO.utente.Corrispondente[] corrAdd, DocsPaVO.utente.Corrispondente[] corrRemove, bool ereditaDiritti)
        {
            bool result = true; // Presume successo

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                BusinessLogic.Fascicoli.TitolarioManager.setAutorizzazioniNodoTitolario(nodoTitolario, corrAdd, corrRemove, ereditaDiritti);
#if TRACE_WS
				pt.WriteLogTracer("FascicolazioneSetAutorizzazioniNodoTitolario");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: setAutorizzazioniNodoTitolario", e);
                result = false;
            }

            return result;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.fascicolazione.Fascicolo))]
        public virtual ArrayList FascicolazioneGetAllListaFasc(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.fascicolazione.Classificazione classificazione, DocsPaVO.filtri.FiltroRicerca[] listaFiltri, bool enableUfficioRef, bool enableProfilazione, bool childs, DocsPaVO.utente.Registro registro, byte[] datiExcel)
        {
            SetUserId(infoUtente);
            ArrayList result = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                string serverPath = System.Configuration.ConfigurationManager.AppSettings["LOG_PATH"];
                serverPath = serverPath.Replace("%DATA", DateTime.Now.ToString("yyyyMMdd"));

                result = BusinessLogic.Fascicoli.FascicoloManager.getListaFascicoli(infoUtente, classificazione, listaFiltri, enableUfficioRef, enableProfilazione, childs, registro, datiExcel, serverPath);
#if TRACE_WS
				pt.WriteLogTracer("FascicolazioneGetListaFascicoli");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneGetListaFascicoli", e);
                result = null;
            }

            return result;
        }


        /// <summary>
        /// </summary>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.fascicolazione.Fascicolo))]
        public virtual ArrayList FascicolazioneGetListaFascicoli(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.fascicolazione.Classificazione classificazione, DocsPaVO.filtri.FiltroRicerca[] listaFiltri, bool enableUfficioRef, bool enableProfilazione, bool childs, byte[] datiExcel)
        {
            SetUserId(infoUtente);
            ArrayList result = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                string serverPath = System.Configuration.ConfigurationManager.AppSettings["LOG_PATH"];
                serverPath = serverPath.Replace("%DATA", DateTime.Now.ToString("yyyyMMdd"));

                result = BusinessLogic.Fascicoli.FascicoloManager.getListaFascicoli(infoUtente, classificazione, listaFiltri, enableUfficioRef, enableProfilazione, childs, datiExcel, serverPath);
#if TRACE_WS
				pt.WriteLogTracer("FascicolazioneGetListaFascicoli");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneGetListaFascicoli", e);
                result = null;
            }

            return result;
        }


        #region paging

        /// <summary>
        /// 
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <param name="classificazione"></param>
        /// <param name="registro"></param>
        /// <param name="listaFiltri"></param>
        /// <param name="enableUfficioRef"></param>
        /// <param name="enableProfilazione"></param>
        /// <param name="childs"></param>
        /// <param name="numPage"></param>
        /// <param name="numTotPage"></param>
        /// <param name="nRec"></param>
        /// <param name="pageSize"></param>
        /// <param name="getSystemIdList">True se si desidera ricevere anche la lista dei system id dei fascicoli restituiti dalla ricerca</param>
        /// <param name="idProjectList">Lista dei system id dei fascicoli restituiti dalla ricerca. Verr valorizzata solo se getSystemIdList  true.</param>
        /// <returns></returns>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.fascicolazione.Fascicolo))]
        public virtual ArrayList FascicolazioneGetListaFascicoliPaging(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.fascicolazione.Classificazione classificazione, DocsPaVO.utente.Registro registro, DocsPaVO.filtri.FiltroRicerca[] listaFiltri, bool enableUfficioRef, bool enableProfilazione, bool childs, int numPage, out int numTotPage, out int nRec, int pageSize,
            bool getSystemIdList, out List<SearchResultInfo> idProjectList, byte[] excelDati)
        {
            ArrayList result = null;
            nRec = 0;
            numTotPage = 0;

            // Lista dei system id dei fascicoli restituiti dalla ricerca
            List<SearchResultInfo> idProjects = null;

            string serverPath = System.Configuration.ConfigurationManager.AppSettings["LOG_PATH"];
            serverPath = serverPath.Replace("%DATA", DateTime.Now.ToString("yyyyMMdd"));

            try
            {
                result = BusinessLogic.Fascicoli.FascicoloManager.getListaFascicoliPaging(infoUtente, classificazione, registro, listaFiltri, enableUfficioRef, enableProfilazione, childs, out numTotPage, out nRec, numPage, pageSize, getSystemIdList, out idProjects, excelDati, serverPath);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneGetListaFascicoliPaging", e);
                result = null;
            }

            // Assegnazione della lista dei system id dei fascicoli
            idProjectList = idProjects;

            return result;
        }
        #endregion

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual DocsPaVO.fascicolazione.Fascicolo FascicolazioneNewFascicolo(DocsPaVO.fascicolazione.Classificazione classificazione, DocsPaVO.fascicolazione.Fascicolo fascicolo, DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.utente.Ruolo ruolo, bool enableUffRef, out DocsPaVO.fascicolazione.ResultCreazioneFascicolo resultCreazione)
        {
            SetUserId(infoUtente);
            logger.Info("BEGIN");
            DocsPaVO.fascicolazione.Fascicolo objFascicolo = null;
            resultCreazione = DocsPaVO.fascicolazione.ResultCreazioneFascicolo.OK;
            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                objFascicolo = BusinessLogic.Fascicoli.FascicoloManager.newFascicolo(classificazione, fascicolo, infoUtente, ruolo, enableUffRef, out resultCreazione);
#if TRACE_WS
				pt.WriteLogTracer("FascicolazioneNewFascicolo");
#endif
                //Celeste 
                if (objFascicolo != null)
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "FASCICOLAZIONENEWFASCICOLO", objFascicolo.systemID, string.Format("{0} {1}", "Cod. Fascicolo:", objFascicolo.codice), DocsPaVO.Logger.CodAzione.Esito.OK);
                //Fine Celeste
            }
            catch (Exception e)
            {
                //Celeste
                resultCreazione = DocsPaVO.fascicolazione.ResultCreazioneFascicolo.GENERIC_ERROR;
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "FASCICOLAZIONENEWFASCICOLO", objFascicolo.systemID, string.Format("{0} {1}", "Cod. Fascicolo:", objFascicolo.codice), DocsPaVO.Logger.CodAzione.Esito.KO);
                //Fine Celeste
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneNewFascicolo", e);
                objFascicolo = null;
            }
            logger.Info("END");
            return objFascicolo;
        }

        //        /// <summary>
        //        /// FascicolazioneNewFascicoloLF: aggiunge le informazioni
        //        /// di Locazione Fisica al fascicolo
        //        /// </summary>
        //        /// <param name="classificazione"></param>
        //        /// <param name="fascicolo"></param>
        //        /// <param name="infoUtente"></param>
        //        /// <param name="ruolo"></param>
        //        /// <returns></returns>
        //        [WebMethod]
        //        public virtual DocsPaVO.fascicolazione.Fascicolo FascicolazioneNewFascicoloLF(DocsPaVO.fascicolazione.Classificazione classificazione, DocsPaVO.fascicolazione.Fascicolo fascicolo, DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.utente.Ruolo ruolo,bool LF, string idUoLF,string dtaLF, bool enableUffRef) 
        //        {
        //            DocsPaVO.fascicolazione.Fascicolo objFascicolo = null;

        //            try 
        //            {
        //                //gestione tracer
        //#if TRACE_WS
        //                DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
        //#endif
        //                objFascicolo = BusinessLogic.Fascicoli.FascicoloManager.newFascicolo_LF(classificazione, fascicolo, infoUtente, ruolo,LF, idUoLF,dtaLF,enableUffRef);
        //#if TRACE_WS
        //                pt.WriteLogTracer("FascicolazioneNewFascicolo");
        //#endif
        //                //Celeste 
        //                if (objFascicolo !=null)
        //                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente,"FASCICOLAZIONENEWFASCICOLO", objFascicolo.systemID, string.Format("{0} {1}", "Cod. Fascicolo:",objFascicolo.codice),DocsPaVO.Logger.CodAzione.Esito.OK);
        //                //Fine Celeste
        //            } 
        //            catch(Exception e) 
        //            {
        //                //Celeste
        //                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente,"FASCICOLAZIONENEWFASCICOLO", objFascicolo.systemID, string.Format("{0} {1}", "Cod. Fascicolo:",objFascicolo.codice),DocsPaVO.Logger.CodAzione.Esito.KO);
        //                //Fine Celeste
        //                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneNewFascicolo",e);
        //                objFascicolo = null;
        //            }

        //            return objFascicolo;
        //        }




        [WebMethod]
        public virtual DocsPaVO.fascicolazione.Folder FascicolazioneGetPrimoChildFolder(string idPeople, string idGruppo, string idFasc, string idFolder)
        {
            DocsPaVO.fascicolazione.Folder objFolder = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                objFolder = BusinessLogic.Fascicoli.FolderManager.getPrimoChildFolder(idPeople, idGruppo, idFasc, idFolder);
#if TRACE_WS
				pt.WriteLogTracer("FascicolazioneGetFolder");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneGetFolder", e);
                objFolder = null;
            }

            return objFolder;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual DocsPaVO.fascicolazione.Folder FascicolazioneGetFolder(string idPeople, string idGruppo, DocsPaVO.fascicolazione.Fascicolo fascicolo)
        {
            DocsPaVO.fascicolazione.Folder objFolder = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                objFolder = BusinessLogic.Fascicoli.FolderManager.getFolder(idPeople, idGruppo, fascicolo);
                string valorechiave = DocsPaUtils.Configuration.InitConfigurationKeys.GetValue("0", "BE_PROJECT_LEVEL");
                if (!string.IsNullOrEmpty(valorechiave) && valorechiave.Equals("1"))
                    BusinessLogic.Fascicoli.FolderManager.setFolderDescription(ref objFolder, idPeople, idGruppo);

#if TRACE_WS
				pt.WriteLogTracer("FascicolazioneGetFolder");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneGetFolder", e);
                objFolder = null;
            }

            return objFolder;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual DocsPaVO.fascicolazione.Folder FascicolazioneGetFolderAndChild(string idPeople, string idGruppo, DocsPaVO.fascicolazione.Folder folder)
        {
            DocsPaVO.fascicolazione.Folder objFolder = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                objFolder = BusinessLogic.Fascicoli.FolderManager.getFolderAndChild(idPeople, idGruppo, folder);
                string valorechiave = DocsPaUtils.Configuration.InitConfigurationKeys.GetValue("0", "BE_PROJECT_LEVEL");
                if (!string.IsNullOrEmpty(valorechiave) && valorechiave.Equals("1"))
                    BusinessLogic.Fascicoli.FolderManager.setFolderDescription(ref objFolder, idPeople, idGruppo);
#if TRACE_WS
				pt.WriteLogTracer("FascicolazioneGetFolderAndChild");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneGetFolderAndChild", e);
                objFolder = null;
            }

            return objFolder;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual DocsPaVO.fascicolazione.Folder FascicolazioneGetFolderByIdFascicolo(string idPeople, string idGruppo, DocsPaVO.fascicolazione.Fascicolo fascicolo)
        {
            DocsPaVO.fascicolazione.Folder objFolder = null;

            try
            {
                objFolder = BusinessLogic.Fascicoli.FolderManager.getFolderByIdFascicolo(idPeople, idGruppo, fascicolo);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneGetFolderByIdFascicolo", e);
                objFolder = null;
            }

            return objFolder;
        }


        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual DocsPaVO.fascicolazione.Folder FascicolazioneGetFolderById(string idPeople, string idGruppo, string idFolder)
        {
            DocsPaVO.fascicolazione.Folder objFolder = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                objFolder = BusinessLogic.Fascicoli.FolderManager.getFolderById(idPeople, idGruppo, idFolder);
#if TRACE_WS
				pt.WriteLogTracer("FascicolazioneGetFolder");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneGetFolderById", e);
                objFolder = null;
            }

            return objFolder;
        }

        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.fascicolazione.Folder))]
        public virtual ArrayList FascicolazioneGetFolderByDescr(string idPeople, string idGruppo, string idFascicolo, string descrFolder)
        {
            ArrayList result = null;

            try
            {
                result = BusinessLogic.Fascicoli.FolderManager.getFolderByDescr(idPeople, idGruppo, idFascicolo, descrFolder);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneGetFolderByDescr", e);
                return null;
            }
            return result;
        }


        /// <summary>
        /// Restituzione di un array di oggetti "Folder",
        /// appartenenti a tutti i fascicoli, 
        /// che contengono il documento fornito in ingresso
        /// </summary>
        /// <param name="systemIdDocumento">DocNumber del documento</param>
        /// <returns></returns>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.fascicolazione.Folder))]
        public virtual ArrayList FascicolazioneGetFoldersDocument(string systemIdDocumento)
        {
            ArrayList folders = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                folders = BusinessLogic.Fascicoli.FolderManager.GetFoldersDocument(systemIdDocumento);
#if TRACE_WS
				pt.WriteLogTracer("FascicolazioneGetFoldersDocument");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneGetFoldersDocument", e);
                folders = null;
            }

            return folders;
        }


        /// <summary>
        /// Restituzione di un array di oggetti "Folder",
        /// relativamente ad un fascicolo,
        /// che contengono il documento fornito in ingresso 
        /// </summary>
        /// <param name="systemIdDocumento">DocNumber del documento</param>
        /// <param name="systemIdFascicolo">ID del fascicolo contenente i folders</param>
        /// <returns></returns>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.fascicolazione.Folder))]
        public virtual ArrayList FascicolazioneGetFoldersDocumentFascicolo(string systemIdDocumento, string systemIdFascicolo)
        {
            ArrayList folders = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                folders = BusinessLogic.Fascicoli.FolderManager.GetFoldersDocument(systemIdDocumento, systemIdFascicolo);
#if TRACE_WS
				pt.WriteLogTracer("FascicolazioneGetFoldersDocument");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneGetFoldersDocument", e);
                folders = null;
            }

            return folders;
        }



        /// <summary>
        /// </summary>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.documento.InfoDocumento))]
        public virtual ArrayList FascicolazioneGetDocumenti(string idGruppo, string idPeople, DocsPaVO.fascicolazione.Folder folder)
        {
            ArrayList objListaDocumenti = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                objListaDocumenti = BusinessLogic.Fascicoli.FolderManager.getDocumenti(idGruppo, idPeople, folder);
#if TRACE_WS
				pt.WriteLogTracer("FascicolazioneGetDocumenti");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneGetDocumenti", e);
                objListaDocumenti = null;
            }

            return objListaDocumenti;
        }


        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.documento.InfoDocumento))]
        public virtual ArrayList FascicolazioneGetDocumentiPaging(string idGruppo, string idPeople, DocsPaVO.fascicolazione.Folder folder, int numPage, out int numTotPage, out int nRec, bool compileIdProfileList, out List<SearchResultInfo> idProfiles)
        {
            nRec = 0;
            numTotPage = 0;
            ArrayList objListaDocumenti = null;
            List<SearchResultInfo> idProfileList = null;
            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                objListaDocumenti = BusinessLogic.Fascicoli.FolderManager.getDocumentiPaging(idGruppo, idPeople, folder, numPage, out numTotPage, out nRec, compileIdProfileList, out idProfileList);
#if TRACE_WS
				pt.WriteLogTracer("FascicolazioneGetDocumenti");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneGetDocumentiPaging", e);
                objListaDocumenti = null;
            }

            idProfiles = idProfileList;
            return objListaDocumenti;
        }

        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.documento.InfoDocumento))]
        public virtual ArrayList FascicolazioneGetDocumentiPagingWithFilters(
            string idGruppo,
            string idPeople,
            DocsPaVO.fascicolazione.Folder folder,
            DocsPaVO.filtri.FiltroRicerca[][] filtriRicerca,
            int numPage,
            out int numTotPage,
            out int nRec,
            bool compileIdProfileList,
            out List<SearchResultInfo> idProfiles)
        {
            nRec = 0;
            numTotPage = 0;
            ArrayList objListaDocumenti = null;
            List<SearchResultInfo> idProfileList = null;
            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                objListaDocumenti = BusinessLogic.Fascicoli.FolderManager.getDocumentiPaging(idGruppo, idPeople, folder, filtriRicerca, numPage, out numTotPage, out nRec, compileIdProfileList, out idProfileList);
#if TRACE_WS
				pt.WriteLogTracer("FascicolazioneGetDocumenti");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneGetDocumentiPaging", e);
                objListaDocumenti = null;
            }

            idProfiles = idProfileList;
            return objListaDocumenti;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual DocsPaVO.Validations.ValidationResultInfo FascicolazioneDeleteDocFromFolder(DocsPaVO.utente.InfoUtente infoUtente, string idProfile, DocsPaVO.fascicolazione.Folder folder, string fascRapida, out string msg)
        {
            SetUserId(infoUtente);
            DocsPaVO.Validations.ValidationResultInfo result = null;

            string domainObject = (folder.idFascicolo.Equals(folder.idParent) ? "fascicolo" : "sottofascicolo");
            msg = string.Empty;
            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Fascicoli.FolderManager.RemoveDocumentFromFolder(infoUtente, idProfile, folder, fascRapida, out msg);
#if TRACE_WS
				pt.WriteLogTracer("FascicolazioneDeleteDocumento");
#endif
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "FOLDERDELDOC", folder.idFascicolo, "Rimozione doc N.ro " + idProfile + " dal " + domainObject + ": " + folder.descrizione, DocsPaVO.Logger.CodAzione.Esito.OK);
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCDELFROMFOLDER", idProfile, "Rimozione doc N.ro " + idProfile + " dal " + domainObject + ": " + folder.descrizione, DocsPaVO.Logger.CodAzione.Esito.OK);

                #region event FOLLOW_DOC_EXT_APP

                //traccio l'evento FOLLOW_DOC_EXT_APP
                string method = "FOLLOWFASCEXTAPP";
                string description = "RemoveDocInFolder#Rimozione doc N.ro " + idProfile + " dal folder: " + folder.descrizione;
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente.userId, infoUtente.idPeople, infoUtente.idGruppo,
                    infoUtente.idAmministrazione, method, folder.idFascicolo, description, DocsPaVO.Logger.CodAzione.Esito.OK,
                    (infoUtente != null && infoUtente.delegato != null ? infoUtente.delegato : null), "1", idProfile);
                //the document has been removed from the folder, therefore, no longer followed by the (user, role) that follow the folder
                FollowDomainObject followObject = new FollowDomainObject(); ;
                followObject.Operation = FollowDomainObject.OperationFollow.RemoveDocFolder;
                followObject.IdProject = folder.idFascicolo;
                followObject.IdProfile = idProfile;
                BusinessLogic.ServiceNotifications.Notification.Follow(followObject);

                #endregion
            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "FOLDERDELDOC", folder.systemID, "Rimozione doc N.ro " + idProfile + " dal " + domainObject + ": " + folder.descrizione, DocsPaVO.Logger.CodAzione.Esito.KO);
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCDELFROMFOLDER", idProfile, "Rimozione doc N.ro " + idProfile + " dal " + domainObject + ": " + folder.descrizione, DocsPaVO.Logger.CodAzione.Esito.KO);
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneDeleteDocumento", e);
                result = null;
            }

            return result;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual DocsPaVO.Validations.ValidationResultInfo FascicolazioneDeleteDocFromProject(DocsPaVO.utente.InfoUtente infoUtente, string idProfile, DocsPaVO.fascicolazione.Folder folder, string fascRapida, DocsPaVO.fascicolazione.Fascicolo fasc, out string msg)
        {
            SetUserId(infoUtente);
            DocsPaVO.Validations.ValidationResultInfo result = null;
            msg = string.Empty;
            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Fascicoli.FolderManager.RemoveDocumentFromProject(infoUtente, idProfile, folder, fascRapida, out msg);
#if TRACE_WS
				pt.WriteLogTracer("FascicolazioneDeleteDocumento");
#endif
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "FOLDERDELDOC", folder.systemID, "Rimozione doc N.ro " + idProfile + " dal fascicolo: " + fasc.codice, DocsPaVO.Logger.CodAzione.Esito.OK);
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCDELFROMFOLDER", idProfile, "Rimozione doc N.ro " + idProfile + " dal fascicolo: " + fasc.codice, DocsPaVO.Logger.CodAzione.Esito.OK);
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "FASCICOLODELDOC", fasc.systemID, "Rimozione doc N.ro " + idProfile + " dal fascicolo: " + fasc.codice, DocsPaVO.Logger.CodAzione.Esito.OK);
                #region event FOLLOW_DOC_EXT_APP

                //traccio l'evento FOLLOW_DOC_EXT_APP
                string method = "FOLLOWFASCEXTAPP";
                string description = "RemoveDocInFolder#Rimozione doc N.ro " + idProfile + " dal folder: " + folder.descrizione;
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente.userId, infoUtente.idPeople, infoUtente.idGruppo,
                    infoUtente.idAmministrazione, method, folder.idFascicolo, description, DocsPaVO.Logger.CodAzione.Esito.OK,
                    (infoUtente != null && infoUtente.delegato != null ? infoUtente.delegato : null), "1", idProfile);
                //the document has been removed from the folder, therefore, no longer followed by the (user, role) that follow the folder
                FollowDomainObject followObject = new FollowDomainObject();
                followObject.Operation = FollowDomainObject.OperationFollow.RemoveDocFolder;
                followObject.IdProject = folder.idFascicolo;
                followObject.IdProfile = idProfile;
                BusinessLogic.ServiceNotifications.Notification.Follow(followObject);

                #endregion

            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "FOLDERDELDOC", folder.systemID, "Rimozione doc N.ro " + idProfile + " dal folder: " + folder.descrizione, DocsPaVO.Logger.CodAzione.Esito.KO);
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCDELFROMFOLDER", idProfile, "Rimozione doc N.ro " + idProfile + " dal folder: " + folder.descrizione, DocsPaVO.Logger.CodAzione.Esito.KO);
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "FASCICOLODELDOC", fasc.systemID, "Rimozione doc N.ro " + idProfile + " dal fascicolo: " + fasc.codice, DocsPaVO.Logger.CodAzione.Esito.KO);
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneDeleteDocumento", e);
                result = null;
            }

            return result;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual bool FascicolazioneSetFascicolo(DocsPaVO.utente.InfoUtente infoUtente, ref DocsPaVO.fascicolazione.Fascicolo fascicolo)
        {
            SetUserId(infoUtente);
            bool result = true; // Presume successo

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                string statoFasc = BusinessLogic.Fascicoli.FascicoloManager.GetChaStateProject(fascicolo.systemID);
                BusinessLogic.Fascicoli.FascicoloManager.setFascicolo(infoUtente, fascicolo);
#if TRACE_WS
				pt.WriteLogTracer("FascicolazioneSetFascicolo");
#endif
                string stato = string.Empty;
                if (!string.IsNullOrEmpty(statoFasc))
                {
                    if (fascicolo.stato.Equals("C") && !fascicolo.stato.Equals(statoFasc))
                        stato = ": Chiusura";
                    else
                        if (fascicolo.stato.Equals("A") && !fascicolo.stato.Equals(statoFasc))
                        stato = ": Riapertura";
                }
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "FASCICOLOMODIFICA", fascicolo.systemID, "Modifica dati del fascicolo " + fascicolo.codice + stato, DocsPaVO.Logger.CodAzione.Esito.OK);

                #region event FOLLOW_DOC_EXT_APP

                //traccio l'evento FOLLOW_DOC_EXT_APP
                string method = "FOLLOWFASCEXTAPP";
                string description = "UpdMetaDataFolder#" + "Modifica dati del fascicolo " + fascicolo.codice;
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente.userId, infoUtente.idPeople, infoUtente.idGruppo,
                    infoUtente.idAmministrazione, method, fascicolo.systemID, description, DocsPaVO.Logger.CodAzione.Esito.OK,
                    (infoUtente != null && infoUtente.delegato != null ? infoUtente.delegato : null), "1", null);

                #endregion
            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "FASCICOLOMODIFICA", fascicolo.systemID, "Modifica dati del fascicolo " + fascicolo.codice, DocsPaVO.Logger.CodAzione.Esito.KO);
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneSetFascicolo", e);
                result = false;
            }

            return result;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual DocsPaVO.fascicolazione.Folder FascicolazioneNewFolder(Folder folder, InfoUtente infoute, Ruolo ruolo, out ResultCreazioneFolder result)
        {
            SetUserId(infoute);
            result = DocsPaVO.fascicolazione.ResultCreazioneFolder.GENERIC_ERROR;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                folder = BusinessLogic.Fascicoli.FolderManager.newFolder(folder, infoute, ruolo, out result);
#if TRACE_WS
				pt.WriteLogTracer("FascicolazioneNewFolder");
#endif
                if (folder != null)
                    BusinessLogic.UserLog.UserLog.WriteLog(
                        infoute, "FASCICOLAZIONENEWFOLDER", folder.idFascicolo, string.Format("{0}{1}{2}{3}", "N.ro Sottofascicolo: ", folder.systemID, " Desc.: ", folder.descrizione), DocsPaVO.Logger.CodAzione.Esito.OK);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneNewFolder", e);
                BusinessLogic.UserLog.UserLog.WriteLog(infoute, "FASCICOLAZIONENEWFOLDER", folder.systemID, string.Format("{0}{1}{2}{3}", "N.ro Sottofascicolo: ", folder.idFascicolo, " Desc.: ", folder.descrizione), DocsPaVO.Logger.CodAzione.Esito.KO);

                folder = null;
            }

            return folder;
        }

        #region Metodo Commentato
        //		[WebMethod]
        //		public virtual DocsPaVO.fascicolazione.Folder FascicolazioneMoveFolder(DocsPaVO.fascicolazione.Folder folderOld, DocsPaVO.fascicolazione.Folder folderNew, DocsPaVO.utente.InfoUtente infoUtente) 
        //		{
        //			DocsPaVO.fascicolazione.Folder result = null;
        //
        //			try 
        //			{
        //				result = DocsPaWS.fascicoli.FolderManager.moveFolder(folderOld, folderNew);
        //			} 
        ////			catch(Exception e) 
        ////			{
        ////				ErrorHandler.throwFault(e.Message,e.failReason,Context.Request.Url.AbsoluteUri);
        ////			} 
        //			catch(Exception e) 
        //			{
        //				//ErrorHandler.throwFault(e.Message,"F_System",Context.Request.Url.AbsoluteUri);
        //				
        //				result = null;
        //			}
        //
        //			return result;
        //		}
        #endregion

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual bool FascicolazioneModifyFolder(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.fascicolazione.Folder folder)
        {
            SetUserId(infoUtente);
            bool result = true; // Presume successo
            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                folder = BusinessLogic.Fascicoli.FolderManager.modifyFolder(infoUtente, folder);
                if (folder != null)
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "MODIFY_FOLDER_FASC", folder.idFascicolo, string.Format("{0}{1}", "Modificata descrizione sottofascicolo ", folder.systemID), DocsPaVO.Logger.CodAzione.Esito.OK);
#if TRACE_WS
				pt.WriteLogTracer("FascicolazioneModifyFolder");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneModifyFolder", e);
                result = false;
            }

            return result;
        }

        [WebMethod]
        public virtual DocsPaVO.fascicolazione.Classificazione FascicolazioneUpdateTitolario(DocsPaVO.fascicolazione.Classificazione nodoTitolario)
        {
            DocsPaVO.fascicolazione.Classificazione result = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Fascicoli.TitolarioManager.updateTitolario(nodoTitolario);
#if TRACE_WS
				pt.WriteLogTracer("FascicolazioneUpdateTitolario");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneUpdateTitolario", e);
                result = null;
            }

            return result;
        }

        //        [WebMethod]
        //        public virtual bool FascicolazioneDelTitolario(DocsPaVO.fascicolazione.Classificazione nodoTitolario, DocsPaVO.utente.InfoUtente infoUtente) 
        //        {
        //            bool result = true; // Presume successo

        //            try 
        //            {
        //                //gestione tracer
        //#if TRACE_WS
        //                DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
        //#endif
        //                BusinessLogic.Fascicoli.TitolarioManager.deleteTitolario(nodoTitolario, infoUtente);
        //#if TRACE_WS
        //                pt.WriteLogTracer("FascicolazioneDelTitolario");
        //#endif
        //            } 
        //            catch(Exception e) 
        //            {
        //                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneDelTitolario",e);
        //                result = false;
        //            }

        //            return result;
        //        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual bool FascicolazioneDelFolder(DocsPaVO.fascicolazione.Folder folder, DocsPaVO.utente.InfoUtente infoUtente)
        {
            SetUserId(infoUtente);
            bool result = true; // Presume successo
            string descriptionFolder = folder.descrizione;
            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                BusinessLogic.Fascicoli.FolderManager.delFolder(folder, infoUtente);
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DELETE_FOLDER_FASC", folder.idFascicolo, string.Format("{0}{1}", "Rimosso Sottofascicolo ", descriptionFolder), DocsPaVO.Logger.CodAzione.Esito.OK);
#if TRACE_WS
				pt.WriteLogTracer("FascicolazioneDelFolder");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneDelFolder", e);
                result = false;
            }

            return result;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        [XmlInclude(typeof(DocsPaVO.documento.ResultFascicolazione))]
        public virtual bool FascicolazioneAddDocFascicolo(DocsPaVO.utente.InfoUtente infoutente, string idProfile, DocsPaVO.fascicolazione.Fascicolo Fascicolo, bool fascRapida, out string msg)
        {
            SetUserId(infoutente);
            bool result = true; // Presume successo
            msg = string.Empty;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Fascicoli.FascicoloManager.addDocFascicolo(infoutente, idProfile, Fascicolo.systemID, fascRapida, out msg);
#if TRACE_WS
				pt.WriteLogTracer("FascicolazioneAddDocFascicolo");
#endif
                if (result)
                {
                    BusinessLogic.UserLog.UserLog.WriteLog(infoutente, "FASCICOLOADDDOC", Fascicolo.systemID, "Inserimento doc " + idProfile + " in fascicolo: " + Fascicolo.codice, DocsPaVO.Logger.CodAzione.Esito.OK);
                    BusinessLogic.UserLog.UserLog.WriteLog(infoutente, "DOCADDINFASC", idProfile, "Inserimento doc " + idProfile + " in fascicolo: " + Fascicolo.codice, DocsPaVO.Logger.CodAzione.Esito.OK);
                    #region event FOLLOW_DOC_EXT_APP

                    //traccio l'evento FOLLOW_DOC_EXT_APP
                    string method = "FOLLOWFASCEXTAPP";
                    string description = "AddDocInFolder#Inserimento doc " + idProfile + " in folder: " + Fascicolo.descrizione;
                    BusinessLogic.UserLog.UserLog.WriteLog(infoutente.userId, infoutente.idPeople, infoutente.idGruppo,
                        infoutente.idAmministrazione, method, Fascicolo.systemID, description, DocsPaVO.Logger.CodAzione.Esito.OK,
                        (infoutente != null && infoutente.delegato != null ? infoutente.delegato : null), "1", idProfile);

                    //the document was added to the file then all pairs (user, role) that follow the file must now follow the document
                    FollowDomainObject followObject = new FollowDomainObject();
                    followObject.Operation = FollowDomainObject.OperationFollow.AddDocFolder;
                    followObject.IdProject = Fascicolo.systemID;
                    followObject.IdProfile = idProfile;
                    BusinessLogic.ServiceNotifications.Notification.Follow(followObject);

                    #endregion
                }
            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(infoutente, "FASCICOLOADDDOC", Fascicolo.systemID, "Inserimento doc " + idProfile + " in fascicolo: " + Fascicolo.codice, DocsPaVO.Logger.CodAzione.Esito.KO);

                if (e != null && !string.IsNullOrEmpty(e.Message))
                {
                    int lengh = (e.Message.Length > 1500) ? 1500 : e.Message.Length;
                    string messageError = e.Message.Substring(0, lengh);
                    BusinessLogic.UserLog.UserLog.WriteLog(infoutente, "DOCADDINFASC", idProfile, "Inserimento doc " + idProfile + " in fascicolo: " + Fascicolo.codice + " " + messageError, DocsPaVO.Logger.CodAzione.Esito.KO);
                }
                else
                {
                    BusinessLogic.UserLog.UserLog.WriteLog(infoutente, "DOCADDINFASC", idProfile, "Inserimento doc " + idProfile + " in fascicolo: " + Fascicolo.codice, DocsPaVO.Logger.CodAzione.Esito.KO);
                }
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneAddDocFascicolo", e);
                result = false;
            }

            return result;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual bool FascicolazioneEliminaFascicolo(DocsPaVO.fascicolazione.Fascicolo Fascicolo, DocsPaVO.utente.InfoUtente infoutente)
        {
            bool result = false;
            try
            {
#if TRACE_WS
			DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Fascicoli.FascicoloManager.DeleteFascicoloAndFigli(Fascicolo);
#if TRACE_WS
				pt.WriteLogTracer("FascicolazioneEliminaFascicolo");
#endif
                if (result)
                {
                    BusinessLogic.UserLog.UserLog.WriteLog(infoutente, "FASCICOLODELETEALL", Fascicolo.systemID, "Cancellazione fasc: " + Fascicolo.codice, DocsPaVO.Logger.CodAzione.Esito.OK);
                }
            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(infoutente, "FASCICOLODELETEALL", Fascicolo.systemID, "Cancellazione fasc: " + Fascicolo.codice, DocsPaVO.Logger.CodAzione.Esito.KO);
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneEliminaFascicolo", e);
                result = false;
            }

            return result;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual bool FascicolaDocumentoAM(DocsPaVO.utente.InfoUtente infoutente, string idProfile, DocsPaVO.fascicolazione.Fascicolo Fascicolo, bool fascRapida, out string msg)
        {
            SetUserId(infoutente);
            bool result = true; // Presume successo
            msg = string.Empty;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                // Se  valorizzato folder, si esegue la fascicolazione nel folder
                if (Fascicolo.folderSelezionato != null)
                    result = BusinessLogic.Fascicoli.FolderManager.addDocFolder(infoutente, idProfile, Fascicolo.folderSelezionato.systemID, false, out msg);
                else
                    result = BusinessLogic.Fascicoli.FascicoloManager.addDocFascicolo(infoutente, idProfile, Fascicolo.systemID, fascRapida, out msg);
#if TRACE_WS
				pt.WriteLogTracer("FascicolazioneAddDocFascicolo");
#endif
                if (result)
                {
                    BusinessLogic.UserLog.UserLog.WriteLog(infoutente, "FASCICOLOADDDOC", Fascicolo.systemID, "Azione Massiva - Inserimento doc " + idProfile + " in fascicolo: " + Fascicolo.codice, DocsPaVO.Logger.CodAzione.Esito.OK);
                    BusinessLogic.UserLog.UserLog.WriteLog(infoutente, "DOCADDINFASC", idProfile, "Azione Massiva - Inserimento doc " + idProfile + " in fascicolo: " + Fascicolo.codice, DocsPaVO.Logger.CodAzione.Esito.OK);
                }
            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(infoutente, "FASCICOLOADDDOC", Fascicolo.systemID, "Azione Massiva - Inserimento doc " + idProfile + " in fascicolo: " + Fascicolo.codice, DocsPaVO.Logger.CodAzione.Esito.KO);
                BusinessLogic.UserLog.UserLog.WriteLog(infoutente, "DOCADDINFASC", idProfile, "Azione Massiva - Inserimento doc " + idProfile + " in fascicolo: " + Fascicolo.codice, DocsPaVO.Logger.CodAzione.Esito.KO);
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneAddDocFascicolo", e);
                result = false;
            }

            return result;
        }

        /// <summary>
        /// aggiunge un documento ad  un fascicolo. 
        /// il prametro fascRapida = TRUE se l'operazione viene effettuata dall'interfaccia utente utilizzando
        /// la fascicolazione rapida, altriementi e FALSE.
        /// metodo rifatto per MEV INPS
        /// </summary>
        /// <param name="infoutente"></param>
        /// <param name="idProfile"></param>
        /// <param name="idFolder"></param>
        /// <param name="fascRapida"></param>
        /// <param name="outValue"></param>
        /// <returns></returns>
        [WebMethod]
        [XmlInclude(typeof(DocsPaVO.documento.ResultFascicolazione))]
        public virtual bool FascicolazioneAddDocFolder(DocsPaVO.utente.InfoUtente infoutente, string idProfile, DocsPaVO.fascicolazione.Folder Folder, string descrFasc, out string msg)
        {
            SetUserId(infoutente);
            logger.Info("BEGIN");
            bool result = true; // Presume successo
            string domainObject = (Folder.idFascicolo.Equals(Folder.idParent) ? "fascicolo" : "sottofascicolo");
            msg = string.Empty;
            string descr = string.Empty;
            if (Folder.descrizione.ToUpper().Equals("ROOT FOLDER") && !string.IsNullOrEmpty(descrFasc))
                descr = descrFasc;
            else
                descr = Folder.descrizione;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Fascicoli.FolderManager.addDocFolder(infoutente, idProfile, Folder.systemID, false, out msg);
#if TRACE_WS
				pt.WriteLogTracer("FascicolazioneAddDocFolder");
#endif
                if (result)
                {
                    BusinessLogic.UserLog.UserLog.WriteLog(infoutente, "FOLDERADDDOC", Folder.idFascicolo, "Inserimento doc " + idProfile + " in " + domainObject + ": " + descr, DocsPaVO.Logger.CodAzione.Esito.OK);
                    BusinessLogic.UserLog.UserLog.WriteLog(infoutente, "DOCADDINFOLDER", idProfile, "Inserimento doc " + idProfile + " in " + domainObject + ": " + descr, DocsPaVO.Logger.CodAzione.Esito.OK);

                    #region event FOLLOW_DOC_EXT_APP

                    //traccio l'evento FOLLOW_DOC_EXT_APP
                    string method = "FOLLOWFASCEXTAPP";
                    string description = "AddDocInFolder#Inserimento doc " + idProfile + " in folder: " + descr;
                    BusinessLogic.UserLog.UserLog.WriteLog(infoutente.userId, infoutente.idPeople, infoutente.idGruppo,
                        infoutente.idAmministrazione, method, Folder.idFascicolo, description, DocsPaVO.Logger.CodAzione.Esito.OK,
                        (infoutente != null && infoutente.delegato != null ? infoutente.delegato : null), "1", idProfile);

                    //the document was added to the file then all pairs (user, role) that follow the file must now follow the document
                    FollowDomainObject followObject = new FollowDomainObject();
                    followObject.Operation = FollowDomainObject.OperationFollow.AddDocFolder;
                    followObject.IdProject = Folder.idFascicolo;
                    followObject.IdProfile = idProfile;
                    BusinessLogic.ServiceNotifications.Notification.Follow(followObject);

                    #endregion

                }
            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(infoutente, "FOLDERADDDOC", Folder.systemID, "Inserimento doc " + idProfile + " in " + domainObject + ": " + descr, DocsPaVO.Logger.CodAzione.Esito.KO);
                BusinessLogic.UserLog.UserLog.WriteLog(infoutente, "DOCADDINFOLDER", idProfile, "Inserimento doc " + idProfile + " in " + domainObject + ": " + descr, DocsPaVO.Logger.CodAzione.Esito.KO);
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneAddDocFolder", e);
                result = false;
            }
            logger.Info("END");
            return result;
        }

        [WebMethod]
        public virtual DocsPaVO.documento.ResultFascicolazione ResultFascicolazioneMethod()
        {
            return DocsPaVO.documento.ResultFascicolazione.OK;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual DocsPaVO.fascicolazione.Fascicolo FascicolazioneGetDettaglioFascicolo(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.fascicolazione.InfoFascicolo infoFascicolo, bool enableUffRef)
        {
            SetUserId(infoUtente);
            DocsPaVO.fascicolazione.Fascicolo result = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Fascicoli.FascicoloManager.getDettaglio(infoUtente, infoFascicolo, enableUffRef);
#if TRACE_WS
				pt.WriteLogTracer("FascicolazioneGetDettaglioFascicolo");
#endif

                if (result == null)
                {
                    logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneGetDettaglioFascicolo");
                    throw new Exception("F_System");
                }

                return result;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneGetDettaglioFascicolo", e);
                result = null;
            }

            return result;
        }

        /// <summary>
        /// Reperimento numero classificazioni di un documento
        /// </summary>
        /// <param name="idProfile"></param>
        /// <param name="idGruppo"></param>
        /// <param name="idPeople"></param>
        /// <returns></returns>
        [WebMethod()]
        public int FascicolazioneGetCountClassificazioniDocumento(string idProfile, string idGruppo, string idPeople)
        {
            int retValue = 0;

            try
            {
                retValue = BusinessLogic.Fascicoli.FascicoloManager.GetCountClassificazioniDocumento(idProfile, idGruppo, idPeople);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneGetCountClassificazioniDocumento", ex);
            }

            return retValue;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.fascicolazione.Fascicolo))]
        public virtual ArrayList FascicolazioneGetFascicoliDaDoc(DocsPaVO.utente.InfoUtente infoUtente, string idProfile)
        {
            SetUserId(infoUtente);
            ArrayList result = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                if (idProfile != null)
                {
                    result = BusinessLogic.Fascicoli.FascicoloManager.getFascicoliDaDoc(infoUtente, idProfile);
#if TRACE_WS
					pt.WriteLogTracer("FascicolazioneGetFascicoliDaDoc");
#endif
                }
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneGetFascicoliDaDoc", e);
                result = null;
            }

            return result;
        }


        //		public static DocsPaVO.fascicolazione.Fascicolo GetFascicolo(string id,
        //			DocsPaVO.utente.InfoUtente infoUtente,
        //			DocsPaVO.utente.Registro registro,
        //			bool enableUffRef) 



        /// <summary>
        /// Reperimento fascicolo da systemID
        /// </summary>
        /// <param name="id"></param>
        /// <param name="infoUtente"></param>
        /// <param name="registro"></param>
        /// <param name="enableUffRef"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual DocsPaVO.fascicolazione.Fascicolo FascicolazioneGetFascicolo(
                                        string id,
                                        DocsPaVO.utente.InfoUtente infoUtente,
                                        DocsPaVO.utente.Registro registro,
                                        bool enableUffRef,
                                        bool enableProfilazione)
        {
            SetUserId(infoUtente);
            DocsPaVO.fascicolazione.Fascicolo result = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Fascicoli.FascicoloManager.GetFascicolo(id, infoUtente, registro, enableUffRef, enableProfilazione);
#if TRACE_WS
				pt.WriteLogTracer("FascicolazioneGetFascicoloDaCodice");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneGetFascicolo", e);
                result = null;
            }

            return result;
        }

        [WebMethod]
        public virtual DocsPaVO.fascicolazione.Fascicolo FascicolazioneGetFascicoloById(string idFascicolo, DocsPaVO.utente.InfoUtente infoUtente)
        {
            SetUserId(infoUtente);
            DocsPaVO.fascicolazione.Fascicolo result = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Fascicoli.FascicoloManager.getFascicoloById(idFascicolo, infoUtente);
#if TRACE_WS
				pt.WriteLogTracer("FascicolazioneGetFascicoloDaCodice");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneGetFascicoloDaCodice", e);
                result = null;
            }

            return result;
        }

        [WebMethod]
        public virtual DocsPaVO.fascicolazione.Fascicolo FascicolazioneGetFascicoloDaCodice2(string idAmministrazione, string idGruppo, string idPeople, string codiceFascicolo, DocsPaVO.utente.Registro registro, bool enableUffRef, bool enableProfilazione, string idTitolario)
        {
            DocsPaVO.fascicolazione.Fascicolo result = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Fascicoli.FascicoloManager.getFascicoloDaCodice2(idAmministrazione, idGruppo, idPeople, codiceFascicolo, registro, enableUffRef, enableProfilazione, idTitolario);
#if TRACE_WS
				pt.WriteLogTracer("FascicolazioneGetFascicoloDaCodice");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneGetFascicoloDaCodice2", e);
                result = null;
            }

            return result;
        }

        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.fascicolazione.Fascicolo))]
        public virtual ArrayList FascicolazioneGetFascicoloDaCodice3(string idAmministrazione, string idGruppo, string idPeople, string codiceFascicolo, DocsPaVO.utente.Registro registro, bool enableUffRef, bool enableProfilazione)
        {
            ArrayList result = new ArrayList();

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Fascicoli.FascicoloManager.getFascicoloDaCodice3(idAmministrazione, idGruppo, idPeople, codiceFascicolo, registro, enableUffRef, enableProfilazione);
#if TRACE_WS
				pt.WriteLogTracer("FascicolazioneGetFascicoloDaCodice");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneGetFascicoloDaCodice3", e);
                result = null;
            }

            return result;
        }

        [WebMethod]
        public virtual DocsPaVO.fascicolazione.Fascicolo FascicolazioneGetFascicoloDaCodice(DocsPaVO.utente.InfoUtente infoUtente, string codiceFascicolo, DocsPaVO.utente.Registro registro, bool enableUffRef, bool enableProfilazione)
        {
            SetUserId(infoUtente);
            DocsPaVO.fascicolazione.Fascicolo result = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Fascicoli.FascicoloManager.getFascicoloDaCodice(infoUtente, codiceFascicolo, registro, enableUffRef, enableProfilazione);
#if TRACE_WS
				pt.WriteLogTracer("FascicolazioneGetFascicoloDaCodice");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneGetFascicoloDaCodice", e);
                result = null;
            }

            return result;
        }

        [WebMethod]
        public virtual DocsPaVO.fascicolazione.Fascicolo FascicolazioneGetFascicoloInClassifica(DocsPaVO.utente.InfoUtente infoUtente, string codiceFascicolo, string idRegistro, bool enableUffRef, string idTitolario, bool enableProfilazione, string systemId)
        {
            SetUserId(infoUtente);
            DocsPaVO.fascicolazione.Fascicolo result = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Fascicoli.FascicoloManager.getFascicoloInClassifica(infoUtente, codiceFascicolo, idRegistro, enableUffRef, idTitolario, enableProfilazione, systemId);
#if TRACE_WS
				pt.WriteLogTracer("FascicolazioneGetFascicoloDaCodice");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneGetFascicoloInClassifica", e);
                result = null;
            }

            return result;
        }



        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual DocsPaVO.fascicolazione.Classifica[] FascicolazioneGetGerarchia(string idClassificazione, string idAmm)
        {
            DocsPaVO.fascicolazione.Classifica[] result = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Fascicoli.TitolarioManager.getGerarchia(idClassificazione, idAmm);
#if TRACE_WS
				pt.WriteLogTracer("FascicolazioneGetGerarchia");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneGetGerarchia", e);
                result = null;
            }

            return result;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual DocsPaVO.fascicolazione.Classifica[] FascicolazioneGetGerarchiaDaCodice(string codiceClassificazione, DocsPaVO.utente.Registro registro, string idAmm)
        {
            DocsPaVO.fascicolazione.Classifica[] result = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Fascicoli.TitolarioManager.getGerarchiaDaCodice(codiceClassificazione, registro, idAmm);
#if TRACE_WS
				pt.WriteLogTracer("FascicolazioneGetGerarchiaDaCodice");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneGetGerarchiaDaCodice", e);
                result = null;
            }

            return result;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual DocsPaVO.fascicolazione.Classifica[] FascicolazioneGetGerarchiaDaCodice2(string codiceClassificazione, DocsPaVO.utente.Registro registro, string idAmm, string idTitolario)
        {
            DocsPaVO.fascicolazione.Classifica[] result = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Fascicoli.TitolarioManager.getGerarchiaDaCodice2(codiceClassificazione, registro, idAmm, idTitolario);
#if TRACE_WS
				pt.WriteLogTracer("FascicolazioneGetGerarchiaDaCodice");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneGetGerarchiaDaCodice", e);
                result = null;
            }

            return result;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.fascicolazione.Classifica))]
        public virtual ArrayList FascicolazioneGetFigliClassifica2(string idGruppo, string idPeople, DocsPaVO.fascicolazione.Classifica classifica, string idRegistro, string idAmm, string idTitolario)
        {
            ArrayList result = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Fascicoli.TitolarioManager.getFigliClassifica2(idGruppo, idPeople, classifica, idRegistro, idAmm, idTitolario);
#if TRACE_WS
				pt.WriteLogTracer("FascicolazioneGetFigliClassifica");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneGetFigliClassifica", e);
                result = null;
            }

            return result;
        }


        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual bool FascicolazionCanAddFasc(string idNodo)
        {
            bool result = false;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Fascicoli.TitolarioManager.fascicolazionCanAddFasc(idNodo);
#if TRACE_WS
				pt.WriteLogTracer("FascicolazionCanAddFasc");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazionCanAddFasc", e);
                result = false;
            }

            return result;
        }



        /// <summary>
        /// </summary>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.fascicolazione.Classifica))]
        public virtual ArrayList FascicolazioneGetFigliClassifica(string idGruppo, string idPeople, DocsPaVO.fascicolazione.Classifica classifica, string idRegistro, string idAmm)
        {
            ArrayList result = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Fascicoli.TitolarioManager.getFigliClassifica(idGruppo, idPeople, classifica, idRegistro, idAmm);
#if TRACE_WS
				pt.WriteLogTracer("FascicolazioneGetFigliClassifica");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneGetFigliClassifica", e);
                result = null;
            }

            return result;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual bool FascicolazioneSospendiRiattivaUtente(string idPeople, DocsPaVO.utente.Corrispondente corr, DocsPaVO.fascicolazione.Fascicolo fasc)
        {
            bool result = true; // Presume successo

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                BusinessLogic.Fascicoli.FascicoloManager.sospendiRiattivaUtente(idPeople, corr, fasc);
#if TRACE_WS
				pt.WriteLogTracer("FascicolazioneSospendiRiattivaUtente");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneSospendiRiattivaUtente", e);
                result = false;
            }

            return result;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.fascicolazione.DirittoOggetto))]
        public virtual ArrayList FascicolazioneGetVisibilita(DocsPaVO.fascicolazione.InfoFascicolo infoFascicolo, bool cercaRimossi, string rootFolder)
        {
            ArrayList objListaDiritti = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                objListaDiritti = BusinessLogic.Utenti.DirittiManager.getListaDirittiFasc(infoFascicolo, cercaRimossi, rootFolder);
#if TRACE_WS
				pt.WriteLogTracer("FascicolazioneGetVisibilita");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneGetVisibilita", e);
                objListaDiritti = null;
            }

            return objListaDiritti;
        }
        #endregion

        #region Trasmissioni
        /// <summary>
        /// questo metodo imposta la datavista sul documento/fascicolo premendo il tasto_VISTO 3.12.1
        /// </summary>
        /// <param name="infoutente"></param>
        /// <param name="idProfile"></param>
        /// <param name="docOrFasc"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual bool SetDataVistaSP_TV(DocsPaVO.utente.InfoUtente infoutente, string docNumber, string docOrFasc, String idRegistro, string idTrasm)
        {
            SetUserId(infoutente);
            bool returnValue = false;
            string method = string.Empty;
            string desc = string.Empty;
            returnValue = BusinessLogic.Documenti.DocManager.setDataVistaSP_TV(infoutente, docNumber, docOrFasc, idRegistro);
            if (returnValue)
            {
                if (docOrFasc.Equals("F"))
                {
                    method = "CHECKTRASMFOLDER";
                    desc = "Click sul tasto Visto del fascicolo " + docNumber + " da parte dell'utente " + infoutente.userId;
                }
                else
                {
                    method = "CHECKTRASMDOCUMENT";
                    desc = "Click sul tasto Visto del documento " + docNumber + " da parte dell'utente " + infoutente.userId;
                }

                BusinessLogic.UserLog.UserLog.WriteLog(infoutente.userId, infoutente.idPeople, infoutente.idGruppo, infoutente.idAmministrazione, method, docNumber, desc, DocsPaVO.Logger.CodAzione.Esito.OK, infoutente.delegato, "1", idTrasm);
            }
            else
            {
                if (docOrFasc.Equals("F"))
                    BusinessLogic.UserLog.UserLog.WriteLog(infoutente.userId, infoutente.idPeople, infoutente.idGruppo, infoutente.idAmministrazione, "TASTO_VISTO_FASC", docNumber, "Click sul tasto Visto del fascicolo " + docNumber + " da parte dell'utente " + infoutente.userId, DocsPaVO.Logger.CodAzione.Esito.KO, null);
                else
                    BusinessLogic.UserLog.UserLog.WriteLog(infoutente.userId, infoutente.idPeople, infoutente.idGruppo, infoutente.idAmministrazione, "TASTO_VISTO_DOC", docNumber, "Click sul tasto Visto del documento " + docNumber + " da parte dell'utente " + infoutente.userId, DocsPaVO.Logger.CodAzione.Esito.KO, null);
            }
            return returnValue;
        }


        [WebMethod]
        public virtual DocsPaVO.utente.Utente getUtenteById(string idPeople)
        {
            try
            {
                return BusinessLogic.Utenti.UserManager.getUtenteById(idPeople);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getUtenteById", e);
                throw new Exception(e.Message);
            }
        }

        [WebMethod]
        public virtual DocsPaVO.utente.Ruolo getRuoloById(string idCorrGlobali)
        {
            try
            {
                return BusinessLogic.Utenti.UserManager.getRuoloById(idCorrGlobali);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getRuoloById", e);
                throw new Exception(e.Message);
            }
        }

        [WebMethod]
        public virtual DocsPaVO.utente.Ruolo GetRuolo(string idCorrGlobali)
        {
            try
            {
                return BusinessLogic.Utenti.UserManager.getRuolo(idCorrGlobali);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetRuolo", e);
                throw new Exception(e.Message);
            }
        }

        [WebMethod]
        public virtual DocsPaVO.utente.InfoUtente getInfoUtente(string idPeople, string idGruppo)
        {
            try
            {

                InfoUtente infoUtWS = BusinessLogic.Utenti.UserManager.GetInfoUtente(getUtenteById(idPeople), getRuoloByIdGruppo(idGruppo));

                if (infoUtWS != null && string.IsNullOrEmpty(infoUtWS.dst))
                    infoUtWS.dst = BusinessLogic.Utenti.UserManager.getSuperUserAuthenticationToken();
                return infoUtWS;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getInfoUtente", e);
                throw new Exception(e.Message);
            }

        }


        [WebMethod]
        public virtual void checkScadenze(string path)
        {
            try
            {
                BusinessLogic.Trasmissioni.TrasmManager trm = new BusinessLogic.Trasmissioni.TrasmManager();
                trm.checkScadenze(path);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: checkScadenze", e);
                throw new Exception(e.Message);
            }
        }
        /// <summary>
        /// Ricerca in todolist delle trasmissioni
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <param name="docOrFasc">
        /// D: Trasmissioni doc
        /// F: Trasmissioni fasc
        /// </param>
        /// <param name="registri"></param>
        /// <param name="filter"></param>
        /// <param name="requestedPage"></param>
        /// <param name="pageSize"></param>
        /// <param name="totalRecordCount"></param>
        /// <returns></returns>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.trasmissione.infoToDoList))]
        public virtual ArrayList getMyTodoList(DocsPaVO.utente.InfoUtente infoUtente,
                        string docOrFasc, string registri,
                        DocsPaVO.filtri.FiltroRicerca[] filter,
                        int requestedPage, int pageSize, out int totalRecordCount)
        {
            SetUserId(infoUtente);
            BusinessLogic.Trasmissioni.TrasmManager trasmManager = new BusinessLogic.Trasmissioni.TrasmManager();

            return trasmManager.getMyTodoList(infoUtente, docOrFasc, registri, filter, requestedPage, pageSize, out totalRecordCount);
        }

        /// <summary>
        /// Ricerca unificata di fascicoli e documenti in todolist        /// </summary>
        /// <param name="infoUtente"></param>
        /// <param name="registri"></param>
        /// <param name="filter"></param>
        /// <param name="requestedPage"></param>
        /// <param name="pageSize"></param>
        /// <param name="totalRecordCount"></param>
        /// <returns></returns>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.trasmissione.infoToDoList))]
        public virtual ArrayList getMyNewTodoList(DocsPaVO.utente.InfoUtente infoUtente,
                        string registri,
                        DocsPaVO.filtri.FiltroRicerca[] filter,
                        int requestedPage, int pageSize, out int totalRecordCount, out int totalTrasmNonViste)
        {
            SetUserId(infoUtente);
            BusinessLogic.Trasmissioni.TrasmManager trasmManager = new BusinessLogic.Trasmissioni.TrasmManager();

            return trasmManager.getMyNewTodoList(infoUtente, registri, filter, requestedPage, pageSize, out totalRecordCount, out totalTrasmNonViste);
        }

        [WebMethod]
        public virtual bool getAllTodoList(DocsPaVO.utente.Utente utente, DocsPaVO.utente.Ruolo ruoloCorrente)
        {
            SetUserId(utente);
            BusinessLogic.Trasmissioni.TrasmManager trasmManager = new BusinessLogic.Trasmissioni.TrasmManager();
            return trasmManager.getAllTodoList(utente, ruoloCorrente);
        }

        [WebMethod]
        public virtual bool getPredInTodoList(DocsPaVO.utente.Utente utente, DocsPaVO.utente.Ruolo ruoloCorrente)
        {
            SetUserId(utente);
            BusinessLogic.Trasmissioni.TrasmManager trasmManager = new BusinessLogic.Trasmissioni.TrasmManager();
            return trasmManager.getPredInTodoList(utente, ruoloCorrente);
        }

        [WebMethod]
        public bool trasmissioniSendSollecito_newWA(string path, DocsPaVO.trasmissione.Trasmissione trasm)
        {
            bool res = false;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                res = BusinessLogic.Trasmissioni.ExecTrasmManager.sendMailSollecito_newWA(path, trasm);
#if TRACE_WS
				pt.WriteLogTracer("trasmissioniSendSollecito_newWA");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: trasmissioniSendSollecito_newWA - ", e);
            }

            return res;
        }

        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.trasmissione.AllToDoList))]
        public virtual ArrayList getDettagliAllTodoList(DocsPaVO.utente.Utente utente)
        {
            SetUserId(utente);
            BusinessLogic.Trasmissioni.TrasmManager trasmManager = new BusinessLogic.Trasmissioni.TrasmManager();
            return trasmManager.getDettagliAllTodoList(utente);
        }

        [WebMethod]
        public virtual bool getValueInteropNoMail()
        {
            return BusinessLogic.Interoperabilit.InteroperabilitaUtils.InteropIntNoMail;
        }


        [WebMethod]
        public virtual void trasmissioneSetTxUtAsViste(DocsPaVO.utente.InfoUtente infoUtente)
        {
            SetUserId(infoUtente);
            try
            {
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                BusinessLogic.Trasmissioni.ExecTrasmManager.trasmissioneSetTxUtAsViste(infoUtente);
#if TRACE_WS
				pt.WriteLogTracer("trasmissioniSendSollecito");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: trasmissioneSetTxUtAsViste - ", e);
            }
        }

        [WebMethod]
        //public void trasmissioniSendSollecito(string path, DocsPaVO.trasmissione.Trasmissione trasm, DocsPaVO.utente.InfoUtente infoUtente) 
        public void trasmissioniSendSollecito(string path, DocsPaVO.trasmissione.Trasmissione trasm)
        {
            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                BusinessLogic.Trasmissioni.ExecTrasmManager.sendMailSollecito(path, trasm);
#if TRACE_WS
				pt.WriteLogTracer("trasmissioniSendSollecito");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: trasmissioniSendSollecito - ", e);
            }
        }

        [WebMethod]
        public virtual DocsPaVO.trasmissione.Trasmissione TrasmissioneAddDaTempl(DocsPaVO.documento.InfoDocumento infoDoc, DocsPaVO.trasmissione.TemplateTrasmissione template, DocsPaVO.utente.Utente utente, DocsPaVO.utente.Ruolo ruolo)
        {
            SetUserId(utente);
            DocsPaVO.trasmissione.Trasmissione result = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Trasmissioni.TemplateTrasmManager.addTrasmDaTemplate(infoDoc, template, utente, ruolo);
#if TRACE_WS
				pt.WriteLogTracer("TrasmissioneAddDaTempl");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: TrasmissioneAddDaTempl", e);
                result = null;
            }

            return result;
        }


        [WebMethod]
        public virtual DocsPaVO.trasmissione.Trasmissione TrasmissioneFascicoloAddDaTempl(DocsPaVO.fascicolazione.InfoFascicolo infoFascicolo, DocsPaVO.trasmissione.TemplateTrasmissione template, DocsPaVO.utente.Utente utente, DocsPaVO.utente.Ruolo ruolo)
        {
            SetUserId(utente);
            DocsPaVO.trasmissione.Trasmissione result = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif

                result = BusinessLogic.Trasmissioni.TemplateTrasmManager.addTrasmFascicoloDaTemplate(infoFascicolo, template, utente, ruolo);

#if TRACE_WS
				pt.WriteLogTracer("TrasmissioneAddDaTempl");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: TrasmissioneFascicoloAddDaTempl", e);
                result = null;
            }

            return result;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual DocsPaVO.trasmissione.Trasmissione TrasmissioneSaveTrasm(DocsPaVO.trasmissione.Trasmissione trasmissione)
        {
            logger.Info("BEGIN");
            DocsPaVO.trasmissione.Trasmissione result = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Trasmissioni.TrasmManager.saveTrasmMethod(trasmissione);
#if TRACE_WS
				pt.WriteLogTracer("TrasmissioneSaveTrasm");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: TrasmissioneSaveTrasm", e);
                result = null;
            }
            logger.Info("END");
            return result;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual DocsPaVO.trasmissione.Trasmissione TrasmissioneExecuteTrasm(string path, DocsPaVO.trasmissione.Trasmissione trasmissione, InfoUtente infoUtente = null)
        {
            logger.Info("BEGIN");
            DocsPaVO.trasmissione.Trasmissione result = null;
            string desc = string.Empty;
            string method;
            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Trasmissioni.ExecTrasmManager.executeTrasmMethod(path, trasmissione);

                if (result != null)
                {
                    // LOG per documento
                    if (result.infoDocumento != null && !string.IsNullOrEmpty(result.infoDocumento.idProfile))
                    {
                        foreach (DocsPaVO.trasmissione.TrasmissioneSingola single in result.trasmissioniSingole)
                        {
                            method = "TRASM_DOC_" + single.ragione.descrizione.ToUpper().Replace(" ", "_");
                            if (result.infoDocumento.segnatura == null)
                                desc = "Trasmesso Documento : " + result.infoDocumento.docNumber.ToString();
                            else
                                desc = "Trasmesso Documento : " + result.infoDocumento.segnatura.ToString();
                            BusinessLogic.UserLog.UserLog.WriteLog(result.utente.userId, result.utente.idPeople, result.ruolo.idGruppo, result.utente.idAmministrazione, method, result.infoDocumento.docNumber, desc, DocsPaVO.Logger.CodAzione.Esito.OK,
                                (infoUtente != null && infoUtente.delegato != null ? infoUtente.delegato : null), "1", single.systemId);
                        }
                    }

                    // LOG per fascicolo
                    else if (result.infoFascicolo != null && !string.IsNullOrEmpty(result.infoFascicolo.idFascicolo))
                    {
                        foreach (DocsPaVO.trasmissione.TrasmissioneSingola single in result.trasmissioniSingole)
                        {
                            method = "TRASM_FOLDER_" + single.ragione.descrizione.ToUpper().Replace(" ", "_");
                            desc = "Trasmesso Fascicolo: " + result.infoFascicolo.codice;
                            BusinessLogic.UserLog.UserLog.WriteLog(result.utente.userId, result.utente.idPeople, result.ruolo.idGruppo, result.utente.idAmministrazione, method, result.infoFascicolo.idFascicolo, desc, DocsPaVO.Logger.CodAzione.Esito.OK,
                                (infoUtente != null && infoUtente.delegato != null ? infoUtente.delegato : null), "1", single.systemId);
                        }
                    }
                }

#if TRACE_WS
				pt.WriteLogTracer("TrasmissioneExecuteTrasm");
#endif
            }
            catch (Exception e)
            {
                // LOG per documento
                if (trasmissione.infoDocumento != null)
                {
                    if (trasmissione.infoDocumento.segnatura == null)
                        desc = "Trasmesso Documento : " + trasmissione.infoDocumento.docNumber.ToString();
                    else
                        desc = "Trasmesso Documento : " + trasmissione.infoDocumento.segnatura.ToString();

                    BusinessLogic.UserLog.UserLog.WriteLog(trasmissione.utente.userId, trasmissione.utente.idPeople, trasmissione.ruolo.idGruppo, trasmissione.utente.idAmministrazione, "DOCUMENTOTRASMESSO", trasmissione.infoDocumento.docNumber, desc, DocsPaVO.Logger.CodAzione.Esito.KO, null);
                }

                // LOG per fascicolo
                if (trasmissione.infoFascicolo != null)
                {
                    desc = "Trasmesso Fascicolo: " + trasmissione.infoFascicolo.codice;
                    BusinessLogic.UserLog.UserLog.WriteLog(trasmissione.utente.userId, trasmissione.utente.idPeople, trasmissione.ruolo.idGruppo, trasmissione.utente.idAmministrazione, "FASCICOLOTRASMESSO", trasmissione.infoFascicolo.idFascicolo, desc, DocsPaVO.Logger.CodAzione.Esito.KO, null);
                }

                logger.Debug("Errore in DocsPaWS.asmx  - metodo: TrasmissioneExecuteTrasm - ", e);
                result = null;
            }
            logger.Info("END");
            return result;
        }

        [WebMethod]
        public virtual DocsPaVO.trasmissione.Trasmissione TrasmissioneSaveExecuteTrasm(string path, DocsPaVO.trasmissione.Trasmissione trasmissione, DocsPaVO.utente.InfoUtente infoUtente)
        {
            SetUserId(infoUtente);
            logger.Info("BEGIN");
            DocsPaVO.trasmissione.Trasmissione result = null;
            string desc = string.Empty;

            try
            {
                result = BusinessLogic.Trasmissioni.ExecTrasmManager.saveExecuteTrasmMethod(path, trasmissione);
                string notify = "1";
                if (trasmissione.NO_NOTIFY != null && trasmissione.NO_NOTIFY.Equals("1"))
                {
                    notify = "0";
                }
                else
                {
                    notify = "1";
                }
                if (result != null)
                {
                    // LOG per documento
                    if (result.infoDocumento != null && !string.IsNullOrEmpty(result.infoDocumento.idProfile))
                    {
                        foreach (DocsPaVO.trasmissione.TrasmissioneSingola single in result.trasmissioniSingole)
                        {
                            string method = "TRASM_DOC_" + single.ragione.descrizione.ToUpper().Replace(" ", "_");
                            if (result.infoDocumento.segnatura == null)
                                desc = "Trasmesso Documento : " + result.infoDocumento.docNumber.ToString();
                            else
                                desc = "Trasmesso Documento : " + result.infoDocumento.segnatura.ToString();

                            BusinessLogic.UserLog.UserLog.WriteLog(result.utente.userId, result.utente.idPeople, result.ruolo.idGruppo, result.utente.idAmministrazione, method, result.infoDocumento.docNumber, desc, DocsPaVO.Logger.CodAzione.Esito.OK, infoUtente.delegato, notify, single.systemId);
                        }
                    }
                    // LOG per fascicolo
                    if (result.infoFascicolo != null && !string.IsNullOrEmpty(result.infoFascicolo.idFascicolo))
                    {
                        foreach (DocsPaVO.trasmissione.TrasmissioneSingola single in result.trasmissioniSingole)
                        {
                            string method = "TRASM_FOLDER_" + single.ragione.descrizione.ToUpper().Replace(" ", "_");
                            desc = "Trasmesso Fascicolo ID: " + result.infoFascicolo.idFascicolo.ToString();
                            BusinessLogic.UserLog.UserLog.WriteLog(result.utente.userId, result.utente.idPeople, result.ruolo.idGruppo, result.utente.idAmministrazione, method, result.infoFascicolo.idFascicolo, desc, DocsPaVO.Logger.CodAzione.Esito.OK, infoUtente.delegato, notify, single.systemId);
                        }
                    }

                }
            }
            catch (Exception e)
            {
                // LOG per documento
                if (trasmissione.infoDocumento != null && !string.IsNullOrEmpty(result.infoDocumento.idProfile))
                {
                    if (trasmissione.infoDocumento.segnatura == null)
                        desc = "Trasmesso Documento : " + trasmissione.infoDocumento.docNumber.ToString();
                    else
                        desc = "Trasmesso Documento : " + trasmissione.infoDocumento.segnatura.ToString();
                    BusinessLogic.UserLog.UserLog.WriteLog(trasmissione.utente.userId, trasmissione.utente.idPeople, trasmissione.ruolo.idGruppo, trasmissione.utente.idAmministrazione, "DOCUMENTOTRASMESSO", trasmissione.infoDocumento.docNumber, desc, DocsPaVO.Logger.CodAzione.Esito.KO, null);
                }
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: TrasmissioneSaveExecuteTrasm - ", e);
                result = null;
            }
            logger.Info("END");
            return result;
        }

        [WebMethod]
        public virtual DocsPaVO.trasmissione.Trasmissione TrasmissioneSaveExecuteTrasmAM(string path, DocsPaVO.trasmissione.Trasmissione trasmissione, DocsPaVO.utente.InfoUtente infoUtente)
        {
            SetUserId(infoUtente);
            logger.Info("BEGIN");
            DocsPaVO.trasmissione.Trasmissione result = null;
            string desc = string.Empty;

            try
            {
                result = BusinessLogic.Trasmissioni.ExecTrasmManager.saveExecuteTrasmMethod(path, trasmissione);
                string notify = "1";
                if (trasmissione.NO_NOTIFY != null && trasmissione.NO_NOTIFY.Equals("1"))
                {
                    notify = "0";
                }
                else
                {
                    notify = "1";
                }
                if (result != null)
                {
                    // LOG per documento
                    if (result.infoDocumento != null)
                    {
                        foreach (DocsPaVO.trasmissione.TrasmissioneSingola single in result.trasmissioniSingole)
                        {
                            string method = "TRASM_DOC_" + single.ragione.descrizione.ToUpper().Replace(" ", "_");
                            if (result.infoDocumento.segnatura == null)
                                desc = "Azioni Massive - Trasmesso Documento : " + result.infoDocumento.docNumber.ToString();
                            else
                                desc = "Azioni Massive - Trasmesso Documento : " + result.infoDocumento.segnatura.ToString();

                            BusinessLogic.UserLog.UserLog.WriteLog(result.utente.userId, result.utente.idPeople, result.ruolo.idGruppo, result.utente.idAmministrazione, method, result.infoDocumento.docNumber, desc, DocsPaVO.Logger.CodAzione.Esito.OK, infoUtente.delegato, notify, single.systemId);
                        }
                    }
                    // LOG per fascicolo
                    if (result.infoFascicolo != null && !string.IsNullOrEmpty(result.infoFascicolo.idFascicolo))
                    {
                        foreach (DocsPaVO.trasmissione.TrasmissioneSingola single in result.trasmissioniSingole)
                        {
                            string method = "TRASM_FOLDER_" + single.ragione.descrizione.ToUpper().Replace(" ", "_");
                            desc = "Trasmesso Fascicolo ID: " + result.infoFascicolo.idFascicolo.ToString();
                            BusinessLogic.UserLog.UserLog.WriteLog(result.utente.userId, result.utente.idPeople, result.ruolo.idGruppo, result.utente.idAmministrazione, method, result.infoFascicolo.idFascicolo, desc, DocsPaVO.Logger.CodAzione.Esito.OK, infoUtente.delegato, notify, single.systemId);
                        }
                    }
                }
            }
            catch (Exception e)
            {/*
                // LOG per documento
                if (trasmissione.infoDocumento != null)
                {
                    if (trasmissione.infoDocumento.segnatura == null)
                        desc = "Azioni Massive - Trasmesso Documento ID: " + trasmissione.infoDocumento.docNumber.ToString();
                    else
                        desc = "Azioni Massive - Trasmesso Documento ID: " + trasmissione.infoDocumento.segnatura.ToString();

                    BusinessLogic.UserLog.UserLog.WriteLog(trasmissione.utente.userId, trasmissione.utente.idPeople, trasmissione.ruolo.idGruppo, trasmissione.utente.idAmministrazione, method, trasmissione.infoDocumento.docNumber, desc, DocsPaVO.Logger.CodAzione.Esito.KO, null);
                }*/
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: TrasmissioneSaveExecuteTrasm - ", e);
                result = null;
            }
            logger.Info("END");
            return result;
        }

        /// <summary>
        /// 
        /// </summary>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.trasmissione.Trasmissione))]
        public virtual ArrayList TrasmissioneGetQueryRicevute(DocsPaVO.trasmissione.OggettoTrasm oggettoTrasmesso, DocsPaVO.filtri.FiltroRicerca[] listaFiltri, DocsPaVO.utente.Utente utente, DocsPaVO.utente.Ruolo ruolo)
        {
            SetUserId(utente);
            ArrayList result = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Trasmissioni.QueryTrasmManager.getQueryRicevuteMethod(oggettoTrasmesso, utente, ruolo, listaFiltri);
#if TRACE_WS
				pt.WriteLogTracer("TrasmissioneGetQueryRicevute");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: TrasmissioneGetQueryRicevute", e);
                result = null;
            }

            return result;
        }

        #region new metod todolist
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.trasmissione.Trasmissione))]
        public virtual ArrayList trasmGetDettaglioTrasmissione(DocsPaVO.utente.Utente ut, DocsPaVO.utente.Ruolo role, DocsPaVO.trasmissione.infoToDoList todo)
        {
            SetUserId(ut);
            try
            {
                DocsPaVO.trasmissione.OggettoTrasm oggettoTrasm = new DocsPaVO.trasmissione.OggettoTrasm();

                if (!string.IsNullOrEmpty(todo.sysIdDoc))
                {
                    using (DocsPaDB.Query_DocsPAWS.Documenti dbDoc = new DocsPaDB.Query_DocsPAWS.Documenti())
                        oggettoTrasm.infoDocumento = dbDoc.GetInfoDocumento(role.idGruppo, ut.idPeople, todo.sysIdDoc, false);

                    oggettoTrasm.infoFascicolo = null;
                }
                else if (!string.IsNullOrEmpty(todo.sysIdFasc))
                {
                    oggettoTrasm.infoDocumento = null;
                    oggettoTrasm.infoFascicolo = new DocsPaVO.fascicolazione.InfoFascicolo { idFascicolo = todo.sysIdFasc };
                }

                return BusinessLogic.Trasmissioni.QueryTrasmManager.getQueryDettaglioTrasmMethod(oggettoTrasm, ut, role, null, todo.sysIdTrasm);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: trasmGetDettaglioTrasmissione", e);
                throw e;
            }

            //try 
            //{
            //    DocsPaVO.trasmissione.Trasmissione trasm = new DocsPaVO.trasmissione.Trasmissione();
            //    DocsPaDB.Query_DocsPAWS.Documenti doc = new DocsPaDB.Query_DocsPAWS.Documenti();
            //    trasm.dataInvio = todo.dataInvio;
            //    trasm.systemId = todo.sysIdTrasm;
            //    trasm.noteGenerali = todo.noteGenerali;
            //    // recupero Ruolo e Utente Mittente
            //    trasm.utente = BusinessLogic.Utenti.UserManager.getUtente(todo.idPeopleMitt);

            //    trasm.ruolo = BusinessLogic.Utenti.UserManager.getRuolo(todo.idRuoloInUo);

            //    //gestione Trasm Doc OR Trasm Fasc
            //    if ((todo.sysIdDoc !=null) && (todo.sysIdDoc != "")) 
            //    {
            //        DocsPaVO.trasmissione.TipoOggetto d = DocsPaVO.trasmissione.TipoOggetto.DOCUMENTO;
            //        trasm.tipoOggetto = d;
            //        DocsPaVO.documento.InfoDocumento infoDoc = doc.GetInfoDocumento(role.idGruppo, ut.idPeople, todo.sysIdDoc, false);
            //        trasm.infoDocumento = infoDoc;
            //    }
            //    else
            //    {
            //        DocsPaVO.trasmissione.TipoOggetto f = DocsPaVO.trasmissione.TipoOggetto.FASCICOLO;
            //        trasm.tipoOggetto = f;
            //        DocsPaVO.fascicolazione.InfoFascicolo infoFasc = new DocsPaVO.fascicolazione.InfoFascicolo();
            //        // getinfofascicolo


            //        infoFasc.idFascicolo = todo.sysIdFasc;
            //        trasm.infoFascicolo = infoFasc;
            //    }

            //    //ISTANZIO trasm Singola e poi aggiungo alla trasmissione
            //    DocsPaVO.trasmissione.TrasmissioneSingola ts = new DocsPaVO.trasmissione.TrasmissioneSingola();
            //     //setto le proprieta gia contenute nell'oggetto infotodolist
            //    ts.systemId = todo.sysIdTrasmSing;
            //    ts.dataScadenza = todo.dataScadenza;
            //    ts.noteSingole = todo.noteIndividuali;
            //    ts.idTrasmUtente = todo.sysIdTrasmUt;
            //    ts.tipoTrasm = todo.TipoTrasm; 

            //    if (todo.idRuoloDest == "0")
            //    {
            //        ts.corrispondenteInterno = ut;
            //        ts.tipoDest = DocsPaVO.trasmissione.TipoDestinatario.UTENTE;
            //    }
            //    else
            //    {
            //        ts.corrispondenteInterno = role;
            //        ts.tipoDest = DocsPaVO.trasmissione.TipoDestinatario.RUOLO;
            //    }

            //    //instanzio la ragione
            //    DocsPaVO.trasmissione.RagioneTrasmissione rag = new DocsPaVO.trasmissione.RagioneTrasmissione();

            //    // aggiungo la rag alla trasm singola
            //    rag = BusinessLogic.Trasmissioni.RagioniManager.getRagione(todo.idRagione);

            //    ts.ragione = rag;

            //    // aggiungo la ts alla trasm
            //    trasm.trasmissioniSingole.Add(ts);

            //    //ISTANZIO trasm utente e poi aggiungo alla trasm singola
            //    DocsPaVO.trasmissione.TrasmissioneUtente tu = new DocsPaVO.trasmissione.TrasmissioneUtente();
            //    tu.systemId = todo.sysIdTrasmUt;
            //    tu.utente = ut;
            //    // se presente in todolist  valida!
            //    tu.valida = "1";
            //   // tu.noteRifiuto
            //   // tu.noteAccettazione
            //   // tu.valida
            //    tu.dataVista = BusinessLogic.Trasmissioni.TrasmManager.getDataVistaTrasmUt(tu.systemId);
            //    //tu.dataAccettata
            //      //tu.dataRifiutata
            //    //aggiungo la tu alla ts
            //    ts.trasmissioneUtente.Add(tu);

            //    result.Add(trasm);

            //} 
            //catch(Exception e) 
            //{
            //    logger.Debug("Errore in DocsPaWS.asmx  - metodo: trasmGetDettaglioTrasmissione", e);
            //    throw e;
            //}

            //return result;
        }

        /// <summary>
        /// Reperimento delle informazioni di stato relative ad una trasmissione utente
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <param name="idTrasmissioneUtente"></param>
        /// <returns></returns>
        [WebMethod(Description = "Reperimento delle informazioni di stato relative ad una trasmissione utente")]
        public DocsPaVO.trasmissione.StatoTrasmissioneUtente GetStatoTrasmissioneUtente(DocsPaVO.utente.InfoUtente infoUtente, string idTrasmissioneUtente)
        {
            SetUserId(infoUtente);
            using (DocsPaDB.Query_DocsPAWS.Trasmissione dbTrasm = new DocsPaDB.Query_DocsPAWS.Trasmissione())
                return dbTrasm.getStatoTrasmissioneUtente(infoUtente, idTrasmissioneUtente);
        }

        #endregion


        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.trasmissione.Trasmissione))]
        public virtual ArrayList TrasmissioneGetQueryRicevutePaging(
            DocsPaVO.trasmissione.OggettoTrasm oggettoTrasmesso,
            DocsPaVO.filtri.FiltroRicerca[] listaFiltri,
            DocsPaVO.utente.Utente utente,
            DocsPaVO.utente.Ruolo ruolo,
            int pageNumber,
            out int totalPageNumber,
            out int recordCount)
        {
            SetUserId(utente);
            ArrayList result = null;

            totalPageNumber = 0;
            recordCount = 0;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Trasmissioni.QueryTrasmManager.getQueryRicevuteMethodPaging(oggettoTrasmesso, utente, ruolo, listaFiltri, pageNumber, out totalPageNumber, out recordCount);
#if TRACE_WS
				pt.WriteLogTracer("TrasmissioneGetQueryRicevutePaging");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: TrasmissioneGetQueryRicevutePaging", e);
                result = null;
            }

            return result;
        }

        /// <summary>
        /// </summary>
        [WebMethod(CacheDuration = 60, BufferResponse = true)]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.trasmissione.Trasmissione))]
        public virtual ArrayList TrasmissioneGetQueryEffettuate(DocsPaVO.trasmissione.OggettoTrasm oggettoTrasmesso, DocsPaVO.filtri.FiltroRicerca[] listaFiltri, DocsPaVO.utente.Utente utente, DocsPaVO.utente.Ruolo ruolo)
        {
            SetUserId(utente);
            ArrayList result = null;

            try
            {
                //				result = BusinessLogic.Trasmissioni.QueryTrasmManager.getQueryEffettuateMethod(oggettoTrasmesso,utente, ruolo, listaFiltri);
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                //result = BusinessLogic.Trasmissioni.QueryTrasmManager.getQueryEffettuateMethod_def(oggettoTrasmesso,utente, ruolo, listaFiltri);
#if TRACE_WS
				pt.WriteLogTracer("TrasmissioneGetQueryEffettuate");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: TrasmissioneGetQueryEffettuate", e);
                result = null;
            }

            return result;
        }

        /// <summary>
        /// 
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <param name="idDocOrFasc"></param>
        /// <param name="docOrFasc"></param>
        /// <param name="pagingContext"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.trasmissione.InfoTrasmissione[] GetInfoTrasmissioniEffettuate(
                DocsPaVO.utente.InfoUtente infoUtente,
                string idDocOrFasc, string docOrFasc,
                ref DocsPaVO.ricerche.SearchPagingContext pagingContext)
        {
            try
            {
                SetUserId(infoUtente);
                return BusinessLogic.Trasmissioni.QueryTrasmManager.GetInfoTrasmissioniEffettuate(infoUtente, idDocOrFasc, docOrFasc, pagingContext);
            }
            catch (Exception e)
            {
                string errorMessage = string.Format("Errore in DocsPaWS.GetInfoTrasmissioniEffettuate:\n{0}", e.Message);

                logger.Debug(errorMessage);
                throw new ApplicationException(errorMessage);
            }
        }

        /// <summary>
        /// 
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <param name="idDocOrFasc"></param>
        /// <param name="docOrFasc"></param>
        /// <param name="pagingContext"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.trasmissione.InfoTrasmissione[] GetInfoTrasmissioniRicevute(
                DocsPaVO.utente.InfoUtente infoUtente,
                string idDocOrFasc, string docOrFasc,
                ref DocsPaVO.ricerche.SearchPagingContext pagingContext)
        {
            try
            {
                SetUserId(infoUtente);
                return BusinessLogic.Trasmissioni.QueryTrasmManager.GetInfoTrasmissioniRicevute(infoUtente, idDocOrFasc, docOrFasc, pagingContext);
            }
            catch (Exception e)
            {
                string errorMessage = string.Format("Errore in DocsPaWS.GetInfoTrasmissioniRicevute:\n{0}", e.Message);

                logger.Debug(errorMessage);
                throw new ApplicationException(errorMessage);
            }
        }


        [WebMethod(CacheDuration = 60, BufferResponse = true)]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.trasmissione.Trasmissione))]
        public virtual ArrayList TrasmissioneGetQueryEffettuateDocPaging(DocsPaVO.trasmissione.OggettoTrasm oggettoTrasmesso, DocsPaVO.filtri.FiltroRicerca[] listaFiltri, DocsPaVO.utente.Utente utente, DocsPaVO.utente.Ruolo ruolo, int pageNumber, out int totalPageNumber, out int recordCount)
        {
            SetUserId(utente);
            ArrayList result = null;

            totalPageNumber = 0;
            recordCount = 0;

            try
            {
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Trasmissioni.QueryTrasmManager.getQueryEffettuateDocMethodPaging(oggettoTrasmesso, utente, ruolo, listaFiltri, pageNumber, out totalPageNumber, out recordCount);
#if TRACE_WS
				pt.WriteLogTracer("TrasmissioneGetQueryEffettuateDocPaging");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: TrasmissioneGetQueryEffettuateDocPaging", e);
                result = null;
            }

            return result;
        }


        [WebMethod(CacheDuration = 60, BufferResponse = true)]
        public virtual DocsPaVO.trasmissione.Trasmissione GetTrasmissioneById(DocsPaVO.trasmissione.OggettoTrasm oggettoTrasmesso, DocsPaVO.utente.Utente utente, DocsPaVO.utente.Ruolo ruolo, string systemId)
        {
            return BusinessLogic.Trasmissioni.QueryTrasmManager.GetTrasmissioneById(oggettoTrasmesso, utente, ruolo, systemId);
        }


        [WebMethod(CacheDuration = 60, BufferResponse = true)]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.trasmissione.Trasmissione))]
        public virtual ArrayList TrasmissioneGetQueryEffettuatePaging(DocsPaVO.trasmissione.OggettoTrasm oggettoTrasmesso, DocsPaVO.filtri.FiltroRicerca[] listaFiltri, DocsPaVO.utente.Utente utente, DocsPaVO.utente.Ruolo ruolo, int pageNumber, out int totalPageNumber, out int recordCount)
        {
            SetUserId(utente);
            ArrayList result = null;

            totalPageNumber = 0;
            recordCount = 0;

            try
            {
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Trasmissioni.QueryTrasmManager.getQueryEffettuateMethodPaging(oggettoTrasmesso, utente, ruolo, listaFiltri, pageNumber, out totalPageNumber, out recordCount);
#if TRACE_WS
				pt.WriteLogTracer("TrasmissioneGetQueryEffettuate");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: TrasmissioneGetQueryEffettuatePaging", e);
                result = null;
            }

            return result;
        }


        /// <summary>
        /// </summary>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.trasmissione.RagioneTrasmissione))]
        public virtual ArrayList TrasmissioneGetRagioniATutti(DocsPaVO.trasmissione.Diritti diritti)
        {
            ArrayList result = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Trasmissioni.RagioniManager.getListaRagioniATutti(diritti);
#if TRACE_WS
				pt.WriteLogTracer("TrasmissioneGetRagioni");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: TrasmissioneGetRagioniATutti", e);
                result = null;
            }

            return result;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.trasmissione.RagioneTrasmissione))]
        public virtual ArrayList TrasmissioneGetRagioni(DocsPaVO.trasmissione.Diritti diritti, bool flgDaRicercaTrasm)
        {
            ArrayList result = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Trasmissioni.RagioniManager.getListaRagioni(diritti, flgDaRicercaTrasm);
#if TRACE_WS
				pt.WriteLogTracer("TrasmissioneGetRagioni");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: TrasmissioneGetRagioni", e);
                result = null;
            }

            return result;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.trasmissione.RagioneTrasmissione))]
        public virtual ArrayList TrasmissioneGetRagioniSysExt(DocsPaVO.trasmissione.Diritti diritti)
        {
            ArrayList result = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Trasmissioni.RagioniManager.getListaRagioni(diritti, false, true);
#if TRACE_WS
				pt.WriteLogTracer("TrasmissioneGetRagioni");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: TrasmissioneGetRagioniSysExt", e);
                result = null;
            }

            return result;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual bool TrasmissioneExecuteAccRif(DocsPaVO.trasmissione.TrasmissioneUtente trasmissioneUtente, string idTrasmissione, DocsPaVO.utente.Ruolo ruolo, DocsPaVO.utente.InfoUtente infoUtente, out string errore)
        {
            SetUserId(infoUtente);
            logger.Info("BEGIN");
            bool result = true; // Presume successo
            errore = string.Empty;
            string mode;
            string idObj;
            string msg;
            const string ACCETTATADOC = "ACCETTATA_DOCUMENTO";
            const string ACCETTATAFASC = "ACCETTATA_FASCICOLO";
            const string RIFIUTATADOC = "RIFIUTATA_DOCUMENTO";
            const string RIFIUTATAFASC = "RIFIUTATA_FASCICOLO";
            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Trasmissioni.ExecTrasmManager.executeAccRifMethod(trasmissioneUtente, idTrasmissione, ruolo, infoUtente, out errore, out mode, out idObj);
#if TRACE_WS
				pt.WriteLogTracer("TrasmissioneExecuteAccRif");
#endif
                if (result && !string.IsNullOrEmpty(mode))
                {
                    DocsPaVO.trasmissione.TrasmissioneSingola sing = BusinessLogic.Trasmissioni.ExecTrasmManager.getTrasmSingola(trasmissioneUtente);
                    string idRole = sing.tipoDest == DocsPaVO.trasmissione.TipoDestinatario.RUOLO ? ruolo.idGruppo : "0";

                    switch (mode)
                    {
                        case ACCETTATADOC:
                            msg = "Accettazione della trasmissione. Id documento: " + idObj;
                            BusinessLogic.UserLog.UserLog.WriteLog(infoUtente.userId, infoUtente.idPeople, idRole, infoUtente.idAmministrazione, "ACCEPTTRASMDOCUMENT", idObj, msg, DocsPaVO.Logger.CodAzione.Esito.OK, infoUtente.delegato, "1", sing.systemId);
                            break;
                        case ACCETTATAFASC:
                            msg = "Accettazione della trasmissione. Id fascicolo: " + idObj;
                            BusinessLogic.UserLog.UserLog.WriteLog(infoUtente.userId, infoUtente.idPeople, idRole, infoUtente.idAmministrazione, "ACCEPTTRASMFOLDER", idObj, msg, DocsPaVO.Logger.CodAzione.Esito.OK, infoUtente.delegato, "1", sing.systemId);
                            break;
                        case RIFIUTATAFASC:
                            msg = "Rifiuto della trasmissione. Id fascicolo: " + idObj;
                            BusinessLogic.UserLog.UserLog.WriteLog(infoUtente.userId, infoUtente.idPeople, idRole, infoUtente.idAmministrazione, "REJECTTRASMFOLDER", idObj, msg, DocsPaVO.Logger.CodAzione.Esito.OK, infoUtente.delegato, "1", sing.systemId);
                            break;
                        case RIFIUTATADOC:
                            msg = "Rifiuto della trasmissione. Id documento: " + idObj;
                            BusinessLogic.UserLog.UserLog.WriteLog(infoUtente.userId, infoUtente.idPeople, idRole, infoUtente.idAmministrazione, "REJECTTRASMDOCUMENT", idObj, msg, DocsPaVO.Logger.CodAzione.Esito.OK, infoUtente.delegato, "1", sing.systemId);
                            break;
                    }
                }
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: TrasmissioneExecuteAccRif", e);
                result = false;
            }
            logger.Info("END");
            return result;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual bool TrasmissioneExecuteAccRifConFascicolazione(DocsPaVO.trasmissione.TrasmissioneUtente trasmissioneUtente, string idTrasmissione, DocsPaVO.utente.Ruolo ruolo, DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.fascicolazione.Fascicolo fascicolo, out string errore)
        {
            SetUserId(infoUtente);
            logger.Info("BEGIN");
            bool result = true; // Presume successo
            errore = string.Empty;
            string mode;
            string idObj;
            string msg;
            const string ACCETTATADOC = "ACCETTATA_DOCUMENTO";
            const string ACCETTATAFASC = "ACCETTATA_FASCICOLO";
            const string RIFIUTATADOC = "RIFIUTATA_DOCUMENTO";
            const string RIFIUTATAFASC = "RIFIUTATA_FASCICOLO";
            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Trasmissioni.ExecTrasmManager.executeAccRifMethod(trasmissioneUtente, idTrasmissione, ruolo, infoUtente, out errore, out mode, out idObj, fascicolo);
#if TRACE_WS
				pt.WriteLogTracer("TrasmissioneExecuteAccRif");
#endif
                if (result && !string.IsNullOrEmpty(mode))
                {
                    DocsPaVO.trasmissione.TrasmissioneSingola sing = BusinessLogic.Trasmissioni.ExecTrasmManager.getTrasmSingola(trasmissioneUtente);
                    string idRole = sing.tipoDest == DocsPaVO.trasmissione.TipoDestinatario.RUOLO ? ruolo.idGruppo : "0";

                    switch (mode)
                    {
                        case ACCETTATADOC:
                            msg = "Accettazione della trasmissione. Id documento: " + idObj;
                            BusinessLogic.UserLog.UserLog.WriteLog(infoUtente.userId, infoUtente.idPeople, idRole, infoUtente.idAmministrazione, "ACCEPTTRASMDOCUMENT", idObj, msg, DocsPaVO.Logger.CodAzione.Esito.OK, infoUtente.delegato, "1", sing.systemId);
                            break;
                        case ACCETTATAFASC:
                            msg = "Accettazione della trasmissione. Id fascicolo: " + idObj;
                            BusinessLogic.UserLog.UserLog.WriteLog(infoUtente.userId, infoUtente.idPeople, idRole, infoUtente.idAmministrazione, "ACCEPTTRASMFOLDER", idObj, msg, DocsPaVO.Logger.CodAzione.Esito.OK, infoUtente.delegato, "1", sing.systemId);
                            break;
                        case RIFIUTATAFASC:
                            msg = "Rifiuto della trasmissione. Id fascicolo: " + idObj;
                            BusinessLogic.UserLog.UserLog.WriteLog(infoUtente.userId, infoUtente.idPeople, idRole, infoUtente.idAmministrazione, "REJECTTRASMFOLDER", idObj, msg, DocsPaVO.Logger.CodAzione.Esito.OK, infoUtente.delegato, "1", sing.systemId);
                            break;
                        case RIFIUTATADOC:
                            msg = "Rifiuto della trasmissione. Id documento: " + idObj;
                            BusinessLogic.UserLog.UserLog.WriteLog(infoUtente.userId, infoUtente.idPeople, idRole, infoUtente.idAmministrazione, "REJECTTRASMDOCUMENT", idObj, msg, DocsPaVO.Logger.CodAzione.Esito.OK, infoUtente.delegato, "1", sing.systemId);
                            break;
                    }
                }
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: TrasmissioneExecuteAccRif", e);
                result = false;
            }
            logger.Info("END");
            return result;
        }

        [WebMethod]
        public virtual bool RitornaAlMittTrasmUt(DocsPaVO.trasmissione.TrasmissioneUtente trasmissioneUtente, DocsPaVO.utente.InfoUtente infoUtente)
        {
            bool result = true;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Trasmissioni.ExecTrasmManager.RitornaAlMittTrasmUt(trasmissioneUtente, infoUtente);
#if TRACE_WS
				pt.WriteLogTracer("TrasmissioneExecuteAccRif");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: RifiutaTrasmUtente", e);
                result = false;
            }

            return result;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual DocsPaVO.trasmissione.Trasmissione TrasmissioneGetRisposta(DocsPaVO.trasmissione.TrasmissioneUtente trasmUtente)
        {
            DocsPaVO.trasmissione.Trasmissione result = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Trasmissioni.ExecTrasmManager.GetRispostaMethod(trasmUtente);
#if TRACE_WS
				pt.WriteLogTracer("TrasmissioneGetRisposta");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: TrasmissioneGetRisposta", e);
                result = null;
            }

            return result;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual DocsPaVO.trasmissione.Trasmissione TrasmissioneGetInRispostaA(DocsPaVO.trasmissione.TrasmissioneSingola trasmSingola)
        {
            DocsPaVO.trasmissione.Trasmissione result = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Trasmissioni.ExecTrasmManager.GetInRispostaA(trasmSingola);
#if TRACE_WS
				pt.WriteLogTracer("TrasmissioneGetInRispostaA");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: TrasmissioneGetInRispostaA", e);
                result = null;
            }

            return result;
        }

        /// <summary>
        /// Trasmissione del protocollo interno
        /// </summary>
        /// <param name="schedaDoc"></param>
        /// <param name="ruolo"></param>
        /// <param name="serverName"></param>
        /// <param name="RagioniVerificate"></param>
        /// <returns>bool</returns>
        [WebMethod]
        public bool TrasmettiProtocolloInterno(DocsPaVO.documento.SchedaDocumento schedaDoc, DocsPaVO.utente.Ruolo ruolo, string serverName, bool isEnableRef, DocsPaVO.utente.InfoUtente infoUtente, out bool RagioniVerificate, out string message)
        {
            SetUserId(infoUtente);
            bool result = true;
            message = "";
            RagioniVerificate = true;
            bool destTo = false;
            bool destCC = false;
            message = "";

            DocsPaVO.Spedizione.ConfigSpedizioneDocumento config = BusinessLogic.Spedizione.SpedizioneManager.GetConfigSpedizioneDocumento(infoUtente);

            //Se la chiave config.SpedizioneAutomaticaDocumento  a true continua ad
            //effettuare le trasmissioni automatiche altrimenti se impostata a false blocca le trasmissioni
            //automatiche per i protocolli INTERNI o in USCITA.
            if (config.SpedizioneAutomaticaDocumento)
            {
                try
                {
                    BusinessLogic.trasmissioni.TrasmProtoIntManager trasmProtoInt = new BusinessLogic.trasmissioni.TrasmProtoIntManager();

                    if (schedaDoc.tipoProto.Equals("P"))//se il protocollo  in partenza
                    {
                        if (((DocsPaVO.documento.ProtocolloUscita)(schedaDoc.protocollo)).destinatari != null && ((DocsPaVO.documento.ProtocolloUscita)(schedaDoc.protocollo)).destinatari.Count > 0)
                        {
                            destTo = true;
                            if (((DocsPaVO.documento.ProtocolloUscita)(schedaDoc.protocollo)).destinatariConoscenza != null && ((DocsPaVO.documento.ProtocolloUscita)(schedaDoc.protocollo)).destinatariConoscenza.Count > 0)
                            {
                                destCC = true;
                            }
                        }
                    }
                    else if (schedaDoc.tipoProto.Equals("I"))//se il protocollo  interno
                    {
                        if (((DocsPaVO.documento.ProtocolloInterno)(schedaDoc.protocollo)).destinatari != null && ((DocsPaVO.documento.ProtocolloInterno)(schedaDoc.protocollo)).destinatari.Count > 0)
                        {
                            destTo = true;
                            if (((DocsPaVO.documento.ProtocolloInterno)(schedaDoc.protocollo)).destinatariConoscenza != null && ((DocsPaVO.documento.ProtocolloInterno)(schedaDoc.protocollo)).destinatariConoscenza.Count > 0)
                            {
                                destCC = true;
                            }
                        }
                    }

                    // Verifica ragioni trasmissione
                    //if(!trasmProtoInt.VerificaRagioni(ruolo.idAmministrazione, isEnableRef)) throw new BusinessLogic.trasmissioni.TrasmProtoIntManager.RagioniNotFoundException();
                    if (!BusinessLogic.trasmissioni.TrasmProtoIntManager.VerificaRagioni(ruolo.idAmministrazione, isEnableRef, schedaDoc.tipoProto, destTo, destCC, out message)) throw new BusinessLogic.trasmissioni.TrasmProtoIntManager.RagioniNotFoundException();

                    // Predisponi trasmissioni ai destinatari
                    //DocsPaVO.trasmissione.Trasmissione trasmissione = trasmProtoInt.SetCorrispondentiTrasmissione(schedaDoc, ruolo, infoUtente);
                    DocsPaVO.trasmissione.Trasmissione trasmissione = trasmProtoInt.SetCorrispondentiTrasmissione(schedaDoc, ruolo, infoUtente, out message);

                    if (trasmissione.trasmissioniSingole.Count > 0)
                    {

                        //Verifico se abilitare l'estensione gerarchica della visibilit per il documento
                        //da trasmettere.
                        if (!string.IsNullOrEmpty(schedaDoc.eredita))
                        {
                            ArrayList appoTrasmSingole = new ArrayList();
                            for (int i = 0; i < trasmissione.trasmissioniSingole.Count; i++)
                            {
                                DocsPaVO.trasmissione.TrasmissioneSingola trasmSing = new DocsPaVO.trasmissione.TrasmissioneSingola();
                                trasmSing = (DocsPaVO.trasmissione.TrasmissioneSingola)trasmissione.trasmissioniSingole[i];
                                trasmSing.ragione.eredita = schedaDoc.eredita;
                                appoTrasmSingole.Add(trasmSing);
                            }
                            trasmissione.trasmissioniSingole = appoTrasmSingole;
                        }
                        if (infoUtente.delegato != null)
                            trasmissione.delegato = ((DocsPaVO.utente.InfoUtente)(infoUtente.delegato)).idPeople;

                        // Salvataggio e Esecuzione della trasmissione solamente se il destinatario != mittente
                        this.TrasmissioneSaveTrasm(trasmissione);
                        this.TrasmissioneExecuteTrasm(serverName, trasmissione);
                    }
                }
                catch (BusinessLogic.trasmissioni.TrasmProtoIntManager.RagioniNotFoundException)
                {
                    RagioniVerificate = false;
                }
                catch (Exception)
                {
                    result = false;
                }
            }

            return result;
        }
        /// <summary>
        /// Trasmissione del fascicolo all'ufficio referente
        /// </summary>
        /// <param name="fasc">fascicolo da trasmettere</param>
        /// <param name="ruolo">ruolo dell'utente loggato che effettua la trasmissione</param>
        /// <param name="serverName"></param>
        /// <param name="RagioniVerificate"></param>
        /// <returns>bool</returns>
        [WebMethod]
        public DocsPaVO.trasmissione.RagioneTrasmissione GetRagioneTrasmissione(string tipoRagione, DocsPaVO.utente.Ruolo ruolo, out bool RagioniVerificate)
        {
            DocsPaVO.trasmissione.RagioneTrasmissione ragTrasm = null;
            RagioniVerificate = true;

            try
            {
                BusinessLogic.trasmissioni.TrasmFascUffRef trasmFascUR = new BusinessLogic.trasmissioni.TrasmFascUffRef();
                // Verifica se  presente la ragione di trasmissione per ufficio referente
                if (!trasmFascUR.VerificaRagioniUffReferente(ruolo.idAmministrazione)) throw new BusinessLogic.trasmissioni.TrasmFascUffRef.RagioniNotFoundException();
                ragTrasm = BusinessLogic.Trasmissioni.RagioniManager.GetRagione(tipoRagione, ruolo.idAmministrazione);

            }
            catch (BusinessLogic.trasmissioni.TrasmFascUffRef.RagioniNotFoundException)
            {
                RagioniVerificate = false;
            }
            catch (Exception)
            {
                ragTrasm = null;
            }

            return ragTrasm;
        }
        /// <summary>
        /// Controlla che una determinata UO abbia un ruolo di riferimento.
        /// </summary>
        /// <param name="schedaDoc"></param>
        /// <returns>bool</returns>
        [WebMethod]
        public bool UOHasReferenceRole(string idUO)
        {
            BusinessLogic.trasmissioni.TrasmProtoIntManager trasmProtoInt = new BusinessLogic.trasmissioni.TrasmProtoIntManager();
            bool result = trasmProtoInt.UOHasReferenceRole(idUO);

            return result;
        }

        #region template
        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual DocsPaVO.trasmissione.TemplateTrasmissione TrasmissioneAddTemplate(DocsPaVO.trasmissione.TemplateTrasmissione template)
        {
            DocsPaVO.trasmissione.TemplateTrasmissione result = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Trasmissioni.TemplateTrasmManager.addTemplate(template);
#if TRACE_WS
				pt.WriteLogTracer("TrasmissioneAddTemplate");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: TrasmissioneAddTemplate", e);
                result = null;
            }

            return result;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.trasmissione.TemplateTrasmissione))]
        public virtual ArrayList TrasmissioneGetListaTemplate(string idPeople, string idCorrGlobali, string tipo)
        {
            ArrayList result = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Trasmissioni.TemplateTrasmManager.getListaTemplate(idPeople, idCorrGlobali, tipo);
#if TRACE_WS
				pt.WriteLogTracer("TrasmissioneGetListaTemplate");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: TrasmissioneGetListaTemplate", e);
                result = null;
            }

            return result;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual bool TrasmissioniUpdateTemplate(DocsPaVO.trasmissione.TemplateTrasmissione template)
        {
            bool result = true; // Presume successo

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                BusinessLogic.Trasmissioni.TemplateTrasmManager.updateTemplate(template);
#if TRACE_WS
				pt.WriteLogTracer("TrasmissioniUpdateTemplate");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: TrasmissioniUpdateTemplate", e);
                result = false;
            }

            return result;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual bool TrasmissioniDeleteTemplate(DocsPaVO.trasmissione.TemplateTrasmissione template)
        {
            bool result = true; // Presume successo

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                BusinessLogic.Trasmissioni.TemplateTrasmManager.deleteTemplate(template);
#if TRACE_WS
				pt.WriteLogTracer("TrasmissioniDeleteTemplate");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: TrasmissioniDeleteTemplate", e);
                result = false;
            }

            return result;
        }
        #endregion

        #endregion

        #region AddressBook

        #region corrispondenti interni autorizzati -- elisa
        /// <summary>
        /// 
        /// </summary>
        /// <param name="queryCorrispondente"></param>
        /// <returns></returns>
        [WebMethod]
        [XmlInclude(typeof(DocsPaVO.utente.Corrispondente))]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.utente.Corrispondente))]
        public virtual ArrayList AddressbookGetListaCorrispondenti_Aut(DocsPaVO.addressbook.QueryCorrispondente queryCorrispondente)
        {
            ArrayList result = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Utenti.addressBookManager.getListaCorrispondentiAutProtInt(queryCorrispondente);
#if TRACE_WS
				pt.WriteLogTracer("AddressbookGetListaCorrispondenti");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AddressbookGetListaCorrispondenti", e);
                result = null;
            }

            return result;
        }
        #endregion


        /// <summary>
        /// </summary>
        [WebMethod]
        [XmlInclude(typeof(DocsPaVO.utente.Corrispondente))]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.utente.Corrispondente))]
        public virtual ArrayList AddressbookGetListaCorrispondenti(DocsPaVO.addressbook.QueryCorrispondente queryCorrispondente)
        {
            ArrayList result = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Utenti.addressBookManager.getListaCorrispondenti(queryCorrispondente);
#if TRACE_WS
				pt.WriteLogTracer("AddressbookGetListaCorrispondenti");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AddressbookGetListaCorrispondenti", e);
                result = null;
            }

            return result;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual System.Data.DataSet AddressbookGetDettagliCorrispondente(DocsPaVO.addressbook.QueryCorrispondente queryCorrispondente)
        {
            DocsPaVO.addressbook.DettagliCorrispondente result = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Utenti.addressBookManager.dettagliCorrispondenteMethod(queryCorrispondente);
#if TRACE_WS
				pt.WriteLogTracer("AddressbookGetDettagliCorrispondente");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AddressbookGetDettagliCorrispondente", e);
                result = null;
            }
            return result;
        }


        /// <summary>
        /// </summary>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.utente.Corrispondente))]
        public virtual ArrayList AddressbookGetListaCorrispondentiAutorizzati(DocsPaVO.addressbook.QueryCorrispondenteAutorizzato queryCorrispondenteAutorizzato)
        {

            ArrayList result = null;
            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Utenti.addressBookManager.listaCorrispondentiAutMethod(queryCorrispondenteAutorizzato);
#if TRACE_WS
				pt.WriteLogTracer("AddressbookGetListaCorrispondentiAutorizzati");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AddressbookGetListaCorrispondentiAutorizzati", e);
                result = null;
            }
            return result;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.utente.UnitaOrganizzativa))]
        public virtual ArrayList AddressbookGetRootUO(DocsPaVO.addressbook.QueryCorrispondente queryCorrispondente)
        {
            ArrayList result = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Utenti.addressBookManager.getRootUO(queryCorrispondente);
#if TRACE_WS
				pt.WriteLogTracer("AddressbookGetRootUO");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AddressbookGetRootUO", e);
                result = null;
            }

            return result;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual DocsPaVO.utente.Corrispondente AddressbookInsertCorrispondente(DocsPaVO.utente.Corrispondente corrispondente, DocsPaVO.utente.Corrispondente parent, DocsPaVO.utente.InfoUtente iu)
        {
            SetUserId(iu);
            DocsPaVO.utente.Corrispondente result = null;
            // DocsPaVO.utente.InfoUtente iu = ;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Utenti.addressBookManager.insertCorrispondente(corrispondente, parent);
#if TRACE_WS
				pt.WriteLogTracer("AddressbookInsertCorrispondente");
#endif
                if (result != null)
                    BusinessLogic.UserLog.UserLog.WriteLog(iu, "RUBRICAINSCORR", corrispondente.systemId, "Inserimento corrispondente " + corrispondente.codiceCorrispondente + " in rubrica", DocsPaVO.Logger.CodAzione.Esito.OK);
            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(iu, "RUBRICAINSCORR", corrispondente.systemId, "Inserimento corrispondente " + corrispondente.codiceCorrispondente + " in rubrica", DocsPaVO.Logger.CodAzione.Esito.OK);
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AddressbookInsertCorrispondente", e);
                result = null;
            }

            return result;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.utente.Ruolo))]
        public virtual System.Collections.ArrayList AddressbookGetRuoliSuperioriInUO(DocsPaVO.utente.Ruolo ruolo)
        {
            System.Collections.ArrayList result = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Utenti.addressBookManager.getRuoliSuperioriInUO(ruolo);
#if TRACE_WS
				pt.WriteLogTracer("AddressbookGetRuoliSuperioriInUO");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AddressbookGetRuoliSuperioriInUO", e);
                result = null;
            }

            return result;
        }


        //
        //

        /// <summary>
        /// </summary>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.utente.Ruolo))]
        public virtual System.Collections.ArrayList AddressbookGetRuoliRiferimentoAutorizzati(DocsPaVO.addressbook.QueryCorrispondenteAutorizzato qca, DocsPaVO.utente.UnitaOrganizzativa uo)
        {
            System.Collections.ArrayList result = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Utenti.addressBookManager.getRuoliRiferimentoAutorizzati(qca, uo);
#if TRACE_WS
				pt.WriteLogTracer("AddressbookGetRuoliSuperioriInUO");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AddressbookGetRuoliRiferimentoUO", e);
                result = null;
            }

            return result;
        }

        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.utente.Canale))]
        public virtual System.Collections.ArrayList AddressbookGetCanali()
        {
            System.Collections.ArrayList result = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Utenti.addressBookManager.getCanaliMethod();
#if TRACE_WS
				pt.WriteLogTracer("AddressbookGetCanali");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AddressbookGetCanali", e);
                result = null;
            }
            return result;
        }

        #endregion

        #region Interoperabilit

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual bool InteroperabilitaRicezione(string serverName, DocsPaVO.utente.Registro reg, DocsPaVO.utente.Utente ut, DocsPaVO.utente.Ruolo ruolo, out DocsPaVO.Interoperabilita.MailAccountCheckResponse mailCheckResponse)
        {
            SetUserId(ut);
            bool result = true; // Presume successo
            mailCheckResponse = null;

            DocsPaVO.Logger.CodAzione.Esito esito = DocsPaVO.Logger.CodAzione.Esito.OK;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Interoperabilit.InteroperabilitaRicezione.interopRiceviMethod(serverName, reg, ut, ruolo, out mailCheckResponse);
#if TRACE_WS
				pt.WriteLogTracer("InteroperabilitaRicezione");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: InteroperabilitaRicezione", e);
                result = false;

                esito = DocsPaVO.Logger.CodAzione.Esito.KO;
            }
            finally
            {
                string email = reg.email;
                if (email == null || email == string.Empty)
                    email = "NON DEFINITO";

                string logInfo = "Registro: " + reg.codRegistro + " - " +
                                "Indirizzo mail: " + email + " - ";

                if (mailCheckResponse.ErrorMessage != string.Empty)
                {
                    logInfo += "Errore nella connessione al server di posta";
                    esito = DocsPaVO.Logger.CodAzione.Esito.KO;
                }
                else if (mailCheckResponse.InvalidMailProcessedCount > 0)
                {
                    logInfo += mailCheckResponse.InvalidMailProcessedCount.ToString() + " messaggi non processati";
                    esito = DocsPaVO.Logger.CodAzione.Esito.KO;
                }
                else
                {
                    logInfo += "Processati " + mailCheckResponse.MailProcessedList.Count.ToString() + " messaggi";
                }

                BusinessLogic.UserLog.UserLog.WriteLog(
                            ut.userId,
                            ut.idPeople,
                            ((DocsPaVO.utente.Ruolo)ut.ruoli[0]).idGruppo,
                            ut.idAmministrazione,
                            "INTEROPERABILITARICEZIONE",
                            reg.systemId,
                            logInfo,
                            esito, null);
            }

            return result;
        }

        /// <summary>
        /// questo metodo esegue la procedura dell'interoperabilit a partire da un oggetto schedaDocuemento, un registro.
        /// la schedadocumento sarebbe quella di un documente protocollato in uscita e spedito alla casella del registro  (parametro)
        /// come paramento. l'infoUtente  quella del utente e ruolo che crea il documento predisposto alla protocollazione che viene creato a partire dalla schedaDocumento (paramento).
        /// il mittente del documento predisposto alla protocollazione  il ruolo che ha creato la schedadocumento (parametro) del protocollato in uscita e spedito alla casella del registro.
        /// il parametro di uscita err  una stringa che riporta il docnumber se la procedura ha avuto successo, altrimenti da un messaggio di errore e il docnumber se  stato creato il documento predisposto  
        /// </summary>
        /// <param name="serverName"></param>
        /// <param name="reg"></param>
        /// <param name="ut"></param>
        /// <param name="ruolo"></param>
        /// <param name="sch"></param>
        /// <param name="err"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual bool InteroperabilitaRispedisci(string serverName, DocsPaVO.utente.Registro reg, DocsPaVO.utente.InfoUtente ut, DocsPaVO.utente.Ruolo ruolo, DocsPaVO.documento.SchedaDocumento sch, out string err)
        {
            SetUserId(ut);
            bool result = true; // Presume successo
            err = string.Empty;
            DocsPaVO.Interoperabilita.DatiInteropAutomatica dia = null;
            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif

                //*****************************************************************************************************//
                // MODIFICA GIORDANO IACOZZILLI 10052012
                //
                BusinessLogic.Interoperabilit.InteroperabilitaSegnatura.eseguiSegnaturaNoMail(ut, serverName, reg, ut, ruolo, sch, out err, out dia, string.Empty, null);
                //
                // OLD CODE:
                //BusinessLogic.Interoperabilit.InteroperabilitaSegnatura.eseguiSegnaturaNoMail(serverName, reg, ut, ruolo, sch, out err, out dia,string.empty);
                //*****************************************************************************************************//
#if TRACE_WS
				pt.WriteLogTracer("InteroperabilitaRicezione");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: InteroperabilitaRicezione", e);
                result = false;
            }

            return result;
        }

        [WebMethod()]
        public DateTime[] InteroperabilitaCheckMailGetLogDateList(DocsPaVO.utente.Registro registro)
        {
            DateTime[] retValue = null;

            try
            {
                BusinessLogic.Interoperabilit.Log.LogCheckMail logCheckMail = new BusinessLogic.Interoperabilit.Log.LogCheckMail();
                retValue = logCheckMail.GetLogDateList(registro);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: InteroperabilitaCheckMailGetLogDateList", e);
            }

            return retValue;
        }

        /// <summary>
        /// Restituzione di tutti i log del controllo casella istituzionale
        /// effettuati in un registro e ordinati per data e ora decrescente 
        /// </summary>
        /// <param name="registro"></param>
        /// <param name="logDateTime"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.Interoperabilita.LogElementCheckMail[] InteroperabilitaCheckMailGetLogElements(DocsPaVO.utente.Registro registro, DateTime logDateTime)
        {
            DocsPaVO.Interoperabilita.LogElementCheckMail[] retValue = null;

            try
            {
                BusinessLogic.Interoperabilit.Log.LogCheckMail logCheckMail = new BusinessLogic.Interoperabilit.Log.LogCheckMail();
                retValue = logCheckMail.GetLogElements(registro, logDateTime);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: InteroperabilitaGetLogElementsCheckMail", e);
            }

            return retValue;
        }


        #region Metodo Commentato
        //		[WebMethod]
        //		public virtual bool InteroperabilitaInvio(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.utente.Corrispondente mittSegnatura, DocsPaVO.utente.Registro reg, DocsPaVO.documento.SchedaDocumento schedaDoc, bool confermaRic) 
        //		{
        //			bool result = true; // Presume successo
        //
        //			try 
        //			{             
        //				//metodo per ottenere i dettagli
        //				DocsPaWS.interoperabilit.InteroperabilitaInvioSegnatura.interopInviaMethod(infoUtente,mittSegnatura,reg,schedaDoc,confermaRic);
        //			}
        ////			catch(Exception e) 
        ////			{
        ////				ErrorHandler.throwFault(e.Message,e.failReason,Context.Request.Url.AbsoluteUri);
        ////			}
        //			catch(Exception e) 
        //			{
        //				//ErrorHandler.throwFault(e.Message,"F_System",Context.Request.Url.AbsoluteUri);
        //				
        //				result = false;
        //			}
        //
        //			return result;
        //		}
        #endregion

        #region Metodo Commentato
        //		[WebMethod]
        //		public virtual bool InteroperabilitaInvioRicevuta(string idProfile,DocsPaVO.utente.Registro reg, DocsPaVO.utente.InfoUtente infoUtente) 
        //		{
        //			bool result = true; // Presume successo
        //
        //			try 
        //			{             
        //				//metodo per ottenere i dettagli
        //				DocsPaWS.interoperabilit.InteroperabilitaInvioRicevuta.sendRicevutaRitorno(idProfile,reg);
        //			}
        ////			catch(Exception e) 
        ////			{
        ////				ErrorHandler.throwFault(e.Message,e.failReason,Context.Request.Url.AbsoluteUri);
        ////			}
        //			catch(Exception e) 
        //			{
        //				//ErrorHandler.throwFault(e.Message,"F_System",Context.Request.Url.AbsoluteUri);
        //				
        //				result = false;
        //			}
        //
        //			return result;
        //		}
        #endregion

        /// <summary>
        /// </summary>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.documento.ProtocolloDestinatario))]
        public virtual ArrayList InteroperabilitaAggiornamentoConferma(string idProfile, DocsPaVO.utente.Corrispondente corrispondente)
        {
            ArrayList result = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Documenti.ProtocolloUscitaManager.aggiornamentoConferma(idProfile, corrispondente);
#if TRACE_WS
				pt.WriteLogTracer("InteroperabilitaAggiornamentoConferma");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: InteroperabilitaAggiornamentoConferma", e);
                result = null;
            }

            return result;
        }

        /// <summary>
        /// questo metodo esegue la procedura dell'interoperabilit a partire da un oggetto schedaDocuemento, un registro.
        /// la schedadocumento sarebbe quella di un documente protocollato in uscita e spedito alla casella del registro  (parametro)
        /// come paramento. l'infoUtente  quella del utente e ruolo che crea il documento predisposto alla protocollazione che viene creato a partire dalla schedaDocumento (paramento).
        /// il mittente del documento predisposto alla protocollazione  il ruolo che ha creato la schedadocumento (parametro) del protocollato in uscita e spedito alla casella del registro.
        /// il parametro di uscita err  una stringa che riporta il docnumber se la procedura ha avuto successo, altrimenti da un messaggio di errore e il docnumber se  stato creato il documento predisposto  
        /// </summary>
        /// <param name="serverName"></param>
        /// <param name="reg"></param>
        /// <param name="ut"></param>
        /// <param name="ruolo"></param>
        /// <param name="sch"></param>
        /// <param name="err"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual bool InteroperabilitaAggiornamentoRicRitorno(DocsPaVO.Interoperabilita.RicevutaRitorno ricevuta, DocsPaVO.utente.InfoUtente ut, out string message)
        {
            SetUserId(ut);
            bool result = true; // Presume successo
            message = string.Empty;
            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Interoperabilit.InteroperabilitaControlloRicevute.processaRicevutaConferma(ricevuta, out message);
#if TRACE_WS
				pt.WriteLogTracer("InteroperabilitaRicezione");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: InteroperabilitaRicezione", e);
                result = false;
            }

            return result;
        }

        /// <summary>
        /// Controlla se un documento  stato ricevuto tramite una casella configurata per mantenere le mail ricevute come pendenti.
        /// Serve per il frontend.
        /// Per gestione pendenti tramite PEC
        /// </summary>
        /// <param name="idDocument"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual bool InteroperabilitaIsDocPecPendente(string idDocument)
        {
            bool retval = false;
            try
            {

                retval = BusinessLogic.Interoperabilit.InteroperabilitaUtils.isDocPecPendente(idDocument);

            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: InteroperabilitaIsDocPecPendente", e);
                retval = false;
            }


            return retval;
        }

        #endregion

        #region Registri
        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual DocsPaVO.documento.StampaRegistroResult RegistriStampa(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.utente.Ruolo ruolo, DocsPaVO.utente.Registro registro)
        {
            SetUserId(infoUtente);
            DocsPaVO.documento.StampaRegistroResult result = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Report.RegistriStampa.stampaRegistro(infoUtente, ruolo, registro);
#if TRACE_WS
				pt.WriteLogTracer("RegistriStampa");
#endif

                //Celeste
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "REGISTRIDISTAMPA", registro.systemId, string.Format("{0} {1}", "Stampa del Registro Cod.:", registro.codRegistro), DocsPaVO.Logger.CodAzione.Esito.OK);
                //Fine Celeste
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: RegistriStampa", e);
                result = null;
                //Celeste
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, registro.systemId, "REGISTRIDISTAMPA", string.Format("{0} {1}", "Stampa del Registro Cod.:", registro.codRegistro), DocsPaVO.Logger.CodAzione.Esito.KO);
                //Fine Celeste
            }

            return result;
        }

        [WebMethod]
        public virtual DocsPaVO.documento.StampaRegistroResult RegistriStampaWithFilters(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.utente.Ruolo ruolo, DocsPaVO.utente.Registro registro, DocsPaVO.filtri.FiltroRicerca[][] filters, out DocsPaVO.documento.FileDocumento fileDoc)
        {
            SetUserId(infoUtente);
            DocsPaVO.documento.StampaRegistroResult result = null;
            fileDoc = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Report.RegistriStampa.StampaRegistroWithFilters(infoUtente, ruolo, registro, filters, out fileDoc);
#if TRACE_WS
				pt.WriteLogTracer("RegistriStampa");
#endif
                if (result != null)
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "REGISTRIDISTAMPA", registro.systemId, "Stampa documenti del registro: " + registro.codice, DocsPaVO.Logger.CodAzione.Esito.OK);
            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "REGISTRIDISTAMPA", registro.systemId, "Stampa documenti del registro: " + registro.codice, DocsPaVO.Logger.CodAzione.Esito.KO);
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: RegistriStampa", e);
                result = null;
            }

            return result;
        }
        #endregion

        #region Stampa Buste
        [WebMethod]
        public virtual DocsPaVO.documento.FileDocumento StampaBusteWithFilters(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.utente.Ruolo ruolo, DocsPaVO.utente.Registro registro, DocsPaVO.filtri.FiltroRicerca[][] filters)
        {
            SetUserId(infoUtente);
            DocsPaVO.documento.FileDocumento result = new DocsPaVO.documento.FileDocumento();

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Report.StampaBuste.StampaBusteWithFilters(infoUtente, ruolo, registro, filters);
#if TRACE_WS
				pt.WriteLogTracer("RegistriStampa");
#endif
                if (result != null)
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "REGISTRIDISTAMPA", registro.systemId, "Stampa buste del registro: " + registro.codice, DocsPaVO.Logger.CodAzione.Esito.OK);
            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "REGISTRIDISTAMPA", registro.systemId, "Stampa buste del registro: " + registro.codice, DocsPaVO.Logger.CodAzione.Esito.KO);
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: StampaBusteWithFilters", e);
                result = null;
            }

            return result;
        }
        #endregion

        #region Fax
        [WebMethod]
        public virtual int FaxProcessaCasella(string serverName, DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.utente.Ruolo ruolo, DocsPaVO.utente.Registro registro)
        {
            SetUserId(infoUtente);
            System.Collections.ArrayList schedeDoc = new System.Collections.ArrayList();
            int res = 0;
            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                res = BusinessLogic.Interoperabilit.Fax.FaxManager.processaCaselleFaxUO(serverName, infoUtente, ruolo, registro);
#if TRACE_WS
				pt.WriteLogTracer("FaxProcessaCasella");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FaxProcessaCasella", e);
                res = -1;
            }

            return res;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual bool FaxInvio(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.utente.Registro registro, DocsPaVO.documento.SchedaDocumento schedaDoc)
        {
            SetUserId(infoUtente);
            bool result = true; // Presume successo
            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                BusinessLogic.Interoperabilit.Fax.FaxInvio.FaxInvioMethod(infoUtente, registro, schedaDoc);
#if TRACE_WS
				pt.WriteLogTracer("FaxInvio");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FaxInvio", e);
                result = false;
            }

            return result;
        }
        #endregion

        #region Report
        [WebMethod]
        public virtual DocsPaVO.documento.FileDocumento ReportSchedaDoc(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.documento.SchedaDocumento schedaDoc)
        {
            SetUserId(infoUtente);
            DocsPaVO.documento.FileDocumento res = null;
            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                string mittDettIndirizzo = "FALSE";
                if (System.Configuration.ConfigurationManager.AppSettings["MITT_DEST_ADDRESS"] != null && System.Configuration.ConfigurationManager.AppSettings["MITT_DEST_ADDRESS"].ToUpper() == "TRUE")
                    mittDettIndirizzo = System.Configuration.ConfigurationManager.AppSettings["MITT_DEST_ADDRESS"];

                res = BusinessLogic.Report.ReportManager.getSchedaDocReport(infoUtente, schedaDoc, mittDettIndirizzo);
#if TRACE_WS
				pt.WriteLogTracer("ReportSchedaDoc");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ReportSchedaDoc", e);
                res = null;
            }

            return res;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual DocsPaVO.documento.FileDocumento ReportBusta(DocsPaVO.documento.SchedaDocumento schedaDoc)
        {
            DocsPaVO.documento.FileDocumento res = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                res = BusinessLogic.Report.ReportManager.getBustaReport(schedaDoc);
#if TRACE_WS
				pt.WriteLogTracer("ReportBusta");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ReportBusta", e);
                res = null;
            }

            return res;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual DocsPaVO.documento.FileDocumento ReportTitolario(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.utente.Registro registro)
        {
            SetUserId(infoUtente);
            DocsPaVO.documento.FileDocumento res = null;
            string idAmministrazione = infoUtente.idAmministrazione;
            string idGruppo = infoUtente.idGruppo;
            string idPeople = infoUtente.idPeople;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                System.Collections.ArrayList classificazioni = BusinessLogic.Fascicoli.TitolarioManager.getTitolario(idAmministrazione, idGruppo, idPeople, registro, null, true);
                res = BusinessLogic.Report.TitolarioReport.getTitolarioReport(idAmministrazione, idGruppo, idPeople, classificazioni);
#if TRACE_WS
				pt.WriteLogTracer("ReportTitolario");
#endif
                if (res != null)
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "REGISTRIDISTAMPA", registro.systemId, "Stampa titolario del registro " + registro.codice, DocsPaVO.Logger.CodAzione.Esito.OK);
            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "REGISTRIDISTAMPA", registro.systemId, "Stampa titolario del registro " + registro.codice, DocsPaVO.Logger.CodAzione.Esito.KO);
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ReportTitolario", e);
                res = null;
            }

            return res;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual DocsPaVO.documento.FileDocumento ReportCorrispondenti(DocsPaVO.addressbook.QueryCorrispondente queryCorrispondente, DocsPaVO.utente.InfoUtente infoUtente)
        {
            SetUserId(infoUtente);
            DocsPaVO.documento.FileDocumento result = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Report.Corrispondenti.stampa(queryCorrispondente);
#if TRACE_WS
				pt.WriteLogTracer("ReportCorrispondenti");
#endif
                if (result != null)
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "REGISTRIDISTAMPA", queryCorrispondente.systemId, "Stampa corrispondenti esterni ", DocsPaVO.Logger.CodAzione.Esito.OK);
            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "REGISTRIDISTAMPA", queryCorrispondente.systemId, "Stampa corrispondenti esterni ", DocsPaVO.Logger.CodAzione.Esito.KO);
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ReportCorrispondenti", e);
                result = null;
            }

            return result;
        }
        [WebMethod]
        public virtual int ReportTrasmissioniDocFasc(DocsPaVO.trasmissione.OggettoTrasm obj, out DocsPaVO.documento.FileDocumento fileDoc)
        {
            fileDoc = null;
            int result = -1;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Report.TrasmissioniReport.reportTrasmDocFasc(obj, out fileDoc);
#if TRACE_WS
				pt.WriteLogTracer("ReportTrasmissioniDocFasc");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ReportTrasmissioniDocFasc", e);
                result = -1;
            }

            return result;

        }

        /// <summary>
        /// overloading per passare nome e cognome dell'utente loggato,in modo da evidenziare le trasmissioni di cui l'utente  destinatario
        /// Dimitri
        /// </summary>
        /// <param name="obj"></param>
        /// <param name="fileDoc"></param>
        /// <param name="Utente"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual int ReportTrasmissioniDocFascUtente(DocsPaVO.trasmissione.OggettoTrasm obj, out DocsPaVO.documento.FileDocumento fileDoc, DocsPaVO.utente.InfoUtente infoUt)
        {
            SetUserId(infoUt);
            fileDoc = null;
            int result = -1;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Report.TrasmissioniReport.reportTrasmDocFasc(obj, out fileDoc, infoUt);
#if TRACE_WS
				pt.WriteLogTracer("ReportTrasmissioniDocFasc");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ReportTrasmissioniDocFasc", e);
                result = -1;
            }

            return result;

        }


        [WebMethod]
        public virtual int ReportTrasmissioniUO(DocsPaVO.filtri.FiltroRicerca[] filtriTrasm, string UO, DocsPaVO.utente.InfoUtente infoUtente, out DocsPaVO.documento.FileDocumento fileDoc)
        {
            SetUserId(infoUtente);
            fileDoc = null;
            int result = -1;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Report.TrasmissioniReport.reportTrasmUO(filtriTrasm, out fileDoc, UO);
#if TRACE_WS
				pt.WriteLogTracer("ReportTrasmissioniDocFasc");
#endif
                if (result != -1)
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "REGISTRIDISTAMPA", "0", "Stampa trasmissioni UO: " + UO, DocsPaVO.Logger.CodAzione.Esito.OK);
            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "REGISTRIDISTAMPA", "0", "Stampa trasmissioni UO: " + UO, DocsPaVO.Logger.CodAzione.Esito.KO);
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ReportTrasmissioniDocFasc", e);
                result = -1;
            }

            return result;

        }


        #endregion

        #region TODO: Metodi Da Implementare
        //TODO: addressbookGetListaCorrispondentiSemplice
        [WebMethod]
        [XmlInclude(typeof(DocsPaVO.utente.Corrispondente))]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.utente.Corrispondente))]
        public virtual ArrayList addressbookGetListaCorrispondentiSemplice()
        {
            return null;
        }

        //TODO: reportFascetteFascicolo
        [WebMethod]
        public DocsPaVO.documento.FileDocumento reportFascetteFascicolo(DocsPaVO.fascicolazione.Fascicolo fascicolo, DocsPaVO.utente.InfoUtente infoUtente)
        {
            SetUserId(infoUtente);
            DocsPaVO.documento.FileDocumento retValue = null;

            try
            {
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                retValue = BusinessLogic.Report.FascicoloReport.StampaFascetta(fascicolo);
#if TRACE_WS
				pt.WriteLogTracer("reportFascetteFascicolo");
#endif
                if (retValue != null)
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "REGISTRIDISTAMPA", fascicolo.systemID, "Stampa fascette del fascicolo " + fascicolo.codice, DocsPaVO.Logger.CodAzione.Esito.OK);
            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "REGISTRIDISTAMPA", fascicolo.systemID, "Stampa fascette del fascicolo " + fascicolo.codice, DocsPaVO.Logger.CodAzione.Esito.KO);
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: reportFascetteFascicolo - ", e);
            }

            return retValue;
        }
        #endregion

        #region AMMINISTRAZIONE

        [WebMethod]
        public string AmmGetIDAmm(string codAmm)
        {
            string retValue = null;

            try
            {
                retValue = BusinessLogic.Amministrazione.OrganigrammaManager.GetIDAmm(codAmm);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetIDAmm - ", e);
            }

            return retValue;
        }

        [WebMethod]
        public string GetFormatoDominio(string idAmm)
        {
            string retValue = null;

            try
            {
                retValue = BusinessLogic.Amministrazione.OrganigrammaManager.GetFormatoDominio(idAmm);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetFormatoDominio - ", e);
            }

            return retValue;
        }

        #region Gestione Amministrazioni

        [WebMethod()]
        public virtual DocsPaVO.amministrazione.InfoAmministrazione[] AmmGetListAmministrazioni()
        {
            DocsPaVO.amministrazione.InfoAmministrazione[] retValue = null;
            try
            {
                retValue = BusinessLogic.Amministrazione.AmministraManager.AmmGetListAmministrazioni();
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmGetListAmministrazioni - ", e);
            }

            return retValue;
        }

        [WebMethod()]
        public virtual DocsPaVO.amministrazione.InfoAmministrazione AmmGetInfoAmmCorrente(string idAmm)
        {
            DocsPaVO.amministrazione.InfoAmministrazione retValue = null;
            try
            {
                retValue = BusinessLogic.Amministrazione.AmministraManager.AmmGetInfoAmmCorrente(idAmm);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmGetInfoAmmCorrente - ", e);
            }
            return retValue;
        }

        [WebMethod()]
        public virtual bool setNews(string idAmm, string news, bool enable_news)
        {
            bool retValue = false;
            try
            {
                retValue = BusinessLogic.Amministrazione.AmministraManager.setNews(idAmm, news, enable_news);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: setNews - ", e);
            }
            return retValue;
        }

        [WebMethod()]
        public virtual string getNews(string idAmm)
        {
            string retValue = string.Empty;
            try
            {
                retValue = BusinessLogic.Amministrazione.AmministraManager.getNews(idAmm);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getNews - ", e);
            }
            return retValue;
        }

        [WebMethod()]
        public virtual bool setBanner(string idAmm, string banner)
        {
            bool retValue = false;
            try
            {
                retValue = BusinessLogic.Amministrazione.AmministraManager.setBanner(idAmm, banner);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: setBanner - ", e);
            }
            return retValue;
        }

        [WebMethod()]
        public virtual string getBanner(string idAmm)
        {
            string retValue = string.Empty;
            try
            {
                retValue = BusinessLogic.Amministrazione.AmministraManager.getBanner(idAmm);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getBanner - ", e);
            }
            return retValue;
        }

        /// <summary>
        /// Inserimento di una nuova amministrazione
        /// </summary>
        /// <param name="info"></param>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual DocsPaVO.amministrazione.EsitoOperazione AmmInsertAmm(ref DocsPaVO.amministrazione.InfoAmministrazione info, DocsPaVO.amministrazione.InfoUtenteAmministratore infoUtente)
        {
            DocsPaVO.amministrazione.EsitoOperazione esito = null;
            SetUserId(infoUtente);
            try
            {
                esito = BusinessLogic.Amministrazione.AmministraManager.InsertAmministrazione(info, infoUtente);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmInsertAmm - ", e);
            }

            return esito;
        }

        /// <summary>
        /// Inserimento di un'amministrazione esistente
        /// </summary>
        /// <param name="info"></param>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual DocsPaVO.amministrazione.EsitoOperazione AmmUpdateAmm(ref DocsPaVO.amministrazione.InfoAmministrazione info, DocsPaVO.amministrazione.InfoUtenteAmministratore infoUtente, bool modFascicolatura, bool modSegnatura, bool modTimbroPdf, bool modProtTit)
        {
            SetUserId(infoUtente);
            DocsPaVO.amministrazione.EsitoOperazione esito = null;
            try
            {
                esito = BusinessLogic.Amministrazione.AmministraManager.UpdateAmministrazione(info, infoUtente);
                if (esito != null)
                {
                    if (modFascicolatura)
                        BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMSEGNFASC", info.IDAmm, "Modifica fascicolatura di AOO " + info.Codice, DocsPaVO.Logger.CodAzione.Esito.OK, info.IDAmm);
                    if (modSegnatura)
                        BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMFORMATOSEGN", info.IDAmm, "Modifica segnatura di AOO " + info.Codice, DocsPaVO.Logger.CodAzione.Esito.OK, info.IDAmm);
                    if (modTimbroPdf)
                        BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMFORMATOTIMBRO", info.IDAmm, "Modifica timbro di AOO " + info.Codice, DocsPaVO.Logger.CodAzione.Esito.OK, info.IDAmm);
                    if (modProtTit)
                        BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "FORMATOPROTTIT", info.IDAmm, "Modifica protocollo titolario di AOO " + info.Codice, DocsPaVO.Logger.CodAzione.Esito.OK, info.IDAmm);
                }
            }
            catch (Exception e)
            {
                if (modFascicolatura)
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMSEGNFASC", info.IDAmm, "Modifica fascicolatura di AOO " + info.Codice, DocsPaVO.Logger.CodAzione.Esito.KO, info.IDAmm);
                if (modSegnatura)
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMFORMATOSEGN", info.IDAmm, "Modifica segnatura di AOO " + info.Codice, DocsPaVO.Logger.CodAzione.Esito.KO, info.IDAmm);
                if (modTimbroPdf)
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMFORMATOTIMBRO", info.IDAmm, "Modifica timbro di AOO " + info.Codice, DocsPaVO.Logger.CodAzione.Esito.KO, info.IDAmm);
                if (modProtTit)
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "FORMATOPROTTIT", info.IDAmm, "Modifica protocollo titolario di AOO " + info.Codice, DocsPaVO.Logger.CodAzione.Esito.OK, info.IDAmm);

                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmUpdateAmm - ", e);
            }

            return esito;
        }

        /// <summary>
        /// Cancellazione di un'amministrazione esistente
        /// </summary>
        /// <param name="info"></param>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual DocsPaVO.amministrazione.EsitoOperazione AmmDeleteAmm(ref DocsPaVO.amministrazione.InfoAmministrazione info, DocsPaVO.amministrazione.InfoUtenteAmministratore infoUtente)
        {
            SetUserId(infoUtente);
            DocsPaVO.amministrazione.EsitoOperazione esito = null;

            try
            {
                esito = BusinessLogic.Amministrazione.AmministraManager.DeleteAmministrazione(info, infoUtente);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmDeleteAmm - ", e);
            }

            return esito;
        }

        #endregion

        #region Gestione Organigramma

        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.amministrazione.OrgUO))]
        public virtual ArrayList AmmGetListUO(string idParent, string livello, string idAmm)
        {
            ArrayList retValue = new ArrayList();

            try
            {
                retValue = BusinessLogic.Amministrazione.OrganigrammaManager.GetListUo(idParent, livello, idAmm);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmGetListUO - ", e);
            }

            return retValue;
        }

        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.amministrazione.OrgUO))]
        public virtual ArrayList AmmGetListUOInReg(string idRegistro, string tipoRicerca, string ricerca)
        {
            ArrayList retValue = new ArrayList();

            try
            {
                retValue = BusinessLogic.Amministrazione.OrganigrammaManager.GetListUoInReg(idRegistro, tipoRicerca, ricerca);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmGetListUOInReg - ", e);
            }

            return retValue;
        }

        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.amministrazione.OrgRuolo))]
        public virtual ArrayList AmmGetListRuoliUtente(string idPeople)
        {
            ArrayList retValue = new ArrayList();

            try
            {
                retValue = BusinessLogic.Amministrazione.OrganigrammaManager.GetListRuoliUtente(idPeople);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmGetListRuoliUtente - ", e);
            }

            return retValue;
        }

        [WebMethod]
        public virtual DocsPaVO.amministrazione.EsitoOperazione AmmImpostaRuoloPreferito(DocsPaVO.utente.InfoUtente infoUtente, string idPeople, string idGruppo)
        {
            SetUserId(infoUtente);
            DocsPaVO.amministrazione.EsitoOperazione esito = new DocsPaVO.amministrazione.EsitoOperazione();
            try
            {
                esito = BusinessLogic.Amministrazione.OrganigrammaManager.AmmImpostaRuoloPreferito(infoUtente, idPeople, idGruppo);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmImpostaRuoloPreferito - ", e);
                esito.Codice = 1;
                esito.Descrizione = "si  verificato un errore";
            }

            return esito;
        }

        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.amministrazione.OrgRuolo))]
        public virtual ArrayList AmmGetListRuoliUO(string idUO)
        {
            ArrayList retValue = new ArrayList();

            try
            {
                retValue = BusinessLogic.Amministrazione.OrganigrammaManager.GetListRuoliUo(idUO);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmGetListRuoliUO - ", e);
            }

            return retValue;
        }

        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.amministrazione.OrgRuolo))]
        public virtual ArrayList AmmGetListRuoliUORic(string idUO, bool ricorsivo)
        {
            ArrayList retValue = new ArrayList();

            try
            {
                retValue = BusinessLogic.Amministrazione.OrganigrammaManager.GetListRuoliUoRic(idUO, ricorsivo);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmGetListRuoliUORic - ", e);
            }

            return retValue;
        }

        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.amministrazione.OrgUtente))]
        public virtual ArrayList AmmGetListUtentiRuolo(string idRuolo)
        {
            ArrayList retValue = new ArrayList();

            try
            {
                retValue = BusinessLogic.Amministrazione.OrganigrammaManager.GetListUtentiRuolo(idRuolo);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmGetListUtentiRuolo - ", e);
            }

            return retValue;
        }

        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.amministrazione.OrgUtente))]
        public virtual ArrayList AmmGetListUtenti(string idAmm, string ricercaPer, string testoDaRicercare, string IDesclusi)
        {
            ArrayList retValue = new ArrayList();

            try
            {
                retValue = BusinessLogic.Amministrazione.OrganigrammaManager.GetListUtenti(idAmm, ricercaPer, testoDaRicercare, IDesclusi);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmGetListUtenti - ", e);
            }

            return retValue;
        }

        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.amministrazione.OrgUtente))]
        public virtual ArrayList AmmGetListUtentiInAmmRic(string idAmm, string ricercaPer, string testoDaRicercare)
        {
            ArrayList retValue = new ArrayList();

            try
            {
                retValue = BusinessLogic.Amministrazione.OrganigrammaManager.GetListUtenti(idAmm, ricercaPer, testoDaRicercare);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmGetListUtenti - ", e);
            }

            return retValue;
        }

        [WebMethod]
        public DocsPaVO.amministrazione.VisualizzaStatoDoc GetInfoDocument(string docnumber, string numProto, string anno, string idAmm, string codiceRegistro)
        {
            VisualizzaStatoDoc info = null;
            try
            {
                info = BusinessLogic.Amministrazione.AmministraManager.GetInfoDocument(docnumber, numProto, anno, idAmm, codiceRegistro);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetInfoDocument - ", e);
                info = null;
            }
            return info;
        }

        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.amministrazione.OrgUtente))]
        public virtual ArrayList AmmGetListUtentiInAmm(string idAmm)
        {
            ArrayList retValue = new ArrayList();

            try
            {
                retValue = BusinessLogic.Amministrazione.OrganigrammaManager.GetListUtenti(idAmm);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmGetListUtenti - ", e);
            }

            return retValue;
        }


        /// <summary>
        /// Ritorna una lista di Registri o di RF, o l'unione di entrambe
        /// </summary>
        /// <param name="idAmm">idAmministrazione corrente</param>
        /// <param name="idRuolo">idRuolo corrente</param>
        /// <param name="chaRF">1, se voglio solo gli RF, 0 se voglio solo i registri, "" per entrambi</param>
        /// <returns></returns>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.amministrazione.OrgRegistro))]
        public virtual ArrayList AmmGetListRegistriRF(string idAmm, string idRuolo, string chaRF)
        {
            ArrayList retValue = new ArrayList();

            try
            {
                retValue = BusinessLogic.Amministrazione.OrganigrammaManager.GetListRegistriRF(idAmm, idRuolo, chaRF);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmGetListRegistriRF - ", e);

            }

            return retValue;
        }

        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.amministrazione.OrgRegistro))]
        public virtual ArrayList AmmGetListRegistriAssRuolo(string idAmm, string idRuolo)
        {
            ArrayList retValue = new ArrayList();

            try
            {
                retValue = BusinessLogic.Amministrazione.OrganigrammaManager.GetListRegistriAssRuolo(idAmm, idRuolo);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmGetListRegistriAssRuolo - ", e);
            }

            return retValue;
        }

        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.amministrazione.OrgRegistro))]
        public virtual ArrayList AmmGetListRegistriUtente(string idAmm, string idCorrGlob)
        {
            ArrayList retValue = new ArrayList();

            try
            {
                retValue = BusinessLogic.Amministrazione.UtenteManager.AmmGetListRegistriUtente(idAmm, idCorrGlob);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmGetListRegistriUtente - ", e);
            }

            return retValue;
        }

        [WebMethod]
        public virtual DocsPaVO.amministrazione.EsitoOperazione AmmInsRegistriUtenteAdmin(DocsPaVO.amministrazione.OrgRegistro[] listaRegistri, string idCorrGlob)
        {
            DocsPaVO.amministrazione.EsitoOperazione esito = new DocsPaVO.amministrazione.EsitoOperazione();
            try
            {
                esito = BusinessLogic.Amministrazione.UtenteManager.AmmInsRegistriUtenteAdmin(listaRegistri, idCorrGlob);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmInsRegistriUtenteAdmin - ", e);
                esito.Codice = 1;
                esito.Descrizione = "si  verificato un errore";
            }

            return esito;
        }

        [WebMethod]
        public virtual bool AmmCheckRegAssUtente(string idCorrGlob)
        {
            bool esito = false;
            try
            {
                esito = BusinessLogic.Amministrazione.UtenteManager.AmmCheckRegAssUtente(idCorrGlob);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmCheckRegAssUtente - ", e);
            }

            return esito;
        }

        [WebMethod]
        public virtual bool AmmCheckRespAOO(string idPeople, string idGruppo)
        {
            bool esito = false;
            try
            {
                esito = BusinessLogic.Amministrazione.UtenteManager.AmmCheckRespAOO(idPeople, idGruppo);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmCheckRespAOO - ", e);
            }

            return esito;
        }

        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(string))]
        public virtual List<string> getAmmRespAOO(string idPeople)
        {
            List<string> listaAOO = new List<string>();
            try
            {
                listaAOO = BusinessLogic.Amministrazione.UtenteManager.getAmmRespAOO(idPeople);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmCheckRespAOO - ", e);
            }

            return listaAOO;
        }


        [WebMethod]
        public virtual DocsPaVO.amministrazione.EsitoOperazione AmmEliminaRegistriUtenteAdmin(string idCorrGlob)
        {
            DocsPaVO.amministrazione.EsitoOperazione esito = new DocsPaVO.amministrazione.EsitoOperazione();
            try
            {
                esito = BusinessLogic.Amministrazione.UtenteManager.AmmEliminaRegistriUtenteAdmin(idCorrGlob);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmEliminaRegistriUtenteAdmin - ", e);
                esito.Codice = 1;
                esito.Descrizione = "si  verificato un errore";
            }

            return esito;
        }

        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.amministrazione.OrgTipoFunzione))]
        public virtual ArrayList AmmGetListFunzioni(string idAmm, string idRuolo)
        {
            ArrayList retValue = new ArrayList();

            try
            {
                retValue = BusinessLogic.Amministrazione.OrganigrammaManager.GetListFunzioni(idAmm, idRuolo);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmGetListFunzioni - ", e);
            }

            return retValue;
        }

        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.amministrazione.OrgTipoRuolo))]
        public virtual ArrayList AmmGetListTipiRuolo(string idAmm)
        {
            ArrayList retValue = new ArrayList();

            try
            {
                retValue = BusinessLogic.Amministrazione.OrganigrammaManager.GetListTipiRuolo(idAmm);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmGetListTipiRuolo - ", e);
            }

            return retValue;
        }

        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.amministrazione.OrgRuolo))]
        public virtual ArrayList AmmGetListTipoRuoloUtenti(string codTipoRuolo, string idAmm)
        {
            ArrayList retValue = new ArrayList();

            try
            {
                retValue = BusinessLogic.Amministrazione.TipiRuoloManager.ListTipoRuoloUtenti(codTipoRuolo, idAmm);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmGetListTipoRuoloUtenti - ", e);
            }

            return retValue;
        }

        [WebMethod]
        public virtual DocsPaVO.amministrazione.OrgUtente AmmGetDatiUtente(string idCorrGlob)
        {
            DocsPaVO.amministrazione.OrgUtente datiUtente = new DocsPaVO.amministrazione.OrgUtente();
            try
            {
                datiUtente = BusinessLogic.Amministrazione.OrganigrammaManager.GetDatiUtente(idCorrGlob);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmGetDatiUtente - ", e);
            }

            return datiUtente;
        }

        [WebMethod]
        public virtual DocsPaVO.amministrazione.OrgUO AmmGetDatiUOCorrente(string idUO)
        {
            DocsPaVO.amministrazione.OrgUO currentUO = new DocsPaVO.amministrazione.OrgUO();
            try
            {
                currentUO = BusinessLogic.Amministrazione.OrganigrammaManager.AmmGetDatiUOCorrente(idUO);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmGetDatiUOCorrente - ", e);
            }
            return currentUO;
        }

        [WebMethod]
        public virtual DocsPaVO.amministrazione.OrgDettagliGlobali AmmGetDatiStampaBuste(string idCorrGlob)
        {
            DocsPaVO.amministrazione.OrgDettagliGlobali dettagli = new DocsPaVO.amministrazione.OrgDettagliGlobali();
            try
            {
                dettagli = BusinessLogic.Amministrazione.OrganigrammaManager.AmmGetDatiStampaBuste(idCorrGlob);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmGetDatiStampaBuste - ", e);
            }

            return dettagli;
        }

        [WebMethod]
        public virtual DocsPaVO.amministrazione.EsitoOperazione AmmInsNuovaUO(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.amministrazione.OrgUO nuovaUO)
        {
            DocsPaVO.amministrazione.EsitoOperazione esito = new DocsPaVO.amministrazione.EsitoOperazione();
            SetUserId(infoUtente);
            try
            {
                esito = BusinessLogic.Amministrazione.OrganigrammaManager.AmmInsNuovaUO(nuovaUO);
                if (esito.Codice != 1 || esito.Codice != 2 || esito.Codice != 3)
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMNEWUO", "0", "Creazione UO " + nuovaUO.Codice + " - " + nuovaUO.Descrizione, DocsPaVO.Logger.CodAzione.Esito.OK, nuovaUO.IDAmministrazione);
                else
                {
                    string report = string.Empty;
                    switch (esito.Codice)
                    {
                        case 1:
                            report = "Errore in creazione UO " + nuovaUO.Descrizione + ": codice gi presente in amministrazione";
                            break;

                        case 2:
                            report = "Errore in creazione UO " + nuovaUO.Descrizione + ": errore generico";
                            break;

                        case 3:
                            report = "Errore in creazione UO " + nuovaUO.Descrizione + ": codice gi presente in altra amministrazione";
                            break;
                    }
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMNEWUO", "0", "Errore in creazione UO " + nuovaUO.Descrizione, DocsPaVO.Logger.CodAzione.Esito.KO, nuovaUO.IDAmministrazione);
                }
            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMNEWUO", "0", "Errore in creazione UO " + nuovaUO.Descrizione, DocsPaVO.Logger.CodAzione.Esito.KO, nuovaUO.IDAmministrazione);
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmInsNuovaUO - ", e);
                esito.Codice = 1;
                esito.Descrizione = "si  verificato un errore";
            }

            return esito;
        }

        [WebMethod]
        public virtual DocsPaVO.amministrazione.EsitoOperazione AmmModUO(DocsPaVO.amministrazione.OrgUO theUO, bool StoricizzUO)
        {
            DocsPaVO.amministrazione.EsitoOperazione esito = new DocsPaVO.amministrazione.EsitoOperazione();
            try
            {
                esito = BusinessLogic.Amministrazione.OrganigrammaManager.AmmModUO(theUO, StoricizzUO);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmModUO - ", e);
                esito.Codice = 1;
                esito.Descrizione = "si  verificato un errore";
            }

            return esito;
        }

        [WebMethod]
        public virtual DocsPaVO.utente.Amministrazione AmmModificaUoTIBCO(string oldCodiceUO, DocsPaVO.amministrazione.OrgUO theUO, out bool result)
        {
            //Andrea - Fatturazione elettronica
            DocsPaVO.utente.Amministrazione retVal = new Amministrazione();

            string fatturazioneElettronicaExternalService = string.Empty;
            //Chiave per abilitare l'utilizzo della fatturazione su DB Schema esterno (PITRE_FATT)
            fatturazioneElettronicaExternalService = System.Configuration.ConfigurationManager.AppSettings["FATTURAZIONE_ELETTRONICA_EXTERNAL_SERVICE"];

            if (!string.IsNullOrEmpty(fatturazioneElettronicaExternalService) && fatturazioneElettronicaExternalService.Equals("1"))
            {
                //La chiave per Fatturazione elettronica  attiva
                string fatturazioneElettronicaWebReferenceUrl = string.Empty;
                //Chiave per identificare URL del servizio di Fatturazione elettronica
                fatturazioneElettronicaWebReferenceUrl = System.Configuration.ConfigurationManager.AppSettings["FATTURAZIONE_ELETTRONICA_WEB_REFERENCE_URL"];
                if (!string.IsNullOrEmpty(fatturazioneElettronicaWebReferenceUrl))
                {
                    try
                    {
                        FatturazioneElettronicaServiceConsumer.FatturazioneElettronicaConsumer consumer = new FatturazioneElettronicaServiceConsumer.FatturazioneElettronicaConsumer(fatturazioneElettronicaWebReferenceUrl);
                        retVal = consumer.ModificaUoSysExternal(oldCodiceUO, theUO, out result);
                        //return consumer.ModificaUoSysExternal(oldCodiceUO, theUO, out result);
                    }
                    catch (Exception e)
                    {
                        //Il costruttore ha rilanciato un'eccezione in quanto la url non  valida
                        logger.DebugFormat("Error costruttore FatturazioneElettronicaConsumer, Message: {0}, StackTrace: {1} ", e.Message, e.StackTrace);
                        result = false;
                        retVal = null;
                        //return null;
                    }
                }
                else
                {
                    result = false;
                    retVal = null;
                    //return null;
                }
            }
            else
                retVal = BusinessLogic.Amministrazione.OrganigrammaManager.AmmModificaUoTIBCO(oldCodiceUO, theUO, out result);
            //return BusinessLogic.Amministrazione.OrganigrammaManager.AmmModificaUoTIBCO(oldCodiceUO, theUO, out result);

            return retVal;
            //End Andrea - Fatturazione elettronica

            //Prima della Modifica Fatturazione per lo schema PITRE_FATT:
            //return BusinessLogic.Amministrazione.OrganigrammaManager.AmmModificaUoTIBCO(oldCodiceUO, theUO, out result);      
        }

        [WebMethod]
        public virtual void inviaNotificaMail(DocsPaVO.amministrazione.OrgUO theUO, DocsPaVO.utente.Amministrazione amm, string descrizioneAOO, string tipoOperazione, string oldCodiceUO)
        {
            BusinessLogic.Amministrazione.OrganigrammaManager.inviaNotificaMail(theUO, amm, descrizioneAOO, tipoOperazione, oldCodiceUO);
        }

        [WebMethod]
        public virtual DocsPaVO.utente.Amministrazione AmmEliminaUoTIBCO(DocsPaVO.amministrazione.OrgUO theUO, out bool result)
        {
            //Andrea - Fatturazione elettronica
            DocsPaVO.utente.Amministrazione retVal = new Amministrazione();

            string fatturazioneElettronicaExternalService = string.Empty;
            //Chiave per abilitare l'utilizzo della fatturazione su DB Schema esterno (PITRE_FATT)
            fatturazioneElettronicaExternalService = System.Configuration.ConfigurationManager.AppSettings["FATTURAZIONE_ELETTRONICA_EXTERNAL_SERVICE"];

            if (!string.IsNullOrEmpty(fatturazioneElettronicaExternalService) && fatturazioneElettronicaExternalService.Equals("1"))
            {
                //La chiave per Fatturazione elettronica  attiva
                string fatturazioneElettronicaWebReferenceUrl = string.Empty;
                //Chiave per identificare URL del servizio di Fatturazione elettronica
                fatturazioneElettronicaWebReferenceUrl = System.Configuration.ConfigurationManager.AppSettings["FATTURAZIONE_ELETTRONICA_WEB_REFERENCE_URL"];
                if (!string.IsNullOrEmpty(fatturazioneElettronicaWebReferenceUrl))
                {
                    try
                    {
                        FatturazioneElettronicaServiceConsumer.FatturazioneElettronicaConsumer consumer = new FatturazioneElettronicaServiceConsumer.FatturazioneElettronicaConsumer(fatturazioneElettronicaWebReferenceUrl);
                        retVal = consumer.EliminaUoSysExternal(theUO, out result);
                        //return consumer.EliminaUoSysExternal(theUO, out result);
                    }
                    catch (Exception e)
                    {
                        //Il costruttore ha rilanciato un'eccezione in quanto la url non  valida
                        logger.DebugFormat("Error costruttore FatturazioneElettronicaConsumer, Message: {0}, StackTrace: {1} ", e.Message, e.StackTrace);
                        result = false;
                        retVal = null;
                        //return null;
                    }
                }
                else
                {
                    result = false;
                    retVal = null;
                    //return null;
                }
            }
            else
                retVal = BusinessLogic.Amministrazione.OrganigrammaManager.AmmEliminaUoTIBCO(theUO, out result);
            //return BusinessLogic.Amministrazione.OrganigrammaManager.AmmEliminaUoTIBCO(theUO, out result);

            return retVal;
            //End Andrea - Fatturazione elettronica.

            //Prima della modifica Fatturazione per lo schema PITRE_FATT:
            //return BusinessLogic.Amministrazione.OrganigrammaManager.AmmEliminaUoTIBCO(theUO, out result);
        }


        [WebMethod]
        public virtual DocsPaVO.amministrazione.EsitoOperazione AmmEliminaUO(DocsPaVO.utente.InfoUtente infoUtente, string idCorrGlob)
        {
            SetUserId(infoUtente);
            DocsPaVO.amministrazione.EsitoOperazione esito = new DocsPaVO.amministrazione.EsitoOperazione();
            try
            {
                esito = BusinessLogic.Amministrazione.OrganigrammaManager.AmmEliminaUO(infoUtente, idCorrGlob);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmEliminaUO - ", e);
                esito.Codice = 1;
                esito.Descrizione = "si  verificato un errore";
            }

            return esito;
        }

        [WebMethod]
        public virtual DocsPaVO.amministrazione.EsitoOperazione AmmInsNuovoRuolo(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.amministrazione.OrgRuolo newRuolo, bool computeAtipicita)
        {
            SetUserId(infoUtente);
            DocsPaVO.amministrazione.EsitoOperazione esito = new DocsPaVO.amministrazione.EsitoOperazione();
            try
            {
                esito = BusinessLogic.Amministrazione.OrganigrammaManager.AmmInsNuovoRuolo(infoUtente, newRuolo, computeAtipicita);
                //if (esito.Codice == 0)
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMNEWROLE", newRuolo.IDCorrGlobale, "Creazione ruolo " + newRuolo.Codice + " - " + newRuolo.Descrizione , DocsPaVO.Logger.CodAzione.Esito.OK, newRuolo.IDAmministrazione);
            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMNEWROLE", newRuolo.IDCorrGlobale, "Creazione ruolo " + newRuolo.Codice, DocsPaVO.Logger.CodAzione.Esito.KO, newRuolo.IDAmministrazione);
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmInsNuovoRuolo - ", e);
                esito.Codice = 1;
                esito.Descrizione = "si  verificato un errore";
            }

            return esito;
        }

        [WebMethod]
        [Obsolete]
        public virtual DocsPaVO.amministrazione.EsitoOperazione AmmModRuolo(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.amministrazione.OrgRuolo ruolo)
        {
            SetUserId(infoUtente);
            DocsPaVO.amministrazione.EsitoOperazione esito = new DocsPaVO.amministrazione.EsitoOperazione();
            try
            {
                esito = BusinessLogic.Amministrazione.OrganigrammaManager.AmmModRuolo(infoUtente, ruolo);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmModRuolo - ", e);
                esito.Codice = 1;
                esito.Descrizione = "si  verificato un errore";
            }
            return esito;
        }

        [WebMethod]
        public virtual DocsPaVO.amministrazione.EsitoOperazione AmmOnlyDisabledRole(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.amministrazione.OrgRuolo ruolo)
        {
            SetUserId(infoUtente);
            DocsPaVO.amministrazione.EsitoOperazione esito = new DocsPaVO.amministrazione.EsitoOperazione();
            try
            {
                esito = BusinessLogic.Amministrazione.OrganigrammaManager.AmmOnlyDisabledRole(infoUtente, ruolo);
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMONLYDISABLEDROLE", ruolo.IDCorrGlobale, "Disabilitazione ruolo " + ruolo.Codice, DocsPaVO.Logger.CodAzione.Esito.OK, ruolo.IDAmministrazione);
            }
            catch (Exception e)
            {
                esito.Codice = 10;
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmOnlyDisabledRole - ", e);
                esito.Descrizione = "si  verificato un errore";
            }
            return esito;
        }


        [WebMethod]
        public virtual DocsPaVO.amministrazione.EsitoOperazione AmmEliminaRuolo(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.amministrazione.OrgRuolo ruolo)
        {
            SetUserId(infoUtente);
            DocsPaVO.amministrazione.EsitoOperazione esito = new DocsPaVO.amministrazione.EsitoOperazione();
            try
            {
                esito = BusinessLogic.Amministrazione.OrganigrammaManager.AmmEliminaRuolo(infoUtente, ruolo);
                //if (esito.Codice == 0)
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMDISABILROLE", ruolo.IDCorrGlobale, "Disabilitazione ruolo " + ruolo.Codice + " - " + ruolo.Descrizione, DocsPaVO.Logger.CodAzione.Esito.OK, ruolo.IDAmministrazione);
            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMDISABILROLE", ruolo.IDCorrGlobale, "Disabilitazione ruolo " + ruolo.Codice, DocsPaVO.Logger.CodAzione.Esito.KO, ruolo.IDAmministrazione);
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmEliminaRuolo - ", e);
                esito.Codice = 1;
                esito.Descrizione = "si  verificato un errore";
            }

            return esito;
        }

        [WebMethod]
        [Obsolete]
        public virtual DocsPaVO.amministrazione.EsitoOperazione AmmSpostaRuolo(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.amministrazione.OrgRuolo ruolo)
        {
            SetUserId(infoUtente);
            DocsPaVO.amministrazione.EsitoOperazione esito = new DocsPaVO.amministrazione.EsitoOperazione();
            try
            {
                esito = BusinessLogic.Amministrazione.OrganigrammaManager.AmmSpostaRuolo(infoUtente, ruolo);
                //if (esito.Codice == 0)
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMSPOSTAROLE", ruolo.IDCorrGlobale, "Spostamento ruolo " + ruolo.Codice + " - " + ruolo.Descrizione, DocsPaVO.Logger.CodAzione.Esito.OK, ruolo.IDAmministrazione);
            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMSPOSTAROLE", ruolo.IDCorrGlobale, "Spostamento ruolo " + ruolo.Codice, DocsPaVO.Logger.CodAzione.Esito.KO, ruolo.IDAmministrazione);
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmSpostaRuolo - ", e);
                esito.Codice = 1;
                esito.Descrizione = "si  verificato un errore";
            }

            return esito;
        }

        [WebMethod]
        public virtual DocsPaVO.amministrazione.EsitoOperazione AmmSpostaUO(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.amministrazione.OrgUO uoDaSpostare, DocsPaVO.amministrazione.OrgUO uoPadre)
        {
            SetUserId(infoUtente);
            DocsPaVO.amministrazione.EsitoOperazione esito = new DocsPaVO.amministrazione.EsitoOperazione();
            try
            {
                esito = BusinessLogic.Amministrazione.OrganigrammaManager.AmmSpostaUO(uoDaSpostare, uoPadre);
                //if(esito.Codice == 0)
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMSPOSTAUO", uoDaSpostare.IDCorrGlobale, "Spostamento UO " + uoDaSpostare.Codice + " sotto " + uoPadre.Codice, DocsPaVO.Logger.CodAzione.Esito.OK, uoDaSpostare.IDAmministrazione);
            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMSPOSTAUO", uoDaSpostare.IDCorrGlobale, "Spostamento UO " + uoDaSpostare.Codice + " sotto " + uoPadre.Codice, DocsPaVO.Logger.CodAzione.Esito.KO, uoDaSpostare.IDAmministrazione);
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmSpostaUO - ", e);
                esito.Codice = 1;
                esito.Descrizione = "si  verificato un errore";
            }

            return esito;
        }

        [WebMethod]
        public virtual DocsPaVO.amministrazione.EsitoOperazione AmmOrdinamento(string idCorrGlobDaSpostare, string idPesoDaSpostare, string idCorrGlobSubisce, string idPesoSubisce)
        {
            DocsPaVO.amministrazione.EsitoOperazione esito = new DocsPaVO.amministrazione.EsitoOperazione();
            try
            {
                esito = BusinessLogic.Amministrazione.OrganigrammaManager.AmmOrdinamento(idCorrGlobDaSpostare, idPesoDaSpostare, idCorrGlobSubisce, idPesoSubisce);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmOrdinamento - ", e);
                esito.Codice = 1;
                esito.Descrizione = "impossibile eseguire il nuovo ordinamento";
            }

            return esito;
        }
        #endregion

        [WebMethod]
        public virtual DocsPaVO.amministrazione.EsitoOperazione AmmInsUtente(DocsPaVO.utente.InfoUtente infoUtente, string idAmm, DocsPaVO.amministrazione.OrgUtente utente)
        {
            SetUserId(infoUtente);
            DocsPaVO.amministrazione.EsitoOperazione esito = new DocsPaVO.amministrazione.EsitoOperazione();
            try
            {
                esito = BusinessLogic.Amministrazione.OrganigrammaManager.AmmInsNuovoUtente(infoUtente, utente);
                //if(esito.Codice == 0)
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMNEWUSER", utente.IDPeople, "Creazione utente " + utente.Codice + " - " + utente.Nome + " " + utente.Cognome, DocsPaVO.Logger.CodAzione.Esito.OK, idAmm);
            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMNEWUSER", utente.IDPeople, "Creazione utente " + utente.Codice + " - " + utente.Nome + " " + utente.Cognome, DocsPaVO.Logger.CodAzione.Esito.KO, idAmm);
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmInsUtente - ", e);
                esito.Codice = 1;
                esito.Descrizione = "si  verificato un errore";
            }

            return esito;
        }

        [WebMethod]
        public virtual DocsPaVO.amministrazione.EsitoOperazione AmmModUtente(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.amministrazione.OrgUtente utente)
        {
            SetUserId(infoUtente);
            DocsPaVO.amministrazione.EsitoOperazione esito = new DocsPaVO.amministrazione.EsitoOperazione();
            try
            {
                esito = BusinessLogic.Amministrazione.OrganigrammaManager.AmmModUtente(infoUtente, utente);

                // Se l'esito  positivo
                if (esito.Codice == 0)
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente,
                        "MODUSER", utente.IDCorrGlobale,
                        string.Format("Profilo dell'utente {0} modificato dall'amministratore {1}",
                            utente.UserId, infoUtente.userId),
                            DocsPaVO.Logger.CodAzione.Esito.OK);
                if (esito.Codice == 4)
                {
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente,
                        "MODUSER", utente.IDCorrGlobale,
                        string.Format("Password dell'utente {0} modificata dall'amministratore {1}",
                            utente.UserId, infoUtente.userId),
                            DocsPaVO.Logger.CodAzione.Esito.OK);
                    esito.Codice = 0;
                }
                if (esito.Codice == 5)
                {
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente,
                        "MODUSER", utente.IDCorrGlobale,
                        string.Format("Impostazione smart client dell'utente {0} modificata dall'amministratore {1}",
                            utente.UserId, infoUtente.userId),
                            DocsPaVO.Logger.CodAzione.Esito.OK);
                    esito.Codice = 0;
                }
                if (esito.Codice == 6)
                {
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente,
                        "MODUSER", utente.IDCorrGlobale,
                        string.Format("Impostazione smart client e password dell'utente {0} modificate dall'amministratore {1}",
                            utente.UserId, infoUtente.userId),
                            DocsPaVO.Logger.CodAzione.Esito.OK);
                    esito.Codice = 0;
                }
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmModUtente - ", e);
                esito.Codice = 1;
                esito.Descrizione = "si  verificato un errore";
            }

            return esito;
        }

        [WebMethod]
        public virtual DocsPaVO.amministrazione.EsitoOperazione AmmInsRegistri(DocsPaVO.amministrazione.OrgRegistro[] listaRegistri, string idUO, string idCorrGlobRuolo)
        {
            DocsPaVO.amministrazione.EsitoOperazione esito = new DocsPaVO.amministrazione.EsitoOperazione();
            try
            {
                esito = BusinessLogic.Amministrazione.OrganigrammaManager.AmmInsRegistri(listaRegistri, idUO, idCorrGlobRuolo);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmInsRegistri - ", e);
                esito.Codice = 1;
                esito.Descrizione = "si  verificato un errore";
            }

            return esito;
        }

        [WebMethod]
        public virtual DocsPaVO.amministrazione.EsitoOperazione AmmInsTipoFunzioni(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.amministrazione.OrgTipoFunzione[] listaFunzioni)
        {
            SetUserId(infoUtente);
            DocsPaVO.amministrazione.EsitoOperazione esito = new DocsPaVO.amministrazione.EsitoOperazione();

            ArrayList listaFunzioniAttuali = new ArrayList();

            try
            {
                listaFunzioniAttuali = BusinessLogic.Amministrazione.OrganigrammaManager.GetListFunzioni(listaFunzioni[0].IDAmministrazione, listaFunzioni[0].Associato);
            }
            catch (Exception e)
            {
                // Errore nel reperimento delle funzioni attuali. The show must go on.
                logger.Warn("Errore nel reperimento funzioni ruolo attuali.", e);
            }

            try
            {
                // aggiornamento funzioni associate
                esito = BusinessLogic.Amministrazione.OrganigrammaManager.AmmInsTipoFunzioni(listaFunzioni);

                // scrittura log eventi in base alla modifica delle funzioni rispetto alle precedenti
                // funzioni attivate
                foreach (OrgTipoFunzione funzione in listaFunzioni)
                {
                    bool exists = false;
                    foreach (OrgTipoFunzione funzioneAttuale in listaFunzioniAttuali)
                    {
                        if (!String.IsNullOrEmpty(funzioneAttuale.Associato) && funzioneAttuale.Codice.Equals(funzione.Codice))
                        {
                            exists = true;
                            break;
                        }
                    }

                    if (!exists)
                        BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMASSFUNZRUOLO", funzione.Associato, "Associazione funzione a ruolo " + funzione.Codice, DocsPaVO.Logger.CodAzione.Esito.OK, funzione.IDAmministrazione);
                }

                // funzioni disattivate
                foreach (OrgTipoFunzione funzioneAttuale in listaFunzioniAttuali)
                {
                    bool removed = true;
                    foreach (OrgTipoFunzione funzione in listaFunzioni)
                    {
                        if (String.IsNullOrEmpty(funzioneAttuale.Associato) || funzioneAttuale.Codice.Equals(funzione.Codice))
                        {
                            removed = false;
                            break;
                        }
                    }

                    if (removed)
                        BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMDISASSFUNZRUOLO", funzioneAttuale.Associato, "Disassociazione funzione a ruolo " + funzioneAttuale.Codice, DocsPaVO.Logger.CodAzione.Esito.OK, listaFunzioni[0].IDAmministrazione);
                }

                //if (esito.Codice == 0)
                //{
                // BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMASSFUNZRUOLO", listaFunzioni[0].Associato, "Associazione funzioni a ruolo " + listaFunzioni[0].Codice, DocsPaVO.Logger.CodAzione.Esito.OK, listaFunzioni[0].IDAmministrazione);
                // BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMDISASSFUNZRUOLO", listaFunzioni[0].Associato, "Disassociazione funzioni a ruolo " + listaFunzioni[0].Codice, DocsPaVO.Logger.CodAzione.Esito.OK, listaFunzioni[0].IDAmministrazione);
                //}
            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMASSFUNZRUOLO", listaFunzioni[0].Associato, "Associazione funzioni a ruolo", DocsPaVO.Logger.CodAzione.Esito.KO, listaFunzioni[0].IDAmministrazione);
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMDISASSFUNZRUOLO", listaFunzioni[0].Associato, "Disassociazione funzioni a ruolo", DocsPaVO.Logger.CodAzione.Esito.KO, listaFunzioni[0].IDAmministrazione);
                logger.Error("Errore in DocsPaWS.asmx  - metodo: AmmInsTipoFunzioni - ", e);
                esito.Codice = 1;
                esito.Descrizione = "si  verificato un errore";
            }

            return esito;
        }

        [WebMethod]
        public virtual DocsPaVO.amministrazione.EsitoOperazione AmmInsUtenteInRuolo(DocsPaVO.utente.InfoUtente infoUtente, string idPeople, string idGruppo, string idAmm, string type)
        {
            SetUserId(infoUtente);
            DocsPaVO.amministrazione.EsitoOperazione esito = new DocsPaVO.amministrazione.EsitoOperazione();
            try
            {
                esito = BusinessLogic.Amministrazione.OrganigrammaManager.AmmInsUtenteInRuolo(infoUtente, idPeople, idGruppo);
                //if (esito.Codice == 0)
                //{
                DocsPaVO.utente.Utente utente = BusinessLogic.Utenti.UserManager.getUtenteById(idPeople);
                DocsPaVO.utente.Ruolo ruolo = BusinessLogic.Utenti.UserManager.getRuoloByIdGruppo(idGruppo);
                string codiceAmm = BusinessLogic.Amministrazione.AmministraManager.GetCodAmmById(idAmm);

                if (type.Equals("newUser"))
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMASSRUOLOUSER", idPeople, "Associazione ruolo " + ruolo.codice + "(" + ruolo.descrizione + ") utente " + utente.userId + "(" + utente.descrizione + ")" , DocsPaVO.Logger.CodAzione.Esito.OK, idAmm);
                else
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMSPOSTAUSER", idPeople, "Spostamento utente " + utente.userId + " - " + utente.descrizione , DocsPaVO.Logger.CodAzione.Esito.OK, idAmm);
                //}
            }
            catch (Exception e)
            {
                if (type.Equals("newUser"))
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMASSRUOLOUSER", idPeople, "Associazione ruolo " + idGruppo + " utente " + idPeople, DocsPaVO.Logger.CodAzione.Esito.KO, idAmm);
                else
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMSPOSTAUSER", idPeople, "Spostamento utente " + idPeople, DocsPaVO.Logger.CodAzione.Esito.KO, idAmm);
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmInsUtenteInRuolo - ", e);
                esito.Codice = 1;
                esito.Descrizione = "si  verificato un errore";
            }

            return esito;
        }

        [WebMethod]
        public virtual DocsPaVO.amministrazione.EsitoOperazione AmmInsTrasmUtente(string idPeople, string idCorrGlobRuolo)
        {
            DocsPaVO.amministrazione.EsitoOperazione esito = new DocsPaVO.amministrazione.EsitoOperazione();
            try
            {
                esito = BusinessLogic.Amministrazione.OrganigrammaManager.AmmInsTrasmUtente(idPeople, idCorrGlobRuolo);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmInsTrasmUtente - ", e);
                esito.Codice = 1;
                esito.Descrizione = "si  verificato un errore";
            }

            return esito;
        }

        [WebMethod]
        public virtual DocsPaVO.amministrazione.EsitoOperazione AmmVerificaEliminazioneUtente(DocsPaVO.amministrazione.OrgUtente utente)
        {
            SetUserId(utente);
            DocsPaVO.amministrazione.EsitoOperazione esito = new DocsPaVO.amministrazione.EsitoOperazione();
            try
            {
                esito = BusinessLogic.Amministrazione.OrganigrammaManager.AmmVerificaEliminazioneUtente(utente);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmVerificaEliminazioneUtente - ", e);
                esito.Codice = 1;
                esito.Descrizione = "si  verificato un errore";
            }

            return esito;
        }

        [WebMethod]
        public virtual DocsPaVO.amministrazione.EsitoOperazione AmmEliminaUtente(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.amministrazione.OrgUtente utente)
        {
            SetUserId(infoUtente);
            DocsPaVO.amministrazione.EsitoOperazione esito = new DocsPaVO.amministrazione.EsitoOperazione();
            try
            {
                esito = BusinessLogic.Amministrazione.OrganigrammaManager.AmmEliminaUtente(infoUtente, utente);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmEliminaUtente - ", e);
                esito.Codice = 1;
                esito.Descrizione = "si  verificato un errore";
            }

            return esito;
        }

        [WebMethod]
        public virtual DocsPaVO.amministrazione.EsitoOperazione AmmEliminaUtenteInRuolo(DocsPaVO.utente.InfoUtente infoUtente, string idPeople, string idGruppo, string idAmm)
        {
            SetUserId(infoUtente);
            DocsPaVO.amministrazione.EsitoOperazione esito = new DocsPaVO.amministrazione.EsitoOperazione();
            try
            {
                DocsPaVO.utente.Ruolo ruolo = BusinessLogic.Utenti.UserManager.getRuoloByIdGruppo(idGruppo);
                esito = BusinessLogic.Amministrazione.OrganigrammaManager.AmmEliminaUtenteInRuolo(infoUtente, idPeople, idGruppo);
                DocsPaVO.utente.Utente utente = BusinessLogic.Utenti.UserManager.getUtenteById(idPeople);
                string codiceAmm = BusinessLogic.Amministrazione.AmministraManager.GetCodAmmById(idAmm);
                //if (esito.Codice == 0)
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMDISASSRUOLOUSER", idPeople, "Disassociazione ruolo " + ruolo.codiceRubrica + "(" + ruolo.descrizione + ")" + " utente " + utente.userId + "(" + utente.descrizione + ")", DocsPaVO.Logger.CodAzione.Esito.OK, idAmm);
            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMDISASSRUOLOUSER", idPeople, "Disassociazione ruolo " + idGruppo + " utente " + idPeople, DocsPaVO.Logger.CodAzione.Esito.KO, idAmm);
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmEliminaUtenteInRuolo - ", e);
                esito.Codice = 1;
                esito.Descrizione = "si  verificato un errore";
            }

            return esito;
        }

        //[WebMethod]
        //public virtual string AmmAvvisoUtenteUnicoConNotifica(DocsPaVO.utente.InfoUtente infoUtente, string idPeople, string idGruppo, string idAmm)
        //{
        //    SetUserId(infoUtente);
        //    string retValue = string.Empty;
        //    try
        //    {
        //        retValue = BusinessLogic.Amministrazione.OrganigrammaManager.AmmUtenteUnicoInNotificheTrasm(idPeople, idGruppo);
        //    }
        //    catch (Exception e)
        //    {
        //        logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmAvvisoUtenteUnicoConNotifica - ", e);
        //    }

        //    return retValue;
        //}

        [WebMethod]
        public virtual DocsPaVO.amministrazione.EsitoOperazione AmmEliminaADLUtente(string idPeople, string idCorrGlobGruppo)
        {
            DocsPaVO.amministrazione.EsitoOperazione esito = new DocsPaVO.amministrazione.EsitoOperazione();
            try
            {
                esito = BusinessLogic.Amministrazione.OrganigrammaManager.AmmEliminaADLUtente(idPeople, idCorrGlobGruppo);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmEliminaADLUtente - ", e);
                esito.Codice = 1;
                esito.Descrizione = "si  verificato un errore";
            }

            return esito;
        }

        [WebMethod]
        public virtual DocsPaVO.amministrazione.EsitoOperazione AmmVerificaUtenteLoggato(string userId, string idAmm)
        {
            SetUserId(userId);
            DocsPaVO.amministrazione.EsitoOperazione esito = new DocsPaVO.amministrazione.EsitoOperazione();
            try
            {
                esito = BusinessLogic.Amministrazione.OrganigrammaManager.AmmVerificaUtenteLoggato(userId, idAmm);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmVerificaUtenteLoggato - ", e);
                esito.Codice = 1;
                esito.Descrizione = "si  verificato un errore";
            }

            return esito;
        }

        [WebMethod]
        public virtual DocsPaVO.amministrazione.EsitoOperazione AmmVerificaTrasmRuolo(string idCorrGlobRuolo)
        {
            DocsPaVO.amministrazione.EsitoOperazione esito = new DocsPaVO.amministrazione.EsitoOperazione();
            try
            {
                esito = BusinessLogic.Amministrazione.OrganigrammaManager.AmmVerificaTrasmRuolo(idCorrGlobRuolo);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmVerificaTrasmRuolo - ", e);
            }

            return esito;
        }

        [WebMethod]
        public virtual DocsPaVO.amministrazione.EsitoOperazione AmmRifiutaTrasmConWF(string idCorrGlobRuolo, string idGruppo)
        {
            DocsPaVO.amministrazione.EsitoOperazione esito = new DocsPaVO.amministrazione.EsitoOperazione();
            try
            {
                esito = BusinessLogic.Amministrazione.OrganigrammaManager.AmmRifiutaTrasmConWF(idCorrGlobRuolo, idGruppo);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmRifiutaTrasmConWF - ", e);
                esito.Codice = 1;
                esito.Descrizione = "si  verificato un errore";
            }

            return esito;
        }

        [WebMethod]
        public DocsPaVO.amministrazione.EsitoOperazione AmmAccettaTrasmConWFRuolo(string idCorrGlobRuolo)
        {
            DocsPaVO.amministrazione.EsitoOperazione esito = new DocsPaVO.amministrazione.EsitoOperazione();
            try
            {
                esito = BusinessLogic.Amministrazione.OrganigrammaManager.AmmAccettaTrasmConWFRuolo(idCorrGlobRuolo);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmAccettaTrasmConWFRuolo - ", e);
                esito.Codice = 1;
                esito.Descrizione = "si  verificato un errore";
            }

            return esito;
        }

        [WebMethod]
        public virtual DocsPaVO.amministrazione.EsitoOperazione AmmSostituzioneUtente(string idPeopleNewUT, string idCorrGlobRuolo)
        {
            DocsPaVO.amministrazione.EsitoOperazione esito = new DocsPaVO.amministrazione.EsitoOperazione();
            try
            {
                esito = BusinessLogic.Amministrazione.OrganigrammaManager.AmmSostituzioneUtente(idPeopleNewUT, idCorrGlobRuolo);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmSostituzioneUtente - ", e);
                esito.Codice = 1;
                esito.Descrizione = "si  verificato un errore";
            }

            return esito;
        }

        [WebMethod]
        public virtual DocsPaVO.amministrazione.EsitoOperazione AmmDisabilitaUtente(DocsPaVO.utente.InfoUtente infoUtente, string idPeople, string idAmm)
        {
            SetUserId(infoUtente);
            DocsPaVO.amministrazione.EsitoOperazione esito = new DocsPaVO.amministrazione.EsitoOperazione();
            try
            {
                esito = BusinessLogic.Amministrazione.OrganigrammaManager.AmmDisabilitaUtente(infoUtente, idPeople);
                DocsPaVO.utente.Utente utente = BusinessLogic.Utenti.UserManager.getUtenteById(idPeople);
                string codiceAmm = BusinessLogic.Amministrazione.AmministraManager.GetCodAmmById(idAmm);
                //if (esito.Codice == 0)
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMDISABILUSER", idPeople, "Disabilitazione utente " + utente.userId + " - " + utente.descrizione, DocsPaVO.Logger.CodAzione.Esito.OK, idAmm);
            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMDISABILUSER", idPeople, "Disabilitazione utente " + idPeople, DocsPaVO.Logger.CodAzione.Esito.KO, idAmm);
                logger.Error("Errore in DocsPaWS.asmx  - metodo: AmmDisabilitaUtente - ", e);
                esito.Codice = 1;
                esito.Descrizione = "si  verificato un errore";
            }

            return esito;
        }

        [WebMethod]
        public virtual DocsPaVO.amministrazione.EsitoOperazione AmmAbilitaUtente(DocsPaVO.utente.InfoUtente infoUtente, string idPeople, string idAmm)
        {
            SetUserId(infoUtente);
            DocsPaVO.amministrazione.EsitoOperazione esito = new DocsPaVO.amministrazione.EsitoOperazione();
            try
            {
                DocsPaVO.utente.Utente utente = BusinessLogic.Utenti.UserManager.getUtenteById(idPeople);
                string codiceAmm = BusinessLogic.Amministrazione.AmministraManager.GetCodAmmById(idAmm);

                esito = BusinessLogic.Amministrazione.OrganigrammaManager.AmmAbilitaUtente(infoUtente, idPeople);
                if (esito.Codice == 9)
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMABILUSER", idPeople, "Abilitazione utente "+ utente.userId + " - " + utente.descrizione, DocsPaVO.Logger.CodAzione.Esito.OK, idAmm);
            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMABILUSER", idPeople, "Abilitazione utente " + idPeople, DocsPaVO.Logger.CodAzione.Esito.KO, idAmm);
                logger.Error("Errore in DocsPaWS.asmx  - metodo: AmmAbilitaUtente - ", e);
                esito.Codice = 1;
                esito.Descrizione = "si  verificato un errore";
            }

            return esito;
        }

        [WebMethod]
        public virtual DocsPaVO.amministrazione.EsitoOperazione AmmEstendeVisibRuolo(DocsPaVO.utente.InfoUtente infoUtente, string idRegistro, string idCorrGlobRuolo, string idGruppo, string idCorrGlobUO, string idAmm, string livelloRuolo, bool escludiAtipicita)
        {
            SetUserId(infoUtente);
            DocsPaVO.amministrazione.EsitoOperazione esito = new DocsPaVO.amministrazione.EsitoOperazione();
            try
            {
                esito = BusinessLogic.Amministrazione.OrganigrammaManager.AmmEstendeVisibRuolo(infoUtente, idRegistro, idCorrGlobRuolo, idGruppo, idCorrGlobUO, idAmm, livelloRuolo, escludiAtipicita);
                //if (esito.Codice == 3 || esito.Codice == 0)
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMVISRUOLO", idCorrGlobRuolo, "Imposta visibilita al ruolo " + idGruppo, DocsPaVO.Logger.CodAzione.Esito.OK, idAmm);
            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMVISRUOLO", idCorrGlobRuolo, "Imposta visibilita al ruolo " + idGruppo, DocsPaVO.Logger.CodAzione.Esito.KO, idAmm);
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmEstendeVisibRuolo - ", e);
                esito.Codice = 1;
                esito.Descrizione = "si  verificato un errore";
            }

            return esito;
        }

        [WebMethod]
        public virtual string GetLivelloTipoRuolo(string idCorrGlobRuolo)
        {
            string retValue = string.Empty;
            try
            {
                retValue = BusinessLogic.Amministrazione.OrganigrammaManager.GetLivelloTipoRuolo(idCorrGlobRuolo);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetLivelloTipoRuolo - ", e);
            }

            return retValue;
        }

        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.amministrazione.OrgRisultatoRicerca))]
        public virtual ArrayList AmmRicercaInOrg(string tipo, string codice, string descrizione, string idAmm, bool searchHistoricized, bool searchByCodeExact)
        {
            ArrayList retValue = new ArrayList();

            try
            {
                retValue = BusinessLogic.Amministrazione.OrganigrammaManager.AmmRicercaInOrg(tipo, codice, descrizione, idAmm, searchHistoricized, searchByCodeExact);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmRicercaInOrg - ", e);
            }

            return retValue;
        }

        [WebMethod]
        [return: XmlArray()]
        //[return:XmlArrayItem(typeof(int))]
        public virtual ArrayList AmmListaIDParentRicerca(string IDPartenza, string tipo)
        {
            ArrayList retValue = new ArrayList();

            try
            {
                retValue = BusinessLogic.Amministrazione.OrganigrammaManager.AmmListaIDParentRicerca(IDPartenza, tipo);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmListaIDParentRicerca - ", e);
            }

            return retValue;
        }

        #region varie
        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual DocsPaVO.amministrazione.Configurazione amministrazioneGetParametroConfigurazione()
        {
            return null;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.utente.Amministrazione))]
        public virtual ArrayList amministrazioneGetAmministrazioni(out string returnMsg)
        {
            returnMsg = string.Empty;

            try
            {
                return BusinessLogic.Amministrazione.AmministraManager.GetAmministrazioni();
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: amministrazioneGetAmministrazioni", e);
                returnMsg = e.ToString();
            }

            return null;
        }


        /// <summary>
        /// </summary>
        /// MEV utente Multi-Amministrazione
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.utente.Amministrazione))]
        public virtual ArrayList amministrazioneGetAmministrazioniByUser(string userId, bool controllo, out string returnMsg)
        {
            returnMsg = string.Empty;

            try
            {
                return BusinessLogic.Amministrazione.AmministraManager.GetAmministrazioniByUser(userId, controllo);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: amministrazioneGetAmministrazioniByUser", e);
                returnMsg = e.ToString();
            }

            return null;
        }

        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.utente.Amministrazione))]
        public virtual ArrayList GetDatiAmministrazioneByUserAdministrator(string userId, bool controllo, out string returnMsg)
        {
            returnMsg = string.Empty;

            try
            {
                return BusinessLogic.Amministrazione.AmministraManager.GetDatiAmministrazioneByUserAdministrator(userId, controllo);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetDatiAmministrazioneByUserAdministrator", e);
                returnMsg = e.ToString();
            }

            return null;
        }

        /// <summary>
        /// </summary>
        /// MEV utente Multi-Amministrazione
        [WebMethod]
        public virtual string GetPasswordUtenteMultiAmm(string userId)
        {
            string password = string.Empty;

            try
            {
                return BusinessLogic.Amministrazione.AmministraManager.GetPasswordUtenteMultiAmm(userId);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetPasswordUtenteMultiAmm", e);
            }

            return password;
        }

        /// <summary>
        /// </summary>
        /// MEV utente Multi-Amministrazione
        [WebMethod]
        public virtual bool SetPasswordUtenteMultiAmm(string userId, string password)
        {
            bool resultValue = false;

            try
            {
                return BusinessLogic.Amministrazione.AmministraManager.SetPasswordUtenteMultiAmm(userId, password);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: SetPasswordUtenteMultiAmm", e);
            }

            return resultValue;
        }

        /// <summary>
        /// </summary>
        /// MEV utente Multi-Amministrazione
        [WebMethod]
        public virtual bool ModificaPasswordUtenteMultiAmm(string userId, string idAmm)
        {
            bool resultValue = false;

            try
            {
                return BusinessLogic.Amministrazione.AmministraManager.ModificaPasswordUtenteMultiAmm(userId, idAmm);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ModificaPasswordUtenteMultiAmm", e);
            }

            return resultValue;
        }

        #endregion

        #region Gestione Titolario


        /// <summary>
        /// Reperimento di tutti i ruoli che hanno, tramite il registro,
        /// la visibilit su un nodo di titolario.
        /// Se non viene fornito l'idRegistro, verranno ricercati i 
        /// ruoli in base a tutti i registri presenti nell'amministrazione richiesta.
        /// </summary>
        /// <param name="idAmministrazione"></param>
        /// <param name="idNodoTitolario"></param>
        /// <param name="idRegistro"></param>
        /// <returns></returns>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.amministrazione.OrgRuoloTitolario))]
        public System.Collections.ArrayList AmmGetRuoliInTitolario(string idNodoTitolario, string idRegistro, string codiceRicerca, string tipoRicerca)
        {
            ArrayList retValue = null;

            try
            {
                retValue = BusinessLogic.Amministrazione.TitolarioManager.GetRuoliInTitolario(idNodoTitolario, idRegistro, codiceRicerca, tipoRicerca);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmGetRuoliInTitolario", e);
            }

            return retValue;
        }

        /// <summary>
        /// Aggiornamento di un nodo di titolario esistente.
        ///
        /// L'operazione andr a buon fine solo se sono rispettati i seguenti vincoli:
        /// -  possibile modificare l'associazione che il nodo ha con un solo registro
        ///   a quella "Tutti i registri", non il contrario;
        /// - non  possibile associare la visibilit ad un ruolo se, su di esso,
        ///   non ha la visibilit il nodo di titolario padre (se presente);
        /// - la visibilit ad un ruolo pu essere rimossa solamente se non esistono
        ///   fascicoli procedimentali visibili ad esso;
        /// - non  possibile modificare il codice di un nodo esistente;
        /// -  possibile modificare la descrizione del nodo solo se:
        ///		1) non ha documenti
        ///		2) non ha fascicoli procedimentali
        /// </summary>
        /// <param name="nodoTitolario"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual DocsPaVO.amministrazione.EsitoOperazione AmmUpdateTitolario(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.amministrazione.OrgNodoTitolario nodoTitolario)
        {
            SetUserId(infoUtente);
            DocsPaVO.amministrazione.EsitoOperazione retValue = null;

            try
            {
                retValue = BusinessLogic.Amministrazione.TitolarioManager.UpdateNodoTitolario(infoUtente, nodoTitolario);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmUpdateTitolario", e);
                retValue.Codice = 1;
                retValue.Descrizione = "si  verificato un errore";
            }

            return retValue;
        }

        /// <summary>
        /// Accesso ai dati per l'associazione di uno o pi ruoli
        /// ad un nodo di titolario. Se la propriet "Associato"
        /// dell'oggetto "OrgRuoloTitolario"  true, viene 
        /// fatto un inserimento in security, altrimenti una cancellazione.
        /// </summary>
        /// <param name="idTitolario"></param>
        /// <param name="ruoloTitolario"></param>
        /// <returns>Numero di record modificati</returns>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.amministrazione.EsitoOperazione))]
        public virtual DocsPaVO.amministrazione.EsitoOperazione[] AmmUpdateRuoliTitolario(
            DocsPaVO.utente.InfoUtente infoUtente,
            string idTitolario,
            DocsPaVO.amministrazione.OrgRuoloTitolario[] ruoliTitolario,
            DocsPaVO.amministrazione.OrgRuoloTitolario[] ruoliTitolarioDisattiva,
            string idAmm,
            bool allTitolario,
            string idRegistro)
        {
            SetUserId(infoUtente);
            DocsPaVO.amministrazione.EsitoOperazione[] retValue = null;

            try
            {
                retValue = BusinessLogic.Amministrazione.TitolarioManager.UpdateRuoliTitolario(infoUtente, idTitolario, ruoliTitolario, ruoliTitolarioDisattiva, allTitolario, idAmm, idRegistro);
                if (retValue != null)
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMVISNODO", idTitolario, "Imposta visibilita nodoTitolario " + idTitolario, DocsPaVO.Logger.CodAzione.Esito.OK, idAmm);
            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMVISNODO", idTitolario, "Imposta visibilita nodoTitolario " + idTitolario, DocsPaVO.Logger.CodAzione.Esito.KO, idAmm);
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmUpdateRuoliTitolario", e);
            }

            return retValue;
        }

        /// <summary>
        /// Verifica se un nodo di titolario pu essere aggiornato in base ai seguenti vincoli:
        /// 
        /// -  possibile modificare l'associazione che il nodo ha con un solo registro
        ///   a quella "Tutti i registri", non il contrario;
        /// - non  possibile modificare il codice di un nodo esistente;
        /// -  possibile modificare la descrizione del nodo solo se:
        ///		1) non ha documenti
        ///		2) non ha fascicoli procedimentali
        ///		
        /// </summary>
        /// <param name="nodoTitolario"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual DocsPaVO.amministrazione.EsitoOperazione AmmCanUpdateTitolario(DocsPaVO.amministrazione.OrgNodoTitolario nodoTitolario)
        {
            DocsPaVO.amministrazione.EsitoOperazione retValue = null;

            try
            {
                retValue = BusinessLogic.Amministrazione.TitolarioManager.CanUpdateTitolario(nodoTitolario);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmCanUpdateTitolario", e);
                retValue.Codice = 1;
                retValue.Descrizione = "si  verificato un errore";
            }

            return retValue;
        }

        /// <summary>
        /// Verifica se un nodo di titolario pu essere inserito
        /// </summary>
        /// <param name="nodoTitolario"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual DocsPaVO.amministrazione.EsitoOperazione AmmCanInsertTitolario(DocsPaVO.amministrazione.OrgNodoTitolario nodoTitolario)
        {
            DocsPaVO.amministrazione.EsitoOperazione retValue = null;

            try
            {
                retValue = BusinessLogic.Amministrazione.TitolarioManager.CanInsertTitolario(nodoTitolario);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: CanInsertTitolario", e);
                retValue.Codice = 1;
                retValue.Descrizione = "si  verificato un errore";
            }

            return retValue;
        }

        /// <summary>
        /// Verifica se uno o pi ruoli possono essere associati ad un titolario
        /// in base ai seguenti vincoli:
        ///
        /// - non  possibile associare la visibilit ad un ruolo se, su di esso,
        ///   non ha la visibilit il nodo di titolario padre (se presente);
        /// - la visibilit ad un ruolo pu essere rimossa solamente se non esistono
        ///   fascicoli procedimentali visibili ad esso;
        ///   
        /// </summary>
        /// <param name="ruoliTitolario"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual DocsPaVO.amministrazione.EsitoOperazione AmmCanUpdateRuoloTitolario(
            string idTitolario,
            DocsPaVO.amministrazione.OrgRuoloTitolario ruoloTitolario)
        {
            DocsPaVO.amministrazione.EsitoOperazione retValue = null;

            try
            {
                retValue = BusinessLogic.Amministrazione.TitolarioManager.CanUpdateRuoloTitolario(idTitolario, ruoloTitolario);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmCanUpdateRuoliTitolario", e);
                retValue.Codice = 1;
                retValue.Descrizione = "si  verificato un errore";
            }

            return retValue;
        }

        /// <summary>
        /// Verifica dei vincoli per la cancellazione di un nodo di titolario,
        /// che pu essere rimosso solamente se:
        /// 
        /// - non ha nodi titolario figli
        /// - non ha documenti
        /// - non ha fascicoli procedimentali
        /// </summary>
        /// </summary>
        /// <param name="nodoTitolario"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual DocsPaVO.amministrazione.EsitoOperazione AmmCanDeleteTitolario(DocsPaVO.amministrazione.OrgNodoTitolario nodoTitolario)
        {
            DocsPaVO.amministrazione.EsitoOperazione retValue = null;

            try
            {
                retValue = BusinessLogic.Amministrazione.TitolarioManager.CanDeleteTitolario(nodoTitolario);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmCanDeleteTitolario", e);
                retValue.Codice = 1;
                retValue.Descrizione = "si  verificato un errore";
            }

            return retValue;
        }

        /// <summary>
        /// Rimozione di un nodo di titolario
        /// </summary>
        /// <param name="nodoTitolario"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual DocsPaVO.amministrazione.EsitoOperazione AmmDeleteTitolario(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.amministrazione.OrgNodoTitolario nodoTitolario)
        {
            DocsPaVO.amministrazione.EsitoOperazione retValue = null;
            SetUserId(infoUtente);
            try
            {
                retValue = BusinessLogic.Amministrazione.TitolarioManager.DeleteNodoTitolario(infoUtente, nodoTitolario);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmDeleteTitolario", e);
                retValue.Codice = -1;
                retValue.Descrizione = "si  verificato un errore";
            }

            return retValue;
        }


        /// <summary>
        /// Inserimento di un nuovo nodo di titolario.
        /// Per default, vengono ereditati il registro associato
        /// e la visibilit dei ruoli del nodo padre (se presente).
        /// </summary>
        /// <param name="nodoTitolario"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual DocsPaVO.amministrazione.EsitoOperazione AmmInsertTitolario(DocsPaVO.utente.InfoUtente infoUtente, ref DocsPaVO.amministrazione.OrgNodoTitolario nodoTitolario, string idAmm)
        {
            DocsPaVO.amministrazione.EsitoOperazione retValue = null;
            SetUserId(infoUtente);
            try
            {
                retValue = BusinessLogic.Amministrazione.TitolarioManager.InsertNodoTitolario(infoUtente, ref nodoTitolario);
                if (retValue.Codice != -1)
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMNEWNODO", nodoTitolario.ID, "Creazione nodo titolario " + nodoTitolario.Codice, DocsPaVO.Logger.CodAzione.Esito.OK, idAmm);
            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMNEWNODO", nodoTitolario.ID, "Creazione nodo titolario " + nodoTitolario.Codice, DocsPaVO.Logger.CodAzione.Esito.KO, idAmm);
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmInsertTitolario", e);
                retValue.Codice = 1;
                retValue.Descrizione = "si  verificato un errore";
            }

            return retValue;
        }

        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.amministrazione.OrgNodoTitolario))]
        public virtual ArrayList AmmGetNodiTitolario(string codiceAmministrazione, string idNodoTitolarioParent, string idRegistro)
        {
            ArrayList retValue = null;

            try
            {
                if (idRegistro == null)
                    idRegistro = string.Empty;

                retValue = BusinessLogic.Amministrazione.TitolarioManager.GetNodiTitolario(codiceAmministrazione, idNodoTitolarioParent, idRegistro);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmGetNodiTitolario", e);
            }

            return retValue;
        }

        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.amministrazione.OrgNodoTitolario))]
        public virtual ArrayList AmmGetNodiTitolario_InRuolo(string idGruppo)
        {
            ArrayList retValue = null;

            try
            {
                retValue = BusinessLogic.Amministrazione.TitolarioManager.GetNodiTitolario_InRuolo(idGruppo);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmGetNodiTitolario_InRuolo", e);
            }

            return retValue;
        }

        [WebMethod]
        public virtual string AmmGetVisibNodoTit_InRuolo(string idNodoTitolario, string idGruppo)
        {
            string retValue = string.Empty;
            try
            {
                retValue = BusinessLogic.Amministrazione.TitolarioManager.AmmGetVisibilitaNodoTit_InRuolo(idNodoTitolario, idGruppo);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmGetVisibilitaNodoTit_InRuolo", e);
            }
            return retValue;
        }

        #endregion

        #region Gestione Registri

        /// <summary>
        /// Reperimento registri/RF in amministrazione
        /// </summary>
        /// <param name="codiceAmministrazione"></param>
        /// <param name="chaRF">0, se voglio solo i registri, 1 se voglio solo gli RF, "" se voglio entrambi</param>
        /// <returns></returns>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.amministrazione.OrgRegistro))]
        public System.Collections.ArrayList AmmGetRegistri(string codiceAmministrazione, string chaRF)
        {
            ArrayList retValue = null;

            try
            {
                retValue = BusinessLogic.Amministrazione.RegistroManager.GetRegistri(codiceAmministrazione, chaRF);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmGetRegistri", e);


            }

            return retValue;
        }


        /// <summary>
        /// Reperimenti di un registro in amministrazione
        /// </summary>
        /// <param name="idRegistro"></param>
        /// <returns></returns>
        [WebMethod]
        public DocsPaVO.amministrazione.OrgRegistro AmmGetRegistro(string idRegistro)
        {
            DocsPaVO.amministrazione.OrgRegistro retValue = null;

            try
            {
                retValue = BusinessLogic.Amministrazione.RegistroManager.GetRegistro(idRegistro);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmGetRegistro", e);
            }

            return retValue;
        }

        /// <summary>
        /// Inserimento di un nuovo registro in amministrazione
        /// </summary>
        /// <param name="registro"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.Validations.ValidationResultInfo AmmInsertRegistro(ref DocsPaVO.amministrazione.OrgRegistro registro, DocsPaVO.utente.InfoUtente infoUtente)
        {
            DocsPaVO.Validations.ValidationResultInfo retValue = null;
            SetUserId(infoUtente);
            try
            {
                retValue = BusinessLogic.Amministrazione.RegistroManager.InsertRegistro(registro);
                if (retValue != null)
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMNEWAOO", registro.IDRegistro, "Creazione nuova AOO " + registro.Codice, DocsPaVO.Logger.CodAzione.Esito.OK, registro.IDAmministrazione);
            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMNEWAOO", registro.IDRegistro, "Creazione nuova AOO " + registro.Codice, DocsPaVO.Logger.CodAzione.Esito.KO, registro.IDAmministrazione);
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmInsertRegistro", e);
            }

            return retValue;
        }

        /// <summary>
        /// Aggiornamento registro in amministrazione
        /// </summary>
        /// <param name="registro"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.Validations.ValidationResultInfo AmmUpdateRegistro(ref DocsPaVO.amministrazione.OrgRegistro registro)
        {
            DocsPaVO.Validations.ValidationResultInfo retValue = null;

            try
            {
                retValue = BusinessLogic.Amministrazione.RegistroManager.UpdateRegistro(registro);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmUpdateRegistro", e);
            }

            return retValue;
        }

        /// <summary>
        /// Cancellazione registro in amministrazione
        /// </summary>
        /// <param name="registro"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.Validations.ValidationResultInfo AmmDeleteRegistro(ref DocsPaVO.amministrazione.OrgRegistro registro)
        {
            DocsPaVO.Validations.ValidationResultInfo retValue = null;

            try
            {
                retValue = BusinessLogic.Amministrazione.RegistroManager.DeleteRegistro(registro);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmDeleteRegistro", e);
            }

            return retValue;
        }

        /// <summary>
        /// Verifica se un registro pu essere inserito in amministrazione
        /// </summary>
        /// <param name="registro"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.Validations.ValidationResultInfo AmmCanInsertRegistro(DocsPaVO.amministrazione.OrgRegistro registro)
        {
            DocsPaVO.Validations.ValidationResultInfo retValue = null;

            try
            {
                retValue = BusinessLogic.Amministrazione.RegistroManager.CanInsertRegistro(registro);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmCanInsertRegistro", e);
            }

            return retValue;
        }

        /// <summary>
        /// Verifica se un registro pu essere aggiornato in amministrazione
        /// </summary>
        /// <param name="registro"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.Validations.ValidationResultInfo AmmCanUpdateRegistro(DocsPaVO.amministrazione.OrgRegistro registro)
        {
            DocsPaVO.Validations.ValidationResultInfo retValue = null;

            try
            {
                retValue = BusinessLogic.Amministrazione.RegistroManager.CanUpdateRegistro(registro);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmCanUpdateRegistro", e);
            }

            return retValue;
        }

        /// <summary>
        /// Verifica se un registro pu essere cancellato in amministrazione
        /// </summary>
        /// <param name="registro"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.Validations.ValidationResultInfo AmmCanDeleteRegistro(DocsPaVO.amministrazione.OrgRegistro registro)
        {
            DocsPaVO.Validations.ValidationResultInfo retValue = null;

            try
            {
                retValue = BusinessLogic.Amministrazione.RegistroManager.CanDeleteRegistro(registro);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmCanDeleteRegistro", e);
            }

            return retValue;
        }

        #endregion

        #region Gestione Tipi Ruoli

        /// <summary>
        /// Reperimento tipi ruolo in amministrazione
        /// </summary>
        /// <param name="codiceAmministrazione"></param>
        /// <returns></returns>
        [WebMethod()]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.amministrazione.OrgTipoRuolo))]
        public ArrayList AmmGetTipiRuolo(string codiceAmministrazione)
        {
            ArrayList retValue = null;

            try
            {
                retValue = BusinessLogic.Amministrazione.TipiRuoloManager.GetTipiRuolo(codiceAmministrazione);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmGetTipiRuolo", e);
            }

            return retValue;
        }

        /// <summary>
        /// Reperimento di un oggetto "OrgTipoRuolo"
        /// </summary>
        /// <param name="idTipoRuolo"></param>
        /// <returns></returns>
        [WebMethod]
        public DocsPaVO.amministrazione.OrgTipoRuolo AmmGetTipoRuolo(string idTipoRuolo)
        {
            DocsPaVO.amministrazione.OrgTipoRuolo retValue = null;

            try
            {
                retValue = BusinessLogic.Amministrazione.TipiRuoloManager.GetTipoRuolo(idTipoRuolo);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmGetTipoRuolo", e);
            }

            return retValue;
        }

        /// <summary>
        /// Inserimento di un nuovo tipo ruolo
        /// </summary>
        /// <param name="tipoRuolo"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.Validations.ValidationResultInfo AmmInsertTipoRuolo(DocsPaVO.utente.InfoUtente infoUtente, ref DocsPaVO.amministrazione.OrgTipoRuolo tipoRuolo, string idAmm)
        {
            DocsPaVO.Validations.ValidationResultInfo retValue = null;
            SetUserId(infoUtente);
            try
            {
                retValue = BusinessLogic.Amministrazione.TipiRuoloManager.InsertTipoRuolo(tipoRuolo);
                if (retValue != null)
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMNEWTIPORUOLO", tipoRuolo.IDTipoRuolo, "Creazione tipo ruolo " + tipoRuolo.Codice, DocsPaVO.Logger.CodAzione.Esito.OK, idAmm);
            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMNEWTIPORUOLO", tipoRuolo.IDTipoRuolo, "Creazione tipo ruolo " + tipoRuolo.Codice, DocsPaVO.Logger.CodAzione.Esito.KO, idAmm);
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmInsertTipoRuolo", e);
            }

            return retValue;
        }

        /// <summary>
        /// Verifica se un tipo ruolo pu essere inserito
        /// </summary>
        /// <param name="tipoRuolo"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.Validations.ValidationResultInfo AmmCanInsertTipoRuolo(DocsPaVO.amministrazione.OrgTipoRuolo tipoRuolo)
        {
            DocsPaVO.Validations.ValidationResultInfo retValue = null;

            try
            {
                retValue = BusinessLogic.Amministrazione.TipiRuoloManager.CanInsertTipoRuolo(tipoRuolo);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmCanInsertTipoRuolo", e);
            }

            return retValue;
        }

        /// <summary>
        /// Aggiornamento di un tipo ruolo
        /// </summary>
        /// <param name="tipoRuolo"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.Validations.ValidationResultInfo AmmUpdateTipoRuolo(ref DocsPaVO.amministrazione.OrgTipoRuolo tipoRuolo)
        {
            DocsPaVO.Validations.ValidationResultInfo retValue = null;

            try
            {
                retValue = BusinessLogic.Amministrazione.TipiRuoloManager.UpdateTipoRuolo(tipoRuolo);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmUpdateTipoRuolo", e);
            }

            return retValue;
        }

        /// <summary>
        /// Verifica se un tipo ruolo pu essere aggiornato
        /// </summary>
        /// <param name="tipoRuolo"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.Validations.ValidationResultInfo AmmCanUpdateTipoRuolo(DocsPaVO.amministrazione.OrgTipoRuolo tipoRuolo)
        {
            DocsPaVO.Validations.ValidationResultInfo retValue = null;

            try
            {
                retValue = BusinessLogic.Amministrazione.TipiRuoloManager.CanUpdateTipoRuolo(tipoRuolo);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmCanUpdateTipoRuolo", e);
            }

            return retValue;
        }

        /// <summary>
        /// Cancellazione di un tipo ruolo
        /// </summary>
        /// <param name="tipoRuolo"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.Validations.ValidationResultInfo AmmDeleteTipoRuolo(DocsPaVO.utente.InfoUtente infoUtente, ref DocsPaVO.amministrazione.OrgTipoRuolo tipoRuolo, string idAmm)
        {
            DocsPaVO.Validations.ValidationResultInfo retValue = null;
            SetUserId(infoUtente);
            try
            {
                retValue = BusinessLogic.Amministrazione.TipiRuoloManager.DeleteTipoRuolo(tipoRuolo);
                if (retValue != null)
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMDELTIPORUOLO", tipoRuolo.IDTipoRuolo, "Cancellazione tipo ruolo " + tipoRuolo.Codice, DocsPaVO.Logger.CodAzione.Esito.OK, idAmm);
            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMDELTIPORUOLO", tipoRuolo.IDTipoRuolo, "Cancellazione tipo ruolo " + tipoRuolo.Codice, DocsPaVO.Logger.CodAzione.Esito.KO, idAmm);
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmDeleteTipoRuolo", e);
            }

            return retValue;
        }

        /// <summary>
        /// Verifica se un tipo ruolo pu essere cancellato
        /// </summary>
        /// <param name="tipoRuolo"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.Validations.ValidationResultInfo AmmCanDeleteTipoRuolo(ref DocsPaVO.amministrazione.OrgTipoRuolo tipoRuolo)
        {
            DocsPaVO.Validations.ValidationResultInfo retValue = null;

            try
            {
                retValue = BusinessLogic.Amministrazione.TipiRuoloManager.CanDeleteTipoRuolo(tipoRuolo);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmCanDeleteTipoRuolo", e);
            }

            return retValue;
        }

        #endregion

        #region Gestione Tipi Funzione e Funzioni

        /// <summary>
        /// Reperimento tipi funzione disponibili
        /// </summary>
        /// <returns></returns>
        [WebMethod()]
        [return: XmlArray()]
        public DocsPaVO.amministrazione.OrgTipoFunzione[] AmmGetTipiFunzione(bool fillFunzioniElementari, string idAmm)
        {
            DocsPaVO.amministrazione.OrgTipoFunzione[] retValue = null;

            try
            {
                retValue = BusinessLogic.Amministrazione.TipiFunzioneManager.GetTipiFunzione(fillFunzioniElementari, idAmm);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmGetTipiFunzione", e);
            }

            return retValue;
        }

        /// <summary>
        /// Reperimento tipo funzione
        /// </summary>
        /// <param name="idTipoFunzione"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.amministrazione.OrgTipoFunzione AmmGetTipoFunzione(string idTipoFunzione, bool fillFunzioniElementari)
        {
            DocsPaVO.amministrazione.OrgTipoFunzione retValue = null;

            try
            {
                retValue = BusinessLogic.Amministrazione.TipiFunzioneManager.GetTipoFunzione(idTipoFunzione, fillFunzioniElementari);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmGetTipoFunzione", e);
            }

            return retValue;
        }

        /// <summary>
        /// Verifica inserimento tipo funzione
        /// </summary>
        /// <param name="tipoFunzione"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.Validations.ValidationResultInfo AmmCanInsertTipoFunzione(DocsPaVO.amministrazione.OrgTipoFunzione tipoFunzione)
        {
            DocsPaVO.Validations.ValidationResultInfo retValue = null;

            try
            {
                retValue = BusinessLogic.Amministrazione.TipiFunzioneManager.CanInsertTipoFunzione(tipoFunzione);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmCanInsertTipoFunzione", e);
            }

            return retValue;
        }

        /// <summary>
        /// Insermento di un tipo funzione
        /// </summary>
        /// <param name="tipoFunzione"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.Validations.ValidationResultInfo AmmInsertTipoFunzione(ref DocsPaVO.amministrazione.OrgTipoFunzione tipoFunzione)
        {
            DocsPaVO.Validations.ValidationResultInfo retValue = null;

            try
            {
                retValue = BusinessLogic.Amministrazione.TipiFunzioneManager.InsertTipoFunzione(tipoFunzione);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmInsertTipoFunzione", e);
            }

            return retValue;
        }

        /// <summary>
        /// Verifica aggiornamento tipo funzione
        /// </summary>
        /// <param name="tipoFunzione"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.Validations.ValidationResultInfo AmmCanUpdateTipoFunzione(DocsPaVO.amministrazione.OrgTipoFunzione tipoFunzione)
        {
            DocsPaVO.Validations.ValidationResultInfo retValue = null;

            try
            {
                retValue = BusinessLogic.Amministrazione.TipiFunzioneManager.CanUpdateTipoFunzione(tipoFunzione);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmCanUpdateTipoFunzione", e);
            }

            return retValue;
        }

        /// <summary>
        /// Aggiornamento di un tipo funzione
        /// </summary>
        /// <param name="tipoFunzione"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.Validations.ValidationResultInfo AmmUpdateTipoFunzione(ref DocsPaVO.amministrazione.OrgTipoFunzione tipoFunzione)
        {
            DocsPaVO.Validations.ValidationResultInfo retValue = null;

            try
            {
                retValue = BusinessLogic.Amministrazione.TipiFunzioneManager.UpdateTipoFunzione(tipoFunzione);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmUpdateTipoFunzione", e);
            }

            return retValue;
        }

        /// <summary>
        /// Verifica cancellazione tipo funzione
        /// </summary>
        /// <param name="tipoFunzione"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.Validations.ValidationResultInfo AmmCanDeleteTipoFunzione(DocsPaVO.amministrazione.OrgTipoFunzione tipoFunzione)
        {
            DocsPaVO.Validations.ValidationResultInfo retValue = null;

            try
            {
                retValue = BusinessLogic.Amministrazione.TipiFunzioneManager.CanDeleteTipoFunzione(tipoFunzione);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmCanDeleteTipoFunzione", e);
            }

            return retValue;
        }

        /// <summary>
        /// Cancellazione di un tipo funzione
        /// </summary>
        /// <param name="tipoFunzione"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.Validations.ValidationResultInfo AmmDeleteTipoFunzione(DocsPaVO.amministrazione.OrgTipoFunzione tipoFunzione)
        {
            DocsPaVO.Validations.ValidationResultInfo retValue = null;

            try
            {
                retValue = BusinessLogic.Amministrazione.TipiFunzioneManager.DeleteTipoFunzione(tipoFunzione);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmDeleteTipoFunzione", e);
            }

            return retValue;
        }

        /// <summary>
        /// Reperimento funzioni in anagrafica funzioni
        /// </summary>
        /// <returns></returns>
        [WebMethod()]
        [return: XmlArray()]
        public DocsPaVO.amministrazione.OrgFunzioneAnagrafica[] AmmGetFunzioniAnagrafica()
        {
            DocsPaVO.amministrazione.OrgFunzioneAnagrafica[] retValue = null;

            try
            {
                retValue = BusinessLogic.Amministrazione.FunzioniManager.GetFunzioniAnagrafica();
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmGetFunzioniAnagrafica", e);
            }

            return retValue;
        }

        [WebMethod()]
        [return: XmlArray()]
        public DocsPaVO.amministrazione.OrgFunzione[] AmmGetFunzioni(string idTipoFunzoine)
        {
            DocsPaVO.amministrazione.OrgFunzione[] retValue = null;

            try
            {
                retValue = BusinessLogic.Amministrazione.FunzioniManager.GetFunzioni(idTipoFunzoine);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmGetFunzioni", e);
            }

            return retValue;
        }

        // MEV EXPORT DETTAGLI FUNZIONE

        [WebMethod()]
        public DocsPaVO.documento.FileDocumento AmmGetReportFunzioni(string tipoReport, string formato, string idFunzione, string idAmm)
        {
            DocsPaVO.documento.FileDocumento retVal = new DocsPaVO.documento.FileDocumento();

            try
            {
                retVal = BusinessLogic.Amministrazione.TipiFunzioneManager.ReportFunzioni(tipoReport, formato, idFunzione, idAmm);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmGetReportFunzioni", ex);
                retVal = null;
            }

            return retVal;
        }

        [WebMethod()]
        public DocsPaVO.amministrazione.OrgTipoFunzione AmmGetTipoFunzioneByCod(string codice, bool fillFunzioniElementari)
        {

            DocsPaVO.amministrazione.OrgTipoFunzione retVal = new DocsPaVO.amministrazione.OrgTipoFunzione();

            try
            {
                retVal = BusinessLogic.Amministrazione.TipiFunzioneManager.GetTipoFunzioneByCod(codice, fillFunzioniElementari);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore in DocsPaWS.asmx - metodo: AmmGetTipoFunzioneByCod", ex);
            }

            return retVal;
        }

        [WebMethod()]
        public DocsPaVO.amministrazione.OrgFunzioneAnagrafica AmmGetFunzioneAnagrafica(string codice)
        {

            DocsPaVO.amministrazione.OrgFunzioneAnagrafica retVal = new DocsPaVO.amministrazione.OrgFunzioneAnagrafica();

            try
            {
                retVal = BusinessLogic.Amministrazione.FunzioniManager.GetAnagraficaPerReport(codice);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore in DocsPaWS.asmx - metodo: AmmGetFunzioneAnagrafica", ex);
            }

            return retVal;

        }

        #endregion

        #region Gestione Ragioni Trasmissione


        [WebMethod()]
        public DocsPaVO.amministrazione.OrgRagioneTrasmissione AmmGetRagioneTrasmissione(string idRagione)
        {
            DocsPaVO.amministrazione.OrgRagioneTrasmissione retValue = null;

            try
            {
                retValue = BusinessLogic.Amministrazione.RagioniTrasmissioneManager.GetRagioneTrasmissione(idRagione);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmGetRagioneTrasmissione", e);
            }

            return retValue;
        }

        /// <summary>
        /// Reperimento ragioni trasmissione disponibili per un'amministrazione
        /// </summary>
        /// <returns></returns>
        [WebMethod()]
        [return: XmlArray()]
        public DocsPaVO.amministrazione.OrgRagioneTrasmissione[] AmmGetRagioniTrasmissione(string idAmministrazione)
        {
            DocsPaVO.amministrazione.OrgRagioneTrasmissione[] retValue = null;

            try
            {
                retValue = BusinessLogic.Amministrazione.RagioniTrasmissioneManager.GetRagioniTrasmissione(idAmministrazione);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmGetRagioniTrasmissione", e);
            }

            return retValue;
        }

        /// <summary>
        /// Reperimento ragioni trasmissione disponibili per un'amministrazione
        /// </summary>
        /// <returns></returns>
        [WebMethod()]
        [return: XmlArray()]
        public DocsPaVO.amministrazione.OrgRagioneTrasmissione[] AmmGetInfoRagioniTrasmissione(string idAmministrazione)
        {
            DocsPaVO.amministrazione.OrgRagioneTrasmissione[] retValue = null;

            try
            {
                retValue = BusinessLogic.Amministrazione.RagioniTrasmissioneManager.GetInfoRagioniTrasmissione(idAmministrazione);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmGetInfoRagioniTrasmissione", e);
            }

            return retValue;
        }

        /// <summary>
        /// Reperimento delle ragioni trasmissione standard
        /// </summary>
        /// <returns></returns>
        [WebMethod()]
        [return: XmlArray()]
        public DocsPaVO.amministrazione.OrgRagioneTrasmissione[] AmmGetRagioniTrasmissioneAnagrafica()
        {
            DocsPaVO.amministrazione.OrgRagioneTrasmissione[] retValue = null;

            try
            {
                retValue = BusinessLogic.Amministrazione.RagioniTrasmissioneManager.GetRagioniTrasmissione();
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmGetRagioniTrasmissioneAnagrafica", e);
            }

            return retValue;
        }

        /// <summary>
        /// Inserimento di una nuova ragione trasmissione
        /// </summary>
        /// <param name="ragione"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.Validations.ValidationResultInfo AmmInsertRagioneTrasmissione(DocsPaVO.utente.InfoUtente infoUtente, ref DocsPaVO.amministrazione.OrgRagioneTrasmissione ragione, string idAmm)
        {
            DocsPaVO.Validations.ValidationResultInfo retValue = null;
            SetUserId(infoUtente);
            try
            {
                retValue = BusinessLogic.Amministrazione.RagioniTrasmissioneManager.InsertRagioneTrasmissione(ragione);
                if (retValue != null)
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMNEWTRASM", ragione.ID, "Creazione nuova ragione di trasmissione " + ragione.Codice, DocsPaVO.Logger.CodAzione.Esito.OK, idAmm);
            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMNEWTRASM", ragione.ID, "Creazione nuova ragione di trasmissione " + ragione.Codice, DocsPaVO.Logger.CodAzione.Esito.KO, idAmm);
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmInsertRagioneTrasmissione", e);
            }

            return retValue;
        }

        /// <summary>
        /// Aggiornamento di una ragione trasmissione
        /// </summary>
        /// <param name="ragione"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.Validations.ValidationResultInfo AmmUpdateRagioneTrasmissione(DocsPaVO.utente.InfoUtente infoUtente, ref DocsPaVO.amministrazione.OrgRagioneTrasmissione ragione, string idAmm)
        {
            SetUserId(infoUtente);
            DocsPaVO.Validations.ValidationResultInfo retValue = null;

            try
            {
                retValue = BusinessLogic.Amministrazione.RagioniTrasmissioneManager.UpdateRagioneTrasmissione(ragione);
                if (retValue != null)
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMMODTRASM", ragione.ID, "Modifica ragione di trasmissione " + ragione.Codice, DocsPaVO.Logger.CodAzione.Esito.OK, idAmm);
            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMMODTRASM", ragione.ID, "Modifica ragione di trasmissione " + ragione.Codice, DocsPaVO.Logger.CodAzione.Esito.KO, idAmm);
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmUpdateRagioneTrasmissione", e);
            }

            return retValue;
        }

        /// <summary>
        /// Cancellazione di una ragione trasmissione
        /// </summary>
        /// <param name="ragione"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.Validations.ValidationResultInfo AmmDeleteRagioneTrasmissione(ref DocsPaVO.amministrazione.OrgRagioneTrasmissione ragione)
        {
            DocsPaVO.Validations.ValidationResultInfo retValue = null;

            try
            {
                retValue = BusinessLogic.Amministrazione.RagioniTrasmissioneManager.DeleteRagioneTrasmissione(ragione);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmDeleteRagioneTrasmissione", e);
            }

            return retValue;
        }

        #endregion

        #endregion

        #region Metodo Commentato
        //		[WebMethod]
        //		public virtual void Pause(double timeToPause, DocsPaVO.utente.InfoUtente infoUtente) 
        //		{
        //			bool inPause=true;
        //			DateTime start=DateTime.Now;
        //			DateTime stop=start.AddMilliseconds(timeToPause);
        //
        //			while (inPause) 
        //			{
        //				DateTime adesso=DateTime.Now; 
        //				if (DateTime.Compare(adesso,stop)==1) 
        //				{
        //					inPause=false;
        //				}
        //			}
        //		}
        #endregion

        #region Ricerche
        /// <summary>
        /// </summary>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.utente.Utente))]
        public virtual ArrayList amministrazioneGetUtenti(string idAmm, string search)
        {
            try
            {
                return BusinessLogic.Amministrazione.UtenteManager.GetUtenti(idAmm, search);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: amministrazioneGetUtenti", e);
            }

            return null;
        }
        #endregion

        #region Debug Methods (Commentato)
        //		/// <summary>Serializza 
        //		/// </summary>
        //		/// <param name="obj"></param>
        //		public void GenerateSoapOutput(object obj)
        //		{
        //			#if Debug
        //			try
        //			{
        //				string basePathFiles = System.Configuration.ConfigurationManager.AppSettings["DEBUG_PATH"];
        //				basePathFiles = basePathFiles.Replace("%DATA", DateTime.Now.ToString("yyyyMMdd"));
        //
        //				string path = basePathFiles + @"\WebServices\";
        //
        //				if(!Directory.Exists(path))
        //				{
        //					Directory.CreateDirectory(path);
        //				}
        //
        //				path += "serialization_" + DateTime.Now.ToString("hhmmss") + ".txt";
        //
        //				IFormatter formatter = new SoapFormatter();
        //				Stream stream = new FileStream(path, 
        //											   FileMode.Append, 
        //											   FileAccess.Write, FileShare.None);
        //	
        //				formatter.Serialize(stream, obj);
        //				stream.Close();
        //			}
        //			catch(Exception exception)
        //			{
        //				
        //			}
        //			#endif
        //		}
        #endregion

        #region Amministrazione XML

        /// <summary>
        /// prende la lista dei files pdf dei log sul file system
        /// </summary>
        /// <param name="codAmm">codice amm.ne</param>
        /// <returns></returns>
        [WebMethod]
        public string[] GetFilesLog(string codAmm)
        {
            string[] files = null;

            try
            {
                BusinessLogic.UserLog.UserLog log = new BusinessLogic.UserLog.UserLog();
                files = log.ListaFilesLog(codAmm);
            }
            catch (Exception exception)
            {
                logger.Debug("Errore nel metodo WS GetFilesLog: ", exception);
            }
            return files;
        }

        /// <summary>
        /// generazione del file pdf del log
        /// </summary>
        /// <param name="codAmm">codice amm.ne</param>
        /// <returns>bool</returns>
        [WebMethod]
        public bool StampaPDFLog(string codAmm, string type)
        {
            bool result = false;

            try
            {
                BusinessLogic.report.ReportLog rpl = new BusinessLogic.report.ReportLog();
                result = rpl.RiversaInStorico(codAmm, type);
            }
            catch (Exception exception)
            {
                logger.Debug("Errore nel metodo WS StampaPDFLog: ", exception);
            }

            return result;
        }

        /// <summary>
        /// conta quanti record ci sono nella tabella dei log
        /// </summary>
        /// <param name="codAmm"></param>
        /// <returns></returns>
        [WebMethod]
        public string ContaLog(string codAmm, string type)
        {
            string result = "";

            try
            {
                BusinessLogic.UserLog.UserLog log = new BusinessLogic.UserLog.UserLog();
                log.ContaArchivioLog(out result, codAmm, type);

            }
            catch (Exception exception)
            {
                logger.Debug("Errore nel metodo WS ContaLog: ", exception);
            }

            return result;
        }

        /// <summary>
        /// verifica se esiste la chiave ARCHIVIO_LOG_PATH sul web.config
        /// </summary>
        /// <returns></returns>
        [WebMethod]
        public string VerificaArchivioLogPath()
        {
            string result = string.Empty;

            try
            {
                BusinessLogic.UserLog.UserLog log = new BusinessLogic.UserLog.UserLog();
                result = log.VerificaArchivioLogPath();
            }
            catch (Exception exception)
            {
                logger.Debug("Errore nel metodo WS VerificaArchivioPath: ", exception);
            }

            return result;
        }

        /// <summary>
        /// verifica se esiste la chiave ARCHIVIO_LOG_PATH_AMM sul web.config
        /// </summary>
        /// <returns></returns>
        [WebMethod]
        public string VerificaArchivioLogPathAmm()
        {
            string result = string.Empty;

            try
            {
                BusinessLogic.UserLog.UserLog log = new BusinessLogic.UserLog.UserLog();
                result = log.VerificaArchivioLogPathAmm();
            }
            catch (Exception exception)
            {
                logger.Debug("Errore nel metodo WS VerificaArchivioPathAmm: ", exception);
            }

            return result;
        }

        /// <summary>
        /// metodo per eseguire query sui log, dati alcuni filtri. Restituisce un file xml
        /// </summary>
        /// <param name="dataDa">data da:</param>
        /// <param name="dataA">data a:</param>
        /// <param name="user">userid operatore</param>
        /// <param name="oggetto">oggetto del log</param>
        /// <param name="azione">azione del log</param>
        /// <param name="codAmm">codice amm.ne</param>
        /// <returns>stream xml</returns>
        [WebMethod]
        public string GetXMLLogFiltrato(string dataDa, string dataA, string user, string oggetto, string azione, string codAmm, string esito, string type, int table)
        {
            string result = "";
            try
            {
                BusinessLogic.UserLog.UserLog log = new BusinessLogic.UserLog.UserLog();
                result = log.GetXmlLogFiltrato(dataDa, dataA, user, oggetto, azione, codAmm, esito, type, table);
            }
            catch (Exception exception)
            {
                logger.Debug("Errore nel metodo WS GetXMLLogFiltrato: ", exception);
            }

            return result;
        }

        /// <summary>
        /// modifica le attivazioni sul file xml dei log
        /// </summary>
        /// <param name="stream">stream xml</param>
        /// <param name="codAmm">codice amm.ne</param>
        /// <returns>bool: true=successo, false=insuccesso</returns>
        [WebMethod]
        public bool SetXMLLog(string stream, string codAmm, DocsPaVO.utente.InfoUtente infoUtente)
        {
            bool result = false;
            try
            {
                BusinessLogic.UserLog.UserLog log = new BusinessLogic.UserLog.UserLog();
                string idAmm = log.GetAdminByName(codAmm);
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMM_MOD_ATTIVAZIONE_LOG", idAmm, "Modifica in attivazione/disabilitazione log", DocsPaVO.Logger.CodAzione.Esito.OK, idAmm);
                result = log.WriteWSLog(stream, codAmm);
            }
            catch (Exception exception)
            {
                logger.Debug("Errore nel metodo WS SetXMLLog: ", exception);
            }
            return result;
        }

        /// <summary>
        /// modifica le attivazioni sul file xml dei log di amministrazione
        /// </summary>
        /// <param name="stream">stream xml</param>
        /// <param name="codAmm">codice amm.ne</param>
        /// <returns>bool: true=successo, false=insuccesso</returns>
        [WebMethod]
        public bool SetXMLLogAmm(string stream, string codAmm, DocsPaVO.utente.InfoUtente infoUtente)
        {
            bool result = false;
            try
            {
                BusinessLogic.UserLog.UserLog log = new BusinessLogic.UserLog.UserLog();
                string idAmm = log.GetAdminByName(codAmm);
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMM_MOD_ATTIVAZIONE_LOG", idAmm, "Modifica in attivazione/disabilitazione log di amministrazione", DocsPaVO.Logger.CodAzione.Esito.OK, idAmm);
                result = log.WriteWSLogAmm(stream, codAmm);
            }
            catch (Exception exception)
            {
                logger.Debug("Errore nel metodo WS SetXMLLogAmm: ", exception);
            }
            return result;
        }

        /// <summary>
        /// legge il file xml dei log per le abilitazioni
        /// </summary>
        /// <returns>stream xml</returns>
        [WebMethod]
        public string GetXMLLog(string codAmm)
        {
            string result = "";
            try
            {
                BusinessLogic.UserLog.UserLog log = new BusinessLogic.UserLog.UserLog();
                result = log.ReadWSLog(codAmm);
            }
            catch (Exception exception)
            {
                logger.Debug("Errore nel metodo WS GetXMLLog: ", exception);
            }
            return result;
        }


        /// <summary>
        /// Restituisce i log attivi
        /// </summary>
        /// <param name="codAmm"></param>
        /// <returns></returns>
        [WebMethod]
        [XmlInclude(typeof(DocsPaVO.Logger.CodAzione.infoOggetto))]
        public List<DocsPaVO.Logger.CodAzione.infoOggetto> GetLogAttiviByOggetto(string oggetto, string codAmm)
        {
            List<DocsPaVO.Logger.CodAzione.infoOggetto> result = new List<DocsPaVO.Logger.CodAzione.infoOggetto>();
            try
            {
                BusinessLogic.UserLog.UserLog log = new BusinessLogic.UserLog.UserLog();
                result = log.GetLogAttiviByOggetto(oggetto, codAmm);
            }
            catch (Exception exception)
            {
                logger.Debug("Errore nel metodo WS GetLogAttiviByOggetto: ", exception);
            }
            return result;
        }

        /// <summary>
        /// prende le info dalla tabella di anagrafica dei log di amministrazione
        /// </summary>
        /// <returns>stream xml</returns>
        [WebMethod]
        public string GetXMLLogAmm(string codAmm)
        {
            string result = "";
            try
            {
                BusinessLogic.UserLog.UserLog log = new BusinessLogic.UserLog.UserLog();
                result = log.ReadWSLogAmm(codAmm);
            }
            catch (Exception exception)
            {
                logger.Debug("Errore nel metodo WS GetXMLLogAmm: ", exception);
            }
            return result;
        }

        /// <summary>
        /// sposta un ruolo da una uo ad un'altra
        /// </summary>
        /// <param name="codRuolo">codice del ruolo da spostare</param>
        /// <param name="codAmm">codice Amm.ne</param>
        /// <param name="codNewUO">codice della nuova UO nella quale deve essere spostato il ruolo</param>
        /// <returns>bool</returns>
        [WebMethod]
        public bool MoveRoleToNewUO(string codRuolo, string codAmm, string codNewUO, string descNewUO, string codTipoRuolo, string descTipoRuolo, string codNewRuolo, string descNewRuolo)
        {
            bool result = false;
            try
            {
                BusinessLogic.AmministrazioneXml.RuoliXml ruoli = new BusinessLogic.AmministrazioneXml.RuoliXml();
                result = ruoli.MoveRoleToNewUO(codRuolo, codAmm, codNewUO, descNewUO, codTipoRuolo, descTipoRuolo, codNewRuolo, descNewRuolo);
            }
            catch (Exception exception)
            {
                logger.Debug("Errore nel metodo WS MoveRoleToNewUO: ", exception);
            }

            return result;
        }




        /// <summary>
        /// </summary>
        [WebMethod]
        public string ExportTitolario()
        {
            string result = null;

            try
            {
                BusinessLogic.AmministrazioneXml.TitolarioXml titolarioXml = new BusinessLogic.AmministrazioneXml.TitolarioXml();

                XmlDocument doc;
                doc = titolarioXml.ExportStructureXmlDocument();
                if (doc != null)
                {
                    result = doc.OuterXml;
                }
            }
            catch (Exception exception)
            {
                logger.Debug("Errore durante l'esportazione della struttura del titolario.", exception);
                result = null;
            }

            return result;
        }

        #region GADAMO: ipotesi di gestione diversa del file XML del titolario
        /// <summary>
        /// </summary>
        //		[WebMethod]
        //		public string ExportSecurity()
        //		{
        //			string result = null;
        //
        //			try
        //			{
        //				BusinessLogic.AmministrazioneXml.TitolarioXml titolarioXml = new BusinessLogic.AmministrazioneXml.TitolarioXml();
        //
        //				XmlDocument doc;
        //			//	doc = titolarioXml.ExportSecurityXmlDocument();
        //				if(doc!=null)
        //				{
        //					result=doc.OuterXml;
        //				}
        //			}
        //			catch(Exception exception)
        //			{
        //				logger.Debug("Errore durante l'esportazione della security titolario.", exception);
        //				result = null;
        //			}
        //
        //			return result;
        //		}
        #endregion

        #region Metodo Commentato
        /*
		[WebMethod]
		public bool ExportData(out string amministrazione,out string titolario)
		{
			bool result = true;
			amministrazione=null;
			titolario=null;
			DocsPaUtils.LogsManagement.ProgressLogger pl=DocsPaUtils.LogsManagement.ProgressLogger.getInstance(true);
			int idMessage;
			try
			{
				idMessage=pl.NewMessage("Esportazione dati.");

				BusinessLogic.AmministrazioneXml.AmministrazioniXml amministrazioniXml = new BusinessLogic.AmministrazioneXml.AmministrazioniXml();
				BusinessLogic.AmministrazioneXml.TitolarioXml titolarioXml = new BusinessLogic.AmministrazioneXml.TitolarioXml();
				XmlDocument doc;
				doc = amministrazioniXml.ExportStructureXmlDocument();
				if(doc!=null)
				{
					amministrazione=doc.OuterXml; 
					doc= titolarioXml.ExportStructureXmlDocument();
					if(doc!=null)
					{
						titolario=doc.OuterXml;
						
					}
				}
				pl.UpdateMessage(idLast,null,true,false);
				pl.Terminate();
			}
			catch(Exception exception)
			{
				logger.Debug("Errore durante l'esportazione dei dati per l'amministrazione.", exception);
				pl.UpdateMessage(idLast,null,true,false);
				pl.Terminate();
				result = false;
			}

			return result;
		}*/
        #endregion

        /// <summary>
        /// </summary>
        /// 
        [WebMethod]
        public string ExportAmministrazioni()
        {
            string result = null;

            try
            {
                BusinessLogic.AmministrazioneXml.AmministrazioniXml amministrazioniXml = new BusinessLogic.AmministrazioneXml.AmministrazioniXml();
                XmlDocument doc;
                doc = amministrazioniXml.ExportStructureXmlDocument();
                if (doc != null)
                {
                    result = doc.OuterXml;
                }
            }
            catch (Exception exception)
            {
                logger.Debug("Errore durante l'esportazione della struttura delle amministrazioni.", exception);
                result = null;
            }

            return result;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public bool ImportTitolarioReadState(out int counter, out int total, out string message)
        {
            bool result = true; // Presume successo
            counter = 0;
            total = 0;
            message = null;

            try
            {
                if (!DocsPaUtils.LogsManagement.ImportExportLogger.ReadImportState(out counter, out total, out message)) throw new Exception();
            }
            catch (Exception exception)
            {
                logger.Debug("Errore durante la lettura del progresso dell'import del titolario.", exception);
                result = false;
            }

            return result;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public bool ImportDocumentiReadState(out int counter, out int total, out string message)
        {
            bool result = true; // Presume successo
            counter = 0;
            total = 0;
            message = null;

            try
            {
                if (!DocsPaUtils.LogsManagement.ImportExportLogger.ReadImportState(out counter, out total, out message)) throw new Exception();
            }
            catch (Exception exception)
            {
                logger.Debug("Errore durante la lettura del progresso dell'import dei documenti.", exception);
                result = false;
            }

            return result;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public bool ImportAmministrazioniReadState(out int counter, out int total, out string message)
        {
            bool result = true; // Presume successo
            counter = 0;
            total = 0;
            message = null;

            try
            {
                if (!DocsPaUtils.LogsManagement.ImportExportLogger.ReadImportState(out counter, out total, out message)) throw new Exception();
            }
            catch (Exception exception)
            {
                /* Non viene usato l'oggetto DocsPaUtils.LogsManagement.Debugger poiche' e' prevista l'eventualita' che
                 * la lettura del file di log per l'import/export fallisca ed in quanto non e' bloccante per i processi
                 * non e' necessario che risulti nel log su file (viene comunque offerto il messaggio di debug a finestra
                 * di output)
                 */
                System.Diagnostics.Debug.WriteLine("Errore durante la lettura del progresso delle amministrazioni.");
                System.Diagnostics.Debug.WriteLine(exception.ToString());
                result = false;
            }

            return result;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public bool ImportCorrispondentiReadState(out int counter, out int total, out string message)
        {
            bool result = true; // Presume successo
            counter = 0;
            total = 0;
            message = null;

            try
            {
                if (!DocsPaUtils.LogsManagement.ImportExportLogger.ReadImportState(out counter, out total, out message)) throw new Exception();
            }
            catch (Exception exception)
            {
                logger.Debug("Errore durante la lettura del progresso dei corrispondenti.", exception);
                result = false;
            }

            return result;
        }

        ///// <summary>
        ///// </summary>
        //[WebMethod]
        //public bool CreateTitolario(string xmlPath)
        //{
        //    bool result = true; // Presume successo

        //    try
        //    {
        //        bool loadResult;
        //        BusinessLogic.AmministrazioneXml.TitolarioXml titolarioXml = new BusinessLogic.AmministrazioneXml.TitolarioXml(xmlPath, out loadResult);

        //        if(loadResult)
        //        {
        //            if(!titolarioXml.CreateStructure()) throw new Exception();
        //        }
        //    }
        //    catch(Exception exception)
        //    {
        //        logger.Debug("Errore durante la creazione della struttura dei documenti.", exception);
        //        result = false;
        //    }

        //    return result;
        //}

        /// <summary>
        /// </summary>
        [WebMethod]
        public bool CreateAmministrazioni(string xmlPath)
        {
            bool result = true; // Presume successo

            try
            {
                bool loadResult;
                BusinessLogic.AmministrazioneXml.AmministrazioniXml amministrazioniXml = new BusinessLogic.AmministrazioneXml.AmministrazioniXml(xmlPath, out loadResult);

                if (loadResult)
                {
                    if (!amministrazioniXml.CreateStructure()) throw new Exception();
                }
            }
            catch (Exception exception)
            {
                logger.Debug("Errore durante la creazione della struttura dei documenti.", exception);
                result = false;
            }

            return result;
        }

        [WebMethod]
        public bool UpdateData(string xmlStreamAmm, string xmlStreamTitolario)
        {
            bool result = true; // Presume successo
            DocsPaUtils.LogsManagement.ProgressLogger pl = DocsPaUtils.LogsManagement.ProgressLogger.getInstance(true);
            //int idLast=-1;
            try
            {


                BusinessLogic.AmministrazioneXml.AmministrazioniXml amministrazioniXml = new BusinessLogic.AmministrazioneXml.AmministrazioniXml(xmlStreamAmm);
                if (!amministrazioniXml.UpdateStructure()) throw new Exception();

                //				BusinessLogic.AmministrazioneXml.TitolarioXml titolarioXml = new BusinessLogic.AmministrazioneXml.TitolarioXml(xmlStreamTitolario);
                //				if(!titolarioXml.UpdateStructure()) throw new Exception();

                int idLast = pl.NewMessage(@"<b>Stato invio file</b>");
                pl.UpdateMessage(idLast, null, true, false);

            }
            catch (Exception exception)
            {
                logger.Debug("Errore durante l'aggiornamento delle strutture XML.", exception);
                result = false;
                //				if(idLast!=-1)
                //				{
                //					pl.UpdateMessage(idLast,null,true,true);
                //				}

            }
            pl.Terminate();

            return result;
        }

        #region Metodi Commentati
        //		[WebMethod]
        //		public bool UpdateAmministrazioni(string xmlStream)
        //		{
        //			bool result = true; // Presume successo
        //
        //			try
        //			{
        //				BusinessLogic.AmministrazioneXml.AmministrazioniXml amministrazioniXml = new BusinessLogic.AmministrazioneXml.AmministrazioniXml(xmlStream);
        //
        //				if(!amministrazioniXml.UpdateStructure()) throw new Exception();
        //			}
        //			catch(Exception exception)
        //			{
        //				logger.Debug("Errore durante l'aggiornamento della struttura della amministrazione.", exception);
        //				result = false;
        //			}
        //
        //			return result;
        //		}

        //		[WebMethod]
        //		public bool UpdateTitolario(string xmlStream)
        //		{
        //			bool result = true; // Presume successo
        //
        //			try
        //			{
        //
        //				BusinessLogic.AmministrazioneXml.TitolarioXml titolarioXml = new BusinessLogic.AmministrazioneXml.TitolarioXml(xmlStream);
        //
        //				if(!titolarioXml.UpdateStructure()) throw new Exception();
        //			}
        //			catch(Exception exception)
        //			{
        //				logger.Debug("Errore durante l'aggiornamento della struttura della amministrazione.", exception);
        //				result = false;
        //			}
        //
        //			return result;
        //		}
        #endregion

        /// <summary>
        /// metodo che legge lo stato dell'upload dei file all'amministrazione
        /// </summary>
        /// <returns></returns>
        [WebMethod]
        public string RefreshAmministrazione()
        {
            string result = null;

            try
            {
                DocsPaUtils.LogsManagement.ProgressLogger pl = DocsPaUtils.LogsManagement.ProgressLogger.getInstance(false);
                result = pl.GetXml();
            }
            catch (Exception exception)
            {
                logger.Debug("Errore durante la richiesta dello stato upload amministrazione.", exception);
                result = null;
            }

            return result;
        }

        #region Metodi Commentati
        //		/// <summary>
        //		/// </summary>
        //		[WebMethod]
        //		public bool ExportAmministrazioni()
        //		{
        //			bool result = true; // Presume successo
        //
        //			try
        //			{
        //				BusinessLogic.AmministrazioneXml.AmministrazioniXml amministrazioniXml = new BusinessLogic.AmministrazioneXml.AmministrazioniXml();
        //
        //				if(result)
        //				{
        //					result = amministrazioniXml.ExportStructure();
        //				}
        //			}
        //			catch(Exception exception)
        //			{
        //				logger.Debug("Errore durante l'esportazione della struttura delle amministrazioni.", exception);
        //				result = false;
        //			}
        //
        //			return result;
        //		}

        //		/// <summary>
        //		/// </summary>
        //		[WebMethod]
        //		public bool ExportAmministrazioni20(string filePath)
        //		{
        //			bool result = true; // Presume successo
        //
        //			try
        //			{
        //				BusinessLogic.AmministrazioneXml20.AmministrazioniXml amministrazioniXml = new BusinessLogic.AmministrazioneXml20.AmministrazioniXml();
        //
        //				if(result)
        //				{
        //					result = amministrazioniXml.ExportStructure(filePath);
        //				}
        //			}
        //			catch(Exception exception)
        //			{
        //				logger.Debug("Errore durante l'esportazione della struttura delle amministrazioni.", exception);
        //				result = false;
        //			}
        //
        //			return result;
        //		}

        //		/// <summary>
        //		/// </summary>
        //		[WebMethod]
        //		public bool ExportDati()
        //		{
        //			bool result = true; // Presume successo
        //
        //			try
        //			{
        //				BusinessLogic.AmministrazioneXml20.ExporterXml exporterXml = new BusinessLogic.AmministrazioneXml20.ExporterXml();
        //
        //				if(result)
        //				{
        ////					result = exporterXml.ExportDati();
        //				}
        //			}
        //			catch(Exception exception)
        //			{
        //				logger.Debug("Errore durante l'esportazione dei dati", exception);
        //				result = false;
        //			}
        //
        //			return result;
        //		}

        //		/// <summary>
        //		/// </summary>
        //		[WebMethod]
        //		public bool ExporterGetCorrispondenti(int startPage, int rows, out int totalPages)
        //		{
        //			bool result = true; // Presume successo
        //			totalPages = 0;
        //
        //			try
        //			{
        //				BusinessLogic.AmministrazioneXml20.ExporterXml exporterXml = new BusinessLogic.AmministrazioneXml20.ExporterXml();
        //				exporterXml.ExportData_Corrispondenti(startPage, rows, out totalPages);
        //			}
        //			catch(Exception exception)
        //			{
        //				logger.Debug("Errore durante l'esportazione dei corrispondenti.", exception);
        //				result = false;
        //			}
        //
        //			return result;
        //		}

        //		/// <summary>
        //		/// </summary>
        //		[WebMethod]
        //		public int ExporterCountCorrispondenti()
        //		{
        //			int result = 0; 
        //
        //			try
        //			{
        //				BusinessLogic.AmministrazioneXml20.ExporterXml exporterXml = new BusinessLogic.AmministrazioneXml20.ExporterXml();
        //				result = exporterXml.ExportData_CountCorrispondenti();
        //			}
        //			catch(Exception exception)
        //			{
        //				logger.Debug("Errore durante la conta dei corrispondenti.", exception);
        //				result = -1;
        //			}
        //
        //			return result;
        //		}
        #endregion

        //		/// <summary>
        //		/// Ritorna i path dei file relativi ai documenti
        //		/// </summary>
        //		[WebMethod]
        //		public bool GetFilePathDocumenti(out string sourcePath, out string destinationPath)
        //		{
        //			bool result = true; // Presume successo 
        //			sourcePath = null;
        //			destinationPath = null;
        //
        //			try
        //			{
        //				BusinessLogic.AmministrazioneXml.ImporterXml importerXml = new BusinessLogic.AmministrazioneXml.ImporterXml();
        //				result = importerXml.GetFilePaths(out sourcePath, out destinationPath);
        //			}
        //			catch(Exception exception)
        //			{
        //				logger.Debug("Errore durante la restituzione dei path dei file relativi ai documenti.", exception);
        //				result = false;
        //			}
        //
        //			return result;
        //		}

        #region Metodi Commentati
        //		/// <summary>
        //		/// </summary>
        //		[WebMethod]
        //		public int ExporterCountDocumenti()
        //		{
        //			int result = 0; 
        //
        //			try
        //			{
        //				BusinessLogic.AmministrazioneXml20.ExporterXml exporterXml = new BusinessLogic.AmministrazioneXml20.ExporterXml();
        //				result = exporterXml.ExportData_CountDocumenti();
        //			}
        //			catch(Exception exception)
        //			{
        //				logger.Debug("Errore durante la conta dei documenti.", exception);
        //				result = -1;
        //			}
        //
        //			return result;
        //		}

        //		/// <summary>
        //		/// </summary>
        //		[WebMethod]
        //		public bool ExporterGetDocumenti(int startPage, int rows, out int totalPages)
        //		{
        //			bool result = true; // Presume successo
        //			totalPages = 0;
        //
        //			try
        //			{
        //				BusinessLogic.AmministrazioneXml20.ExporterXml exporterXml = new BusinessLogic.AmministrazioneXml20.ExporterXml();
        //				exporterXml.ExportData_Documenti(startPage, rows, out totalPages);
        //			}
        //			catch(Exception exception)
        //			{
        //				logger.Debug("Errore durante l'esportazione dei documenti.", exception);
        //				result = false;
        //			}
        //
        //			return result;
        //		}

        //		/// <summary>
        //		/// </summary>
        //		[WebMethod]
        //		public bool ExporterGetTipiAtto()
        //		{
        //			bool result = true; // Presume successo
        //			
        //			try
        //			{
        //				BusinessLogic.AmministrazioneXml20.ExporterXml exporterXml = new BusinessLogic.AmministrazioneXml20.ExporterXml();
        //				exporterXml.ExportData_TipiAtto();
        //			}
        //			catch(Exception exception)
        //			{
        //				logger.Debug("Errore durante l'esportazione dei tipi atto.", exception);
        //				result = false;
        //			}
        //
        //			return result;
        //		}

        //		/// <summary>
        //		/// </summary>
        //		[WebMethod]
        //		public bool ExporterGetTipiDocumento()
        //		{
        //			bool result = true; // Presume successo
        //			
        //			try
        //			{
        //				BusinessLogic.AmministrazioneXml20.ExporterXml exporterXml = new BusinessLogic.AmministrazioneXml20.ExporterXml();
        //				exporterXml.ExportData_TipiDocumento();
        //			}
        //			catch(Exception exception)
        //			{
        //				logger.Debug("Errore durante l'esportazione dei tipi documento.", exception);
        //				result = false;
        //			}
        //
        //			return result;
        //		}

        //		/// <summary>
        //		/// </summary>
        //		[WebMethod]
        //		public string ExporterGetRegistroByID(string idRegistro)
        //		{
        //			string result = null;
        //
        //			try
        //			{
        //				BusinessLogic.AmministrazioneXml20.ExporterXml exporterXml = new BusinessLogic.AmministrazioneXml20.ExporterXml();
        //				exporterXml.ExporterGetRegistroByID(idRegistro);
        //			}
        //			catch(Exception exception)
        //			{
        //				logger.Debug("Errore durante l'esportazione del registro", exception);
        //				result = null;
        //			}
        //
        //			return result;
        //		}

        //		/// <summary>
        //		/// </summary>
        //		[WebMethod]
        //		public bool ExporterGetAmministrazione(out System.Data.DataSet dataSet, string idAmm)
        //		{
        //			bool result = true;
        //			dataSet = null;
        //
        //			try
        //			{
        //				BusinessLogic.AmministrazioneXml20.ExporterXml exporterXml = new BusinessLogic.AmministrazioneXml20.ExporterXml();
        //				exporterXml.ExporterGetAmministrazione(out dataSet, idAmm);
        //			}
        //			catch(Exception exception)
        //			{
        //				logger.Debug("Errore durante l'esportazione del registro", exception);
        //				result = false;
        //			}
        //
        //			return result;
        //		}
        #endregion

        /// <summary>
        /// </summary>
        [WebMethod]
        public bool ImportCorrispondenti(string filePath)
        {
            bool result = true;

            try
            {
                BusinessLogic.AmministrazioneXml.ImporterXml importerXml = new BusinessLogic.AmministrazioneXml.ImporterXml();
                importerXml.ImportCorrispondenti(filePath);
            }
            catch (Exception exception)
            {
                logger.Debug("Errore durante l'importazione dei corrispondenti del documentale", exception);
                result = false;
            }

            return result;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public bool ImportDocumenti(string filePath)
        {
            bool result = true;

            try
            {
                BusinessLogic.AmministrazioneXml.ImporterXml importerXml = new BusinessLogic.AmministrazioneXml.ImporterXml();
                importerXml.ImportDocumenti(filePath);
            }
            catch (Exception exception)
            {
                logger.Debug("Errore durante l'importazione dei documenti del documentale", exception);
                result = false;
            }

            return result;
        }

        [WebMethod]
        public virtual bool importaOggettario(byte[] dati, string nomeFile, string codiceAmm, bool update, ref int oggInseriti, ref int oggAggiornati, ref int oggErrati)
        {
            try
            {
                //string serverPath = System.Configuration.ConfigurationManager.AppSettings["MODELS_ROOT_PATH"];
                // PALUMBO: modificato per ovviare al blocco dell'accesso su macchina 20 in scrittura    
                //string serverPath = System.Configuration.ConfigurationManager.AppSettings["LOG_PATH"];
                string serverPath = System.Configuration.ConfigurationManager.AppSettings["DOC_ROOT"];
                serverPath = System.IO.Path.Combine(serverPath, DateTime.Now.ToString("yyyyMMdd"));

                bool result = BusinessLogic.Oggettario.OggettarioManager.importaOggettario(dati, nomeFile, serverPath, codiceAmm, update, ref oggInseriti, ref oggAggiornati, ref oggErrati);
                return result;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: importaOggettario", e);
                return false;
            }
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public bool ImportOggettario(string filePath)
        {
            bool result = true;

            try
            {
                BusinessLogic.AmministrazioneXml.ImporterXml importerXml = new BusinessLogic.AmministrazioneXml.ImporterXml();
                importerXml.ImportOggettario(filePath);
            }
            catch (Exception exception)
            {
                logger.Debug("Errore durante l'importazione dell'oggettario", exception);
                result = false;
            }
            return result;
        }


        [WebMethod]
        public bool ImportStoricoOggettario(string filePath)
        {
            bool result = true;

            try
            {
                BusinessLogic.AmministrazioneXml.ImporterXml importerXml = new BusinessLogic.AmministrazioneXml.ImporterXml();
                importerXml.ImportStoricoOggettario(filePath);
            }
            catch (Exception ecc)
            {
                logger.Debug("Errore durante l'importazione dello storico oggettario", ecc);
                result = false;
            }
            return result;
        }


        /// <summary>
        /// </summary>
        [WebMethod]
        public bool ImportTipiAtto(string filePath)
        {
            bool result = true;

            try
            {
                BusinessLogic.AmministrazioneXml.ImporterXml importerXml = new BusinessLogic.AmministrazioneXml.ImporterXml();
                importerXml.ImportTipiAtto(filePath);
            }
            catch (Exception exception)
            {
                logger.Debug("Errore durante l'importazione dei tipi atto del documentale", exception);
                result = false;
            }

            return result;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public bool ImportTipiDocumento(string filePath)
        {
            bool result = true;

            try
            {
                BusinessLogic.AmministrazioneXml.ImporterXml importerXml = new BusinessLogic.AmministrazioneXml.ImporterXml();
                importerXml.ImportTipiDocumento(filePath);
            }
            catch (Exception exception)
            {
                logger.Debug("Errore durante l'importazione dei tipi documento del documentale", exception);
                result = false;
            }

            return result;
        }

        //[WebMethod]
        //public DocsPaVO.amministrazione.EsitoOperazione LoginAmministratore(string utente,string password, string sessionID) 
        //{						
        //    DocsPaVO.amministrazione.EsitoOperazione esito = new DocsPaVO.amministrazione.EsitoOperazione();

        //    try 
        //    {		
        //        esito = BusinessLogic.Amministrazione.AmministraManager.LoginAmministratore(utente,password,sessionID);
        //    }
        //    catch(Exception e) 
        //    {
        //        logger.Debug("Errore in DocsPaWS.asmx  - metodo: LoginAmministratore ",e);
        //        esito.Codice=1;
        //        esito.Descrizione="errore di sistema!";
        //    }

        //    return esito;
        //}

        [WebMethod]
        public DocsPaVO.amministrazione.EsitoOperazione LoginAmministratoreProfilato(DocsPaVO.utente.UserLogin userLogin, bool forceLogin, out DocsPaVO.amministrazione.InfoUtenteAmministratore datiAmministratore)
        {
            DocsPaVO.amministrazione.EsitoOperazione esito = new DocsPaVO.amministrazione.EsitoOperazione();
            datiAmministratore = null;
            SetUserId(userLogin.UserName);
            try
            {
                esito = BusinessLogic.Amministrazione.AmministraManager.LoginAmministratoreProfilato(userLogin, forceLogin, out datiAmministratore);
                if (esito.Codice == 0)
                    BusinessLogic.UserLog.UserLog.WriteLog(datiAmministratore, "AMM_LOGIN", datiAmministratore.idPeople, "Accesso ad amministrazione di " + datiAmministratore.userId + " da IP " + userLogin.IPAddress, DocsPaVO.Logger.CodAzione.Esito.OK);
                else
                {
                    if (datiAmministratore == null)
                    {
                        datiAmministratore = new InfoUtenteAmministratore();
                        datiAmministratore.idPeople = "0";
                        datiAmministratore.userId = userLogin.UserName;
                        datiAmministratore.idGruppo = "0";
                        datiAmministratore.idAmministrazione = "0";
                        datiAmministratore.delegato = null;
                    }
                    BusinessLogic.UserLog.UserLog.WriteLog(datiAmministratore, "AMM_LOGIN", datiAmministratore.idPeople, "Accesso ad amministrazione fallito di " + datiAmministratore.userId + " da IP " + userLogin.IPAddress, DocsPaVO.Logger.CodAzione.Esito.KO);
                }
            }
            catch (Exception e)
            {
                if (datiAmministratore == null)
                {
                    datiAmministratore = new InfoUtenteAmministratore();
                    datiAmministratore.idPeople = "0";
                    datiAmministratore.userId = userLogin.UserName;
                    datiAmministratore.idGruppo = "0";
                    datiAmministratore.idAmministrazione = "0";
                    datiAmministratore.delegato = null;
                }
                BusinessLogic.UserLog.UserLog.WriteLog(datiAmministratore, "AMM_LOGIN", datiAmministratore.idPeople, "Accesso ad amministrazione fallito di " + datiAmministratore.userId + " da IP " + userLogin.IPAddress, DocsPaVO.Logger.CodAzione.Esito.KO);
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: LoginAmministratoreProfilato ", e);
                esito.Codice = 1;
                esito.Descrizione = "errore di sistema!";
            }

            return esito;
        }

        //[WebMethod]
        //public DocsPaVO.amministrazione.EsitoOperazione UpdateLoginAmministrazione(string userid, string sessionID) 
        //{						
        //    DocsPaVO.amministrazione.EsitoOperazione esito = new DocsPaVO.amministrazione.EsitoOperazione();

        //    try 
        //    {		
        //        esito = BusinessLogic.Amministrazione.AmministraManager.UpdLoginAmm(userid,sessionID);
        //    }
        //    catch(Exception e) 
        //    {
        //        logger.Debug("Errore in DocsPaWS.asmx  - metodo: UpdateLoginAmministrazione ",e);
        //        esito.Codice=1;
        //        esito.Descrizione="errore di sistema!";
        //    }

        //    return esito;
        //}

        [WebMethod]
        public DocsPaVO.amministrazione.InfoAmministrazione GetInfoAmmAppartenenzaUtente(string userid, string pwd)
        {
            DocsPaVO.amministrazione.InfoAmministrazione result = new DocsPaVO.amministrazione.InfoAmministrazione();
            try
            {
                result = BusinessLogic.Amministrazione.AmministraManager.GetInfoAmmAppartenenzaUtente(userid, pwd);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetInfoAmmAppartenenzaUtente ", e);
            }
            return result;
        }

        [WebMethod]
        public bool LogoutAmministratore(DocsPaVO.amministrazione.InfoUtenteAmministratore adminUser)
        {
            SetUserId(adminUser);
            bool result = false;
            try
            {
                BusinessLogic.Amministrazione.AmministraManager manager = new BusinessLogic.Amministrazione.AmministraManager();
                result = manager.LogoutAmministratore(adminUser);
                if (result)
                    BusinessLogic.UserLog.UserLog.WriteLog(adminUser, "AMM_LOGOFF", adminUser.idPeople, "Uscita da amministrazione di " + adminUser.userId, DocsPaVO.Logger.CodAzione.Esito.OK);
                else
                    BusinessLogic.UserLog.UserLog.WriteLog(adminUser, "AMM_LOGOFF", adminUser.idPeople, "Uscita fallita da amministrazione di " + adminUser.userId, DocsPaVO.Logger.CodAzione.Esito.KO);
            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(adminUser, "AMM_LOGOFF", adminUser.idPeople, "Uscita fallita da amministrazione di " + adminUser.userId, DocsPaVO.Logger.CodAzione.Esito.KO);
                logger.Debug("Errore durante la Logout amministratore.", e);
            }

            return result;
        }

        [WebMethod]
        public bool AmmCheckSessionID(string sessionID)
        {
            bool result = false;
            try
            {
                BusinessLogic.Amministrazione.AmministraManager amministrazione = new BusinessLogic.Amministrazione.AmministraManager();
                result = amministrazione.CheckSessionID(sessionID);
            }
            catch (Exception e)
            {
                logger.Debug("Errore durante il controllo SessionID amministratore.", e);
            }

            return result;
        }


        [WebMethod]
        public bool CambiaPwdAmministratore(string utente, string password)
        {
            bool result = false;
            SetUserId(utente);
            try
            {
                BusinessLogic.AmministrazioneXml.AmministrazioniXml amministrazione = new BusinessLogic.AmministrazioneXml.AmministrazioniXml();

                return amministrazione.ChangeAdminPwd(utente, password);
            }
            catch (Exception e)
            {
                logger.Debug("Errore durante il cambio password amministratore.", e);
            }

            return result;
        }

        #endregion

        [WebMethod]
        public virtual string GetDKPath(string docNumber)
        {
            try
            {
                return BusinessLogic.Documenti.DocManager.getDKPath(docNumber);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getDKPath", e);
                return null;
            }
        }

        [WebMethod]
        public virtual string GetIdDK(string collid)
        {
            try
            {
                return BusinessLogic.Documenti.DocManager.getIdDK(collid);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getIdDK", e);
                return null;
            }
        }



        /*
        [Serializable]
            public class login : MarshalByRefObject 
        {
            public string userName;
            public string password;
            public string idAmministrazione;
            public string dominio;
            public bool update=false;
        }
        */

        #region  REGISTRO EMERGENZA

        [WebMethod(MessageName = "login")]
        public virtual DocsPaVO.utente.Utente LoginRDE(DocsPaVO.utente.Login login)
        {
            DocsPaVO.utente.Utente utente = null;
            try
            {
                SetUserId(login.userName);
                DocsPaVO.utente.UserLogin userLogin = new DocsPaVO.utente.UserLogin(login.userName,
                    login.password,
                    login.idAmministrazione,
                    login.dominio,
                    null,
                    login.update);

                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                DocsPaVO.utente.UserLogin.LoginResult loginResult;
                string ipaddress = "";
                utente = BusinessLogic.Utenti.Login.loginMethod(userLogin, out loginResult, true,
                    null, out ipaddress);

#if TRACE_WS
				pt.WriteLogTracer("Login");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore durante la Login.", e);
                utente = null;
            }

            return utente;
        }

        #endregion

        [WebMethod]
        public virtual DocsPaVO.utente.UserLogin VerificaUtente(string userName)
        {
            SetUserId(userName);
            DocsPaVO.utente.UserLogin userLogin;

            try
            {
                userLogin = BusinessLogic.Utenti.Login.VerificaUtente(userName);
                if (userLogin == null) throw new Exception("Errore durante la validazione dell'utente");
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: VerificaUtente", e);
                return null;
            }
            return userLogin;
        }


        [WebMethod]
        public virtual bool VerificaRuoloAutorizzato(string idRuolo, string idRegistro)
        {
            bool result = false;
            try
            {
                result = BusinessLogic.Utenti.addressBookManager.VerificaAutorizzazioneRuolo(idRuolo, idRegistro);

            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: VerificaRuoloAutorizzato", e);
            }
            return result;
        }


        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.utente.Ruolo))]
        public virtual ArrayList GetListaRuoliUtente(string idPeople)
        {
            ArrayList listaRuoli = null;
            try
            {
                listaRuoli = BusinessLogic.Utenti.UserManager.getRuoliUtente(idPeople);

            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetListaRuoliUtente", e);
            }
            return listaRuoli;
        }

        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.utente.Ruolo))]
        public virtual ArrayList GetListaRuoliUtenteByIdCorr(string idCorr)
        {
            ArrayList listaRuoli = null;
            try
            {
                listaRuoli = BusinessLogic.Utenti.UserManager.getRuoliUtenteByIdCorr(idCorr);

            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetListaRuoliUtenteByIdCorr", e);
            }
            return listaRuoli;
        }

        #region Prospetti Riepilogativi
        #region DO_GetConnectionString
        [WebMethod]
        public virtual string DO_GetConnectionString()
        {
            string connString = "";
            try
            {
                connString = System.Configuration.ConfigurationManager.AppSettings["connectionString"];
                return connString;
            }
            catch (Exception ex)
            {
                logger.Debug("Errore nel recupero della connectionString - metodo: DO_GetConnectionString", ex);
                return connString;
            }
        }
        #endregion

        #region DO_GetDBType
        [WebMethod]
        public virtual string DO_GetDBType()
        {
            string DBType = "";
            try
            {
                DBType = System.Configuration.ConfigurationManager.AppSettings["DBType"];
                return DBType;
            }
            catch (Exception ex)
            {
                logger.Debug("Errore nel recupero della connectionString - metodo: DO_GetDBType", ex);
                return DBType;
            }
        }
        #endregion

        #region DO_GetAmministrazioni
        [WebMethod]
        public virtual ArrayList DO_GetAmministrazioni()
        {
            ArrayList result = new ArrayList();
            try
            {
                ProspettiRiepilogativi.Model objM = new ProspettiRiepilogativi.Model();
                result = objM.DO_GetAmministrazioni();
            }
            catch (Exception ex)
            {
                logger.Debug("Errore nel recupero della connectionString - metodo: DO_GetDBType", ex);
            }
            return result;
        }
        #endregion

        #region DO_GetRegistri
        [WebMethod]
        public virtual ArrayList DO_GetRegistri(int idAmm)
        {
            ArrayList result = new ArrayList();
            try
            {
                ProspettiRiepilogativi.Model objM = new ProspettiRiepilogativi.Model();
                result = objM.DO_GetRegistri(idAmm);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore nel recupero della connectionString - metodo: DO_GetDBType", ex);
            }
            return result;
        }
        #endregion

        #region DO_GetAnniProfilazione
        [WebMethod]
        public virtual ArrayList DO_GetAnniProfilazione(int idReg)
        {
            ArrayList result = new ArrayList();
            try
            {
                ProspettiRiepilogativi.Model objM = new ProspettiRiepilogativi.Model();
                result = objM.DO_GetAnniProfilazione(idReg);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore nel recupero della connectionString - metodo: DO_GetDBType", ex);
            }
            return result;
        }
        #endregion

        #region DO_GetSedi
        [WebMethod]
        public virtual ArrayList DO_GetSedi()
        {
            ArrayList result = new ArrayList();
            try
            {
                ProspettiRiepilogativi.Model objM = new ProspettiRiepilogativi.Model();
                result = objM.DO_GetSedi();
            }
            catch (Exception ex)
            {
                logger.Debug("Errore nel recupero della connectionString - metodo: DO_GetDBType", ex);
            }
            return result;
        }
        #endregion

        #region DO_GetIdAmmByCodAmm
        [WebMethod]
        public virtual int DO_GetIdAmmByCodAmm(string codAmm)
        {
            int result = 0;
            try
            {
                ProspettiRiepilogativi.Model objM = new ProspettiRiepilogativi.Model();
                result = objM.DO_GetIdAmmByCodice(codAmm);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore nel recupero della connectionString - metodo: DO_GetDBType", ex);
            }
            return result;
        }
        #endregion

        #region Do_GetVarDescAmmByIdAmm
        [WebMethod]
        public virtual string Do_GetVarDescAmmByIdAmm(int idAmm)
        {
            string result = "";
            try
            {
                ProspettiRiepilogativi.Model objM = new ProspettiRiepilogativi.Model();
                result = objM.DO_GetVarDescAmmById(idAmm);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore nel recupero della connectionString - metodo: DO_GetDBType", ex);
            }
            return result;
        }
        #endregion

        #region Do_GetAmmByIdAmm
        [WebMethod]
        public virtual ProspettiRiepilogativi.PR_Amministrazione Do_GetAmmByIdAmm(int idAmm)
        {
            ProspettiRiepilogativi.PR_Amministrazione result = new ProspettiRiepilogativi.PR_Amministrazione();
            try
            {
                ProspettiRiepilogativi.Model objM = new ProspettiRiepilogativi.Model();
                result = objM.DO_GetAmmById(idAmm);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore nel recupero della connectionString - metodo: DO_GetDBType", ex);
            }
            return result;
        }
        #endregion

        #region DO_GetDescRegistro
        [WebMethod]
        public virtual string DO_GetDescRegistro(string idReg)
        {
            string result = "";
            try
            {
                ProspettiRiepilogativi.Model objM = new ProspettiRiepilogativi.Model();
                result = objM.DO_GetDescReg(idReg);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore nel recupero della connectionString - metodo: DO_GetDBType", ex);
            }
            return result;
        }
        #endregion

        #region Do_GetTitolari
        [WebMethod]
        [XmlInclude(typeof(ProspettiRiepilogativi.PR_Titolario))]
        public virtual ArrayList DO_GetTitolari(int idAmm)
        {
            ArrayList result = new ArrayList();
            try
            {
                ProspettiRiepilogativi.Model objM = new ProspettiRiepilogativi.Model();
                result = objM.DO_GetTitolari(idAmm);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore nel recupero della connectionString - metodo: DO_GetTitolari", ex);
            }
            return result;
        }
        #endregion

        #region DO_GetNumDocSpediti
        [WebMethod]
        public virtual string DO_GetNumDocSpediti(string dataSpedDa, string dataSpedA, string idReg, string confermaProt, int idAmm)
        {

            using (DocsPaDB.TransactionContext transactionContext = new DocsPaDB.TransactionContext())
            {
                string result = string.Empty;
                try
                {
                    ProspettiRiepilogativi.Model objM = new ProspettiRiepilogativi.Model();
                    result = objM.DO_GetNumDocSpediti(dataSpedDa, dataSpedA, idReg, confermaProt, idAmm);
                    transactionContext.Complete();

                }
                catch (Exception ex)
                {
                    logger.Debug("Errore nel recupero della connectionString - metodo: DO_GetNumDocSpediti", ex);
                }
                return result;
            }
        }
        #endregion

        #region DO_ReadXML
        [WebMethod]
        public virtual ArrayList DO_ReadXML()
        {
            ArrayList result = new ArrayList();
            try
            {
                string xmlPath = Server.MapPath("XML/rapporti.xml");
                ProspettiRiepilogativi.ReaderXML _r = new ProspettiRiepilogativi.ReaderXML(xmlPath);
                result = _r.DO_ReadXML();
            }
            catch (Exception ex)
            {
                logger.Debug("Errore nel recupero della connectionString - metodo: DO_GetDBType", ex);
            }
            return result;
        }
        #endregion

        #region DO_AddSubReport
        [WebMethod]
        public virtual ProspettiRiepilogativi.Report DO_AddSubReport(ProspettiRiepilogativi.Report report, ProspettiRiepilogativi.Report subReport)
        {
            try
            {
                report.DO_AddSubReport(subReport);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore nel recupero della connectionString - metodo: DO_GetDBType", ex);
            }
            return report;
        }
        #endregion

        #region DO_NewReport
        [WebMethod]
        public virtual ProspettiRiepilogativi.Report DO_NewReport(string descrizione, string valore)
        {
            try
            {
                ProspettiRiepilogativi.Report _r = new ProspettiRiepilogativi.Report(descrizione, valore);
                return _r;
            }
            catch (Exception ex)
            {
                logger.Debug("Errore nel recupero della connectionString - metodo: DO_GetDBType", ex);
                return null;
            }

        }
        #endregion

        #region DO_NewRegistro
        [WebMethod]
        public virtual ProspettiRiepilogativi.PR_Registro DO_NewRegistro(string system_id, string codice, string descrizione)
        {
            try
            {
                ProspettiRiepilogativi.PR_Registro _r = new ProspettiRiepilogativi.PR_Registro(system_id, codice, descrizione);
                return _r;
            }
            catch (Exception ex)
            {
                logger.Debug("Errore nel recupero della connectionString - metodo: DO_GetDBType", ex);
                return null;
            }

        }
        #endregion

        #region DO_NewAmministrazione
        [WebMethod]
        public virtual ProspettiRiepilogativi.PR_Amministrazione DO_NewAmministrazione(string system_id, string codice, string descrizione, string libreria)
        {
            try
            {
                ProspettiRiepilogativi.PR_Amministrazione _r = new ProspettiRiepilogativi.PR_Amministrazione(system_id, codice, descrizione, libreria);
                return _r;
            }
            catch (Exception ex)
            {
                logger.Debug("Errore nel recupero della connectionString - metodo: DO_NewAmministrazione", ex);
                return null;
            }

        }
        #endregion

        #region Blank Object
        [WebMethod]
        public virtual ProspettiRiepilogativi.Parametro DO_GetEmptyParametro()
        {
            ProspettiRiepilogativi.Parametro _p = new ProspettiRiepilogativi.Parametro();
            return _p;
        }

        [WebMethod]
        public virtual ProspettiRiepilogativi.PR_Registro DO_GetEmptyRegitro()
        {
            ProspettiRiepilogativi.PR_Registro _p = new ProspettiRiepilogativi.PR_Registro();
            return _p;
        }

        [WebMethod]
        public virtual ProspettiRiepilogativi.Report DO_GetEmptyReport()
        {
            ProspettiRiepilogativi.Report _p = new ProspettiRiepilogativi.Report();
            return _p;
        }

        #endregion

        #region Recupero Dati

        #region DO_GetDSReportAnnualeByReg
        [WebMethod]
        public virtual DataSet DO_GetDSReportAnnualeByReg(int id_amm, int idReg, int anno, int mese, string sede, bool simpleSP, int titolario)
        {
            DataSet result = new DataSet();
            try
            {
                ProspettiRiepilogativi.Model objM = new ProspettiRiepilogativi.Model();
                result = objM.DO_GetDSReportAnnualeByReg(id_amm, idReg, anno, mese, sede, simpleSP, titolario);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore nel recupero della connectionString - metodo: DO_GetDSReportAnnualeByReg", ex);
            }
            return result;
        }
        #endregion

        #region DO_GetDSReportDocClass
        [WebMethod]
        public virtual DataSet DO_GetDSReportDocClass(int idReg, int anno, int idamm, string sede, int titolario)
        {
            DataSet result = new DataSet();
            try
            {
                ProspettiRiepilogativi.Model objM = new ProspettiRiepilogativi.Model();
                result = objM.DO_GetDSReportDocClass(idReg, anno, idamm, sede, titolario);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore nel recupero della connectionString - metodo: DO_GetDSReportDocClass", ex);
            }
            return result;
        }
        #endregion

        #region DO_GetDSReportDocClassCompact
        [WebMethod]
        public virtual DataSet DO_GetDSReportDocClassCompact(int idReg, int anno, int idamm, string sede, int titolario)
        {
            DataSet result = new DataSet();
            try
            {
                ProspettiRiepilogativi.Model objM = new ProspettiRiepilogativi.Model();
                result = objM.DO_GetDSReportDocClassCompact(idReg, anno, idamm, sede, titolario);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore nel recupero della connectionString - metodo: DO_GetDSReportDocClassCompact", ex);
            }
            return result;
        }

        [WebMethod]
        public virtual string DO_GetCountReportDocClassCompact(int idReg, int anno, int idamm, string sede, int titolario)
        {

            using (DocsPaDB.TransactionContext transactionContext = new DocsPaDB.TransactionContext())
            {
                string result = string.Empty;
                try
                {
                    ProspettiRiepilogativi.Model objM = new ProspettiRiepilogativi.Model();
                    // il result al momento funziona solo per ORACLE
                    result = objM.DO_GetCountReportDocClassCompact(idReg, anno, idamm, sede, titolario);
                    transactionContext.Complete();

                }
                catch (Exception ex)
                {
                    logger.Debug("Errore nel recupero della connectionString - metodo: DO_GetCountReportDocClassCompact", ex);
                }
                return result;
            }
        }

        [WebMethod]
        public virtual string DO_GetCountDistinctReportDocClassCompact(int idReg, int anno, int idAmm, string sede, int titolario)
        {
            using (DocsPaDB.TransactionContext transactionContext = new DocsPaDB.TransactionContext())
            {
                string result = string.Empty;
                try
                {
                    ProspettiRiepilogativi.Model objM = new ProspettiRiepilogativi.Model();
                    // il result al momento funziona solo per ORACLE
                    result = objM.DO_GetCountDistinctReportDocClassCompact(idReg, anno, idAmm, sede, titolario);
                    transactionContext.Complete();
                }
                catch (Exception ex)
                {
                    logger.Debug("Errore nel recupero della connectionString - metodo: DO_GetCountDistinctReportDocClassCompact", ex);
                }
                return result;
            }
        }

        #endregion

        #region DO_GetDSReportDocTrasmToAOO
        [WebMethod]
        public virtual DataSet DO_GetDSReportDocTrasmToAOO(int idReg, int anno, int idAmm)
        {
            DataSet result = new DataSet();
            try
            {
                ProspettiRiepilogativi.Model objM = new ProspettiRiepilogativi.Model();
                result = objM.DO_GetDSReportDocTrasmToAOO(idReg, anno, idAmm);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore nel recupero della connectionString - metodo: DO_GetDSReportDocTrasmToAOO", ex);
            }
            return result;
        }

        [WebMethod]
        public virtual string DO_GetCountReportDocTrasmToAOO(int idReg, int anno, int idAmm)
        {
            string result = string.Empty;
            try
            {
                ProspettiRiepilogativi.Model objM = new ProspettiRiepilogativi.Model();
                // il result al momento funziona solo per ORACLE
                result = objM.DO_GetCountReportDocTrasmToAOO(idReg, anno, idAmm);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore in DocsPaWS.asmx - metodo: DO_GetDSReportDocTrasmToAOO", ex);
            }
            return result;
        }

        #endregion

        #region DO_GetDSReportFascicoliPerVT
        [WebMethod]
        public virtual DataSet DO_GetDSReportFascicoliPerVT(int idAmm, int idReg, int anno, int mese, int titolario)
        {
            DataSet result = new DataSet();
            try
            {
                ProspettiRiepilogativi.Model objM = new ProspettiRiepilogativi.Model();
                result = objM.DO_GetDSReportFascicoliPerVT(idAmm, idReg, anno, mese, titolario);
            }
            catch (Exception ex)
            {
                logger.Error("Errore nel recupero della connectionString - metodo: DO_GetDSReportFascicoliPerVT", ex);
            }
            return result;
        }
        #endregion

        #region DO_GetDSReportFascicoliPerVTCompact
        [WebMethod]
        public virtual DataSet DO_GetDSReportFascicoliPerVTCompact(int idAmm, int idReg, int anno, int mese, int titolario)
        {
            DataSet result = new DataSet();
            try
            {
                ProspettiRiepilogativi.Model objM = new ProspettiRiepilogativi.Model();
                result = objM.DO_GetDSReportFascicoliPerVTCompact(idAmm, idReg, anno, mese, titolario);
            }
            catch (Exception ex)
            {
                logger.Error("Errore nel recupero della connectionString - metodo: DO_GetDSReportFascicoliPerVTCompact", ex);
            }
            return result;
        }
        #endregion

        #region DO_GetDSReportAnnualeByFasc
        [WebMethod]
        public virtual DataSet DO_GetDSReportAnnualeByFasc(int idAmm, int idReg, int anno, int mese, int titolario, bool simpleSP)
        {
            DataSet result = new DataSet();
            try
            {
                ProspettiRiepilogativi.Model objM = new ProspettiRiepilogativi.Model();
                result = objM.DO_GetDSReportAnnualeByFasc(idAmm, idReg, anno, mese, titolario, simpleSP);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore nel recupero della connectionString - metodo: DO_GetDSReportAnnualeByFasc", ex);
            }
            return result;
        }
        #endregion

        #region DO_GetDSTempiMediLavorazione
        [WebMethod]
        public virtual DataSet DO_GetDSTempiMediLavorazione(int idAmm, int idReg, int anno, int mese, int titolario)
        {
            DataSet result = new DataSet();
            try
            {
                ProspettiRiepilogativi.Model objM = new ProspettiRiepilogativi.Model();
                result = objM.DO_GetDSTempiMediLavorazione(idAmm, idReg, anno, mese, titolario);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore nel recupero della connectionString - metodo: DO_GetDSTempiMediLavorazione", ex);
            }
            return result;
        }
        #endregion

        #region DO_GetDSTempiMediLavorazioneCompact
        [WebMethod]
        public virtual DataSet DO_GetDSTempiMediLavorazioneCompact(int idAmm, int idReg, int anno, int mese, int titolario)
        {
            DataSet result = new DataSet();
            try
            {
                ProspettiRiepilogativi.Model objM = new ProspettiRiepilogativi.Model();
                result = objM.DO_GetDSTempiMediLavorazioneCompact(idAmm, idReg, anno, mese, titolario);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore nel recupero della connectionString - metodo: DO_GetDSTempiMediLavorazioneCompact", ex);
            }
            return result;
        }
        #endregion

        #region DO_GetDSReportDocXSede
        [WebMethod]
        public virtual DataSet DO_GetDSReportDocXSede(int idAmm, int idReg, int anno, int idPeople, string timeStamp)
        {
            DataSet result = new DataSet();
            try
            {
                ProspettiRiepilogativi.Model objM = new ProspettiRiepilogativi.Model();
                result = objM.DO_GetDSReportDocXSede(idAmm, idReg, anno, idPeople, timeStamp);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore nel recupero della connectionString - metodo: DO_GetDSReportDocXSede", ex);
            }
            return result;
        }
        #endregion

        #region DO_GetDSReportDocXUo
        [WebMethod]
        public virtual DataSet DO_GetDSReportDocXUo(int idAmm, int idReg, int anno)
        {
            DataSet result = new DataSet();
            try
            {
                ProspettiRiepilogativi.Model objM = new ProspettiRiepilogativi.Model();
                result = objM.DO_GetDSReportDocXUo(idAmm, idReg, anno);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore nel recupero della connectionString - metodo: DO_GetDSReportDocXUo", ex);
            }
            return result;
        }
        #endregion

        #region DO_GetDSReportContatoriDoc
        [WebMethod]
        public virtual DataSet DO_GetDSReportContatoriDoc(int idAmm, int anno)
        {
            DataSet result = new DataSet();
            try
            {
                ProspettiRiepilogativi.Model objM = new ProspettiRiepilogativi.Model();
                result = objM.DO_GetDSReportContatoriDocumento(idAmm, anno);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore nel recupero della connectionString - metodo: DO_GetDSReportContatoriDoc", ex);
            }
            return result;
        }
        #endregion

        #region DO_GetDSReportContatoriFasc
        [WebMethod]
        public virtual DataSet DO_GetDSReportContatoriFasc(int idAmm, int anno)
        {
            DataSet result = new DataSet();
            try
            {
                ProspettiRiepilogativi.Model objM = new ProspettiRiepilogativi.Model();
                result = objM.DO_GetDSReportContatoriFascicolo(idAmm, anno);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore nel recupero della connectionString - metodo: DO_GetDSReportContatoriFascicolo", ex);
            }
            return result;
        }
        #endregion

        #region DO_GetDSReportProtocolloArma
        [WebMethod]
        public virtual DataSet DO_GetDSReportProtocolloArma(string idRegistro, int idTitolario, int idAmm)
        {
            DataSet result = new DataSet();
            try
            {
                ProspettiRiepilogativi.Model objM = new ProspettiRiepilogativi.Model();
                result = objM.DO_GetDSReportProtocolloArma(idRegistro, idTitolario, idAmm);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore nel recupero della connectionString - metodo: DO_GetDSReportProtocolloArma", ex);
            }
            return result;
        }
        #endregion

        #region DO_GetDSReportDettaglioPratica
        [WebMethod]
        public virtual DataSet DO_GetDSReportDettaglioPratica(string idRegistro, int idTitolario, int numPratica, int idAmm)
        {
            DataSet result = new DataSet();
            try
            {
                ProspettiRiepilogativi.Model objM = new ProspettiRiepilogativi.Model();
                result = objM.DO_GetDSReportDettaglioPratica(idRegistro, idTitolario, numPratica, idAmm);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore nel recupero della connectionString - metodo: DO_GetDSReportDettaglioPratica", ex);
            }
            return result;
        }
        #endregion

        #region DO_GetDSReportGiornaleRiscontri
        [WebMethod]
        public virtual DataSet DO_GetDSReportGiornaleRiscontri(string idRegistro, int idAmm)
        {
            DataSet result = new DataSet();
            try
            {
                ProspettiRiepilogativi.Model objM = new ProspettiRiepilogativi.Model();
                result = objM.DO_GetDSReportGiornaleRegistri(idRegistro, idAmm);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore nel recupero della connectionString - metodo: DO_GetDSReportGiornaleRiscontri", ex);
            }
            return result;
        }
        #endregion

        #region DO_GetDSReportDocSpeditiInterop
        [WebMethod]
        public virtual DataSet DO_GetDSReportDocSpeditiInterop(int idAmm, string idRegistro, string dataSpedDa, string dataSpedA, string confermaProt)
        {
            DataSet result = new DataSet();
            try
            {
                ProspettiRiepilogativi.Model objM = new ProspettiRiepilogativi.Model();
                result = objM.DO_GetDSReportDocSpeditiInterop(idAmm, idRegistro, dataSpedDa, dataSpedA, confermaProt);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore nel recupero della connectionString - metodo: DO_GetDSReportDocSpeditiInterop", ex);
            }
            return result;
        }
        #endregion

        #endregion




        #endregion

        #region	Test
        //		[WebMethod]
        //		public void ImportDocumentiCSF(string FileCSF,string RootDocumenti,string user,string password,string idAmm,string idRuolo)
        //		{
        //			//BusinessLogic.Documenti.DocSave.test_InsertDoc("1058","mrossi","pwd","1178","oggetto-test","C:\\","test.txt","1|2004|1","FOLDER2");
        //			BusinessLogic.Documenti.DocSave.ImportDocCSF(FileCSF,RootDocumenti,user,password,idAmm,idRuolo);
        //		}

        //		[WebMethod]
        //		public int TestSP() 
        //		{
        //			DocsPaDbManagement.Database.Database db = new DocsPaDbManagement.Database.Database();
        //			ArrayList param = new ArrayList();
        //			param.Add(new DocsPaUtils.Data.ParameterSP("cod", "1.1"));
        //			return db.ExecuteStoreProcedure("EXIST_COLL", param);
        //		}

        #endregion

        #region gestione TITOLARIO in Amm.ne (gadamo)

        [WebMethod]
        public string NodoTitolario(string codAmm, string idParent)
        {
            string result = "";
            try
            {
                BusinessLogic.AmministrazioneXml.TitolarioXml obj = new BusinessLogic.AmministrazioneXml.TitolarioXml();
                result = obj.NodoTit(codAmm, idParent);
            }
            catch (Exception exception)
            {
                logger.Debug("Errore nel metodo WS NodoTitolario: ", exception);
            }

            return result;
        }

        [WebMethod]
        public string NodoTitolarioSecurity(string idAmm, string idParent, string idGruppo, string idRegistro, string idTitolario)
        {
            string result = "";
            try
            {
                BusinessLogic.AmministrazioneXml.TitolarioXml obj = new BusinessLogic.AmministrazioneXml.TitolarioXml();
                result = obj.NodoTitSecurity(idAmm, idParent, idGruppo, idRegistro, idTitolario);
            }
            catch (Exception exception)
            {
                logger.Debug("Errore nel metodo WS NodoTitolarioSecurity: ", exception);
            }

            return result;
        }

        [WebMethod]
        public string RegistriInAmm(string codAmm)
        {
            string result = "";
            try
            {
                BusinessLogic.AmministrazioneXml.TitolarioXml obj = new BusinessLogic.AmministrazioneXml.TitolarioXml();
                result = obj.registriInAmm(codAmm);
            }
            catch (Exception exception)
            {
                logger.Debug("Errore nel metodo WS RegistriInAmm: ", exception);
            }
            return result;
        }

        [WebMethod]
        public string RegistriInAmmRestricted(string sessionID)
        {
            string result = "";
            try
            {
                BusinessLogic.AmministrazioneXml.TitolarioXml obj = new BusinessLogic.AmministrazioneXml.TitolarioXml();
                result = obj.registriInAmmRestricted(sessionID);
            }
            catch (Exception exception)
            {
                logger.Debug("Errore nel metodo WS RegistriInAmmRestricted: ", exception);
            }
            return result;
        }

        [WebMethod]
        public string SecurityNodoRuoli(string idNodo, string codAmm)
        {
            string result = "";
            try
            {
                BusinessLogic.AmministrazioneXml.TitolarioXml obj = new BusinessLogic.AmministrazioneXml.TitolarioXml();
                result = obj.securityNodoRuoli(idNodo, codAmm);
            }
            catch (Exception exception)
            {
                logger.Debug("Errore nel metodo WS SecurityNodoRuoli: ", exception);
            }
            return result;
        }

        [WebMethod]
        public string filtroRicercaTit(string codice, string descrizione, string idAmm)
        {
            string result = "";
            try
            {
                BusinessLogic.AmministrazioneXml.TitolarioXml obj = new BusinessLogic.AmministrazioneXml.TitolarioXml();
                result = obj.filtroRicTit(codice, descrizione, idAmm);
            }
            catch (Exception exception)
            {
                logger.Debug("Errore nel metodo WS filtroRicercaTit: ", exception);
            }
            return result;
        }


        [WebMethod]
        public string filtroRicercaTitDocspa(string codice, string descrizione, string note, string indice, string idAmm, string idGruppo, string idRegistro, string idTitolario)
        {
            string result = "";
            try
            {
                BusinessLogic.Fascicoli.TitolarioManager obj = new BusinessLogic.Fascicoli.TitolarioManager();
                result = obj.filtroRicTitDocspa(codice, descrizione, note, indice, idAmm, idGruppo, idRegistro, idTitolario);
            }
            catch (Exception exception)
            {
                logger.Debug("Errore nel metodo WS filtroRicercaTitAmm: ", exception);
            }
            return result;
        }

        [WebMethod]
        public string filtroRicercaTitAmm(string codice, string descrizione, string codAmm, string idRegistro)
        {
            string result = "";
            try
            {
                BusinessLogic.AmministrazioneXml.TitolarioXml obj = new BusinessLogic.AmministrazioneXml.TitolarioXml();
                result = obj.filtroRicTitAmm(codice, descrizione, codAmm, idRegistro);
            }
            catch (Exception exception)
            {
                logger.Debug("Errore nel metodo WS filtroRicercaTitAmm: ", exception);
            }
            return result;
        }

        [WebMethod]
        public string findNodoRoot(string idrecord, string idparent, int livello)
        {
            string result = "";
            try
            {
                BusinessLogic.AmministrazioneXml.TitolarioXml obj = new BusinessLogic.AmministrazioneXml.TitolarioXml();
                result = obj.cercaNodoRoot(idrecord, idparent, livello);
            }
            catch (Exception exception)
            {
                logger.Debug("Errore nel metodo WS findNodoRoot: ", exception);
            }
            return result;
        }

        [WebMethod]
        public string findNodoByCod(string codClass, string idAmm, string idReg, string idTitolario)
        {
            string result = "";
            try
            {
                BusinessLogic.AmministrazioneXml.TitolarioXml obj = new BusinessLogic.AmministrazioneXml.TitolarioXml();
                result = obj.cercaNodoByCod(codClass, idAmm, idReg, idTitolario);
            }
            catch (Exception exception)
            {
                logger.Debug("Errore nel metodo WS findNodoByCod: ", exception);
            }
            return result;
        }

        [WebMethod]
        public string AggNewNodo(
            string padre,
            string codice,
            string descrizione,
            string idregistro,
            string livello,
            string codAmm,
            string codliv,
            string r_w)
        {
            string result;
            /*
             * possibili valori di ritorno:
             * "0" = tutto ok
             * "1" = codice gi presente!	
             * "9" = errore di sistema		 		
            */
            try
            {
                BusinessLogic.AmministrazioneXml.TitolarioXml obj = new BusinessLogic.AmministrazioneXml.TitolarioXml();
                result = obj.AggiungeNewNodo(padre, codice, descrizione, idregistro, livello, codAmm, codliv, r_w);
            }
            catch (Exception exception)
            {
                logger.Debug("Errore nel metodo WS AggNewNodo: ", exception);
                result = "9";
            }
            return result;
        }

        [WebMethod]
        public string EliminaNodo(string idrecord)
        {
            string result;
            /*
             * possibili valori di ritorno:
             * "0" = tutto ok
             * "1" = presenti fascicoli procedimentali	
             * "2" = presenti documenti in root folder			 
             * "9" = errore di sistema		 		
            */
            try
            {
                BusinessLogic.AmministrazioneXml.TitolarioXml obj = new BusinessLogic.AmministrazioneXml.TitolarioXml();
                result = obj.DeleteNodo(idrecord);
            }
            catch (Exception exception)
            {
                logger.Debug("Errore nel metodo WS EliminaNodo: ", exception);
                result = "9";
            }
            return result;
        }

        [WebMethod]
        public string GetCodLiv(string codliv, string livello, string codAmm, string idTitolario, string idRegistro)
        {
            string result = "";
            try
            {
                BusinessLogic.AmministrazioneXml.TitolarioXml obj = new BusinessLogic.AmministrazioneXml.TitolarioXml();
                result = obj.getCodLiv(codliv, livello, codAmm, idTitolario, idRegistro);
            }
            catch (Exception exception)
            {
                logger.Debug("Errore nel metodo WS GetCodLiv: ", exception);
            }
            return result;
        }

        [WebMethod]
        public string SpostaNodoTitolario(string currentCodLiv, string newCodLiv, string codAmm, string idRegistro)
        {
            string result;
            try
            {
                BusinessLogic.AmministrazioneXml.TitolarioXml obj = new BusinessLogic.AmministrazioneXml.TitolarioXml();
                result = obj.spostaNodoTit(currentCodLiv, newCodLiv, codAmm, idRegistro);
            }
            catch (Exception exception)
            {
                logger.Debug("Errore nel metodo WS SpostaNodoTitolario: ", exception);
                result = "9";
            }
            return result;
        }

        #endregion

        #region Gestione Smistamento Documenti

        /// <summary>
        /// Reperimento dei SystemID delle trasmissioni ricevute da un utente (ToDoList)
        /// </summary>
        /// <param name="infoUtente">Contesto utente</param>
        /// <returns></returns>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.Smistamento.DatiTrasmissioneDocumento))]
        public virtual ArrayList GetListDocumentiTrasmessi(DocsPaVO.Smistamento.MittenteSmistamento mittente)
        {
            ArrayList retValue = new ArrayList();

            try
            {
                retValue = BusinessLogic.SmistamentoDocumenti.SmistamentoManager.GetListDocumentiTrasmessi(mittente);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetListDocumentiTrasmessi - ", e);
            }

            return retValue;
        }

        /// <summary>
        /// Reperimento dei SystemID delle trasmissioni ricevute da un utente (ToDoList)
        /// </summary>
        /// <param name="infoUtente">Contesto utente</param>
        /// <param name="mittente"></param>
        /// <param name="filtriRicerca">Filtri di ricerca</param>
        /// <returns></returns>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.Smistamento.DatiTrasmissioneDocumento))]
        public virtual ArrayList GetListDocumentiTrasmessiFilters(DocsPaVO.Smistamento.MittenteSmistamento mittente, DocsPaVO.filtri.FiltroRicerca[] filtriRicerca)
        {
            ArrayList retValue = new ArrayList();

            try
            {
                retValue = BusinessLogic.SmistamentoDocumenti.SmistamentoManager.GetListDocumentiTrasmessi(mittente, filtriRicerca);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetListDocumentiTrasmessiFilters - ", e);
            }

            return retValue;
        }

        /// <summary>
        /// Restituzione di un oggetto di tipo "DocumentoTrasmesso"
        /// </summary>
        /// <param name="idDocumento"></param>
        /// <param name="infoUtente"></param>
        /// <param name="content"></param>
        /// <param name="pdfConverted"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual DocsPaVO.Smistamento.DocumentoSmistamento GetDocumentoSmistamentoAsPdf(string idDocumento, DocsPaVO.utente.InfoUtente infoUtente, bool content, out bool pdfConverted)
        {
            SetUserId(infoUtente);
            DocsPaVO.Smistamento.DocumentoSmistamento retValue = null;
            pdfConverted = false;

            try
            {
                retValue = BusinessLogic.SmistamentoDocumenti.SmistamentoManager.GetDocumentoSmistamento(idDocumento, infoUtente, content, true, out pdfConverted);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetDocumentoSmistamentoAsPdf - ", e);
            }

            return retValue;
        }

        /// <summary>
        /// Restituzione di un oggetto di tipo "DocumentoTrasmesso"
        /// </summary>
        /// <param name="IDDocumento">SystemID documento</param>
        /// <param name="content">bool se volglio il content o no</param>
        /// <returns></returns>
        [WebMethod]
        public virtual DocsPaVO.Smistamento.DocumentoSmistamento GetDocumentoSmistamento(string idDocumento, DocsPaVO.utente.InfoUtente infoUtente, bool content)
        {
            SetUserId(infoUtente);
            DocsPaVO.Smistamento.DocumentoSmistamento retValue = null;

            try
            {
                retValue = BusinessLogic.SmistamentoDocumenti.SmistamentoManager.GetDocumentoSmistamento(idDocumento, infoUtente, content);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetDocumentoSmistamento - ", e);
            }

            return retValue;
        }

        /// <summary>
        /// Reperimento oggetto "DocsPaVO.SmistamentoDocumenti.UnitaOrganizzativa" 
        /// contenente i ruoli gerarchicamente inferiori definiti nell'ambito
        /// della propria UO o della UO corrente (se siamo in smista_naviga_UO)
        /// </summary>
        /// <param name="idUnitaOrganizzativa">system_id della UO (dpa_corr_globali)</param>
        /// <param name="mittente">Oggetto mittente</param>
        /// <param name="isCurrentUO">True se deve reperire la UO corrente (navigazione UO in smistamento), altimenti False (default)</param>
        /// <returns></returns>
        [WebMethod]
        public virtual DocsPaVO.Smistamento.UOSmistamento GetUOAppartenenza(string idUnitaOrganizzativa, DocsPaVO.Smistamento.MittenteSmistamento mittente, bool isCurrentUO)
        {
            DocsPaVO.Smistamento.UOSmistamento retValue = null;

            try
            {
                retValue = BusinessLogic.SmistamentoDocumenti.SmistamentoManager.GetUOAppartenenza(idUnitaOrganizzativa, mittente, isCurrentUO);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetUOAppartenenza - ", e);
            }

            return retValue;
        }

        /// <summary>
        /// Restituisce la lista degli id_corr_globali all'interno della UO, per cui il documento  stato gi trasmesso
        /// </summary>
        /// <param name="idUo"></param>
        /// <param name="docnumber"></param>
        /// <param name="mittente"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual string[] GetIdDestinatariTrasmDocInUo(string idUo, string docnumber)
        {
            string[] retValue = null;

            try
            {
                retValue = BusinessLogic.SmistamentoDocumenti.SmistamentoManager.GetIdDestinatariTrasmDocInUo(idUo, docnumber);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetIdDestinatariTrasmDocInUo - ", e);
            }

            return retValue;
        }


        /// <summary>
        /// Reperimento array di oggetti "DocsPaVO.SmistamentoDocumenti.UnitaOrganizzativa" 
        /// contenente i ruoli gerarchicamente inferiori definiti nell'ambito
        /// delle UO direttamente inferiori
        /// </summary>
        /// <param name="IDUO"></param>
        /// <returns></returns>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.Smistamento.UOSmistamento))]
        public virtual ArrayList GetUOInferiori(string idUOAppartenenza, DocsPaVO.Smistamento.MittenteSmistamento mittente)
        {
            ArrayList retValue = null;

            try
            {
                retValue = BusinessLogic.SmistamentoDocumenti.SmistamentoManager.GetUOInferiori(idUOAppartenenza, mittente);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetUOInferiori - ", e);
            }

            return retValue;
        }
        /// <summary>
        /// Verifica se il documento corrente  stato gi spedito precedentemente
        /// </summary>
        /// <param name="idProfile"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual bool DocumentoVerificaSpedizione(string idProfile)
        {
            bool result = false;
            try
            {
                result = BusinessLogic.Documenti.ProtocolloUscitaManager.VerificaSpedizione(idProfile);

            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoVerificaSpedizione", e);
            }
            return result;
        }


        /// <summary>
        /// Invio del documento trasmesso ai destinatari selezionati
        /// </summary>
        /// <param name="documentoTrasmesso"></param>
        /// <param name="datiTrasmissioneDocumento"></param>
        /// <param name="uoAppartenenza"></param>
        /// <param name="uoInferiori"></param>
        /// <param name="alertMessage"></param>
        /// <returns></returns>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.Smistamento.EsitoSmistamentoDocumento))]
        public virtual ArrayList SmistaDocumento(
            DocsPaVO.Smistamento.MittenteSmistamento mittente,
            DocsPaVO.utente.InfoUtente infoUtente,
            DocsPaVO.Smistamento.DocumentoSmistamento documentoTrasmesso,
            DocsPaVO.Smistamento.DatiTrasmissioneDocumento datiTrasmissioneDocumento,
            DocsPaVO.Smistamento.UOSmistamento uoAppartenenza,
            DocsPaVO.Smistamento.UOSmistamento[] uoInferiori,
            string httpFullPath)
        {
            SetUserId(infoUtente);
            ArrayList retValue = null;
            string desc = string.Empty;
            try
            {

                if (documentoTrasmesso.Segnatura.Equals(""))
                {
                    desc = "Smistamento Documento ID: " + documentoTrasmesso.IDDocumento.ToString();
                }
                else
                {
                    desc = "Smistamento Documento " + documentoTrasmesso.Segnatura.ToString();
                }

                retValue =
                    BusinessLogic.SmistamentoDocumenti.SmistamentoManager.SmistaDocumento(
                    mittente,
                    infoUtente,
                    documentoTrasmesso,
                    datiTrasmissioneDocumento,
                    uoAppartenenza,
                    uoInferiori,
                    httpFullPath);
                //gestione report LOG							
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente.userId, infoUtente.idPeople, infoUtente.idGruppo, infoUtente.idAmministrazione, "SMISTADOCUMENTO", documentoTrasmesso.IDDocumento, desc, DocsPaVO.Logger.CodAzione.Esito.OK, null);
            }
            catch (Exception e)
            {
                //gestione report LOG								
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente.userId, infoUtente.idPeople, infoUtente.idGruppo, infoUtente.idAmministrazione, "SMISTADOCUMENTO", documentoTrasmesso.IDDocumento, desc, DocsPaVO.Logger.CodAzione.Esito.KO, null);

                logger.Debug("Errore in DocsPaWS.asmx  - metodo: SmistaDocumento - ", e);
            }

            return retValue;
        }

        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.Smistamento.EsitoSmistamentoDocumento))]
        public virtual ArrayList SmistaDocumentoNonTrasmesso(
            DocsPaVO.Smistamento.MittenteSmistamento mittente,
            DocsPaVO.utente.InfoUtente infoUtente,
            DocsPaVO.Smistamento.DocumentoSmistamento documentoSmistamento,
            DocsPaVO.Smistamento.UOSmistamento[] uoDestinatarie,
            string httpFullPath)
        {
            SetUserId(infoUtente);
            ArrayList retValue = null;

            try
            {
                retValue =
                    BusinessLogic.SmistamentoDocumenti.SmistamentoManager.SmistaDocumento(
                    mittente,
                    infoUtente,
                    documentoSmistamento,
                    uoDestinatarie,
                    httpFullPath);

                //gestione report LOG							
                BusinessLogic.UserLog.UserLog.WriteLog(
                    infoUtente.userId,
                    infoUtente.idPeople,
                    infoUtente.idGruppo,
                    infoUtente.idAmministrazione,
                    "SMISTADOCUMENTO",
                    documentoSmistamento.IDDocumento,
                    "Smistamento Documento " + documentoSmistamento.Segnatura,
                    DocsPaVO.Logger.CodAzione.Esito.OK, null);
            }
            catch (Exception e)
            {
                //gestione report LOG							
                BusinessLogic.UserLog.UserLog.WriteLog(
                    infoUtente.userId,
                    infoUtente.idPeople,
                    infoUtente.idGruppo,
                    infoUtente.idAmministrazione,
                    "SMISTADOCUMENTO",
                    documentoSmistamento.IDDocumento,
                    "Smistamento Documento " + documentoSmistamento.Segnatura,
                    DocsPaVO.Logger.CodAzione.Esito.KO, null);

                logger.Debug("Errore in DocsPaWS.asmx  - metodo: SmistaDocumentoNonTrasmesso - ", e);
            }

            return retValue;
        }

        [WebMethod]
        public virtual bool ScartaDocumento(DocsPaVO.utente.InfoUtente infoUtente, string idOggetto, string tipoOggetto, string idTrasmissione, string idTrasmSingola, DocsPaVO.Smistamento.MittenteSmistamento mittente, DocsPaVO.Smistamento.RuoloSmistamento ruolo)
        {
            bool retValue = false;
            try
            {
                SetUserId(infoUtente);
                retValue = BusinessLogic.SmistamentoDocumenti.SmistamentoManager.ScartaDocumento(infoUtente, idOggetto, tipoOggetto, idTrasmissione, idTrasmSingola, mittente, ruolo);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ScartaDocumento - ", e);
            }
            return retValue;
        }

        [WebMethod]
        public virtual bool RifiutaDocumento(string notaRifiuto, string IDTrasmUtente, string idTrasmissione, string idPeople, DocsPaVO.utente.Ruolo ruolo, DocsPaVO.utente.InfoUtente infoUtente)
        {
            SetUserId(infoUtente);
            bool retValue = false;
            try
            {
                retValue = BusinessLogic.SmistamentoDocumenti.SmistamentoManager.RifiutaDocumento(notaRifiuto, IDTrasmUtente, idTrasmissione, idPeople, ruolo, infoUtente);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: RifiutaDocumento - ", e);
            }
            return retValue;
        }

        [WebMethod]
        /// <summary>
        /// verifica l'esistenza delle ragioni di trasmissione: COMPETENZA e CONOSCENZA
        /// </summary>
        /// <param name="idAmm"></param>
        /// <returns>TRUE: esistono le ragioni di trasmissione per lo smistamento; FALSE: non esistono</returns>
        public virtual bool VerificaRagTrasmSmista(string idAmm)
        {
            bool retValue = false;
            try
            {
                retValue = BusinessLogic.SmistamentoDocumenti.SmistamentoManager.VerificaRagTrasmSmista(idAmm);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: VerificaRagTrasmSmista - ", e);
            }
            return retValue;
        }

        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.Smistamento.UOSmistamento))]
        public virtual ArrayList GetUOSmistamento(string idRegistro, DocsPaVO.Smistamento.MittenteSmistamento mittente)
        {
            ArrayList retValue = null;

            try
            {
                retValue = BusinessLogic.SmistamentoDocumenti.SmistamentoManager.GetListUOSmistamento(idRegistro, mittente);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetUOInferiori - ", e);
            }

            return retValue;
        }

        [WebMethod]
        public virtual bool SmistamentoExistUOInf(string idUO, DocsPaVO.Smistamento.MittenteSmistamento mittente)
        {
            bool retValue = false;
            try
            {
                retValue = BusinessLogic.SmistamentoDocumenti.SmistamentoManager.ExistUOInf(idUO, mittente);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: SmistamentoExistUOInf - ", e);
            }

            return retValue;
        }
        #endregion

        #region Nuova Rubrica

        [WebMethod]
        public virtual bool verificaDipendezaCodRubrica(string codiceUoAppartenenza, string codiceRubrica, DocsPaVO.utente.InfoUtente u)
        {
            SetUserId(u);
            bool result = false;
            try
            {
                BusinessLogic.Rubrica.DPA3_RubricaSearchAgent ccs = new BusinessLogic.Rubrica.DPA3_RubricaSearchAgent(u);
                result = ccs.verificaDipendezaCodRubrica(codiceUoAppartenenza, codiceRubrica);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx - metodo: verificaDipendezaCodRubrica - ", e);
            }
            return result;
        }

        [WebMethod]
        [XmlInclude(typeof(DocsPaVO.rubrica.ElementoRubrica))]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.rubrica.ElementoRubrica))]
        public virtual ArrayList rubricaGetElementiRubrica(DocsPaVO.rubrica.ParametriRicercaRubrica qc, DocsPaVO.utente.InfoUtente u, DocsPaVO.rubrica.SmistamentoRubrica smistamentoRubrica)
        {
            SetUserId(u);
            ArrayList objElementiRubrica = null;
            try
            {
                logger.Debug("WS > rubricaGetElementiRubrica");
                BusinessLogic.Rubrica.DPA3_RubricaSearchAgent ccs = new BusinessLogic.Rubrica.DPA3_RubricaSearchAgent(u);
                if (qc.caller != null && qc.caller.IdUtente == null)
                    qc.caller.IdUtente = u.idPeople;
                objElementiRubrica = ccs.Search(qc, smistamentoRubrica);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: rubricaGetElementiRubrica - ", e);
            }
            return objElementiRubrica;
        }

        [WebMethod]
        [XmlInclude(typeof(DocsPaVO.rubrica.ElementoRubrica))]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.rubrica.ElementoRubrica))]
        public virtual ArrayList rubricaGetElementiRubricaPaging(DocsPaVO.rubrica.ParametriRicercaRubrica qc, DocsPaVO.utente.InfoUtente u, DocsPaVO.rubrica.SmistamentoRubrica smistamentoRubrica, int firstRowNum, int maxRowForPage, out int totale)
        {
            int tot = 0;
            SetUserId(u);
            ArrayList objElementiRubrica = null;
            try
            {
                logger.Debug("WS > rubricaGetElementiRubrica");
                BusinessLogic.Rubrica.DPA3_RubricaSearchAgent ccs = new BusinessLogic.Rubrica.DPA3_RubricaSearchAgent(u);
                if (qc.caller != null && qc.caller.IdUtente == null)
                    qc.caller.IdUtente = u.idPeople;
                objElementiRubrica = ccs.SearchPaging(qc, smistamentoRubrica, firstRowNum, maxRowForPage, out tot);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: rubricaGetElementiRubrica - ", e);
            }

            totale = tot;
            return objElementiRubrica;
        }

        [WebMethod]
        [XmlInclude(typeof(DocsPaVO.rubrica.ElementoRubrica))]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.rubrica.ElementoRubrica))]
        public virtual ArrayList rubricaGetGerarchiaElemento(string codice, DocsPaVO.addressbook.TipoUtente tipoIE, DocsPaVO.utente.InfoUtente u, DocsPaVO.rubrica.SmistamentoRubrica smistamentoRubrica)
        {
            SetUserId(u);
            ArrayList gerarchia = null;

            try
            {
                logger.Debug("WS > rubricaGetGerarchiaElemento");
                BusinessLogic.Rubrica.DPA3_RubricaSearchAgent ccs = new BusinessLogic.Rubrica.DPA3_RubricaSearchAgent(u);
                gerarchia = ccs.GetHierarchy(codice, tipoIE, smistamentoRubrica);
                if (gerarchia != null && gerarchia.Count > 0)
                {
                    List<ElementoRubrica> listEl = gerarchia.Cast<ElementoRubrica>().ToList();
                    ElementoRubrica el = (from n in listEl where n.tipo.Equals("F") select n).FirstOrDefault();
                    if (el != null)
                    {
                        listEl.Remove(el);
                    }
                    gerarchia = new ArrayList(listEl);
                }
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: rubricaGetGerarchiaElemento - ", e);
            }
            return gerarchia;
        }

        [WebMethod]
        [XmlInclude(typeof(DocsPaVO.rubrica.ElementoRubrica))]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.rubrica.ElementoRubrica))]
        public virtual ArrayList rubricaGetChildrenElement(string elementID, string childrensType, DocsPaVO.utente.InfoUtente u)
        {
            SetUserId(u);
            ArrayList childrens = null;

            try
            {
                logger.Debug("WS > rubricaGetGerarchiaElemento");
                BusinessLogic.Rubrica.DPA3_RubricaSearchAgent ccs = new BusinessLogic.Rubrica.DPA3_RubricaSearchAgent(u);
                childrens = ccs.GetChildrenElement(elementID, childrensType);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: rubricaGetGerarchiaElemento - ", e);
            }
            return childrens;
        }

        [WebMethod]
        [XmlInclude(typeof(DocsPaVO.rubrica.ElementoRubrica))]
        public virtual DocsPaVO.rubrica.ElementoRubrica rubricaGetElementoRubrica(string cod, DocsPaVO.utente.InfoUtente u, DocsPaVO.rubrica.SmistamentoRubrica smistamentoRubrica, string condRegistri)
        {
            SetUserId(u);
            try
            {
                logger.Debug("WS > rubricaGetElementoRubrica");
                BusinessLogic.Rubrica.DPA3_RubricaSearchAgent ccs = new BusinessLogic.Rubrica.DPA3_RubricaSearchAgent(u);
                return ccs.SearchSingle(cod, smistamentoRubrica, condRegistri);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: rubricaGetElementoRubrica - ", e);
                return null;
            }
        }

        [WebMethod]
        [XmlInclude(typeof(DocsPaVO.rubrica.ElementoRubrica))]
        public virtual DocsPaVO.rubrica.ElementoRubrica rubricaGetElementoRubricaSimple(string cod, DocsPaVO.utente.InfoUtente u)
        {
            SetUserId(u);
            try
            {
                logger.Debug("WS > rubricaGetElementoRubricaSimple");
                BusinessLogic.Rubrica.DPA3_RubricaSearchAgent ccs = new BusinessLogic.Rubrica.DPA3_RubricaSearchAgent(u);
                return ccs.SearchSingleSimple(cod);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: rubricaGetElementoRubricaSimple - ", e);
                return null;
            }
        }
        [WebMethod]
        [XmlInclude(typeof(DocsPaVO.rubrica.ElementoRubrica))]
        public virtual void rubricaCheckChildrenExistence(ref DocsPaVO.rubrica.ElementoRubrica[] ers, DocsPaVO.utente.InfoUtente u)
        {
            SetUserId(u);
            try
            {
                logger.Debug("WS > rubricaCheckChildrenExistence");
                BusinessLogic.Rubrica.DPA3_RubricaSearchAgent ccs = new BusinessLogic.Rubrica.DPA3_RubricaSearchAgent(u);
                ccs.CheckChildrenExistence(ref ers, u.idAmministrazione);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: rubricaCheckChildrenExistence - ", e);
            }
        }

        [WebMethod]
        [XmlInclude(typeof(DocsPaVO.rubrica.ElementoRubrica))]
        public virtual void rubricaCheckChildrenExistenceEx(ref DocsPaVO.rubrica.ElementoRubrica[] ers, bool checkUo, bool checkRuoli, bool checkUtenti, DocsPaVO.utente.InfoUtente u)
        {
            SetUserId(u);
            try
            {
                logger.Debug("WS > rubricaCheckChildrenExistenceEx");
                BusinessLogic.Rubrica.DPA3_RubricaSearchAgent ccs = new BusinessLogic.Rubrica.DPA3_RubricaSearchAgent(u);
                ccs.CheckChildrenExistence(ref ers, checkUo, checkRuoli, checkUtenti, u.idAmministrazione);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: rubricaCheckChildrenExistenceEx - ", e);
            }
        }

        [WebMethod]
        [XmlInclude(typeof(DocsPaVO.utente.Corrispondente))]
        public virtual DocsPaVO.utente.Corrispondente AddressbookGetCorrispondenteByCodRubrica(string codice, DocsPaVO.utente.InfoUtente u, string condRegistri, bool storicizzato)
        {
            SetUserId(u);
            DocsPaVO.utente.Corrispondente corr = null;

            try
            {
                logger.Debug("WS > AddressbookGetCorrispondenteByCodRubrica");
                corr = BusinessLogic.Utenti.UserManager.getCorrispondenteByCodRubrica(codice, u, condRegistri, storicizzato);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AddressbookGetCorrispondenteByCodRubrica - ", e);
            }
            return corr;
        }

        [WebMethod]
        [XmlInclude(typeof(DocsPaVO.utente.Corrispondente))]
        public virtual DocsPaVO.utente.Corrispondente AddressbookGetCorrispondenteBySystemId(string system_id)
        {
            DocsPaVO.utente.Corrispondente corr = null;

            try
            {
                logger.Debug("WS > AddressbookGetCorrispondenteBySystemId");
                corr = BusinessLogic.Utenti.UserManager.getCorrispondenteBySystemID(system_id);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AddressbookGetCorrispondenteBySystemId - ", e);
            }
            return corr;
        }

        [WebMethod]
        [XmlInclude(typeof(DocsPaVO.utente.Corrispondente))]
        public virtual DocsPaVO.utente.Canale GetCanalePreferenzialeByIdCorr(string system_id)
        {
            DocsPaVO.utente.Canale canale = null;

            try
            {
                logger.Debug("WS > AddressbookGetCanalePreferenzialeByIdCorr");
                canale = BusinessLogic.Utenti.UserManager.GetCanalePreferenzialeByIdCorr(system_id);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AddressbookGetCanalePreferenzialeByIdCorr - ", e);
            }
            return canale;
        }

        [WebMethod]
        [XmlInclude(typeof(DocsPaVO.utente.Corrispondente))]
        public virtual DocsPaVO.utente.Corrispondente AddressbookGetCorrispondenteBySystemIdDisabled(string system_id)
        {
            DocsPaVO.utente.Corrispondente corr = null;

            try
            {
                logger.Debug("WS > AddressbookGetCorrispondenteBySystemId");
                corr = BusinessLogic.Utenti.UserManager.getCorrispondenteBySystemIDDisabled(system_id);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AddressbookGetCorrispondenteBySystemIdDisabled - ", e);
            }
            return corr;
        }

        [WebMethod]
        [XmlInclude(typeof(DocsPaVO.utente.Corrispondente))]

        public virtual DocsPaVO.utente.Corrispondente AddressbookGetCorrispondenteByCodRubricaIE(string codice, DocsPaVO.addressbook.TipoUtente tipoIE, DocsPaVO.utente.InfoUtente u)
        {
            SetUserId(u);
            DocsPaVO.utente.Corrispondente corr = null;

            try
            {
                logger.Debug("WS > AddressbookGetCorrispondenteByCodRubricaIE");
                corr = BusinessLogic.Utenti.UserManager.getCorrispondenteByCodRubrica(codice, tipoIE, u);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AddressbookGetCorrispondenteByCodRubricaIE - ", e);
            }
            return corr;
        }



        [WebMethod]
        [XmlInclude(typeof(DocsPaVO.utente.Corrispondente))]

        public virtual DocsPaVO.utente.Corrispondente AddressbookGetCorrispondenteByCodRubricaIENotDisabled(string codice, DocsPaVO.addressbook.TipoUtente tipoIE, DocsPaVO.utente.InfoUtente u)
        {
            SetUserId(u);
            DocsPaVO.utente.Corrispondente corr = null;

            try
            {
                logger.Debug("WS > AddressbookGetCorrispondenteByCodRubricaIE");
                corr = BusinessLogic.Utenti.UserManager.getCorrispondenteByCodRubricaNotDisabled(codice, tipoIE, u);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AddressbookGetCorrispondenteByCodRubricaIE - ", e);
            }
            return corr;
        }

        [WebMethod(Description = "Prelievo dei dati di un canale preferenziale. Per ottimizzazione.")]
        [XmlInclude(typeof(DocsPaVO.utente.Canale))]
        public virtual DocsPaVO.utente.Canale AddressBookGetDatiCanalePref_Experimental(Corrispondente corr)
        {
            DocsPaVO.utente.Canale retval = null;
            try
            {
                retval = BusinessLogic.Utenti.UserManager.GetDatiCanPref_Experimental(corr);
            }
            catch (Exception e)
            {
                logger.Error("Errore in Docspaws.asmx - metodo: AddressBookGetDatiCanalePref - ", e);
            }
            return retval;
        }


        [WebMethod]
        [XmlInclude(typeof(DocsPaVO.rubrica.ElementoRubrica))]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.rubrica.ElementoRubrica))]
        public virtual ArrayList rubricaGetElementiRubricaRange(string[] codici, DocsPaVO.addressbook.TipoUtente tipoIE, DocsPaVO.utente.InfoUtente u)
        {
            SetUserId(u);
            ArrayList objElementiRubrica = null;

            try
            {
                logger.Debug("WS > rubricaGetElementiRubricaRange");
                BusinessLogic.Rubrica.DPA3_RubricaSearchAgent ccs = new BusinessLogic.Rubrica.DPA3_RubricaSearchAgent(u);
                objElementiRubrica = ccs.SearchRange(codici, tipoIE);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: rubricaGetElementiRubricaRange - ", e);
            }
            return objElementiRubrica;
        }

        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.utente.Ruolo))]
        public virtual ArrayList amministrazioneGetRuoliInUO(DocsPaVO.utente.UnitaOrganizzativa uo, DocsPaVO.utente.InfoUtente infoUtente)
        {
            SetUserId(infoUtente);
            ArrayList res = null;
            try
            {
                res = BusinessLogic.Amministrazione.UOManager.GetRuoliUO(uo);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: amministrazioneGetRuoliInUO - ", e);
            }
            return res;
        }

        [WebMethod]
        [XmlInclude(typeof(DocsPaVO.rubrica.ElementoRubrica))]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.rubrica.ElementoRubrica))]
        public virtual ArrayList rubricaGetRootItems(DocsPaVO.addressbook.TipoUtente tipoIE, DocsPaVO.utente.InfoUtente u, DocsPaVO.rubrica.SmistamentoRubrica smistamentoRubrica)
        {
            SetUserId(u);
            ArrayList objElementiRubrica = null;

            try
            {
                logger.Debug("WS > rubricaGetRootItems");
                BusinessLogic.Rubrica.DPA3_RubricaSearchAgent ccs = new BusinessLogic.Rubrica.DPA3_RubricaSearchAgent(u);
                objElementiRubrica = ccs.GetRootItems(tipoIE, smistamentoRubrica);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: rubricaGetRootItems - ", e);
            }
            return objElementiRubrica;
        }

        [WebMethod]
        public virtual DataSet AddressbookGetRuoliUtenteInt(string codRubrica)
        {
            DataSet result = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                logger.Debug("WS > AddressbookGetRuoliUtenteInt");
                result = BusinessLogic.Utenti.addressBookManager.getRuoliUtenteInt(codRubrica);
#if TRACE_WS
				pt.WriteLogTracer("AddressbookGetRuoliUtenteInt");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AddressbookGetRuoliUtenteInt", e);
                result = null;
            }

            return result;
        }

        [WebMethod]
        [XmlInclude(typeof(DocsPaVO.rubrica.ElementoRubrica))]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.rubrica.ElementoRubrica))]
        public virtual ArrayList AddressbookGetRuoliUtente(string id_amm, string cod_rubrica)
        {
            try
            {
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                logger.Debug("WS > AddressbookGetRuoliUtente");
                return BusinessLogic.Utenti.addressBookManager.GetRuoliUtente(id_amm, cod_rubrica);
#if TRACE_WS
				pt.WriteLogTracer("AddressbookGetRuoliUtente");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AddressbookGetRuoliUtente", e);
                return null;
            }
        }

        [WebMethod]
        public virtual bool UoIsOnExternalReg(string codice, string id_reg, string id_amm, DocsPaVO.utente.InfoUtente u)
        {
            SetUserId(u);
            try
            {
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                logger.Debug("WS > UoIsOnExternalReg");
                BusinessLogic.Rubrica.DPA3_RubricaSearchAgent ccs = new BusinessLogic.Rubrica.DPA3_RubricaSearchAgent(u);
                return ccs.UoIsOnExternalReg(codice, id_reg, id_amm);
#if TRACE_WS
				pt.WriteLogTracer("UoIsOnExternalReg");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: UoIsOnExternalReg", e);
                return false;
            }
        }

        [WebMethod]
        public virtual string[] GetUoInterneAoo(string id_reg, DocsPaVO.utente.InfoUtente u)
        {
            SetUserId(u);
            try
            {
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                logger.Debug("WS > GetUoInterneAoo");
                BusinessLogic.Rubrica.DPA3_RubricaSearchAgent ccs = new BusinessLogic.Rubrica.DPA3_RubricaSearchAgent(u);
                return ccs.GetUoInterneAoo(id_reg);
#if TRACE_WS
				pt.WriteLogTracer("GetUoInterneAoo");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetUoInterneAoo", e);
                return null;
            }
        }

        #endregion

        #region ProfilazioneDinamica
        [WebMethod]
        [return: XmlArrayItem(typeof(DocsPaVO.Modelli_Trasmissioni.AssDocDiagTrasm))]
        public virtual ArrayList getIdModelliTrasmAssociati(string idTipoDoc, string idDiagramma, string idStato)
        {
            try
            {
                return BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.getIdModelliTrasmAssociati(idTipoDoc, idDiagramma, idStato);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getIdModelliTrasmAssociati", e);
                return null;
            }
        }

        [WebMethod]
        [return: XmlArrayItem(typeof(DocsPaVO.ProfilazioneDinamica.AssDocFascRuoli))]
        public virtual ArrayList getRuoliTipoDoc(string idTipoDoc)
        {
            try
            {
                return BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.getRuoliTipoDoc(idTipoDoc);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getRuoliTipoDoc", e);
                return null;
            }
        }

        [WebMethod]
        public virtual ArrayList getRuoliTipoAtto(string idTipoDoc, string testo, string tipoRicerca)
        {
            try
            {
                return BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.getRuoliTipoAtto(idTipoDoc, testo, tipoRicerca);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getRuoliTipoAtto", e);
                return null;
            }
        }

        /*
        [WebMethod]
        public virtual ArrayList getRuoliOggCustomDoc(string idOggCustom)
        {
            try
            {
                return BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.getRuoliOggCustomDoc(idOggCustom);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getRuoliOggCustomDoc", e);
                return null;
            }
        }
        */

        [WebMethod]
        [return: XmlArrayItem(typeof(DocsPaVO.ProfilazioneDinamica.AssDocFascRuoli))]
        public virtual ArrayList getRuoliTipoFasc(string idTipoFasc)
        {
            try
            {
                return BusinessLogic.ProfilazioneDinamica.ProfilazioneFascicoli.getRuoliTipoFasc(idTipoFasc);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getRuoliTipoDoc", e);
                return null;
            }
        }

        /*
        [WebMethod]
        public virtual void salvaAssociazioneRuoloOggettoCustomDoc(string idOggettoCustom, string[] listaRuoliSelezionati, string idTipoAtto)
        {
            try
            {
                BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.salvaAssociazioneRuoloOggettoCustomDoc(idOggettoCustom, listaRuoliSelezionati, idTipoAtto);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: salvaAssociazioneRuoloOggettoCustomDoc", e);
            }

        }

        [WebMethod]
        public virtual void cancellaAssociazioneRuoloOggettoCustomDoc(string idOggettoCustom, string idRuolo)
        {
            try
            {
                BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.cancellaAssociazioneRuoloOggettoCustomDoc(idOggettoCustom, idRuolo);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: cancellaAssociazioneRuoloOggettoCustomDoc", e);
            }
        }
        */

        [WebMethod]
        public virtual void salvaAssociazioneDocRuoli(ArrayList assDocRuoli)
        {
            try
            {
                BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.salvaAssociazioneDocRuoli(assDocRuoli);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: salvaAssociazioneDocRuoli", e);
            }

        }

        [WebMethod]
        public virtual void salvaAssociazioneFascRuoli(ArrayList assFascRuoli)
        {
            try
            {
                BusinessLogic.ProfilazioneDinamica.ProfilazioneFascicoli.salvaAssociazioneFascRuoli(assFascRuoli);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: salvaAssociazioneDocRuoli", e);
            }

        }

        [WebMethod]
        public virtual void salvaAssociazioneModelli(string idTipoDoc, string idDiagramma, ArrayList modelliSelezionati, string idStato)
        {
            try
            {
                BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.salvaAssociazioneModelli(idTipoDoc, idDiagramma, modelliSelezionati, idStato);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: salvaAssociazioneModelli", e);
            }

        }

        [WebMethod]
        public virtual string getIdTemplate(string docNumber)
        {
            string idTemplate = "";
            try
            {
                return BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.getIdTemplate(docNumber);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getIdTemplate", e);
                return idTemplate;
            }
        }

        [WebMethod]
        public virtual DocsPaVO.ProfilazioneDinamica.OggettoCustom getOggettoById(string idOggetto)
        {
            try
            {
                return BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.getOggettoById(idOggetto);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getOggettoById", e);
                throw e;
            }
        }

        [WebMethod]
        public virtual DocsPaVO.ProfilazioneDinamica.OggettoCustom getOggettoFascById(string idOggetto)
        {
            try
            {
                return BusinessLogic.ProfilazioneDinamica.ProfilazioneFascicoli.getOggettoById(idOggetto);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getOggettoFascById", e);
                throw e;
            }
        }

        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.documento.TipologiaAtto))]
        public virtual ArrayList getTipoAttoPDInsRic(string idAmministrazione, string idGruppo, string diritti)
        {
            ArrayList result = null;

            try
            {
#if TRACE_WS
					DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Documenti.DocManager.getTipoAttoPDInsRic(idAmministrazione, idGruppo, diritti);
#if TRACE_WS
					pt.WriteLogTracer("DocumentoGetTipologiaAtto");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getTipoAttoPDIns", e);
                result = null;
            }
            return result;
        }

        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.ProfilazioneDinamica.Templates))]
        public virtual ArrayList getTipoFasc(string idAmministrazione)
        {
            ArrayList result = null;

            try
            {
                return BusinessLogic.ProfilazioneDinamica.ProfilazioneFascicoli.getTipoFasc(idAmministrazione);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getTipoFasc", e);
                result = null;
            }
            return result;
        }

        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.ProfilazioneDinamica.Templates))]
        public virtual ArrayList getTipoFascFromRuolo(string idAmministrazione, string idRuolo, string diritti)
        {
            ArrayList result = null;

            try
            {
                return BusinessLogic.ProfilazioneDinamica.ProfilazioneFascicoli.getTipoFascFromRuolo(idAmministrazione, idRuolo, diritti);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getTipoFascFromRuolo", e);
                result = null;
            }
            return result;
        }


        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.documento.TipologiaAtto))]
        public virtual ArrayList GetTipologiaAttoProfDin(string idAmministrazione)
        {
            ArrayList result = null;

            try
            {
#if TRACE_WS
					DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Documenti.DocManager.getTipologiaAtto(idAmministrazione);
#if TRACE_WS
					pt.WriteLogTracer("DocumentoGetTipologiaAtto");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoGetTipologiaAtto", e);
                result = null;
            }
            return result;
        }

        [WebMethod]
        public virtual ArrayList getTipiOggetto()
        {
            try
            {
                return BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.getTipiOggetto();
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getTipiOggetto", e);
                return null;
            }
        }

        [WebMethod]
        public virtual ArrayList getTipiDocumento(string idAmministrazione)
        {
            try
            {
                return BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.getTipiDocumento(idAmministrazione);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getTipiDocumento", e);
                return null;
            }
        }

        [WebMethod]
        public virtual DocsPaVO.ProfilazioneDinamica.Templates aggiungiOggettoCustomTemplate(DocsPaVO.ProfilazioneDinamica.OggettoCustom oggettoCustom, DocsPaVO.ProfilazioneDinamica.Templates template)
        {
            try
            {
                template.ELENCO_OGGETTI.Add(oggettoCustom);
                return template;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: aggiungiOggettoCustomTemplate", e);
                return null;
            }
        }

        [WebMethod]
        public virtual DocsPaVO.ProfilazioneDinamica.Templates aggiungiOggettoCustomTemplateFasc(DocsPaVO.ProfilazioneDinamica.OggettoCustom oggettoCustom, DocsPaVO.ProfilazioneDinamica.Templates template)
        {
            try
            {
                template.ELENCO_OGGETTI.Add(oggettoCustom);
                return template;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: aggiungiOggettoCustomTemplateFasc", e);
                return null;
            }
        }

        [WebMethod]
        public virtual DocsPaVO.ProfilazioneDinamica.Templates eliminaOggettoCustomTemplate(DocsPaVO.ProfilazioneDinamica.Templates template, int oggettoCustom)
        {
            try
            {
                DocsPaVO.ProfilazioneDinamica.OggettoCustom oggettoC = (DocsPaVO.ProfilazioneDinamica.OggettoCustom)template.ELENCO_OGGETTI[oggettoCustom];
                BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.eliminaOggettoCustomDaDB(oggettoC, template);
                template.ELENCO_OGGETTI.RemoveAt(oggettoCustom);

                for (int i = oggettoCustom; i < template.ELENCO_OGGETTI.Count; i++)
                {
                    oggettoC = (DocsPaVO.ProfilazioneDinamica.OggettoCustom)template.ELENCO_OGGETTI[i];
                    if (oggettoC.POSIZIONE != null && oggettoC.POSIZIONE != "")
                    {
                        int posizione = Convert.ToInt32(oggettoC.POSIZIONE);
                        posizione--;
                        oggettoC.POSIZIONE = Convert.ToString(posizione);
                        BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.aggiornaPosizione(oggettoC, template);
                    }
                }
                return template;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: eliminaOggettoCustomTemplate", e);
                return null;
            }
        }

        [WebMethod]
        public virtual DocsPaVO.ProfilazioneDinamica.Templates eliminaOggettoCustomTemplateFasc(DocsPaVO.ProfilazioneDinamica.Templates template, int oggettoCustom)
        {
            try
            {
                DocsPaVO.ProfilazioneDinamica.OggettoCustom oggettoC = (DocsPaVO.ProfilazioneDinamica.OggettoCustom)template.ELENCO_OGGETTI[oggettoCustom];
                BusinessLogic.ProfilazioneDinamica.ProfilazioneFascicoli.eliminaOggettoCustomDaDBFasc(oggettoC, template);
                template.ELENCO_OGGETTI.RemoveAt(oggettoCustom);

                for (int i = oggettoCustom; i < template.ELENCO_OGGETTI.Count; i++)
                {
                    oggettoC = (DocsPaVO.ProfilazioneDinamica.OggettoCustom)template.ELENCO_OGGETTI[i];
                    if (oggettoC.POSIZIONE != null && oggettoC.POSIZIONE != "")
                    {
                        int posizione = Convert.ToInt32(oggettoC.POSIZIONE);
                        posizione--;
                        oggettoC.POSIZIONE = Convert.ToString(posizione);
                        BusinessLogic.ProfilazioneDinamica.ProfilazioneFascicoli.aggiornaPosizioneFasc(oggettoC, template);
                    }
                }
                return template;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: eliminaOggettoCustomTemplateFasc", e);
                return null;
            }
        }

        [WebMethod]
        public virtual void updateScadenzeTipoDoc(int systemId_template, string scadenza, string preScadenza)
        {
            try
            {
                BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.updateScadenzeTipoDoc(systemId_template, scadenza, preScadenza);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: updateScadenzeTipoDoc", e);
            }
        }

        /// <summary>
        /// Aggiorna il campo privato al tipo documento da privato a pubblico o viceversa
        /// </summary>
        /// <param name="systemId_template"></param>
        /// <param name="privato"></param>
        [WebMethod]
        public virtual void updatePrivatoTipoDoc(int systemId_template, string privato)
        {
            try
            {
                BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.UpdatePrivatoTipoDoc(systemId_template, privato);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: updatePrivatoTipoDoc", e);
            }
        }

        /// <summary>
        /// Aggiorna il campo Num_Mesi_Conservazione al tipo documento 
        /// </summary>
        /// <param name="systemId_template"></param>
        /// <param name="mesiCons"></param>
        [WebMethod]
        public virtual void updateMesiConsTipoDoc(int systemId_template, string mesiCons)
        {
            try
            {
                BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.UpdateMesiConsTipoDoc(systemId_template, mesiCons);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: updateMesiCosnTipoDoc", e);
            }
        }

        /// <summary>
        /// Aggiorna il campo Num_Mesi_Conservazione al tipo fascicolo
        /// </summary>
        /// <param name="systemId_template"></param>
        /// <param name="mesiCons"></param>
        [WebMethod]
        public virtual void updateMesiConsTipoFasc(int systemId_template, string mesiCons)
        {
            try
            {
                BusinessLogic.ProfilazioneDinamica.ProfilazioneFascicoli.UpdateMesiConsTipoFasc(systemId_template, mesiCons);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: updateMesiCosnTipoFasc", e);
            }
        }

        /// <summary>
        /// INTEGRAZIONE PITRE-PARER
        /// Aggiorna il campo Invio Conservazione al tipo documento
        /// </summary>
        /// <param name="systemId_templale"></param>
        /// <param name="invioCons"></param>
        [WebMethod]
        public virtual void updateInvioConsTipoDoc(int systemId_template, string invioCons)
        {
            try
            {
                BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.UpdateInvioConsTipoDoc(systemId_template, invioCons);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore in DocsPaWS.asmx - metodo: updateInvioConsTipoDoc", ex);
            }
        }

        /// <summary>
        /// INTEGRAZIONE PITRE-PARER
        /// Aggiorna il parametro Consolidamento di un campo di una tipologia documentale
        /// </summary>
        /// <param name="systemId"></param>
        /// <param name="consolida"></param>
        [WebMethod]
        public virtual void updateConsolidamentoOggCustom(int systemId, string consolida, string systemId_template)
        {
            try
            {
                BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.UpdateConsolidaCampo(systemId, consolida, systemId_template);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore in DocsPaWS.asmx - metodo: updateConsolidamentoOggCustom", ex);
            }
        }

        /// <summary>
        /// INTEGRAZIONE PITRE-PARER
        /// Aggiorna il parametro Conservazione di un campo di una tipologia documentale
        /// </summary>
        /// <param name="systemId"></param>
        /// <param name="conserva"></param>
        [WebMethod]
        public virtual void updateConservazioneOggCustom(int systemId, string conserva, string systemId_template)
        {
            try
            {
                BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.UpdateConservaCampo(systemId, conserva, systemId_template);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore in DocsPaWS.asmx - metodo: updateConservazioneOggCustom", ex);
            }
        }

        /// <summary>
        /// Aggiorna il campo privato al tipo fascicolo da privato a pubblico o viceversa
        /// </summary>
        /// <param name="systemId_template"></param>
        /// <param name="privato"></param>
        [WebMethod]
        public virtual void updatePrivatoTipoFasc(int systemId_template, string privato)
        {
            try
            {
                BusinessLogic.ProfilazioneDinamica.ProfilazioneFascicoli.UpdatePrivatoTipoFasc(systemId_template, privato);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: updatePrivatoTipoFasc", e);
            }
        }

        /// <summary>
        /// Restituisce il numero di documenti che hanno un dato tipo documento
        /// </summary>
        /// <param name="systemId_template"></param>
        /// <param name="privato"></param>
        [WebMethod]
        public virtual int countDocTipoDoc(string tipo_atto, string codiceAmm)
        {
            try
            {
                return BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.countDocTipoDoc(tipo_atto, codiceAmm);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: countDocTipoDoc", e);
                return 0;
            }
        }


        /// <summary>
        /// Restituisce il numero di fascicoli che hanno un dato tipo fascicolo
        /// </summary>
        /// <param name="systemId_template"></param>
        /// <param name="privato"></param>
        [WebMethod]
        public virtual int countFascTipoFasc(string tipo_fasc, string codiceAmm)
        {
            try
            {
                return BusinessLogic.ProfilazioneDinamica.ProfilazioneFascicoli.countFascTipoFasc(tipo_fasc, codiceAmm);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: countFascTipoFasc", e);
                return 0;
            }
        }

        [WebMethod]
        public virtual DocsPaVO.ProfilazioneDinamica.Templates aggiungiOggettoValoreOggettoCustom(DocsPaVO.ProfilazioneDinamica.ValoreOggetto valoreOggetto, int oggettoCustom, DocsPaVO.ProfilazioneDinamica.Templates template, bool cancellazione)
        {
            try
            {
                if (cancellazione)
                {
                    ((DocsPaVO.ProfilazioneDinamica.OggettoCustom)template.ELENCO_OGGETTI[oggettoCustom]).ELENCO_VALORI.Clear();
                }
                ((DocsPaVO.ProfilazioneDinamica.OggettoCustom)template.ELENCO_OGGETTI[oggettoCustom]).ELENCO_VALORI.Add(valoreOggetto);
                return template;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: aggiungiOggettoValoreOggettoCustom", e);
                return null;
            }
        }

        [WebMethod]
        public virtual DocsPaVO.ProfilazioneDinamica.Templates aggiungiOggettoValoreOggettoCustomFasc(DocsPaVO.ProfilazioneDinamica.ValoreOggetto valoreOggetto, int oggettoCustom, DocsPaVO.ProfilazioneDinamica.Templates template, bool cancellazione)
        {
            try
            {
                if (cancellazione)
                {
                    ((DocsPaVO.ProfilazioneDinamica.OggettoCustom)template.ELENCO_OGGETTI[oggettoCustom]).ELENCO_VALORI.Clear();
                }
                ((DocsPaVO.ProfilazioneDinamica.OggettoCustom)template.ELENCO_OGGETTI[oggettoCustom]).ELENCO_VALORI.Add(valoreOggetto);
                return template;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: aggiungiOggettoValoreOggettoCustomFasc", e);
                return null;
            }
        }

        [WebMethod]
        public virtual bool salvaTemplate(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.ProfilazioneDinamica.Templates template, string idAmministrazione)
        {
            SetUserId(infoUtente);
            bool retValue = false;
            try
            {
                retValue = BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.salvaTemplate(template, idAmministrazione);
                if (retValue)
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMNEWDOC", template.SYSTEM_ID.ToString(), "Creazione tipo documento " + template.DESCRIZIONE, DocsPaVO.Logger.CodAzione.Esito.OK, idAmministrazione);
            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMNEWDOC", template.SYSTEM_ID.ToString(), "Creazione tipo documento " + template.DESCRIZIONE, DocsPaVO.Logger.CodAzione.Esito.KO, idAmministrazione);
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: salvaTemplate", e);
                retValue = false;
            }
            return retValue;
        }

        [WebMethod]
        public virtual bool salvaTemplateFasc(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.ProfilazioneDinamica.Templates template, string idAmministrazione)
        {
            SetUserId(infoUtente);
            bool retValue = false;
            try
            {
                retValue = BusinessLogic.ProfilazioneDinamica.ProfilazioneFascicoli.salvaTemplateFasc(template, idAmministrazione);
                if (retValue)
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMNEWFASC", template.SYSTEM_ID.ToString(), "Creazione tipo fascicolo " + template.DESCRIZIONE, DocsPaVO.Logger.CodAzione.Esito.OK, idAmministrazione);
            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMNEWFASC", template.SYSTEM_ID.ToString(), "Creazione tipo fascicolo " + template.DESCRIZIONE, DocsPaVO.Logger.CodAzione.Esito.KO, idAmministrazione);
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: salvaTemplateFasc", e);
                retValue = false;
            }
            return retValue;
        }

        [WebMethod]
        public virtual bool aggiornaTemplate(DocsPaVO.ProfilazioneDinamica.Templates template)
        {
            try
            {
                return BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.aggiornaTemplate(template);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: aggiornaTemplate", e);
                return false;
            }
        }

        [WebMethod]
        public virtual bool aggiornaTemplateFasc(DocsPaVO.ProfilazioneDinamica.Templates template)
        {
            try
            {
                return BusinessLogic.ProfilazioneDinamica.ProfilazioneFascicoli.aggiornaTemplateFasc(template);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: aggiungiOggettoValoreOggettoCustom", e);
                return false;
            }
        }

        [WebMethod]
        public virtual ArrayList getTemplates(string idAmministrazione)
        {
            try
            {
                return BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.getTemplates(idAmministrazione);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getTemplates", e);
                return null;
            }
        }

        /// <summary>
        /// 
        /// </summary>
        /// <param name="idAmministrazione"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual ArrayList getTemplatesFasc(string idAmministrazione)
        {
            try
            {
                return BusinessLogic.ProfilazioneDinamica.ProfilazioneFascicoli.getTemplatesFasc(idAmministrazione);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getTemplatesFasc", e);
                return null;
            }
        }

        [WebMethod]
        public virtual DocsPaVO.ProfilazioneDinamica.Templates getTemplateById(string idTemplate)
        {
            try
            {
                return BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.getTemplateById(idTemplate);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getTemplateById", e);
                return null;
            }
        }

        [WebMethod]
        public virtual DocsPaVO.ProfilazioneDinamica.Templates getTemplateFascById(string idTemplate)
        {
            try
            {
                return BusinessLogic.ProfilazioneDinamica.ProfilazioneFascicoli.getTemplateFascById(idTemplate);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getTemplateFascById", e);
                return null;
            }
        }

        [WebMethod]
        public virtual DocsPaVO.ProfilazioneDinamica.Templates getTemplateFascDettagli(string idProject)
        {
            try
            {
                return BusinessLogic.ProfilazioneDinamica.ProfilazioneFascicoli.getTemplateFascDettagli(idProject);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getTemplateFascDettagli", e);
                return null;
            }
        }

        [WebMethod]
        public virtual bool disabilitaTemplate(DocsPaVO.ProfilazioneDinamica.Templates template, string idAmministrazione, string codiceAmministrazione)
        {
            try
            {
                string serverPath = this.Server.MapPath("xml");
                return BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.disabilitaTemplate(template, idAmministrazione, serverPath, codiceAmministrazione);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: disabilitaTemplate", e);
                return false;
            }
        }

        [WebMethod]
        public virtual bool disabilitaTemplateFasc(DocsPaVO.ProfilazioneDinamica.Templates template, string idAmministrazione, string codiceAmministrazione)
        {
            try
            {
                string serverPath = this.Server.MapPath("xml");
                return BusinessLogic.ProfilazioneDinamica.ProfilazioneFascicoli.disabilitaTemplateFasc(template, idAmministrazione, serverPath, codiceAmministrazione);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: disabilitaTemplateFasc", e);
                return false;
            }
        }

        [WebMethod]
        public virtual string getIdAmmByCod(string codiceAmministrazione)
        {
            try
            {
                return BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.getIdAmmByCod(codiceAmministrazione);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: aggiungiOggettoValoreOggettoCustom", e);
                return null;
            }
        }

        [WebMethod]
        public virtual void messaInEserizioTemplate(DocsPaVO.ProfilazioneDinamica.Templates template, string idAmministrazione)
        {
            try
            {
                BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.messaInEsercizioTemplate(template, idAmministrazione);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: messaInEserizioTemplate", e);
            }
        }

        [WebMethod]
        public virtual void messaInEserizioTemplateFasc(DocsPaVO.ProfilazioneDinamica.Templates template, string idAmministrazione)
        {
            try
            {
                BusinessLogic.ProfilazioneDinamica.ProfilazioneFascicoli.messaInEsercizioTemplateFasc(template, idAmministrazione);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: messaInEserizioTemplateFasc", e);
            }
        }

        [WebMethod]
        public virtual DocsPaVO.ProfilazioneDinamica.Templates spostaOggetto(DocsPaVO.ProfilazioneDinamica.Templates template, int oggettoSelezionato, string spostamento)
        {
            try
            {
                if (spostamento.Equals("UP"))
                {
                    DocsPaVO.ProfilazioneDinamica.OggettoCustom oggettoCustom_1 = (DocsPaVO.ProfilazioneDinamica.OggettoCustom)template.ELENCO_OGGETTI[oggettoSelezionato];
                    oggettoCustom_1.POSIZIONE = (Convert.ToInt32(oggettoCustom_1.POSIZIONE) - 1).ToString();
                    DocsPaVO.ProfilazioneDinamica.OggettoCustom oggettoCustom_2 = (DocsPaVO.ProfilazioneDinamica.OggettoCustom)template.ELENCO_OGGETTI[oggettoSelezionato - 1];
                    oggettoCustom_2.POSIZIONE = (Convert.ToInt32(oggettoCustom_2.POSIZIONE) + 1).ToString();
                    //update posizione
                    BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.aggiornaPosizioni(oggettoCustom_1, oggettoCustom_2, template);
                    template.ELENCO_OGGETTI.Reverse(oggettoSelezionato - 1, 2);
                }
                if (spostamento.Equals("DOWN"))
                {
                    DocsPaVO.ProfilazioneDinamica.OggettoCustom oggettoCustom_1 = (DocsPaVO.ProfilazioneDinamica.OggettoCustom)template.ELENCO_OGGETTI[oggettoSelezionato];
                    oggettoCustom_1.POSIZIONE = (Convert.ToInt32(oggettoCustom_1.POSIZIONE) + 1).ToString();
                    DocsPaVO.ProfilazioneDinamica.OggettoCustom oggettoCustom_2 = (DocsPaVO.ProfilazioneDinamica.OggettoCustom)template.ELENCO_OGGETTI[oggettoSelezionato + 1];
                    oggettoCustom_2.POSIZIONE = (Convert.ToInt32(oggettoCustom_2.POSIZIONE) - 1).ToString();
                    //update posizione
                    BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.aggiornaPosizioni(oggettoCustom_1, oggettoCustom_2, template);
                    template.ELENCO_OGGETTI.Reverse(oggettoSelezionato, 2);
                }
                return template;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: spostaOggetto", e);
                return null;
            }
        }

        [WebMethod]
        public virtual DocsPaVO.ProfilazioneDinamica.Templates spostaOggettoFasc(DocsPaVO.ProfilazioneDinamica.Templates template, int oggettoSelezionato, string spostamento)
        {
            try
            {
                if (spostamento.Equals("UP"))
                {
                    DocsPaVO.ProfilazioneDinamica.OggettoCustom oggettoCustom_1 = (DocsPaVO.ProfilazioneDinamica.OggettoCustom)template.ELENCO_OGGETTI[oggettoSelezionato];
                    oggettoCustom_1.POSIZIONE = (Convert.ToInt32(oggettoCustom_1.POSIZIONE) - 1).ToString();
                    DocsPaVO.ProfilazioneDinamica.OggettoCustom oggettoCustom_2 = (DocsPaVO.ProfilazioneDinamica.OggettoCustom)template.ELENCO_OGGETTI[oggettoSelezionato - 1];
                    oggettoCustom_2.POSIZIONE = (Convert.ToInt32(oggettoCustom_2.POSIZIONE) + 1).ToString();
                    //update posizione
                    BusinessLogic.ProfilazioneDinamica.ProfilazioneFascicoli.aggiornaPosizioniFasc(oggettoCustom_1, oggettoCustom_2, template);
                    template.ELENCO_OGGETTI.Reverse(oggettoSelezionato - 1, 2);
                }
                if (spostamento.Equals("DOWN"))
                {
                    DocsPaVO.ProfilazioneDinamica.OggettoCustom oggettoCustom_1 = (DocsPaVO.ProfilazioneDinamica.OggettoCustom)template.ELENCO_OGGETTI[oggettoSelezionato];
                    oggettoCustom_1.POSIZIONE = (Convert.ToInt32(oggettoCustom_1.POSIZIONE) + 1).ToString();
                    DocsPaVO.ProfilazioneDinamica.OggettoCustom oggettoCustom_2 = (DocsPaVO.ProfilazioneDinamica.OggettoCustom)template.ELENCO_OGGETTI[oggettoSelezionato + 1];
                    oggettoCustom_2.POSIZIONE = (Convert.ToInt32(oggettoCustom_2.POSIZIONE) - 1).ToString();
                    //update posizione
                    BusinessLogic.ProfilazioneDinamica.ProfilazioneFascicoli.aggiornaPosizioniFasc(oggettoCustom_1, oggettoCustom_2, template);
                    template.ELENCO_OGGETTI.Reverse(oggettoSelezionato, 2);
                }
                return template;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: spostaOggettoFasc", e);
                return null;
            }
        }

        [WebMethod]
        public virtual DocsPaVO.ProfilazioneDinamica.Templates getTemplatePerRicerca(string idAmministrazione, string tipoAtto)
        {
            try
            {
                return BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.getTemplatePerRicerca(idAmministrazione, tipoAtto);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getTemplatePerRicerca", e);
                return null;
            }
        }

        [WebMethod]
        public virtual bool isValueInUse(string idOggetto, string idTemplate, string valoreOggettoDB)
        {
            try
            {
                return BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.isValueInUse(idOggetto, idTemplate, valoreOggettoDB);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: isValueInUse", e);
                return false;
            }
        }

        [WebMethod]
        public virtual bool isValueInUseFasc(string idOggetto, string idTemplate, string valoreOggettoDB)
        {
            try
            {
                return BusinessLogic.ProfilazioneDinamica.ProfilazioneFascicoli.isValueInUseFasc(idOggetto, idTemplate, valoreOggettoDB);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: isValueInUse", e);
                return false;
            }
        }

        [WebMethod]
        public virtual void salvaModelli(byte[] dati, string nomeProfilo, string codiceAmministrazione, string nomeFile, string estensione, DocsPaVO.ProfilazioneDinamica.Templates template)
        {
            try
            {
                string serverPath = System.Configuration.ConfigurationManager.AppSettings["MODELS_ROOT_PATH"];
                //string serverPath = this.Server.MapPath("xml");
                BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.salvaModelli(dati, nomeProfilo, codiceAmministrazione, nomeFile, estensione, serverPath, template);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: salvaModelli", e);
            }
        }

        [WebMethod]
        public virtual void eliminaModelli(string nomeProfilo, string codiceAmministrazione, string nomeFile, string estensione, DocsPaVO.ProfilazioneDinamica.Templates template)
        {
            try
            {
                string serverPath = System.Configuration.ConfigurationManager.AppSettings["MODELS_ROOT_PATH"];
                //string serverPath = this.Server.MapPath("xml");
                BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.eliminaModelli(nomeProfilo, codiceAmministrazione, nomeFile, estensione, serverPath, template);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: eliminaModelli", e);
            }
        }

        [WebMethod]
        public virtual bool SaveModelloStampaRicevuta(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.amministrazione.OrgRegistro registro, byte[] modelContent, bool modelPdf)
        {
            SetUserId(infoUtente);
            bool retValue = false;
            try
            {
                retValue = BusinessLogic.Amministrazione.RegistroManager.SaveModelloStampaRicevuta(infoUtente, registro, modelContent, modelPdf);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: SaveModelloStampaRicevuta ", e);
            }
            return retValue;
        }


        //[WebMethod]
        //public virtual bool SaveModelloStampaRicevutaPDF(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.amministrazione.OrgRegistro registro, byte[] modelContent)
        //{
        //    bool retValue = false;
        //    try
        //    {
        //        retValue = BusinessLogic.Amministrazione.RegistroManager.SaveModelloStampaRicevutaPDF(infoUtente, registro, modelContent);
        //    }
        //    catch (Exception e)
        //    {
        //        logger.Debug("Errore in DocsPaWS.asmx  - metodo: SaveModelloStampaRicevutaPDF ", e);
        //    }
        //    return retValue;
        //}

        [WebMethod]
        public virtual bool ContainsModelloStampaRicevuta(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.amministrazione.OrgRegistro objRegistro)
        {
            SetUserId(infoUtente);
            bool retValue = false;
            try
            {
                retValue = BusinessLogic.Amministrazione.RegistroManager.ContainsModelloStampaRicevuta(infoUtente, objRegistro);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ContainsModelloStampaRicevuta ", e);
            }
            return retValue;
        }

        [WebMethod]
        public virtual bool DeleteModelloStampaRicevuta(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.amministrazione.OrgRegistro registro)
        {
            SetUserId(infoUtente);
            bool retValue = false;
            try
            {
                retValue = BusinessLogic.Amministrazione.RegistroManager.DeleteModelloStampaRicevuta(infoUtente, registro);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DeleteModelloStampaRicevuta ", e);
            }
            return retValue;
        }

        #endregion

        #region AcquisizioneMassiva

        /// <summary>
        /// Reperimento, dal file Web.config, del percorso della cartella in cui viene fatto l'upload
        /// dei documenti per l'acquisizione massiva
        /// </summary>
        /// <returns></returns>
        [WebMethod]
        public virtual string GetPathAcquisizioneBatch()
        {
            string retValue = string.Empty;

            try
            {
                retValue = BusinessLogic.AcquisizioneMassiva.Configurations.GetPathAcquisizioneBatch();
            }
            catch (Exception ex)
            {
                logger.Debug("Errore nel reperimento del percorso della cartella in cui viene fatto l'upload", ex);
            }

            return retValue;
        }

        /// <summary>
        /// Reperimento, dal file Web.config, dell'url della WebApplication
        /// tramite la quale viene fatto l'upload dei documenti per l'acquisizione massiva
        /// </summary>
        /// <returns></returns>
        [WebMethod]
        public virtual string GetUrlUploadAcquisizione()
        {
            string retValue = string.Empty;

            try
            {
                retValue = BusinessLogic.AcquisizioneMassiva.Configurations.GetUrlUploadAcquisizione();
            }
            catch (Exception ex)
            {
                logger.Debug("Errore nel reperimento dell'url della WebApplication necessaria per l'upload", ex);
            }

            return retValue;
        }

        #endregion

        #region Destinatari Modificati
        #region destinatariModificati
        [WebMethod]
        public virtual DocsPaVO.documento.SchedaDocumento DO_AddDestinatrioModificato(DocsPaVO.documento.SchedaDocumento scheda, string systemID)
        {
            try
            {
                scheda.modOggetto = "1";
                scheda.destinatariModificati.Add(systemID);
                return scheda;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DO_AddDestinatrioModificato", e);
                return null;
            }
        }

        [WebMethod]
        public virtual DocsPaVO.documento.SchedaDocumento DO_AddDestinatrioCCModificato(DocsPaVO.documento.SchedaDocumento scheda, string systemID)
        {
            try
            {
                scheda.modOggetto = "1";
                scheda.destinatariCCModificati.Add(systemID);
                return scheda;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DO_AddDestinatrioCCModificato", e);
                return null;
            }
        }

        [WebMethod]
        public virtual DocsPaVO.documento.SchedaDocumento DO_RemoveDestinatrioModificato(DocsPaVO.documento.SchedaDocumento scheda, string systemID)
        {
            try
            {
                if (scheda.destinatariModificati.IndexOf(systemID) != -1)
                {
                    scheda.modOggetto = "1";
                    scheda.destinatariModificati.Remove(systemID);
                }
                return scheda;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DO_AddDestinatrioModificato", e);
                return null;
            }
        }
        #endregion

        #region destinatariCCModificati
        [WebMethod]
        public virtual DocsPaVO.documento.SchedaDocumento DO_ClearDestinatariModificati(DocsPaVO.documento.SchedaDocumento scheda)
        {
            try
            {
                scheda.destinatariModificati.Clear();
                return scheda;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DO_ClearDestinatariModificati", e);
                return null;
            }
        }

        [WebMethod]
        public virtual DocsPaVO.documento.SchedaDocumento DO_ClearDestinatariCCModificati(DocsPaVO.documento.SchedaDocumento scheda)
        {
            try
            {
                scheda.destinatariCCModificati.Clear();
                return scheda;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DO_ClearDestinatariCCModificati", e);
                return null;
            }
        }

        [WebMethod]
        public virtual DocsPaVO.documento.SchedaDocumento DO_RemoveDestinatrioCCModificato(DocsPaVO.documento.SchedaDocumento scheda, string systemID)
        {
            try
            {
                if (scheda.destinatariCCModificati.IndexOf(systemID) != -1)
                {
                    scheda.destinatariCCModificati.Remove(systemID);
                }
                return scheda;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DO_AddDestinatrioModificato", e);
                return null;
            }
        }
        #endregion

        [WebMethod]
        public virtual bool DO_TrasmettiDestinatariModificati(DocsPaVO.documento.SchedaDocumento scheda, DocsPaVO.utente.Ruolo ruolo, string serverName)
        {
            bool result = false;
            BusinessLogic.trasmissioni.TrasmProtoIntManager trasmProtoInt = new BusinessLogic.trasmissioni.TrasmProtoIntManager();
            try
            {
                DocsPaVO.trasmissione.Trasmissione trasmissione = trasmProtoInt.SetCorrModificatiTrasmissione(scheda, ruolo);
                if (trasmissione != null)
                {
                    // Salvataggio e Esecuzione della trasmissione solamente se il destinatario != mittente
                    this.TrasmissioneSaveTrasm(trasmissione);
                    this.TrasmissioneExecuteTrasm(serverName, trasmissione);
                    result = true;
                }

            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DO_TrasmettiDestinatariModificati", e);
                result = false;
            }
            return result;
        }

        [WebMethod]
        public virtual bool DocumentoGetSeDocFascicolato(string idDocumento)
        {
            bool result = false;
            try
            {
                result = BusinessLogic.Documenti.DocManager.getSeDocFascicolato(idDocumento);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoGetSeDocFascicolato", e);
                result = false;
            }
            return result;
        }

        //visualizzazione storia del documento
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.documento.LogDocumento))]
        public virtual ArrayList DocumentoGetListaLog(string idOggetto, string varOggetto)
        {
            ArrayList res = null;
            try
            {
                res = BusinessLogic.Documenti.Oggettario.getListaLog(idOggetto, varOggetto);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoGetListaLog", e);
                res = null;
            }
            return res;
        }


        //storicizzazione Mittente e Mittente Intermedio
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.documento.StoricoMittente))]
        public virtual ArrayList DO_GetListaStoriciMittente(string idProfile, string tipo)
        {
            ArrayList res = null;
            try
            {

                res = BusinessLogic.Utenti.DirittiManager.getListaStoriciMittenti(idProfile, tipo);

            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: documentoGetListaStoriciMittente", e);
                res = null;
            }
            return res;
        }
        #endregion

        #region Liste_Distribuzione
        [WebMethod]
        public virtual bool isUniqueCodLista(string codLista, string idAmm)
        {
            try
            {
                return BusinessLogic.Rubrica.ListeDistribuzione.isUniqueCodLista(codLista, idAmm);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: isUniqueCodLista", e);
                return false;
            }
        }
        [WebMethod]
        public virtual bool isUniqueCod(string codLista, string idAmm)
        {
            try
            {
                return BusinessLogic.Rubrica.ListeDistribuzione.isUniqueCod(codLista, idAmm);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: isUniqueCod", e);
                return false;
            }
        }

        [WebMethod]
        public virtual bool isUniqueNomeLista(string nomeLista, string idAmm)
        {
            try
            {
                return BusinessLogic.Rubrica.ListeDistribuzione.isUniqueNomeLista(nomeLista, idAmm);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: isUniqueNomeLista", e);
                return false;
            }
        }

        [WebMethod]
        public virtual string getCodiceLista(string idLista)
        {
            try
            {
                return BusinessLogic.Rubrica.ListeDistribuzione.getCodiceLista(idLista);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getCodiceLista", e);
                return null;
            }
        }

        [WebMethod]
        public virtual string getRuoloOrUserLista(string idLista)
        {
            try
            {
                return BusinessLogic.Rubrica.ListeDistribuzione.getRuoloOrUserLista(idLista);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getRuoloOrUserLista", e);
                return null;
            }
        }

        [WebMethod]
        public virtual ArrayList getCorrispondentiByCodLista(string codiceLista, string idAmm, InfoUtente infoUtente)
        {
            ArrayList corr = new ArrayList();
            try
            {
                corr = BusinessLogic.Rubrica.ListeDistribuzione.getCorrispondentiByCodLista(codiceLista, idAmm, infoUtente);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getCorrispondentiByCodLista", e);
                return null;
            }
            return corr;
        }

        /// <summary>
        /// Se la lista  visibile all'utente in input, restituisce i corrispondenti della lista
        /// </summary>
        /// <param name="codiceLista"></param>
        /// <param name="idAmm"></param>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual ArrayList getCorrispondentiByCodListaByUtente(string codiceLista, string idAmm, InfoUtente infoUtente)
        {
            ArrayList corr = new ArrayList();
            try
            {
                corr = BusinessLogic.Rubrica.ListeDistribuzione.getCorrispondentiByCodListaByUtente(codiceLista, idAmm, infoUtente);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getCorrispondentiByCodListaByUtente", e);
                return null;
            }
            return corr;
        }

        [WebMethod]
        public virtual string getNomeRF(string codiceRF)
        {
            try
            {
                return BusinessLogic.Rubrica.RF.getNomeRF(codiceRF);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getNomeRF", e);
                return null;
            }
        }

        [WebMethod]
        public virtual string getSystemIdRF(string codiceRF)
        {
            try
            {
                return BusinessLogic.Rubrica.RF.getSystemIdRF(codiceRF);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getSystemIdRF", e);
                return null;
            }
        }

        [WebMethod]
        public virtual string getNomeLista(string codiceLista, string idAmm)
        {
            try
            {
                return BusinessLogic.Rubrica.ListeDistribuzione.getNomeLista(codiceLista, idAmm);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getNomeLista", e);
                return null;
            }
        }

        [WebMethod]
        public virtual string getSystemIdLista(string codiceLista)
        {
            try
            {
                return BusinessLogic.Rubrica.ListeDistribuzione.getSystemIdLista(codiceLista);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getSystemIdLista", e);
                return null;
            }
        }

        [WebMethod]
        public virtual DataSet getListePerModificaUt(DocsPaVO.utente.InfoUtente infoUtente)
        {
            try
            {
                SetUserId(infoUtente);
                return BusinessLogic.Rubrica.ListeDistribuzione.getListePerModificaUt(infoUtente.idPeople, infoUtente.idGruppo);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getListePerModificaUt", e);
                return null;
            }
        }

        [WebMethod]
        public virtual DataSet getListePerRuoloUt(DocsPaVO.utente.InfoUtente infoUtente)
        {
            try
            {
                SetUserId(infoUtente);
                return BusinessLogic.Rubrica.ListeDistribuzione.getListePerRuoloUt(infoUtente.idPeople, infoUtente.idGruppo);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getListePerRuoloUt", e);
                return null;
            }
        }

        [WebMethod]
        public virtual DataSet getListeDistribuzioneUt(DocsPaVO.utente.InfoUtente infoUtente)
        {
            try
            {
                SetUserId(infoUtente);
                return BusinessLogic.Rubrica.ListeDistribuzione.getListe(infoUtente.idCorrGlobali, infoUtente.idAmministrazione);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getListeDistribuzione", e);
                return null;
            }
        }

        [WebMethod]
        public virtual DataSet isCorrInListaDistr(string idCorr)
        {
            try
            {
                return BusinessLogic.Rubrica.ListeDistribuzione.isCorrInListaDistr(idCorr);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: isCorrInListaDistr", e);
                return null;
            }
        }

        [WebMethod]
        public virtual DataSet getListeDistribuzioneAmm(string idAmm)
        {
            try
            {
                return BusinessLogic.Rubrica.ListeDistribuzione.getListe(idAmm);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getListeDistribuzione", e);
                return null;
            }
        }

        [WebMethod]
        public virtual void deleteListaDistribuzione(string codiceLista)
        {
            try
            {
                BusinessLogic.Rubrica.ListeDistribuzione.deleteLista(codiceLista);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: deleteListaDistribuzione", e);
            }
        }

        [WebMethod]
        public virtual DataSet getCorrispondentiLista(string codiceLista)
        {
            try
            {
                return BusinessLogic.Rubrica.ListeDistribuzione.getCorrispondentiLista(codiceLista);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getCorrispondentiLista", e);
                return null;
            }
        }

        [WebMethod]
        public virtual void deleteCorrListaDistribuzione(string codiceCorr)
        {
            try
            {
                BusinessLogic.Rubrica.ListeDistribuzione.deleteCorrLista(codiceCorr);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: deleteCorrListaDistribuzione", e);
            }
        }

        [WebMethod]
        public virtual DataSet ricercaCorrispondentiLista(string p_ricercaDescrizione)
        {
            try
            {
                return BusinessLogic.Rubrica.ListeDistribuzione.ricercaCorrLista(p_ricercaDescrizione);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ricercaCorrispondentiLista", e);
                return null;
            }
        }

        [WebMethod]
        public virtual void salvaLista(DataSet dsCorrLista, string nomeLista, string codiceLista, string idUtente, string idAmm)
        {
            SetUserId(idUtente);
            try
            {
                BusinessLogic.Rubrica.ListeDistribuzione.salvaLista(dsCorrLista, nomeLista, codiceLista, idUtente, idAmm);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: salvaLista", e);
            }
        }

        [WebMethod]
        public virtual void salvaListaGruppo(DataSet dsCorrLista, string nomeLista, string codiceLista, string idUtente, string idAmm, string gruppo, DocsPaVO.utente.InfoUtente infoUtente)
        {
            SetUserId(infoUtente);
            int idLista = 0;
            try
            {
                idLista = BusinessLogic.Rubrica.ListeDistribuzione.salvaListaGruppo(dsCorrLista, nomeLista, codiceLista, idUtente, idAmm, gruppo);
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "TRASMISSIONELISTADISTR", idLista.ToString(), "Inserimento nuova lista distribuzione: " + nomeLista, DocsPaVO.Logger.CodAzione.Esito.OK);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: salvaLista", e);
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "TRASMISSIONELISTADISTR", idLista.ToString(), "Inserimento nuova lista distribuzione: " + nomeLista, DocsPaVO.Logger.CodAzione.Esito.KO);
            }
        }

        [WebMethod]
        public virtual void modificaListaGruppo(DataSet dsCorrLista, string idLista, string nomeLista, string codiceLista, string idGruppo)
        {
            try
            {
                BusinessLogic.Rubrica.ListeDistribuzione.modificaListaGruppo(dsCorrLista, idLista, nomeLista, codiceLista, idGruppo);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: modificaListaGruppo", e);
            }
        }


        [WebMethod]
        public virtual void modificaListaUser(DataSet dsCorrLista, string idLista, string nomeLista, string codiceLista, string idUtente)
        {
            try
            {
                BusinessLogic.Rubrica.ListeDistribuzione.modificaListaUser(dsCorrLista, idLista, nomeLista, codiceLista, idUtente);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: modificaListaUser", e);
            }
        }

        [WebMethod]
        public virtual void modificaLista(DataSet dsCorrLista, string idLista, string nomeLista, string codiceLista)
        {
            try
            {
                BusinessLogic.Rubrica.ListeDistribuzione.modificaLista(dsCorrLista, idLista, nomeLista, codiceLista);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: modificaLista", e);
            }
        }

        [WebMethod]
        public virtual void modificaListaCorr(DataSet dsCorrLista, string idLista)
        {
            try
            {
                BusinessLogic.Rubrica.ListeDistribuzione.modificaListaCorr(dsCorrLista, idLista);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: modificaLista", e);
            }
        }

        [WebMethod]
        [XmlInclude(typeof(DocsPaVO.rubrica.ElementoRubrica))]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.rubrica.ElementoRubrica))]
        public virtual ArrayList filtra_trasmissioniPerListe(DocsPaVO.rubrica.ParametriRicercaRubrica qc, DocsPaVO.utente.InfoUtente u, DocsPaVO.rubrica.ElementoRubrica[] ers)
        {
            SetUserId(u);
            try
            {
                BusinessLogic.Rubrica.DPA3_RubricaSearchAgent ccs = new BusinessLogic.Rubrica.DPA3_RubricaSearchAgent(u);
                return ccs.filtra_trasmissioniPerListe(qc, ers);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: filtra_trasmissioniPerListe - ", e);
            }
            return null;
        }
        #endregion Liste_Distribuzione

        /// <summary>
        /// Ritorna il codice dell'RF della dpa_el_registri dal system id della dpa_corr_globali
        /// </summary>
        /// <param name="systemId"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual string getCodRFFromSysIdCorrGlob(string systemId)
        {
            try
            {
                return BusinessLogic.Amministrazione.RegistroManager.getCodRFFromSysIdCorrGlob(systemId);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getUtenteInternoAOO", e);
                return null;
            }
        }

        [WebMethod]
        public virtual ArrayList getCorrispondentiByCodRF(string codiceRF)
        {
            ArrayList corr = new ArrayList();
            try
            {
                corr = BusinessLogic.Rubrica.RF.getCorrispondentiByCodRF(codiceRF);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getCorrispondentiByCodRF", e);
                return null;
            }
            return corr;
        }

        [WebMethod]
        public virtual string getCheckInteropFromSysIdCorrGlob(string systemId)
        {
            string check = string.Empty;
            try
            {
                check = BusinessLogic.interoperabilita.InteroperabilitaManager.getCheckInteropFromSysIdCorrGlob(systemId);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getCheckInteropFromSysIdCorrGlob", e);
                return null;
            }
            return check;
        }

        /// <summary>
        /// Invio la ricevuta di ritorno se l'atto della protocollazione  andato a buon fine
        /// </summary>
        /// <param name="idProfile"></param>
        /// <param name="registro"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual bool ProtocolloInvioRicevutaDiRitorno(DocsPaVO.documento.SchedaDocumento schedaDoc, DocsPaVO.utente.Registro registro, DocsPaVO.utente.Ruolo ruolo, DocsPaVO.utente.InfoUtente infoUtente, out string errorMessage)
        {
            SetUserId(infoUtente);
            bool result = true; // Presume successo
            errorMessage = string.Empty;
            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                BusinessLogic.Interoperabilit.InteroperabilitaInvioRicevuta.sendRicevutaRitorno(schedaDoc, registro, ruolo, infoUtente, out errorMessage);

#if TRACE_WS
				pt.WriteLogTracer("ProtocolloInvioRicevutaDiRitorno");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ProtocolloInvioRicevutaDiRitorno", e);
                result = false;
            }

            return result;
        }




        /// <summary>
        /// Invio la notifica di annullamento se il documento arrivato per interoperabilit  stato annullato
        /// </summary>
        /// <param name="idProfile"></param>
        /// <param name="registro"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual bool ProtocolloInvioNotificaAnnulla(string idProfile, DocsPaVO.utente.Registro registro)
        {
            bool result = true; // Presume successo

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Interoperabilit.InteroperabilitaInvioAnnullamento.sendNotificaAnnullamento(idProfile, registro);

#if TRACE_WS
				pt.WriteLogTracer("ProtocolloInvioRicevutaDiRitorno");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ProtocolloInvioAnnullamento", e);

                result = false;
            }

            return result;
        }

        #region ModelliTrasmissioni

        [WebMethod]
        public virtual ArrayList getModelliPerTrasm(string idAmm, DocsPaVO.utente.Registro[] registri, string idPeople, string idCorrGlobali, string idTipoDoc, string idDiagramma, string idStato, string cha_tipo_oggetto, string system_id, string idRuoloUtente, bool AllReg, string accessrights)
        {
            try
            {
                return BusinessLogic.Trasmissioni.ModelliTrasmissioni.getModelliPerTrasm(idAmm, registri, idPeople, idCorrGlobali, idTipoDoc, idDiagramma, idStato, cha_tipo_oggetto, system_id, idRuoloUtente, AllReg, accessrights);

            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getModelliPerTrasm", e);
                return null;
            }
        }

        [WebMethod]
        public virtual bool isUniqueCodModelloTrasm(DocsPaVO.Modelli_Trasmissioni.ModelloTrasmissione modello)
        {
            try
            {
                return BusinessLogic.Trasmissioni.ModelliTrasmissioni.isUniqueCodModelloTrasm(modello);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: isUniqueCodModelloTrasm", e);
                return false;
            }
        }

        [WebMethod]
        public virtual string salvaModello(DocsPaVO.Modelli_Trasmissioni.ModelloTrasmissione modelloTrasmissione, DocsPaVO.utente.InfoUtente infoUtente)
        {
            SetUserId(infoUtente);
            string result = string.Empty;
            try
            {
                result = BusinessLogic.Trasmissioni.ModelliTrasmissioni.salvaModello(modelloTrasmissione);
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "TRASMISSIONEINSMOD", modelloTrasmissione.SYSTEM_ID.ToString(), "Inserimento nuovo modello trasm: " + modelloTrasmissione.NOME + " da utente " + infoUtente.userId, DocsPaVO.Logger.CodAzione.Esito.OK);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: salvaModello", e);
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "TRASMISSIONEINSMOD", modelloTrasmissione.SYSTEM_ID.ToString(), "Inserimento nuovo modello trasm: " + modelloTrasmissione.NOME + " da utente " + infoUtente.userId, DocsPaVO.Logger.CodAzione.Esito.KO);
            }
            return result;
        }

        [WebMethod]
        public virtual ArrayList getRuoliByAmm(string idAmm, string codiceRicerca, string tipoRicerca)
        {
            ArrayList listaRuoli = new ArrayList();
            try
            {
                return BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.getRuoliByAmm(idAmm, codiceRicerca, tipoRicerca);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getRuoliByAmm", e);
                return null;
            }
        }

        [WebMethod]
        public virtual ArrayList getModelliByAmm(string idAmm)
        {
            ArrayList listaModelli = new ArrayList();
            try
            {
                listaModelli = BusinessLogic.Trasmissioni.ModelliTrasmissioni.getModelliByAmm(idAmm);
                return listaModelli;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getModelliByAmm", e);
                return null;
            }
        }

        [WebMethod]
        public virtual ArrayList getModelliByAmmLite(string idAmm)
        {
            ArrayList listaModelli = new ArrayList();
            try
            {
                listaModelli = BusinessLogic.Trasmissioni.ModelliTrasmissioni.getModelliByAmmLite(idAmm);
                return listaModelli;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getModelliByAmm", e);
                return null;
            }
        }

        [WebMethod]
        public virtual ArrayList getModelliByAmmPaging(string idAmm, int nPagina, string ricerca, string codice, out int numTotPag)
        {
            ArrayList listaModelli = new ArrayList();
            numTotPag = 0;
            try
            {
                listaModelli = BusinessLogic.Trasmissioni.ModelliTrasmissioni.getModelliByAmmPaging(idAmm, nPagina, ricerca, codice, out numTotPag);
                return listaModelli;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getModelliByAmmPaging", e);
                return null;
            }
        }

        [WebMethod]
        public virtual string getModelloSystemId()
        {
            string systemId = string.Empty;
            try
            {
                systemId = BusinessLogic.Trasmissioni.ModelliTrasmissioni.getModelloSystemId();
                return systemId;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getModelloSystemId", e);
                return null;
            }
        }

        [WebMethod]
        public virtual ArrayList getModelliUtente(DocsPaVO.utente.Utente utente, DocsPaVO.utente.InfoUtente infoUt, DocsPaVO.filtri.FiltroRicerca[] filtriRicerca)
        {
            SetUserId(utente);
            ArrayList listaModelli = new ArrayList();
            try
            {
                listaModelli = BusinessLogic.Trasmissioni.ModelliTrasmissioni.getModelliUtente(utente, infoUt, filtriRicerca);
                return listaModelli;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getModelliUtente", e);
                return null;
            }
        }

        [WebMethod]
        public virtual DocsPaVO.Modelli_Trasmissioni.ModelloTrasmissione getModelloByID(string idAmm, string idModello)
        {

            try
            {
                return BusinessLogic.Trasmissioni.ModelliTrasmissioni.getModelloByID(idAmm, idModello);

            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getModelloByID", e);
                return null;
            }
        }

        [WebMethod]
        public virtual void CancellaModello(string idAmm, string idModello)
        {

            try
            {
                BusinessLogic.Trasmissioni.ModelliTrasmissioni.CancellaModello(idAmm, idModello);

            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: CancellaModello", e);
            }
        }

        [WebMethod]
        public virtual void CancellaDestModello(string idRagione, string varCodRubrica, string idModello)
        {

            try
            {
                BusinessLogic.Trasmissioni.ModelliTrasmissioni.CancellaDestModello(idRagione, varCodRubrica, idModello);

            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: CancellaDestModello", e);
            }
        }





        #endregion ModelliTrasmissioni

        #region DiagrammiStato
        [WebMethod]
        public virtual void cambiaDirittiDocumenti(int accessRight, string idDocumento)
        {
            try
            {
                BusinessLogic.Documenti.DocManager.cambiaDirittiDocumenti(accessRight, idDocumento);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: documentoSolaLettura", e);
            }
        }

        [WebMethod]
        public virtual void salvaDiagramma(DocsPaVO.DiagrammaStato.DiagrammaStato dg, string idAmm)
        {
            try
            {
                BusinessLogic.DiagrammiStato.DiagrammiStato.salvaDiagramma(dg, idAmm);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: salvaDiagramma", e);
            }
        }

        [WebMethod]
        public virtual DocsPaVO.DiagrammaStato.DiagrammaStato getDiagrammaById(string idDiagramma)
        {
            try
            {
                return BusinessLogic.DiagrammiStato.DiagrammiStato.getDiagrammaById(idDiagramma);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getDiagrammaById", e);
                return null;
            }
        }

        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.DiagrammaStato.DiagrammaStato))]
        public virtual ArrayList getDiagrammi(string idAmm)
        {
            try
            {
                return BusinessLogic.DiagrammiStato.DiagrammiStato.getDiagrammi(idAmm);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getDiagrammi", e);
                return null;
            }
        }

        [WebMethod]
        public virtual bool isUniqueNameDiagramma(string nomeDiagramma)
        {
            try
            {
                return BusinessLogic.DiagrammiStato.DiagrammiStato.isUniqueNameDiagramma(nomeDiagramma);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: isUniqueNameDiagramma", e);
                return false;
            }
        }

        [WebMethod]
        public virtual void delDiagramma(DocsPaVO.DiagrammaStato.DiagrammaStato dg)
        {
            try
            {
                BusinessLogic.DiagrammiStato.DiagrammiStato.delDiagramma(dg);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: delDiagramma", e);
            }
        }

        [WebMethod]
        public virtual void updateDiagramma(DocsPaVO.DiagrammaStato.DiagrammaStato dg)
        {
            try
            {
                BusinessLogic.DiagrammiStato.DiagrammiStato.updateDiagramma(dg);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: updateDiagramma", e);
            }
        }

        [WebMethod]
        public virtual bool associaTipoDocDiagramma(string idTipoDoc, string idDiagramma)
        {
            try
            {
                return BusinessLogic.DiagrammiStato.DiagrammiStato.associaTipoDocDiagramma(idTipoDoc, idDiagramma);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: associaTipoDocDiagramma", e);
                return false;
            }
        }

        [WebMethod]
        public virtual void disassociaTipoDocDiagramma(string idTipoDoc)
        {
            try
            {
                BusinessLogic.DiagrammiStato.DiagrammiStato.disassociaTipoDocDiagramma(idTipoDoc);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: disassociaTipoDocDiagramma", e);
            }
        }

        [WebMethod]
        public virtual int getDiagrammaAssociato(string idTipoDoc)
        {
            try
            {
                return BusinessLogic.DiagrammiStato.DiagrammiStato.getDiagrammaAssociato(idTipoDoc);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getDiagrammaAssociato", e);
                return 0;
            }
        }

        [WebMethod]
        public virtual bool isModificabile(int systemIdDiagramma)
        {
            try
            {
                return BusinessLogic.DiagrammiStato.DiagrammiStato.isModificabile(systemIdDiagramma);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: isModificabile", e);
                return false;
            }
        }

        [WebMethod]
        public virtual DocsPaVO.DiagrammaStato.DiagrammaStato getDgByIdTipoDoc(string systemIdTipoDoc, string idAmm)
        {
            try
            {
                if (systemIdTipoDoc != "")
                    return BusinessLogic.DiagrammiStato.DiagrammiStato.getDgByIdTipoDoc(systemIdTipoDoc, idAmm);
                else
                    return null;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getDgByIdTipoDoc", e);
                return null;
            }
        }

        [WebMethod]
        public virtual void salvaModificaStato(string docNumber, string idStato, DocsPaVO.DiagrammaStato.DiagrammaStato diagramma, string idUtente, DocsPaVO.utente.InfoUtente user, string dataScadenza)
        {
            SetUserId(user);
            DocsPaVO.DiagrammaStato.Stato[] stati = (DocsPaVO.DiagrammaStato.Stato[])diagramma.STATI.ToArray(typeof(DocsPaVO.DiagrammaStato.Stato));
            DocsPaVO.DiagrammaStato.Stato stato = stati.Where(e => e.SYSTEM_ID.ToString() == idStato).First();
            try
            {
                BusinessLogic.DiagrammiStato.DiagrammiStato.salvaModificaStato(docNumber, idStato, diagramma, idUtente, user, dataScadenza);
                BusinessLogic.UserLog.UserLog.WriteLog(user.userId, user.idPeople, user.idGruppo, user.idAmministrazione, "DOC_CAMBIO_STATO", docNumber, String.Format("Stato passato a  {0}", stato.DESCRIZIONE.ToUpper()), DocsPaVO.Logger.CodAzione.Esito.OK,
                    user.delegato, "1");

                string resultExternalService = BusinessLogic.ExternalServices.ExternalServicesManager.AvviaAzioniEsterne(user, docNumber, diagramma.SYSTEM_ID);

                string statoPrecedente = (int.Parse(idStato) - 1).ToString();
                switch (resultExternalService)
                {
                    case "-3":
                        //Che stato Imposto?
                        //Sarebbe opportuno avere uno stato tipo "MANCA FIRMA DIGITALE"
                        //Per ora reimposto lo stato precedente                    
                        stato = stati.Where(e => e.SYSTEM_ID.ToString() == statoPrecedente).First();
                        BusinessLogic.DiagrammiStato.DiagrammiStato.salvaModificaStato(docNumber, statoPrecedente, diagramma, idUtente, user, dataScadenza);
                        BusinessLogic.UserLog.UserLog.WriteLog(user.userId, user.idPeople, user.idGruppo, user.idAmministrazione, "DOC_CAMBIO_STATO", docNumber, String.Format("Stato passato a  {0}", stato.DESCRIZIONE.ToUpper()), DocsPaVO.Logger.CodAzione.Esito.OK,
                            user.delegato, "1");
                        break;
                    case "-2":
                        //Che stato Imposto?
                        //Sarebbe opportuno avere uno stato tipo "MANCATA CONNESSIONE A SDI"
                        //Per ora reimposto lo stato precedente                    
                        stato = stati.Where(e => e.SYSTEM_ID.ToString() == statoPrecedente).First();
                        BusinessLogic.DiagrammiStato.DiagrammiStato.salvaModificaStato(docNumber, statoPrecedente, diagramma, idUtente, user, dataScadenza);
                        BusinessLogic.UserLog.UserLog.WriteLog(user.userId, user.idPeople, user.idGruppo, user.idAmministrazione, "DOC_CAMBIO_STATO", docNumber, String.Format("Stato passato a  {0}", stato.DESCRIZIONE.ToUpper()), DocsPaVO.Logger.CodAzione.Esito.OK,
                            user.delegato, "1");
                        break;
                    case "-1":
                        //Che stato Imposto?
                        //Sarebbe opportuno avere uno stato tipo "ERRORE INTERNO A SDI"
                        //Per ora reimposto lo stato precedente
                        stato = stati.Where(e => e.SYSTEM_ID.ToString() == statoPrecedente).First();
                        BusinessLogic.DiagrammiStato.DiagrammiStato.salvaModificaStato(docNumber, statoPrecedente, diagramma, idUtente, user, dataScadenza);
                        BusinessLogic.UserLog.UserLog.WriteLog(user.userId, user.idPeople, user.idGruppo, user.idAmministrazione, "DOC_CAMBIO_STATO", docNumber, String.Format("Stato passato a  {0}", stato.DESCRIZIONE.ToUpper()), DocsPaVO.Logger.CodAzione.Esito.OK,
                            user.delegato, "1");
                        break;
                    case "1":
                        //Imposto in uno stato tipo "ATTESA RISPOSTA" ?
                        break;
                }


            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(user, "DOC_CAMBIO_STATO", docNumber, String.Format("Stato passato a  {0}", stato.DESCRIZIONE.ToUpper()), DocsPaVO.Logger.CodAzione.Esito.KO);
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: salvaModificaStato", e);

            }
        }

        //Verifica se alla stato  associata una trasmissione automatica 
        //eventualmente ritorna il modello della trasmissione
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.Modelli_Trasmissioni.ModelloTrasmissione))]
        public virtual ArrayList isStatoTrasmAuto(string idAmm, string idStato, string idTemplate)
        {
            try
            {
                return BusinessLogic.DiagrammiStato.DiagrammiStato.isStatoTrasmAuto(idAmm, idStato, idTemplate);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: isStatoTrasmAuto", e);
                return null;
            }
        }

        [WebMethod]
        public virtual bool isStatoAuto(string idStato, string idDiagramma)
        {
            try
            {
                return BusinessLogic.DiagrammiStato.DiagrammiStato.isStatoAuto(idStato, idDiagramma);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: isStatoAuto", e);
                return false;
            }
        }

        [WebMethod]
        public virtual DocsPaVO.DiagrammaStato.Stato getStatoDoc(string docNumber)
        {
            try
            {
                return BusinessLogic.DiagrammiStato.DiagrammiStato.getStatoDoc(docNumber);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getStatoDoc", e);
                return null;
            }
        }

        [WebMethod]
        public virtual bool getDocOrFascInStato(string idStato)
        {
            try
            {
                return BusinessLogic.DiagrammiStato.DiagrammiStato.getDocOrFascInStato(idStato);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getDocOrFascInStato", e);
                return false;
            }
        }

        [WebMethod]
        public virtual string getStatoDocStorico(string docNumber)
        {
            try
            {
                return BusinessLogic.DiagrammiStato.DiagrammiStato.getStatoDocStorico(docNumber);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getStatoDocStorico", e);
                return null;
            }
        }

        [WebMethod]
        public virtual DataSet getDiagrammaStoricoDoc(string docNumber)
        {
            try
            {
                return BusinessLogic.DiagrammiStato.DiagrammiStato.getDiagrammaStoricoDoc(docNumber);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getDiagrammaStoricoDoc", e);
                return null;
            }
        }

        [WebMethod]
        public virtual void salvaStoricoTrasmDiagrammi(string idTrasm, string docNumber, string idStato)
        {
            try
            {
                BusinessLogic.DiagrammiStato.DiagrammiStato.salvaStoricoTrasmDiagrammi(idTrasm, docNumber, idStato);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: salvaStoricoTrasmDiagrammi", e);
            }
        }

        [WebMethod]
        public virtual void deleteStoricoTrasmDiagrammi(string docNumber, string idStato)
        {
            try
            {
                BusinessLogic.DiagrammiStato.DiagrammiStato.deleteStoricoTrasmDiagrammi(docNumber, idStato);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: deleteStoricoTrasmDiagrammi", e);
            }
        }

        [WebMethod]
        public virtual bool isUltimaDaAccettare(string idTrasmissione)
        {
            try
            {
                return BusinessLogic.DiagrammiStato.DiagrammiStato.isUltimaDaAccettare(idTrasmissione);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: isUltimaDaAccettare", e);
                return false;
            }
        }

        [WebMethod]
        public virtual DocsPaVO.DiagrammaStato.Stato getStatoSuccessivoAutomatico(string docNumber)
        {
            try
            {
                return BusinessLogic.DiagrammiStato.DiagrammiStato.getStatoSuccessivoAutomatico(docNumber);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getStatoSuccessivoAutomatico", e);
                return null;
            }
        }

        [WebMethod]
        public virtual bool isDocumentiInStatoFinale(string idDiagramma, string idTemplate)
        {
            try
            {
                return BusinessLogic.DiagrammiStato.DiagrammiStato.isDocumentiInStatoFinale(idDiagramma, idTemplate);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: isDocumentiInStatoFinale", e);
                return false;
            }
        }
        #endregion

        [WebMethod]
        public virtual string[] getUtenteInternoAOO(string idPeople, string systemIdRegistro, DocsPaVO.utente.InfoUtente user)
        {
            try
            {
                BusinessLogic.Rubrica.DPA3_RubricaSearchAgent dpa3 = new BusinessLogic.Rubrica.DPA3_RubricaSearchAgent(user);
                return dpa3.getUtenteInternoAOO(idPeople, systemIdRegistro);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getUtenteInternoAOO", e);
                return null;
            }
        }

        [WebMethod]
        public virtual DocsPaVO.trasmissione.RagioneTrasmissione getRagione(string tipoDest, string idAmm)
        {
            DocsPaVO.trasmissione.RagioneTrasmissione ragTrasm = null;
            try
            {
                ragTrasm = BusinessLogic.Trasmissioni.RagioniManager.GetRagione(tipoDest, idAmm);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getRagione", e);
                return ragTrasm;
            }
            return ragTrasm;
        }

        [WebMethod]
        public virtual DocsPaVO.trasmissione.RagioneTrasmissione getRagioneById(string idRagione)
        {
            DocsPaVO.trasmissione.RagioneTrasmissione ragTrasm = null;
            try
            {
                ragTrasm = BusinessLogic.Trasmissioni.QueryTrasmManager.getRagioneById(idRagione);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getRagioneById", e);
                return ragTrasm;
            }
            return ragTrasm;
        }

        [WebMethod]
        public virtual void scriviLog(DocsPaVO.documento.SchedaDocumento schedaDocumento, DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.utente.Ruolo ruolo)
        {
            SetUserId(infoUtente);
            try
            {
                string VarDescOggetto;
                if (schedaDocumento.protocollo != null)
                    VarDescOggetto = string.Format("{0}{1} / {2}{3}", "Stampa etichetta - N.ro Doc.: ", schedaDocumento.docNumber, "Segnatura: ", schedaDocumento.protocollo.segnatura);
                else
                    VarDescOggetto = string.Format("{0}{1}", "Stampa etichetta - N.ro Doc.: ", schedaDocumento.docNumber);

                if (schedaDocumento.systemId != "0")
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOSTAMPAETICHETTA", schedaDocumento.systemId, VarDescOggetto, DocsPaVO.Logger.CodAzione.Esito.OK);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: scriviLog", e);

            }
        }

        [WebMethod]
        public virtual void updateStampeDocumentoEffettuate(InfoUtente info, int numStampeEffettuate, int numStampe, string idProfile)
        {
            DocsPaVO.Logger.CodAzione.Esito logResponse = DocsPaVO.Logger.CodAzione.Esito.OK;
            int stampaTo = Convert.ToInt32(numStampe) + Convert.ToInt32(numStampeEffettuate);

            try
            {
                BusinessLogic.Documenti.ProtoManager.updateStampeEffettuate(info, stampaTo.ToString(), idProfile);
            }
            catch (Exception ex)
            {

                throw DocsPaUtils.Exceptions.SoapExceptionFactory.Create(ex);
            }

            finally
            {

                DocsPaVO.documento.InfoDocumento documentInfo = BusinessLogic.Documenti.DocManager.GetInfoDocumento(info, idProfile, idProfile);

                string description = string.Empty;
                int stampaFrom = Convert.ToInt32(numStampeEffettuate) + 1;
                string[] args = { documentInfo.docNumber, documentInfo.segnatura, stampaFrom.ToString(), stampaTo.ToString() };
                description = string.Format("{0}{1}{2}{3}", "Stampate etichette da ", args[2], " a ", args[3]);

                /* else
                 {
                     string[] args = { documentInfo.docNumber, stampaFrom.ToString(), stampaTo.ToString() };
                     description = string.Format("Stampate etichette N.ro Doc.:{0} da {1} a {2}", args);
                 }*/
                BusinessLogic.UserLog.UserLog.WriteLog(info, "DOCUMENTOSTAMPAETICHETTA", idProfile, description, logResponse);
            }
        }

        [WebMethod]
        public virtual string DataFromProject(string campo, string condizione)
        {
            string retValue = string.Empty;

            try
            {
                retValue = BusinessLogic.Fascicoli.TitolarioManager.getDataFromProject(campo, condizione);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DataFromProject ", e);
            }

            return retValue;
        }

        [WebMethod]
        public virtual void resetHashTable()
        {
            BusinessLogic.Rubrica.DPA3_RubricaSearchAgent.resetHashTable();
        }

        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.utente.Registro))]
        public virtual ArrayList GetListaRegistriByRuolo(string idRuolo)
        {
            ArrayList retValue = new ArrayList();

            try
            {
                retValue = BusinessLogic.Utenti.RegistriManager.getRegistriRuolo(idRuolo);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetListaRegistriByRuolo - ", e);
            }

            return retValue;
        }

        /// <summary>
        /// UO smistamento in amm.ne
        /// </summary>
        /// <returns>stream xml</returns>
        [WebMethod]
        public string GetXMLUOSmistamento(string idRegistro)
        {
            string result = "";
            try
            {
                result = BusinessLogic.Amministrazione.RegistroManager.GetXMLUOSmistamento(idRegistro);
            }
            catch (Exception exception)
            {
                logger.Debug("Errore nel metodo WS GetXMLUOSmistamento: ", exception);
            }
            return result;
        }

        [WebMethod]
        public bool SetXMLUOSmistamento(string stream, string idRegistro)
        {
            bool result = false;
            try
            {
                result = BusinessLogic.Amministrazione.RegistroManager.SetXMLUOSmistamento(stream, idRegistro);
            }
            catch (Exception exception)
            {
                logger.Debug("Errore nel metodo WS SetXMLUOSmistamento: ", exception);
            }
            return result;
        }

        [WebMethod]
        public DocsPaVO.documento.FileDocumento StampaOrgInPdf(XmlDocument xmlDoc)
        {
            DocsPaVO.documento.FileDocumento filePdf = new DocsPaVO.documento.FileDocumento();
            try
            {
                filePdf = BusinessLogic.Amministrazione.OrganigrammaManager.StampaOrgInPdf(xmlDoc);
            }
            catch (Exception exception)
            {
                logger.Debug("Errore nel metodo WS StampaOrgInPdf: ", exception);
            }
            return filePdf;
        }

        [WebMethod]
        public DocsPaVO.ricerche.SearchItemList ListaRicercheSalvate(int idPeople, int idGruppo, string pgName, bool inADL, string tipo)
        {
            DocsPaVO.ricerche.SearchItemList outcome = new DocsPaVO.ricerche.SearchItemList();
            outcome.lista = BusinessLogic.Documenti.InfoDocManager.GetSearchList(idPeople, idGruppo, pgName, inADL, tipo);
            return outcome;
        }

        [WebMethod]
        [XmlInclude(typeof(DocsPaVO.Grid.Grid.GridTypeEnumeration))]
        public DocsPaVO.ricerche.SearchItem SalvaRicerca(DocsPaVO.ricerche.SearchItem item, DocsPaVO.utente.InfoUtente infoUtente, bool ADL, bool customGrid, string gridId, Grid tempGrid, Grid.GridTypeEnumeration gridType)
        {
            SetUserId(infoUtente);
            DocsPaVO.ricerche.SearchItem returnItem = null;
            try
            {
                returnItem = BusinessLogic.Documenti.InfoDocManager.SaveSearchItem(item, ADL, customGrid, gridId, tempGrid, infoUtente, gridType);
                if (returnItem != null)
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "SAVERICERCA", item.system_id.ToString(), "Salvataggio ricerca " + item.descrizione, DocsPaVO.Logger.CodAzione.Esito.OK);
            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "SAVERICERCA", item.system_id.ToString(), "Salvataggio ricerca " + item.descrizione, DocsPaVO.Logger.CodAzione.Esito.KO);
                logger.Debug("Errore nel salvataggio della ricerca");
            }
            return returnItem;
        }

        [WebMethod]
        public bool verificaNomeRicerca(string nome, DocsPaVO.utente.InfoUtente infoUtente, string pagina, string adl)
        {
            return BusinessLogic.Documenti.InfoDocManager.ExistsSearchName(nome, infoUtente, pagina, adl);
        }

        [WebMethod]
        public bool CancellaRicerca(int id)
        {
            return BusinessLogic.Documenti.InfoDocManager.DeleteSearchItem(id);
        }

        [WebMethod]
        public DocsPaVO.ricerche.SearchItem RecuperaRicerca(int id)
        {
            return BusinessLogic.Documenti.InfoDocManager.GetSearchItem(id);
        }

        [WebMethod]
        public bool EsisteRicerca(DocsPaVO.ricerche.SearchItem item)
        {
            return BusinessLogic.Documenti.InfoDocManager.ExistsSearchItem(item);
        }


        [WebMethod]
        public DocsPaVO.amministrazione.EsitoOperazione AmmExtendToChildNodes(DocsPaVO.utente.InfoUtente infoUtente, string idNodoTitolario, DocsPaVO.amministrazione.OrgRuoloTitolario ruoloTitolario, string idAmm, string idRegistro, bool check)
        {
            SetUserId(infoUtente);
            DocsPaVO.amministrazione.EsitoOperazione esito = new DocsPaVO.amministrazione.EsitoOperazione();

            logger.Debug("Inizio procedura di inserimento o eliminazione visibilit a tutti i nodi titolario figli di: " + idNodoTitolario);

            try
            {
                esito = BusinessLogic.Amministrazione.TitolarioManager.AmmExtendToChildNodes(infoUtente, idNodoTitolario, ruoloTitolario, idAmm, idRegistro, check);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmExtendToChildNodes", e);
                esito.Codice = 1;
                esito.Descrizione = "si  verificato un errore durante la procedura di inserimento dei diritti sui nodi del titolario";
            }

            logger.Debug("Fine procedura di inserimento visibilit");

            return esito;
        }

        #region Gestione CheckIn / CheckOut

        #region Gestione CheckIn / CheckOut per amministrazione

        /// <summary>
        /// Reperimento di tutti i documenti in stato CheckedOut
        /// </summary>
        /// <param name="idAdministration"></param>
        /// <param name="adminInfoUtente"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.CheckInOut.CheckOutStatus[] GetCheckOutAdminDocuments(DocsPaVO.utente.InfoUtente adminInfoUtente, string idAdministration)
        {
            SetUserId(adminInfoUtente);
            // TODO: Gestione log
            DocsPaVO.CheckInOut.CheckOutStatus[] retValue = null;

            try
            {
                retValue = BusinessLogic.CheckInOut.CheckInOutAdminServices.GetCheckOutDocuments(adminInfoUtente, idAdministration);
            }
            catch (Exception e)
            {
                Console.WriteLine(e.Message);
            }

            return retValue;
        }

        /// <summary>
        /// Reperimento di tutti i documenti in stato CheckedOut relativamente ad un utente
        /// </summary>
        /// <param name="adminInfoUtente"></param>
        /// <param name="idAdministrationstring"></param>
        /// <param name="idUser"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.CheckInOut.CheckOutStatus[] GetCheckOutAdminDocumentsUser(DocsPaVO.utente.InfoUtente adminInfoUtente, string idAdministration, string idUser)
        {
            SetUserId(adminInfoUtente);
            // TODO: Gestione log
            DocsPaVO.CheckInOut.CheckOutStatus[] retValue = null;

            try
            {
                retValue = BusinessLogic.CheckInOut.CheckInOutAdminServices.GetCheckOutDocuments(adminInfoUtente, idAdministration, idUser);
            }
            catch (Exception e)
            {
                Console.WriteLine(e.Message);
            }

            return retValue;
        }

        /// <summary>
        /// Annullamento dello stato CheckedOut per un documento
        /// </summary>
        /// <param name="adminInfoUtente">Utente amministratore</param>
        /// <param name="checkOutStatus"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.Validations.ValidationResultInfo ForceUndoCheckOutAdminDocument(DocsPaVO.utente.InfoUtente adminInfoUtente, DocsPaVO.CheckInOut.CheckOutStatus checkOutAdminStatus)
        {
            SetUserId(adminInfoUtente);
            // TODO: Gestione log
            DocsPaVO.Validations.ValidationResultInfo retValue = null;

            try
            {
                retValue = BusinessLogic.CheckInOut.CheckInOutAdminServices.ForceUndoCheckOut(adminInfoUtente, checkOutAdminStatus);
            }
            catch (Exception e)
            {
                Console.WriteLine(e.Message);
            }

            return retValue;
        }

        /// <summary>
        /// Verifica se lo stato CheckedOut per un documento pu 
        /// essere annullato da un utente amministratore
        /// </summary>
        /// <param name="adminInfoUtente">Utente amministratore</param>
        /// <returns></returns>
        [WebMethod()]
        public bool CanForceUndoCheckOutAdminDocument(DocsPaVO.utente.InfoUtente adminInfoUtente)
        {
            SetUserId(adminInfoUtente);
            bool retValue = false;

            try
            {
                retValue = BusinessLogic.CheckInOut.CheckInOutAdminServices.CanForceUndoCheckOut(adminInfoUtente);
            }
            catch (Exception e)
            {
                Console.WriteLine(e.Message);
            }

            return retValue;
        }

        #endregion

        /// <summary>
        /// Reperimento tipologie di modelli di documenti disponibili per il checkout
        /// a livello di singola amministrazione
        /// </summary>
        /// <param name="idAdmin"></param>
        /// <returns></returns>
        [WebMethod()]
        public string[] GetCheckOutDocumentModelTypes(int idAdmin)
        {
            string[] retValue = null;

            try
            {
                retValue = BusinessLogic.CheckInOut.CheckInOutModels.GetDocumentModelTypes(idAdmin);
            }
            catch (Exception e)
            {
                Console.WriteLine(e.Message);
            }

            return retValue;
        }

        /// <summary>
        /// Reperimento del file in stato checkedout
        /// </summary>
        /// <param name="checkOutStatus"></param>
        /// <param name="checkOutOwner"></param>
        /// <returns></returns>
        [WebMethod()]
        public byte[] GetCheckedOutFileDocument(DocsPaVO.CheckInOut.CheckOutStatus checkOutStatus, DocsPaVO.utente.InfoUtente checkOutOwner)
        {
            SetUserId(checkOutOwner);
            // TODO: Gestione log
            byte[] retValue = null;

            try
            {
                retValue = BusinessLogic.CheckInOut.CheckInOutServices.GetCheckedOutFile(checkOutStatus, checkOutOwner);
            }
            catch (Exception e)
            {
                Console.WriteLine(e.Message);
            }

            return retValue;
        }


        /// <summary>
        /// 
        /// </summary>
        /// <param name="idDocument"></param>
        /// <param name="documentNumber"></param>
        /// <param name="utente"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.CheckInOut.CheckOutStatus GetCheckOutDocumentStatus(string idDocument, string documentNumber, DocsPaVO.utente.InfoUtente infoUtente)
        {
            SetUserId(infoUtente);
            DocsPaVO.CheckInOut.CheckOutStatus retValue = null;

            try
            {
                retValue = BusinessLogic.CheckInOut.CheckInOutServices.GetCheckOutStatus(idDocument, documentNumber, infoUtente);
            }
            catch (Exception e)
            {
                logger.Debug(e.Message);
            }

            return retValue;
        }


        /// <summary>
        /// CheckOut di un documento senza estrarre il contenuto del file
        /// </summary>
        /// <param name="idDocument"></param>
        /// <param name="documentNumber"></param>
        /// <param name="documentLocation"></param>
        /// <param name="machineName"></param>
        /// <param name="utente"></param>
        /// <param name="checkOutStatus"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.Validations.ValidationResultInfo CheckOutDocument(string idDocument, string documentNumber, string documentLocation, string machineName, DocsPaVO.utente.InfoUtente utente, out DocsPaVO.CheckInOut.CheckOutStatus checkOutStatus)
        {
            SetUserId(utente);
            DocsPaVO.Validations.ValidationResultInfo retValue = null;

            checkOutStatus = null;

            string errorMessage = string.Empty;

            try
            {
                retValue = BusinessLogic.CheckInOut.CheckInOutServices.CheckOut(idDocument, documentNumber, documentLocation, machineName, utente, out checkOutStatus);
            }
            catch (Exception e)
            {
                errorMessage = e.Message;
                logger.Debug(e.Message);

                retValue = new DocsPaVO.Validations.ValidationResultInfo { Value = false };
                retValue.BrokenRules.Add(new DocsPaVO.Validations.BrokenRule { Level = DocsPaVO.Validations.BrokenRule.BrokenRuleLevelEnum.Error, Description = errorMessage });
            }
            finally
            {
                if (retValue.Value)
                    BusinessLogic.UserLog.UserLog.WriteLog(utente, "CHECKOUTDOCUMENT", documentNumber, "Blocco del documento. Id documento: " + documentNumber, DocsPaVO.Logger.CodAzione.Esito.OK);
                else
                    BusinessLogic.UserLog.UserLog.WriteLog(utente, "CHECKOUTDOCUMENT", documentNumber, "Blocco del documento. Id documento: " + documentNumber, DocsPaVO.Logger.CodAzione.Esito.KO);
            }

            return retValue;
        }

        /// <summary>
        /// Scrittura log per CheckIn / CheckOut
        /// </summary>
        /// <param name="logOperation"></param>
        /// <param name="utente"></param>
        /// <param name="logMessage"></param>
        /// <param name="esitoLog"></param>
        private void WriteLogCheckInOut(string logOperation,
                                        DocsPaVO.utente.InfoUtente utente,
                                        string logMessage,
                                        DocsPaVO.Logger.CodAzione.Esito esitoLog)
        {
            SetUserId(utente);
            BusinessLogic.UserLog.UserLog.WriteLog(
                                        utente.userId,
                                        utente.idPeople,
                                        utente.idGruppo,
                                        utente.idAmministrazione,
                                        logOperation,
                                        "0", // registro non necessario
                                        logMessage,
                                        esitoLog, null);
        }

        /// <summary>
        /// Scrittura log per CheckIn / CheckOut
        /// </summary>
        /// <param name="logOperation"></param>
        /// <param name="logMessage"></param>
        /// <param name="utente"></param>
        /// <param name="validationInfo"></param>
        private void WriteLogCheckInOut(string logOperation,
                                        string logMessage,
                                        DocsPaVO.utente.InfoUtente utente,
                                        DocsPaVO.Validations.ValidationResultInfo validationInfo)
        {
            SetUserId(utente);
            DocsPaVO.Logger.CodAzione.Esito esitoLog = DocsPaVO.Logger.CodAzione.Esito.OK;

            string errorMessage = string.Empty;

            foreach (DocsPaVO.Validations.BrokenRule brokenRule in validationInfo.BrokenRules)
            {
                if (errorMessage != string.Empty)
                    errorMessage += "; ";

                errorMessage += brokenRule.Description;
            }

            if (validationInfo.BrokenRules.Count > 0)
            {
                esitoLog = DocsPaVO.Logger.CodAzione.Esito.KO;

                logMessage = errorMessage;
            }

            this.WriteLogCheckInOut(logOperation, utente, logMessage, esitoLog);
        }

        /// <summary>
        /// CheckOut di un documento e restituzione del file
        /// </summary>
        /// <param name="idDocument"></param>
        /// <param name="documentNumber"></param>
        /// <param name="documentLocation"></param>
        /// <param name="machineName"></param>
        /// <param name="utente"></param>
        /// <param name="checkOutStatus"></param>
        /// <param name="content"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.Validations.ValidationResultInfo CheckOutDocumentWithFile(string idDocument, string documentNumber, string documentLocation, string machineName, DocsPaVO.utente.InfoUtente utente, out DocsPaVO.CheckInOut.CheckOutStatus checkOutStatus, out byte[] content)
        {
            SetUserId(utente);
            DocsPaVO.Validations.ValidationResultInfo retValue = null;

            checkOutStatus = null;
            content = null;

            string errorMessage = string.Empty;

            try
            {
                retValue = BusinessLogic.CheckInOut.CheckInOutServices.CheckOut(idDocument, documentNumber, documentLocation, machineName, utente, out checkOutStatus, out content);
            }
            catch (Exception e)
            {
                errorMessage = e.Message;
                logger.Debug(e.Message);

                retValue = new DocsPaVO.Validations.ValidationResultInfo { Value = false };
                retValue.BrokenRules.Add(new DocsPaVO.Validations.BrokenRule { Level = DocsPaVO.Validations.BrokenRule.BrokenRuleLevelEnum.Error, Description = errorMessage });
            }
            finally
            {
                if (retValue.Value)
                    BusinessLogic.UserLog.UserLog.WriteLog(utente, "CHECKOUTDOCUMENT", documentNumber, "Blocco del documento. Id documento: " + documentNumber, DocsPaVO.Logger.CodAzione.Esito.OK);
                else
                    BusinessLogic.UserLog.UserLog.WriteLog(utente, "CHECKOUTDOCUMENT", documentNumber, "Blocco del documento. Id documento: " + documentNumber, DocsPaVO.Logger.CodAzione.Esito.KO);
            }

            return retValue;
        }


        /// <summary>
        /// CheckIn di un documento
        /// </summary>
        /// <param name="checkOutStatus"></param>
        /// <param name="checkedOutFile"></param>
        /// <param name="checkInComments"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.Validations.ValidationResultInfo CheckInDocument(DocsPaVO.CheckInOut.CheckOutStatus checkOutStatus, DocsPaVO.utente.InfoUtente checkOutOwner, byte[] content, string checkInComments)
        {
            SetUserId(checkOutOwner);
            DocsPaVO.Validations.ValidationResultInfo retValue = null;

            string errorMessage = string.Empty;

            try
            {
                retValue = BusinessLogic.CheckInOut.CheckInOutServices.CheckIn(checkOutStatus, checkOutOwner, content, checkInComments);
            }
            catch (Exception e)
            {
                errorMessage = e.Message;
                logger.Debug(e.Message);

                retValue = new DocsPaVO.Validations.ValidationResultInfo { Value = false };
                retValue.BrokenRules.Add(new DocsPaVO.Validations.BrokenRule { Level = DocsPaVO.Validations.BrokenRule.BrokenRuleLevelEnum.Error, Description = errorMessage });
            }
            finally
            {
                if (retValue.Value)
                    BusinessLogic.UserLog.UserLog.WriteLog(checkOutOwner, "CHECKINDOCUMENT", checkOutStatus.DocumentNumber, "Rilascio del documento. Id documento: " + checkOutStatus.DocumentNumber, DocsPaVO.Logger.CodAzione.Esito.OK);
                else
                    BusinessLogic.UserLog.UserLog.WriteLog(checkOutOwner, "CHECKINDOCUMENT", checkOutStatus.DocumentNumber, "Rilascio del documento. Id documento: " + checkOutStatus.DocumentNumber, DocsPaVO.Logger.CodAzione.Esito.KO);
            }

            return retValue;
        }


        /// <summary>
        /// 
        /// </summary>
        /// <param name="checkOutStatus"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.Validations.ValidationResultInfo UndoCheckOutDocument(DocsPaVO.CheckInOut.CheckOutStatus checkOutStatus, DocsPaVO.utente.InfoUtente checkOutOwner)
        {
            SetUserId(checkOutOwner);
            DocsPaVO.Validations.ValidationResultInfo retValue = null;

            string errorMessage = string.Empty;

            try
            {
                retValue = BusinessLogic.CheckInOut.CheckInOutServices.UndoCheckOut(checkOutStatus, checkOutOwner);
            }
            catch (Exception e)
            {
                errorMessage = e.Message;
                logger.Debug(e.Message);

                retValue = new DocsPaVO.Validations.ValidationResultInfo { Value = false };
                retValue.BrokenRules.Add(new DocsPaVO.Validations.BrokenRule { Level = DocsPaVO.Validations.BrokenRule.BrokenRuleLevelEnum.Error, Description = errorMessage });
            }
            finally
            {
                if (retValue.Value)
                    BusinessLogic.UserLog.UserLog.WriteLog(checkOutOwner, "UNDOCHECKOUTDOCUMENT", checkOutStatus.DocumentNumber, "Annullamento del blocco del documento. Id documento: " + checkOutStatus.DocumentNumber, DocsPaVO.Logger.CodAzione.Esito.OK);
                else
                    BusinessLogic.UserLog.UserLog.WriteLog(checkOutOwner, "UNDOCHECKOUTDOCUMENT", checkOutStatus.DocumentNumber, "Annullamento del blocco del documento. Id documento: " + checkOutStatus.DocumentNumber, DocsPaVO.Logger.CodAzione.Esito.KO);
            }

            return retValue;
        }


        /// <summary>
        /// Verifica se un documento  in checkout
        /// </summary>
        /// <param name="idDocumento">SystemID del documento</param>
        /// <param name="documentNumber"></param>
        /// <param name="utente">Utente che ha fatto il checkout del documento</param>
        /// <returns></returns>
        [WebMethod()]
        public bool IsCheckedOutDocumentWithUser(string idDocument, string documentNumber, DocsPaVO.utente.InfoUtente user, out string ownerUser)
        {
            SetUserId(user);
            bool retValue = false;
            ownerUser = string.Empty;

            try
            {
                retValue = BusinessLogic.CheckInOut.CheckInOutServices.IsCheckedOut(idDocument, documentNumber, user, out ownerUser);
            }
            catch (Exception e)
            {
                Console.WriteLine(e.Message);
            }

            return retValue;
        }


        /// <summary>
        /// Verifica se un documento principale o uno dei suoi allegati  in checkout, a seconda del parametro checkAllegati
        /// </summary>
        /// <param name="idDocumento">SystemID del documento</param>
        /// <param name="documentNumber"></param>
        /// <returns></returns>
        [WebMethod()]
        public bool IsCheckedOutDocument(string idDocument, string documentNumber, DocsPaVO.utente.InfoUtente infoUtente, bool checkAllegati)
        {
            SetUserId(infoUtente);
            // TODO: Gestione log
            bool retValue = false;

            try
            {
                retValue = BusinessLogic.CheckInOut.CheckInOutServices.IsCheckedOut(idDocument, documentNumber, infoUtente, checkAllegati);
            }
            catch (Exception e)
            {
                Console.WriteLine(e.Message);
            }

            return retValue;
        }


        /// <summary>
        /// Verifica se il documento  stato messo in checkout dall'utente richiesto
        /// </summary>
        /// <param name="idDocument"></param>
        /// <param name="documentNumber"></param>
        /// <param name="utente"></param>
        /// <returns></returns>
        [WebMethod()]
        public bool IsOwnerCheckedOutDocument(string idDocument, string documentNumber, DocsPaVO.utente.InfoUtente utente)
        {
            SetUserId(utente);
            // TODO: Gestione log
            bool retValue = false;

            try
            {
                retValue = BusinessLogic.CheckInOut.CheckInOutServices.IsOwnerCheckedOut(idDocument, documentNumber, utente);
            }
            catch (Exception e)
            {
                Console.WriteLine(e.Message);
            }

            return retValue;
        }

        /// <summary>
        /// Verifica se un documento principale o uno dei suoi allegati  in checkout, a seconda del parametro checkAllegati
        /// </summary>
        /// <param name="idDocumento">SystemID del documento</param>
        /// <param name="documentNumber"></param>
        /// <returns></returns>
        [WebMethod()]
        public bool IsCheckedOutDocumentSimple(string idDocument, string documentNumber, DocsPaVO.utente.InfoUtente infoUtente, bool checkAllegati, DocsPaVO.documento.SchedaDocumento doc)
        {
            SetUserId(infoUtente);
            // TODO: Gestione log
            bool retValue = false;

            try
            {
                retValue = BusinessLogic.CheckInOut.CheckInOutServices.IsCheckedOutSimple(idDocument, documentNumber, infoUtente, checkAllegati, doc);
            }
            catch (Exception e)
            {
                Console.WriteLine(e.Message);
            }

            return retValue;
        }


        #endregion


        [WebMethod]
        [return: XmlArray]
        [return: XmlArrayItem(typeof(string))]
        public virtual ArrayList GetListaParentUo(string idUo, string livelloUo)
        {
            ArrayList listaUo = new ArrayList();
            try
            {
                listaUo = BusinessLogic.Utenti.addressBookManager.GetParentUo(idUo, livelloUo);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetListaParentUo", e);
            }
            return listaUo;
        }

        #region Gestione conversione in pdf inline

        /// <summary>
        /// Verifica se  attiva o meno la conversione in pdf inline di documenti
        /// </summary>
        /// <returns></returns>
        [WebMethod]
        public bool ConvertPdfInlineActive()
        {
            bool retValue = false;

            try
            {
                retValue = BusinessLogic.Documenti.PdfConverter.ConvertInlineActive();
            }
            catch (Exception ex)
            {
                logger.Debug("Errore in ConvertPdfInlineActive: " + ex.Message);
            }

            return retValue;
        }

        /// <summary>
        /// Verifica se il file richiesto pu essere convertito in formato pdf 
        /// </summary>
        /// <param name="fileName"></param>
        /// <returns></returns>
        [WebMethod]
        public bool CanConvertFileToPdf(string fileName)
        {
            bool retValue = false;

            try
            {
                retValue = BusinessLogic.Documenti.PdfConverter.CanConvertFile(fileName);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore in CanConvertFileToPdf: " + ex.Message);
            }

            return retValue;
        }

        /// <summary>
        /// Verifica se la conversione inline di documenti in pdf supporta ocr
        /// </summary>
        /// <param name="fileName"></param>
        /// <returns></returns>
        [WebMethod]
        public bool ConvertPdfWidthOcrSupported()
        {
            bool retValue = false;

            try
            {
                retValue = BusinessLogic.Documenti.PdfConverter.OcrSupported();
            }
            catch (Exception ex)
            {
                logger.Debug("Errore in ConvertPdfWidthOcrSupported: " + ex.Message);
            }

            return retValue;
        }


        /// <summary>
        /// Reperimento di tutte le tipolgie predefinite di file 
        /// per cui  possibile effettuare la conversione in pdf
        /// </summary>
        /// <returns></returns>
        [WebMethod]
        public string[] GetConvertiblePdfFileTypes()
        {
            string[] retValue = null;

            try
            {
                retValue = BusinessLogic.Documenti.PdfConverter.GetConvertibleFileTypes();
            }
            catch (Exception ex)
            {
                logger.Debug("Errore in GetConvertibleFileTypes: " + ex.Message);
            }

            return retValue;
        }

        #endregion

        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.fascicolazione.Fascicolo))]
        public virtual ArrayList FascicolazioneGetListaFascicoliDaCodice(DocsPaVO.utente.InfoUtente infoUtente, string codiceFascicolo, DocsPaVO.utente.Registro registro, bool enableUffRef, bool enableProfilazione, string insRic)
        {
            SetUserId(infoUtente);
            ArrayList result = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Fascicoli.FascicoloManager.getListaFascicoliDaCodice(infoUtente, codiceFascicolo, registro, enableUffRef, enableProfilazione, insRic);
#if TRACE_WS
				pt.WriteLogTracer("FascicolazioneGetListaFascicoliDaCodice");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneGetListaFascicoliDaCodice", e);
                result = null;
            }

            return result;
        }




        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.fascicolazione.Folder))]
        public virtual ArrayList FascicolazioneGetListaFolderDaCodice(DocsPaVO.utente.InfoUtente infoUtente, string codiceFascicolo, string descrFolder, DocsPaVO.utente.Registro registro, bool enableUffRef, bool enableProfilazione)
        {
            SetUserId(infoUtente);
            ArrayList result = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Fascicoli.FascicoloManager.getListaFolderDaCodiceFascicolo(infoUtente, codiceFascicolo, descrFolder, registro, enableUffRef, enableProfilazione);
#if TRACE_WS
				pt.WriteLogTracer("FascicolazioneGetListaFolderDaCodice");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneGetListaFolderDaCodice", e);
                result = null;
            }

            return result;
        }

        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.fascicolazione.Folder))]
        public virtual ArrayList FascicolazioneGetListaFolderDaIdFascicolo(DocsPaVO.utente.InfoUtente infoUtente, string idfascicolo, DocsPaVO.utente.Registro registro, bool enableUffRef, bool enableProfilazione)
        {
            SetUserId(infoUtente);
            ArrayList result = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Fascicoli.FascicoloManager.getListaFolderDaIdFascicolo(infoUtente, idfascicolo, registro, enableUffRef, enableProfilazione);
#if TRACE_WS
				pt.WriteLogTracer("FascicolazioneGetListaFolderDaCodice");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneGetListaFolderDaIdFasc", e);
                result = null;
            }

            return result;
        }
        [WebMethod]
        public virtual DocsPaVO.rubrica.SmistamentoRubrica getSmistamentoRubrica()
        {
            return new DocsPaVO.rubrica.SmistamentoRubrica();
        }

        //Veronica
        #region gestione del report piani di rientro
        ///<summary>
        ///WS per effettuare il report dei piani di rientro
        ///</summary>

        [WebMethod]
        public virtual DataSet ReportPianiRientro(int idReg, string dataInizio, string dataFine, out int res)
        {
            DataSet result = new DataSet();
            res = 0;
            try
            {
                ProspettiRiepilogativi.Model objM = new ProspettiRiepilogativi.Model();
                result = objM.DO_GetDSReportPianiRientroConScadenza(idReg, dataInizio, dataFine, out res);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ReportPianiRientro", ex);
            }
            return result;
        }

        [WebMethod]
        public virtual DataSet ReportPianiRientroSenzaScadenza(int idReg, string dataInizio, string dataFine, out int res)
        {
            DataSet result = new DataSet();
            res = 0;
            try
            {
                ProspettiRiepilogativi.Model objM = new ProspettiRiepilogativi.Model();
                result = objM.DO_GetDSReportPianiRientroSenzaScadenza(idReg, dataInizio, dataFine, out res);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ReportPianiRientro", ex);
            }
            return result;
        }

        [WebMethod]
        public virtual DataSet ReportPianiRientroFuoriPiano(int idReg, string dataInizio, string dataFine, out int res)
        {
            DataSet result = new DataSet();
            res = 0;
            try
            {
                ProspettiRiepilogativi.Model objM = new ProspettiRiepilogativi.Model();
                result = objM.DO_GetDSReportPianiRientroFuoriPiano(idReg, dataInizio, dataFine, out res);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ReportPianiRientro", ex);
            }
            return result;
        }
        #endregion

        #region gestione degli export dei risultati delle ricerche (DOC - FASC -  TRASM)
        /// <summary>
        /// WS per effettuare l'export dei risultati della ricerca dei documenti protocollati
        /// </summary>
        /// <param name="idGruppo"></param>
        /// <param name="idPeople"></param>
        /// <param name="filtri">filtri impostati dall'utente</param>
        /// <param name="exportType">possibili valori: PDF o XLS</param>
        /// <param name="title">titolo che dovr comparire al file di export</param>
        /// <param name="documentsSystemId">Array dei system id dei documenti selezionati</param>
        /// <param name="grid">Griglia da utilizzare per la costruzione del file Excel</param>
        /// <returns>oggetto FileDocumento</returns>
        [WebMethod]

        public virtual DocsPaVO.documento.FileDocumento ExportRicercaDoc(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.filtri.FiltroRicerca[][] filtri, string exportType, string title, DocsPaVO.ricerche.FullTextSearchContext context, ArrayList campiSelezionati, String[] documentsSystemId, DocsPaVO.Grid.Grid grid, bool useTraditionaExport)
        {
            SetUserId(infoUtente);
            DocsPaVO.documento.FileDocumento file = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                bool mittDettIndirizzo = false;
                if (System.Configuration.ConfigurationManager.AppSettings["MITT_DEST_ADDRESS"] != null && System.Configuration.ConfigurationManager.AppSettings["MITT_DEST_ADDRESS"].ToUpper() == "TRUE")
                    mittDettIndirizzo = Convert.ToBoolean(System.Configuration.ConfigurationManager.AppSettings["MITT_DEST_ADDRESS"]);

                BusinessLogic.ExportDati.ExportDatiManager manager = new BusinessLogic.ExportDati.ExportDatiManager();
                file = manager.ExportDoc(infoUtente, filtri, exportType, title, context, campiSelezionati, mittDettIndirizzo, documentsSystemId, grid, useTraditionaExport);
#if TRACE_WS
				pt.WriteLogTracer("ExportRicercaDoc");
#endif
                if (file != null)
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "EXPORTRICERCA", "0", "Export in " + exportType + " del risultato ricerca documenti", DocsPaVO.Logger.CodAzione.Esito.OK);
            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "EXPORTRICERCA", "0", "Export in " + exportType + " del risultato ricerca documenti", DocsPaVO.Logger.CodAzione.Esito.KO);
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ExportRicercaDoc", e);
                file = null;
            }

            return file;
        }

        ///<summary>
        ///WS per effettuare l'export dei risultati della ricerca dei documenti di un dato fascicolo
        ///</summary>
        [WebMethod]
        public virtual DocsPaVO.documento.FileDocumento ExportRicercaDocInFasc(DocsPaVO.fascicolazione.Folder folder, string codFascicolo, string exportType, string title, DocsPaVO.filtri.FiltroRicerca[][] filtriRicerca, DocsPaVO.utente.InfoUtente infoUtente, ArrayList campiSelezionati, DocsPaVO.Grid.Grid grid, String[] selectedDocumentsId, bool useTraditionaExport)
        {
            SetUserId(infoUtente);
            DocsPaVO.documento.FileDocumento file = null;

            try
            {
                bool mittDettIndirizzo = false;
                if (System.Configuration.ConfigurationManager.AppSettings["MITT_DEST_ADDRESS"] != null && System.Configuration.ConfigurationManager.AppSettings["MITT_DEST_ADDRESS"].ToUpper() == "TRUE")
                    mittDettIndirizzo = Convert.ToBoolean(System.Configuration.ConfigurationManager.AppSettings["MITT_DEST_ADDRESS"]);

                BusinessLogic.ExportDati.ExportDatiManager manager = new BusinessLogic.ExportDati.ExportDatiManager();
                file = manager.ExportDocInFasc(infoUtente, folder, codFascicolo, exportType, title, filtriRicerca, campiSelezionati, mittDettIndirizzo, grid, selectedDocumentsId, useTraditionaExport);
                if (file != null)
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "EXPORTRICERCA", folder.systemID, "Export in " + exportType + " del risultato ricerca documenti nel fascicolo " + codFascicolo, DocsPaVO.Logger.CodAzione.Esito.OK);
            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "EXPORTRICERCA", folder.systemID, "Export in " + exportType + " del risultato ricerca documenti nel fascicolo " + codFascicolo, DocsPaVO.Logger.CodAzione.Esito.KO);
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ExportRicercaDocInFasc", e);
                file = null;
            }

            return file;
        }

        [WebMethod]
        public virtual DocsPaVO.documento.FileDocumento ExportRicercaDocInCest(DocsPaVO.utente.InfoUtente infoUtente, string exportType, string title, DocsPaVO.filtri.FiltroRicerca[][] filtri, ArrayList campiSelezionati)
        {
            SetUserId(infoUtente);
            DocsPaVO.documento.FileDocumento file = null;
            try
            {
                BusinessLogic.ExportDati.ExportDatiManager manager = new BusinessLogic.ExportDati.ExportDatiManager();
                file = manager.ExportDocInCest(infoUtente, exportType, title, filtri, campiSelezionati);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ExportRicercaDocInCest", e);
                file = null;
            }

            return file;
        }

        /// <summary>
        /// WS per effettuare l'export dei risultati della ricerca dei fascicoli
        /// </summary>
        /// <param name="userInfo">info utente</param>
        /// <param name="registro">info registro</param>
        /// <param name="enableUfficioRef">ufficio referente abilitato</param>
        /// <param name="enableChilds">'Mostra tutti i fascicoli' abilitato</param>
        /// <param name="classificazione">classificazione impostata dall'utente</param>
        /// <param name="filtri">filtri impostati dall'utente</param>
        /// <param name="exportType">possibili valori: PDF o XLS</param>
        /// <param name="title">titolo che dovr comparire al file di export</param>
        /// <param name="idProjectsList">Array dei system id dei fascicoli selezionati</param>
        /// <param name="grid">Griglia da utilizzare per l'export</param>
        /// <returns>oggetto FileDocumento</returns>
        [WebMethod]
        public virtual DocsPaVO.documento.FileDocumento ExportRicercaFasc(DocsPaVO.utente.InfoUtente userInfo, DocsPaVO.utente.Registro registro, bool enableUfficioRef, bool enableProfilazione, bool enableChilds, DocsPaVO.fascicolazione.Classificazione classificazione, DocsPaVO.filtri.FiltroRicerca[][] filtri, string exportType, string title, ArrayList campiSelezionati, String[] idProjectsList, DocsPaVO.Grid.Grid grid, bool useTraditionaExport)
        {
            SetUserId(userInfo);
            DocsPaVO.documento.FileDocumento file = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                BusinessLogic.ExportDati.ExportDatiManager manager = new BusinessLogic.ExportDati.ExportDatiManager();
                file = manager.ExportFasc(userInfo, registro, enableUfficioRef, enableProfilazione, enableChilds, classificazione, filtri, exportType, title, campiSelezionati, idProjectsList, grid, useTraditionaExport);
#if TRACE_WS
				pt.WriteLogTracer("ExportRicercaFasc");
#endif
                if (file != null)
                    BusinessLogic.UserLog.UserLog.WriteLog(userInfo, "EXPORTRICERCA", registro.systemId, "Export in " + exportType + " del risultato ricerca fascicoli nel registro " + registro.codRegistro, DocsPaVO.Logger.CodAzione.Esito.OK);
            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(userInfo, "EXPORTRICERCA", registro.systemId, "Export in " + exportType + " del risultato ricerca fascicoli nel registro " + registro.codRegistro, DocsPaVO.Logger.CodAzione.Esito.KO);
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ExportRicercaFasc", e);
                file = null;
            }

            return file;
        }

        /// <summary>
        /// WS per effettuare l'export dei risultati della ricerca log da amministrazione
        /// </summary>
        /// <param name="codAmm">codice amministrazione</param>
        /// <param name="type">tipo di log per il report (se di amministrazione o applicativi)</param>
        /// <param name="exportType">possibili valori: PDF o XLS</param>
        /// <param name="title">titolo che dovr comparire al file di export</param>
        /// <returns>oggetto FileDocumento</returns>
        [WebMethod]
        public virtual DocsPaVO.documento.FileDocumento ExportLog(string codAmm, string type, string exportType, string title, string user, string data_a, string data_da, string oggetto, string azione, string esito, int tabelle)
        {
            SetUserId(user);
            DocsPaVO.documento.FileDocumento file = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                BusinessLogic.report.ReportLog manager = new BusinessLogic.report.ReportLog();
                file = (DocsPaVO.documento.FileDocumento)manager.GeneraFile(codAmm, type, exportType, title, user, data_a, data_da, oggetto, azione, esito, tabelle);
#if TRACE_WS
				pt.WriteLogTracer("ExportRicercaFasc");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ExportLog", e);
                file = null;
            }
            return file;
        }

        /// <summary>
        /// WS per effettuare l'export dei risultati della ricerca delle trasmissioni
        /// </summary>
        /// <param name="oggettoTrasmesso">oggetto trasmesso</param>
        /// <param name="tipoRicerca">Possibili valori: "R" = ricevute, "E" = effettuate</param>
        /// <param name="utente">info utente</param>
        /// <param name="ruolo">info ruolo</param>
        /// <param name="listaFiltri">filtri impostati dall'utente</param>
        /// <param name="exportType">possibili valori: PDF o XLS</param>
        /// <param name="title">titolo che dovr comparire al file di export</param>
        /// <returns>oggetto FileDocumento</returns>
        [WebMethod]
        public virtual DocsPaVO.documento.FileDocumento ExportRicercaTrasm(DocsPaVO.trasmissione.OggettoTrasm oggettoTrasmesso, string tipoRicerca, DocsPaVO.utente.Utente utente, DocsPaVO.utente.Ruolo ruolo, DocsPaVO.filtri.FiltroRicerca[] listaFiltri, string exportType, string title, DocsPaVO.utente.InfoUtente infoUtente, ArrayList campiSelezionati)
        {
            SetUserId(utente);
            DocsPaVO.documento.FileDocumento file = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif

                BusinessLogic.ExportDati.ExportDatiManager manager = new BusinessLogic.ExportDati.ExportDatiManager();
                file = manager.ExportTrasm(oggettoTrasmesso, tipoRicerca, utente, ruolo, listaFiltri, exportType, title, campiSelezionati);
#if TRACE_WS
				pt.WriteLogTracer("ExportRicercaFasc");
#endif
                if (file != null)
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "EXPORTRICERCA", "0", "Export in " + exportType + " del risultato ricerca trasmissioni ", DocsPaVO.Logger.CodAzione.Esito.OK);
            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "EXPORTRICERCA", "0", "Export in " + exportType + " del risultato ricerca trasmissioni ", DocsPaVO.Logger.CodAzione.Esito.KO);
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ExportRicercaTrasm", e);
                file = null;
            }

            return file;
        }

        [WebMethod]
        public virtual DocsPaVO.documento.FileDocumento ExportToDoList(DocsPaVO.utente.InfoUtente infoUtente, string docOrFasc, DocsPaVO.filtri.FiltroRicerca[] listaFiltri, string registri, string exportType, string title, ArrayList campiSelezionati, String[] objectId)
        {
            SetUserId(infoUtente);
            DocsPaVO.documento.FileDocumento file = null;
            try
            {
                BusinessLogic.ExportDati.ExportDatiManager manager = new BusinessLogic.ExportDati.ExportDatiManager();
                file = manager.ExportToDoList(infoUtente, docOrFasc, listaFiltri, registri, exportType, title, campiSelezionati, objectId);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ExportToDoList", e);
                file = null;
            }
            return file;
        }

        [WebMethod]
        public virtual DocsPaVO.documento.FileDocumento ExportRubrica(DocsPaVO.utente.InfoUtente infoUtente, bool store, string registri)
        {
            SetUserId(infoUtente);
            DocsPaVO.documento.FileDocumento file = null;
            try
            {
                BusinessLogic.ExportDati.ExportDatiManager manager = new BusinessLogic.ExportDati.ExportDatiManager();
                file = manager.ExportRubrica(infoUtente, store, registri, string.Empty);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ExportRubrica", e);
                file = null;
            }
            return file;
        }

        [WebMethod]
        public virtual DocsPaVO.documento.FileDocumento ExportSearchAddressBook(DocsPaVO.utente.InfoUtente infoUtente, bool store, DocsPaVO.rubrica.ParametriRicercaRubrica qr)
        {
            SetUserId(infoUtente);
            DocsPaVO.documento.FileDocumento file = null;
            try
            {
                BusinessLogic.ExportDati.ExportDatiManager manager = new BusinessLogic.ExportDati.ExportDatiManager();
                file = manager.ExportSearchAddressBook(infoUtente, store, qr, string.Empty);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ExportSearchAddressBook", e);
                file = null;
            }
            return file;
        }

        [WebMethod]
        public virtual DocsPaVO.documento.FileDocumento ExportSearchAddressBookNew(DocsPaVO.utente.InfoUtente infoUtente, bool store, DocsPaVO.rubrica.ParametriRicercaRubrica qr, string title, string tipologia)
        {
            SetUserId(infoUtente);
            DocsPaVO.documento.FileDocumento file = null;
            try
            {
                BusinessLogic.ExportDati.ExportDatiManager manager = new BusinessLogic.ExportDati.ExportDatiManager();
                file = manager.ExportSearchAddressBookNew(infoUtente, store, qr, title, tipologia);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ExportSearchAddressBookNew", ex);
                file = null;
            }
            return file;
        }

        [WebMethod]
        public virtual DocsPaVO.documento.FileDocumento ExportRubricaWithTitle(DocsPaVO.utente.InfoUtente infoUtente, bool store, string registri, string title)
        {
            SetUserId(infoUtente);
            DocsPaVO.documento.FileDocumento file = null;
            try
            {
                BusinessLogic.ExportDati.ExportDatiManager manager = new BusinessLogic.ExportDati.ExportDatiManager();
                file = manager.ExportRubrica(infoUtente, store, registri, title);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ExportRubrica", e);
                file = null;
            }
            return file;
        }

        [WebMethod]
        public virtual DocsPaVO.documento.FileDocumento ExportRubricaWithTitleNew(DocsPaVO.utente.InfoUtente infoUtente, bool store, string registri, string title, string tipologia)
        {
            SetUserId(infoUtente);
            DocsPaVO.documento.FileDocumento file = null;
            try
            {
                BusinessLogic.ExportDati.ExportDatiManager manager = new BusinessLogic.ExportDati.ExportDatiManager();
                file = manager.ExportRubricaNew(infoUtente, store, registri, title, tipologia);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore in DocspaWS.asmx - metodo: ExportRubricaWithTitleNew", ex);
                file = null;
            }
            return file;
        }

        #endregion

        #region svuotamento della TDL

        [WebMethod]
        public virtual bool isNoticeActivedTDL(out string noticeDays, out string countTxOverNoticeDays, out string datePost, DocsPaVO.utente.Utente utente, DocsPaVO.utente.Ruolo ruolo, string tipoTrasm)
        {
            SetUserId(utente);
            bool retValue = false;
            noticeDays = string.Empty;
            countTxOverNoticeDays = string.Empty;
            datePost = string.Empty;

            try
            {
                retValue = BusinessLogic.Trasmissioni.ExecTrasmManager.isNoticeActivedTDL(out noticeDays, out countTxOverNoticeDays, out datePost, utente, ruolo, tipoTrasm);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: isNoticeActivedTDL", e);
            }

            return retValue;
        }

        [WebMethod]
        public virtual DocsPaVO.amministrazione.EsitoOperazione SvuotaTDL(DocsPaVO.utente.Utente utente, DocsPaVO.utente.Ruolo ruolo, string dataImpostata, string tipoTrasm, bool noWF, DocsPaVO.filtri.FiltroRicerca[] filtri)
        {
            SetUserId(utente);
            DocsPaVO.amministrazione.EsitoOperazione esito = new DocsPaVO.amministrazione.EsitoOperazione();
            try
            {
                esito = BusinessLogic.Trasmissioni.ExecTrasmManager.svuotaTDL(utente, ruolo, dataImpostata, tipoTrasm, noWF, filtri);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: SvuotaTDL", e);
                esito.Codice = 1;
                esito.Descrizione = "si  verificato un errore";
            }
            return esito;
        }
        #endregion

        #region VisibilitFrame
        [WebMethod]
        public virtual int DO_getIdProfileByData(string numProto, string AnnoProto, string idRegistro, DocsPaVO.utente.InfoUtente infoUtente, out string inArchivio)
        {
            SetUserId(infoUtente);
            inArchivio = "-1";
            try
            {
                return BusinessLogic.Documenti.InfoDocManager.DO_getIdProfileByData(out inArchivio, numProto, AnnoProto, idRegistro, infoUtente);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DO_getIdProfileByData", ex);
                return -1;
            }

        }
        #endregion



        [WebMethod]
        [return: XmlArray]
        [return: XmlArrayItem(typeof(DocsPaVO.StatoInvio.StatoInvio))]
        public virtual ArrayList GetListaSpedizioni(string idProfile)
        {
            ArrayList listaSpedizioni = new ArrayList();
            try
            {
                listaSpedizioni = BusinessLogic.Documenti.ProtocolloUscitaManager.getSpedizioni(idProfile);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetListaSpedizioni", e);
            }
            return listaSpedizioni;
        }

        [WebMethod]
        public virtual string FascicolazioneGetFascNumRif(string idTitolario, string idRegistro)
        {
            string numFascicolo = "";
            try
            {
                numFascicolo = BusinessLogic.Fascicoli.FascicoloManager.getFascNumRif(idTitolario, idRegistro);
                return numFascicolo;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getIFascicolazioneGetFascNumRif", e);
                return null;
            }
        }



        /// <summary>
        /// </summary>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.trasmissione.RagioneTrasmissione))]
        public virtual ArrayList SmistamentoGetRagioniTrasmissione(string idAmm)
        {
            ArrayList result = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.SmistamentoDocumenti.SmistamentoManager.GetRagioniTrasmissioneSmistamento(idAmm);
#if TRACE_WS
				pt.WriteLogTracer("SmistamentoGetRagioniTrasmissione");
#endif

            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: SmistamentoGetRagioniTrasmissione", e);
                logger.Debug(e.ToString());
                result = null;
            }

            return result;
        }

        [WebMethod]
        public virtual DocsPaVO.Smistamento.datiAggiuntiviSmistamento getDatiAggiuntiviSmistamento()
        {
            return new DocsPaVO.Smistamento.datiAggiuntiviSmistamento();
        }

        [WebMethod]
        public virtual bool importaUtenti(DocsPaVO.utente.InfoUtente infoUtente, byte[] dati, string nomeFile, string codiceAmm, bool update, ref int utInseriti, ref int utAggiornati)
        {
            SetUserId(infoUtente);
            try
            {
                //string serverPath = System.Configuration.ConfigurationManager.AppSettings["MODELS_ROOT_PATH"];
                // PALUMBO: modificato per ovviare al blocco dell'accesso su macchina 20 in scrittura    
                //string serverPath = System.Configuration.ConfigurationManager.AppSettings["LOG_PATH"];
                string serverPath = System.Configuration.ConfigurationManager.AppSettings["DOC_ROOT"];
                serverPath = System.IO.Path.Combine(serverPath, DateTime.Now.ToString("yyyyMMdd"));

                bool result = BusinessLogic.Utenti.UserManager.importaUtenti(infoUtente, dati, nomeFile, serverPath, codiceAmm, update, ref utInseriti, ref utAggiornati);
                return result;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: importaUtenti", e);
                return false;
            }
        }

        [WebMethod]
        public virtual bool insertFile(DocsPaVO.utente.InfoUtente infoUtente, byte[] dati, string nomeFile, string type)
        {
            try
            {
                SetUserId(infoUtente);
                string serverPath = "";
                switch (type)
                {
                    case "Amministrazione":
                        serverPath = System.Configuration.ConfigurationManager.AppSettings["ADMIN_IMAGES_ROOT_PATH"];
                        break;

                    case "FrontEnd":
                        serverPath = System.Configuration.ConfigurationManager.AppSettings["IMAGES_ROOT_PATH"];
                        break;
                }
                bool result = BusinessLogic.Amministrazione.AmministraManager.insertFile(infoUtente, dati, nomeFile, serverPath);
                return result;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: insertFile", e);
                return false;
            }
        }

        [WebMethod]
        public virtual string getpath(string type)
        {
            string serverPath = "";
            try
            {

                switch (type)
                {
                    case "Amministrazione":
                        serverPath = System.Configuration.ConfigurationManager.AppSettings["ADMIN_IMAGES_ROOT_PATH"];
                        break;

                    case "FrontEnd":
                        serverPath = System.Configuration.ConfigurationManager.AppSettings["IMAGES_ROOT_PATH"];
                        break;

                    case "LoginFE":
                        serverPath = System.Configuration.ConfigurationManager.AppSettings["IMAGES_PATH"];
                        break;

                    case "Scrittura":
                        serverPath = System.Configuration.ConfigurationManager.AppSettings["READ_IMAGES_ROOT_PATH"];
                        break;

                    case "Css":
                        serverPath = System.Configuration.ConfigurationManager.AppSettings["CSS_ROOT_PATH"];
                        break;
                }
                return serverPath;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: existFile", e);
                return serverPath;
            }
        }

        [WebMethod]
        public virtual string findFontColor(string idAmm)
        {
            string result = "";
            try
            {
                result = BusinessLogic.Amministrazione.AmministraManager.findFontColor(idAmm);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: findFontColor", e);
                result = "";
            }
            return result;
        }

        [WebMethod]
        public virtual string findPulsColor(string idAmm)
        {
            string result = "";
            try
            {
                result = BusinessLogic.Amministrazione.AmministraManager.findPulsColor(idAmm);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: findPulsColor", e);
                result = "";
            }
            return result;
        }

        [WebMethod]
        public virtual string findRecords(string idAmm)
        {
            string result = "";
            try
            {
                result = BusinessLogic.Amministrazione.AmministraManager.findRecords(idAmm);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: findRecords", e);
                result = null;
            }
            return result;
        }

        [WebMethod]
        public virtual bool modifyRecordNumber(string idAmm, char chk, int num)
        {
            bool result = true;
            try
            {
                result = BusinessLogic.Amministrazione.AmministraManager.modifyRecordNumber(idAmm, chk, num);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: modifyRecordNumber", e);
                result = false;
            }
            return result;
        }

        [WebMethod]
        public virtual bool changeColor(string idAmm, string color)
        {
            bool result = false;
            try
            {
                result = BusinessLogic.Amministrazione.AmministraManager.changeColor(idAmm, color);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: changeColor", e);
                result = false;
            }
            return result;
        }

        [WebMethod]
        public virtual bool changePulsColor(string idAmm, string color)
        {
            bool result = false;
            try
            {
                result = BusinessLogic.Amministrazione.AmministraManager.changePulsColor(idAmm, color);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: changePulsColor", e);
                result = false;
            }
            return result;
        }

        [WebMethod]
        [return: XmlArray()]
        public virtual ArrayList getLogImportOggettario()
        {
            ArrayList logFile = new ArrayList();

            try
            {
                //string serverPath = System.Configuration.ConfigurationManager.AppSettings["MODELS_ROOT_PATH"];
                // PALUMBO: modificato per ovviare al blocco dell'accesso su macchina 20 in scrittura    
                //string serverPath = System.Configuration.ConfigurationManager.AppSettings["LOG_PATH"];
                string serverPath = System.Configuration.ConfigurationManager.AppSettings["DOC_ROOT"];
                serverPath = System.IO.Path.Combine(serverPath, DateTime.Now.ToString("yyyyMMdd"));

                logFile = BusinessLogic.Oggettario.OggettarioManager.getLogImportOggettario(serverPath);
                return logFile;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getLogImportOggettario", e);
                return logFile;
            }
        }


        [WebMethod]
        [return: XmlArray()]
        public virtual ArrayList getLogImportUtenti()
        {
            ArrayList logFile = new ArrayList();

            try
            {
                //string serverPath = System.Configuration.ConfigurationManager.AppSettings["MODELS_ROOT_PATH"];
                // PALUMBO: modificato per ovviare al blocco dell'accesso su macchina 20 in scrittura    
                //string serverPath = System.Configuration.ConfigurationManager.AppSettings["LOG_PATH"];
                string serverPath = System.Configuration.ConfigurationManager.AppSettings["DOC_ROOT"];
                serverPath = System.IO.Path.Combine(serverPath, DateTime.Now.ToString("yyyyMMdd"));

                logFile = BusinessLogic.Utenti.UserManager.getLogImportUtenti(serverPath);
                return logFile;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getLogImportUtenti", e);
                return logFile;
            }
        }

        [WebMethod]
        [return: XmlArray()]
        public virtual ArrayList getLogImportTitolario()
        {
            ArrayList logFile = new ArrayList();

            try
            {
                //string serverPath = System.Configuration.ConfigurationManager.AppSettings["MODELS_ROOT_PATH"];
                // PALUMBO: modificato per ovviare al blocco dell'accesso su macchina 20 in scrittura    
                //string serverPath = System.Configuration.ConfigurationManager.AppSettings["LOG_PATH"];
                string serverPath = System.Configuration.ConfigurationManager.AppSettings["DOC_ROOT"];
                serverPath = System.IO.Path.Combine(serverPath, DateTime.Now.ToString("yyyyMMdd"));

                logFile = BusinessLogic.Amministrazione.TitolarioManager.getLogImportTitolario(serverPath);
                return logFile;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getLogImportTitolario", e);
                return logFile;
            }
        }

        [WebMethod]
        [return: XmlArray()]
        public virtual ArrayList getLogImportRubrica()
        {
            ArrayList logFile = new ArrayList();

            try
            {
                //string serverPath = System.Configuration.ConfigurationManager.AppSettings["MODELS_ROOT_PATH"];
                // PALUMBO: modificato per ovviare al blocco dell'accesso su macchina 20 in scrittura    
                //string serverPath = System.Configuration.ConfigurationManager.AppSettings["LOG_PATH"];
                //string serverPath = DocsPaUtils.Configuration.InitConfigurationKeys.GetValue("0", "BE_LOG_PATH");
                //serverPath = serverPath.Replace("%DATA", DateTime.Now.ToString("yyyyMMdd"));
                string serverPath = System.Configuration.ConfigurationManager.AppSettings["DOC_ROOT"];
                serverPath = System.IO.Path.Combine(serverPath, DateTime.Now.ToString("yyyyMMdd"));

                logFile = BusinessLogic.Rubrica.DPA3_RubricaSearchAgent.getLogImportRubrica(serverPath);
                return logFile;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getLogImportRubrica", e);
                return logFile;
            }
        }




        #region Gestione allineamento archivio cartaceo / elettronico

        /// <summary>
        /// Reperimento documenti ancora da fascicolare in archivio cartaceo
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <param name="filtriRicerca"></param>
        /// <param name="idSnapshot"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.FascicolazioneCartacea.DocumentoFascicolazione[] FascCartaceaGetDocumentiFascicolazione(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.filtri.FiltroRicerca[] filtriRicerca)
        {
            SetUserId(infoUtente);
            try
            {
                return BusinessLogic.FascicolazioneCartacea.FascicolazioneCartaceaServices.GetDocumentiFascicolazione(infoUtente, filtriRicerca);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascCartaceaGetDocumentiFascicolazione", e);

                throw e;
            }
        }

        /// <summary>
        /// Reperimento documenti ancora da fascicolare in archivio cartaceo
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <param name="filtriRicerca"></param>
        /// <param name="requestedPage"></param>
        /// <param name="pageSize"></param>
        /// <param name="totalRecordCount"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.FascicolazioneCartacea.DocumentoFascicolazione[] FascCartaceaGetDocumentiFascicolazionePaging(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.filtri.FiltroRicerca[] filtriRicerca, int requestedPage, int pageSize, ref int totalRecordCount)
        {
            SetUserId(infoUtente);
            try
            {
                return BusinessLogic.FascicolazioneCartacea.FascicolazioneCartaceaServices.GetDocumentiFascicolazione(infoUtente, filtriRicerca, requestedPage, pageSize, ref totalRecordCount);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascCartaceaGetDocumentiFascicolazione", e);

                throw e;
            }
        }

        /// <summary>
        /// Reperimento di tutti i documenti acquisiti gi fascicolati su cartaceo 
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <param name="filtriRicerca"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.FascicolazioneCartacea.DocumentoFascicolazione[] FascCartaceaGetDocumentiFascicolati(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.filtri.FiltroRicerca[] filtriRicerca)
        {
            SetUserId(infoUtente);
            try
            {
                return BusinessLogic.FascicolazioneCartacea.FascicolazioneCartaceaServices.GetDocumentiFascicolati(infoUtente, filtriRicerca);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascCartaceaGetDocumentiFascicolati", e);

                throw e;
            }
        }

        /// <summary>
        /// 
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <param name="versionId"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.documento.FileDocumento FascCartaceaGetFile(DocsPaVO.utente.InfoUtente infoUtente, int versionId)
        {
            SetUserId(infoUtente);
            try
            {
                return BusinessLogic.FascicolazioneCartacea.FascicolazioneCartaceaServices.GetFile(infoUtente, versionId);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascCartaceaGetFile", e);

                throw e;
            }
        }

        /// <summary>
        /// 
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <param name="idProfile"></param>
        /// <param name="idFascicolo"></param>
        /// <returns></returns>
        [WebMethod()]
        public bool FascCartaceaRimuoviDocumentoDaFascicolo(DocsPaVO.utente.InfoUtente infoUtente, int idProfile, int idFascicolo)
        {
            SetUserId(infoUtente);
            try
            {
                return BusinessLogic.FascicolazioneCartacea.FascicolazioneCartaceaServices.RimuoviDocumentoDaFascicolo(infoUtente, idProfile, idFascicolo);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascCartaceaRimuoviDocumentoDaFascicolo", e);

                throw e;
            }
        }

        /// <summary>
        /// Se in base dati  presente il tipo componenti java applet (true) altrimenti (false)
        /// </summary>
        /// <returns></returns>
        [WebMethod()]
        public bool EnableJavaAppletOption()
        {
            bool retVal = false;
            try
            {
                retVal = DocsPaDB.Query_DocsPAWS.SmartClient.EnableJavaAppletOption();
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: EnableJavaAppletOption", e);
                retVal = false;
            }

            return retVal;
        }

        /// <summary>
        /// Se in base dati  presente il tipo componenti HTML5 Socket (true) altrimenti (false)
        /// </summary>
        /// <returns></returns>
        [WebMethod()]
        public bool EnableHTML5SocketOption()
        {
            bool retVal = false;
            try
            {
                retVal = DocsPaDB.Query_DocsPAWS.SmartClient.EnableHTML5SocketOption();
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: EnableJavaAppletOption", e);
                retVal = false;
            }

            return retVal;
        }

        /// <summary>
        /// 
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <param name="versionId"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.FascicolazioneCartacea.FascicoloArchivio[] FascCartaceaVerificaDocumentoFascicolato(DocsPaVO.utente.InfoUtente infoUtente, int versionId)
        {
            SetUserId(infoUtente);
            try
            {
                return BusinessLogic.FascicolazioneCartacea.FascicolazioneCartaceaServices.VerificaDocumentoFascicolato(infoUtente, versionId);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascCartaceaVerificaDocumentoFascicolato", e);

                throw e;
            }
        }

        /// <summary>
        /// Save dei dati documento fascicolazione
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <param name="documenti"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.Validations.ValidationResultInfo FascCartaceaSaveDocumentiFascicolazione(DocsPaVO.utente.InfoUtente infoUtente, int idSnapshot, ref DocsPaVO.FascicolazioneCartacea.DocumentoFascicolazione[] documenti)
        {
            SetUserId(infoUtente);
            try
            {
                return BusinessLogic.FascicolazioneCartacea.FascicolazioneCartaceaServices.SaveDocumentiFascicolazione(infoUtente, idSnapshot, ref documenti);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascCartaceaSaveDocumentiFascicolazione", e);

                throw e;
            }
        }

        /// <summary>
        /// Archiviazione di un documento in un fascicolo cartaceo
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <param name="documento"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.Validations.ValidationResultInfo FascCartaceaFascicolaDocumento(DocsPaVO.utente.InfoUtente infoUtente, ref DocsPaVO.FascicolazioneCartacea.DocumentoFascicolazione documento)
        {
            SetUserId(infoUtente);
            try
            {
                return BusinessLogic.FascicolazioneCartacea.FascicolazioneCartaceaServices.FascicolaDocumento(infoUtente, ref documento);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolaDocumento", e);

                throw e;
            }
        }

        /// <summary>
        /// Save dei dati fascicolo archivio cartaceo
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <param name="documento"></param>
        /// <returns></returns>
        [WebMethod()]
        public bool FascCartaceaSaveFascicoloArchivio(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.FascicolazioneCartacea.FascicoloArchivio fascicolo)
        {
            SetUserId(infoUtente);
            try
            {
                return BusinessLogic.FascicolazioneCartacea.FascicolazioneCartaceaServices.SaveFascicoloArchivio(infoUtente, fascicolo);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascCartaceaSaveFascicoloArchivio", e);

                throw e;
            }
        }

        /// <summary>
        /// Export dei documenti
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <param name="filtriRicerca"></param>
        /// <param name="format"></param>
        /// <param name="exportTitle"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.documento.FileDocumento FascCartaceaExportListFilters(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.ExportData.ExportDataFormatEnum format, DocsPaVO.filtri.FiltroRicerca[] filtriRicerca, string exportTitle)
        {
            SetUserId(infoUtente);
            try
            {
                return BusinessLogic.FascicolazioneCartacea.FascicolazioneCartaceaServices.ExportList(infoUtente, format, filtriRicerca, exportTitle);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascCartaceaExportList", e);

                throw e;
            }
        }

        /// <summary>
        /// Export dei documenti
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <param name="documenti"></param>
        /// <param name="exportTitle"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.documento.FileDocumento FascCartaceaExportList(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.ExportData.ExportDataFormatEnum format, DocsPaVO.FascicolazioneCartacea.DocumentoFascicolazione[] documenti, string exportTitle)
        {
            SetUserId(infoUtente);
            try
            {
                return BusinessLogic.FascicolazioneCartacea.FascicolazioneCartaceaServices.ExportList(infoUtente, format, documenti, exportTitle);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascCartaceaExportList", e);

                throw e;
            }
        }

        /// <summary>
        /// Reperimento lista delle snapshot salvate
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <param name="documenti"></param>
        /// <param name="exportTitle"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.FascicolazioneCartacea.SnapshotDocumentiFascicolazione[] FascCartaceaGetSnapshotList(DocsPaVO.utente.InfoUtente infoUtente)
        {
            SetUserId(infoUtente);
            try
            {
                return BusinessLogic.FascicolazioneCartacea.FascicolazioneCartaceaSnapshotServices.GetSnapshotList(infoUtente);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascCartaceaGetSnapshotList", e);

                throw e;
            }
        }

        /// <summary>
        /// 
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <param name="idSnapshot"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.FascicolazioneCartacea.SnapshotDocumentiFascicolazione FascCartaceaCreateSnapshot(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.filtri.FiltroRicerca[] filtri)
        {
            SetUserId(infoUtente);
            try
            {
                return BusinessLogic.FascicolazioneCartacea.FascicolazioneCartaceaSnapshotServices.CreateSnapshot(infoUtente, filtri);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascCartaceaCreateSnapshot", e);

                throw e;
            }
        }

        /// <summary>
        /// Reperimento filtri salvati per una snapshot
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <param name="idSnapshot"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.filtri.FiltroRicerca[] FascCartaceaGetSnapshotFilters(DocsPaVO.utente.InfoUtente infoUtente, int idSnapshot)
        {
            SetUserId(infoUtente);
            try
            {
                return BusinessLogic.FascicolazioneCartacea.FascicolazioneCartaceaSnapshotServices.GetSnapshotFilters(infoUtente, idSnapshot);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascCartaceaGetSnapshotFilters", e);

                throw e;
            }
        }

        /// <summary>
        /// Rimozione snapshot
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <param name="idSnapshot"></param>
        [WebMethod()]
        public void FascCartaceaRemoveSnapshot(DocsPaVO.utente.InfoUtente infoUtente, int idSnapshot)
        {
            SetUserId(infoUtente);
            try
            {
                BusinessLogic.FascicolazioneCartacea.FascicolazioneCartaceaSnapshotServices.RemoveSnapshot(infoUtente, idSnapshot);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascCartaceaRemoveSnapshot", e);

                throw e;
            }
        }

        /// <summary>
        /// Servizio che permette di scartare un documento non cartaceo
        /// in modo tale da non essere considerato
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <param name="idSnapshot"></param>
        /// <param name="documento"></param>
        /// <param name="fascicoliScartati"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.Validations.ValidationResultInfo FascCartaceaScartaDocumentoNonCartaceo(DocsPaVO.utente.InfoUtente infoUtente, int idSnapshot, DocsPaVO.FascicolazioneCartacea.DocumentoFascicolazione documento, out int fascicoliScartati)
        {
            SetUserId(infoUtente);
            try
            {
                return BusinessLogic.FascicolazioneCartacea.FascicolazioneCartaceaServices.ScartaDocumentoNonCartaceo(infoUtente, idSnapshot, documento, out fascicoliScartati);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascCartaceaScartaDocumentoNonCartaceo", e);

                throw e;
            }
        }

        #endregion


        #region Gestione Voci Menu Amministrazione  //SABRINA

        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.amministrazione.Menu))]
        public virtual ArrayList AmmGetListMenuUtente(string idAmm, string idCorrGlob)
        {
            ArrayList retValue = new ArrayList();

            try
            {
                retValue = BusinessLogic.Amministrazione.UtenteManager.AmmGetListMenuUtente(idAmm, idCorrGlob);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmGetListMenuUtente - ", e);
            }

            return retValue;
        }

        [WebMethod]
        public virtual DocsPaVO.amministrazione.EsitoOperazione AmmInsMenuUtenteAdmin(DocsPaVO.amministrazione.Menu[] listaMenu, string idCorrGlob, string idAmm)
        {
            DocsPaVO.amministrazione.EsitoOperazione esito = new DocsPaVO.amministrazione.EsitoOperazione();
            try
            {
                esito = BusinessLogic.Amministrazione.UtenteManager.AmmInsMenuUtenteAdmin(listaMenu, idCorrGlob, idAmm);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmInsMenuUtenteAdmin - ", e);
                esito.Codice = 1;
                esito.Descrizione = "si  verificato un errore";
            }

            return esito;
        }

        [WebMethod]
        public virtual bool AmmCheckMenuAssUtente(string idCorrGlob)
        {
            bool esito = false;
            try
            {
                esito = BusinessLogic.Amministrazione.UtenteManager.AmmCheckMenuAssUtente(idCorrGlob);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmCheckMenuAssUtente - ", e);
            }

            return esito;
        }

        [WebMethod]
        public virtual DocsPaVO.amministrazione.EsitoOperazione AmmEliminaMenuUtenteAdmin(string idCorrGlob)
        {
            DocsPaVO.amministrazione.EsitoOperazione esito = new DocsPaVO.amministrazione.EsitoOperazione();
            try
            {
                esito = BusinessLogic.Amministrazione.UtenteManager.AmmEliminaMenuUtenteAdmin(idCorrGlob);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmEliminaMenuUtenteAdmin - ", e);
                esito.Codice = 1;
                esito.Descrizione = "si  verificato un errore";
            }

            return esito;
        }

        #endregion

        #region Gestione formati file supportati

        /// <summary>
        /// Reperimento dei tipi di file supportati da un'amministrazione
        /// </summary>
        /// <param name="idAmministrazione"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.FormatiDocumento.SupportedFileType[] GetSupportedFileTypes(int idAmministrazione)
        {
            try
            {
                return BusinessLogic.FormatiDocumento.SupportedFormatsManager.GetFileTypes(idAmministrazione);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetSupportedFileTypes", e);

                throw e;
            }
        }

        /// <summary>
        /// Reperimento di un tipo di file supportato da un'amministrazione
        /// </summary>
        /// <param name="idAmministrazione"></param>
        /// <param name="fileExtension"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.FormatiDocumento.SupportedFileType GetSupportedFileType(int idAmministrazione, string fileExtension)
        {
            try
            {
                return BusinessLogic.FormatiDocumento.SupportedFormatsManager.GetFileType(idAmministrazione, fileExtension);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetSupportedFileType", e);

                throw e;
            }
        }

        /// <summary>
        /// Verifica se risulta abilitata o meno la gestione dei formati file
        /// </summary>
        /// <returns></returns>
        [WebMethod()]
        public bool IsEnabledSupportedFileTypes()
        {
            try
            {
                return BusinessLogic.FormatiDocumento.Configurations.SupportedFileTypesEnabled;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: IsEnabledSupportedFileTypes", e);

                throw e;
            }
        }

        /// <summary>
        /// Verifica se risulta abilitata o meno la gestione degli RF
        /// </summary>
        /// <returns></returns>
        [WebMethod()]
        public bool IsEnabledRF(string idAmm)
        {
            try
            {
                return BusinessLogic.Utenti.RegistriManager.enabledRF(idAmm);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: IsEnabledSupportedFileTypes", e);

                throw e;
            }
        }

        /// <summary>
        /// Salvataggio di un oggetto "SupportedFileType"
        /// </summary>
        /// <param name="fileType"></param>
        [WebMethod()]
        public DocsPaVO.Validations.ValidationResultInfo SaveSupportedFileType(ref DocsPaVO.FormatiDocumento.SupportedFileType fileType)
        {
            try
            {
                return BusinessLogic.FormatiDocumento.SupportedFormatsManager.SaveFileType(ref fileType);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: SaveSupportedFileType", e);

                throw e;
            }
        }

        /// <summary>
        /// Rimozione di un oggetto "SupportedFileType".
        /// I tipi di file predefiniti non possono essere rimossi.
        /// </summary>
        /// <param name="fileType"></param>
        [WebMethod()]
        public DocsPaVO.Validations.ValidationResultInfo RemoveSupportedFileType(ref DocsPaVO.FormatiDocumento.SupportedFileType fileType)
        {
            try
            {
                return BusinessLogic.FormatiDocumento.SupportedFormatsManager.RemoveFileType(ref fileType);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: RemoveSupportedFileType", e);

                throw e;
            }
        }

        /// <summary>
        /// Reperimento modello predefinito per il file
        /// </summary>
        /// <param name="admin"></param>
        /// <param name="fileType"></param>
        /// <returns></returns>
        [WebMethod()]
        public byte[] GetFileTypeDocumentModel(string admin, string fileType)
        {
            try
            {
                return BusinessLogic.FormatiDocumento.DocumentModelsManager.GetModelFile(admin, fileType);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetFileTypeDocumentModel", e);

                throw e;
            }
        }

        /// <summary>
        /// 
        /// </summary>
        /// <param name="admin"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.Validations.ValidationResultInfo RemoveFileTypeDocumentModel(string admin, string fileType)
        {
            try
            {
                return BusinessLogic.FormatiDocumento.DocumentModelsManager.RemoveFileTypeDocumentModel(admin, fileType);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: RemoveFileTypeDocumentModel", e);

                throw e;
            }
        }

        /// <summary>
        /// Impostazione del modello predefinito per il file
        /// </summary>
        /// <param name="admin"></param>
        /// <param name="fileType"></param>
        /// <param name="fileContent"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.Validations.ValidationResultInfo SetFileTypeDocumentModel(string admin, string fileType, byte[] fileContent)
        {
            try
            {
                return BusinessLogic.FormatiDocumento.DocumentModelsManager.SetFileTypeDocumentModel(admin, fileType, fileContent);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: SetFileTypeDocumentModel", e);

                throw e;
            }
        }

        #endregion
        /// <summary>
        /// Verifica se utente  proprietario di un dato oggetto
        /// </summary>
        /// <param name="idObj"></param>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual bool DirittoProprietario(string idObj, DocsPaVO.utente.InfoUtente infoUtente)
        {
            SetUserId(infoUtente);
            bool result = false;
            try
            {
                result = BusinessLogic.Documenti.DocManager.DirittoProprietario(idObj, infoUtente);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DirittoProprietario", e);
                result = false;
            }
            return result;
        }
        /// <summary>
        /// consente di rimuovere la visibilit sul documento per il ruolo o utente selezionato
        /// </summary>
        /// <param name="docNumber"></param>
        /// <param name="corr"></param>
        /// <param name="infout"></param>
        /// <returns></returns>
        [WebMethod]
        public string RemoveVisibilita(string docNumber, DocsPaVO.utente.Corrispondente corr, DocsPaVO.utente.InfoUtente infout)
        {
            SetUserId(infout);
            string result = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                BusinessLogic.Utenti.UserManager um = new BusinessLogic.Utenti.UserManager();
                result = um.removeVisibilita(docNumber, corr);
#if TRACE_WS
				pt.WriteLogTracer("GetVisibilitaRuoli");
#endif

                BusinessLogic.UserLog.UserLog.WriteLog(infout, "CANCELLADIRITTI", docNumber, string.Format("{0}{1}{2}{3}{4}{5}", "Cancellati diritti sul N.ro Doc.: ", docNumber, " per ", corr.descrizione, " da ", infout.userId), DocsPaVO.Logger.CodAzione.Esito.OK);

            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(infout, "CANCELLADIRITTI", docNumber, string.Format("{0}{1}{2}{3}{4}{5}", "Cancellati diritti sul N.ro Doc.: ", docNumber, " per ", corr.descrizione, " da ", infout.userId), DocsPaVO.Logger.CodAzione.Esito.KO);

                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetVisibilitaRuoli", e);
                result = null;
            }
            return result;
        }


        [WebMethod]
        [XmlInclude(typeof(DocsPaVO.utente.Corrispondente))]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.utente.Corrispondente))]
        public virtual ArrayList AddressbookGetListaCorrispondentiLite(string descrizione, string tipoIE, string idAmm)
        {
            ArrayList result = null;

            try
            {

                //gestione tracer

#if TRACE_WS

                        DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");

#endif

                result = BusinessLogic.Utenti.UserManager.getListaCorrispondentiByDescrizione(descrizione, tipoIE, idAmm);

#if TRACE_WS

                        pt.WriteLogTracer("getListaCorrispondentiByDescrizione");

#endif
            }

            catch (Exception e)
            {

                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getListaCorrispondentiByDescrizione", e);
                result = null;
            }

            return result;
        }

        [WebMethod]
        public virtual DocsPaVO.Interoperabilita.DatiInteropAutomatica getDatiInteropAutomatica()
        {
            return new DocsPaVO.Interoperabilita.DatiInteropAutomatica();
        }

        [WebMethod]
        public bool importTitolario(byte[] dati, DocsPaVO.amministrazione.OrgTitolario titolario, DocsPaVO.utente.InfoUtente infoUtente)
        {
            try
            {
                SetUserId(infoUtente);
                //string serverPath = System.Configuration.ConfigurationManager.AppSettings["MODELS_ROOT_PATH"];
                // PALUMBO: modificato per ovviare al blocco dell'accesso su macchina 20 in scrittura    
                //string serverPath = System.Configuration.ConfigurationManager.AppSettings["LOG_PATH"];
                string serverPath = System.Configuration.ConfigurationManager.AppSettings["DOC_ROOT"];
                serverPath = System.IO.Path.Combine(serverPath, DateTime.Now.ToString("yyyyMMdd"));

                bool result = BusinessLogic.Amministrazione.TitolarioManager.importaTitolario(dati, "importazioneTitolario.xls", serverPath, infoUtente, titolario, System.Configuration.ConfigurationManager.AppSettings["DS_PROVIDER"],
                    System.Configuration.ConfigurationManager.AppSettings["DS_EXTENDED_PROPERTIES"]);
                return result;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: importTitolario", e);
                return false;
            }
        }

        [WebMethod]
        public bool modificaTemplateExcelTitolario(string codice, string descrizione, string nomeFile, DocsPaVO.utente.InfoUtente infoUtente)
        {
            SetUserId(infoUtente);
            try
            {
                string serverPath = System.Configuration.ConfigurationManager.AppSettings["MODELS_ROOT_PATH"];

                bool result = BusinessLogic.Amministrazione.TitolarioManager.modificaTemplateExcelTitolario(codice, descrizione, nomeFile, serverPath, infoUtente);
                return result;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: modificaTemplateExcelTitolario", e);
                return false;
            }
        }


        #region Gestione scadenza password per amministrazione

        /// <summary>
        /// 
        /// </summary>
        /// <returns></returns>
        [WebMethod()]
        public bool AdminIsSupportedPasswordConfig()
        {
            try
            {
                return BusinessLogic.Amministrazione.AdminPasswordConfig.IsSupportedPasswordConfig();
            }
            catch (Exception e)
            {
                throw new ApplicationException("Errore in DocsPaWS.asmx  - metodo: AdminIsSupportedPasswordConfig", e);
            }
        }

        /// <summary>
        /// Save dei dati per la gestione delle password in amministrazione
        /// </summary>
        /// <param name="configurations"></param>
        /// <returns></returns>
        [WebMethod()]
        public bool AdminSavePasswordConfigurations(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.amministrazione.PasswordConfigurations configurations)
        {
            SetUserId(infoUtente);
            try
            {
                return BusinessLogic.Amministrazione.AdminPasswordConfig.SavePasswordConfigurations(infoUtente, configurations);
            }
            catch (Exception e)
            {
                throw new ApplicationException("Errore in DocsPaWS.asmx  - metodo: AdminSavePasswordConfigurations", e);
            }
        }

        /// <summary>
        /// Reperimento dei dati per la gestione della password in amministrazione
        /// </summary>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.amministrazione.PasswordConfigurations AdminGetPasswordConfigurations(DocsPaVO.utente.InfoUtente infoUtente, int idAmministrazione)
        {
            SetUserId(infoUtente);
            try
            {
                return BusinessLogic.Amministrazione.AdminPasswordConfig.GetPasswordConfigurations(infoUtente, idAmministrazione);
            }
            catch (Exception e)
            {
                throw new ApplicationException("Errore in DocsPaWS.asmx  - metodo: AdminGetPasswordConfigurations", e);
            }
        }

        /// <summary>
        /// 
        /// </summary>
        /// <param name="idAmministrazione"></param>
        [WebMethod()]
        public void AdminExpireAllPassword(DocsPaVO.utente.InfoUtente infoUtente, int idAmministrazione)
        {
            SetUserId(infoUtente);
            try
            {
                BusinessLogic.Amministrazione.AdminPasswordConfig.ExpireAllPassword(infoUtente, idAmministrazione);
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente,
                        "MODUSER", infoUtente.idCorrGlobali,
                        string.Format("Richiesta di invalidare tutte le password da parte dell'amministratore {0}",
                            infoUtente.userId),
                            DocsPaVO.Logger.CodAzione.Esito.OK);
            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente,
                        "MODUSER", infoUtente.idCorrGlobali,
                        string.Format("Errore nella richiesta di invalidare tutte le password da parte dell'amministratore {0}",
                            infoUtente.userId),
                            DocsPaVO.Logger.CodAzione.Esito.KO);
                throw new ApplicationException("Errore in DocsPaWS.asmx  - metodo: AdminExpireAllPassword", e);
            }
        }

        /// <summary>
        /// Modifica della password per l'utente
        /// </summary>
        /// <param name="oldPassword"></param>
        /// <param name="newPassword"></param>
        /// <param name="user"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.Validations.ValidationResultInfo UserChangePassword(DocsPaVO.utente.UserLogin user, string oldPassword)
        {
            SetUserId(user.UserName);
            try
            {
                return BusinessLogic.Utenti.Login.ChangePassword(user, oldPassword);
            }
            catch (Exception e)
            {
                throw new ApplicationException("Errore in DocsPaWS.asmx  - metodo: UserChangePassword", e);
            }
        }

        ///// <summary>
        ///// Modifica della password per l'utente
        ///// </summary>
        ///// <param name="oldPassword"></param>
        ///// <param name="newPassword"></param>
        ///// <param name="user"></param>
        ///// <returns></returns>
        //[WebMethod()]
        //public DocsPaVO.Validations.ValidationResultInfo UserChangePassword(DocsPaVO.utente.UserLogin user, string oldPassword, int insertMode)
        //{
        //    SetUserId(user.UserName);
        //    try
        //    {
        //        return BusinessLogic.Utenti.Login.ChangePassword(user, oldPassword, insertMode);
        //    }
        //    catch (Exception e)
        //    {
        //        throw new ApplicationException("Errore in DocsPaWS.asmx  - metodo: UserChangePassword", e);
        //    }
        //}

        /// <summary>
        /// Modifica della password per l'amministratore
        /// </summary>
        /// <param name="newPassword"></param>
        /// <param name="userId"></param>
        /// <returns></returns>
        [WebMethod]
        public DocsPaVO.Validations.ValidationResultInfo AdminChangePassword(DocsPaVO.utente.UserLogin user, string oldPassword)
        {
            try
            {
                return BusinessLogic.Amministrazione.AmministraManager.ChangeAdminPassword(user, oldPassword);
            }
            catch (Exception e)
            {
                throw new ApplicationException("Errore in DocsPaWS.asmx  - metodo: AdminChangePassword", e);
            }
        }

        /// <summary>
        /// Reperimento della data di scadenza della password per l'utente
        /// </summary>
        /// <param name="userId"></param>
        /// <returns></returns>
        [WebMethod]
        public DateTime GetUserPasswordExpirationDate(string userId)
        {
            SetUserId(userId);
            try
            {
                return BusinessLogic.Utenti.Login.GetUserPasswordExpirationDate(userId);
            }
            catch (Exception e)
            {
                throw new ApplicationException("Errore in DocsPaWS.asmx  - metodo: GetUserPasswordExpirationDate", e);
            }
        }

        #endregion

        [WebMethod]
        public bool deleteTitolario(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.amministrazione.OrgTitolario titolario)
        {
            SetUserId(infoUtente);
            try
            {
                bool result = BusinessLogic.Amministrazione.TitolarioManager.deleteTitolario(infoUtente, titolario);
                return result;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: deleteTitolario", e);
                return false;
            }
        }

        [WebMethod]
        public bool SaveTitolario(DocsPaVO.utente.InfoUtente infoUtente, ref DocsPaVO.amministrazione.OrgTitolario titolario)
        {
            try
            {
                SetUserId(infoUtente);
                bool result = BusinessLogic.Amministrazione.TitolarioManager.SaveTitolario(infoUtente, titolario);
                return result;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: saveTitolario", e);
                return false;
            }
        }

        [WebMethod]
        public bool existTitolarioInDef(string codiceAmm)
        {
            try
            {
                bool result = BusinessLogic.Amministrazione.TitolarioManager.existTitolarioInDef(codiceAmm);
                return result;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: existTitolarioInDef", e);
                return false;
            }
        }

        [WebMethod]
        public bool attivaTitolario(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.amministrazione.OrgTitolario titolario)
        {
            SetUserId(infoUtente);
            try
            {
                bool result = BusinessLogic.Amministrazione.TitolarioManager.attivaTitolario(infoUtente, titolario);
                return result;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: attivaTitolario", e);
                return false;
            }
        }

        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.amministrazione.OrgTitolario))]
        public virtual ArrayList getTitolari(string idAmministrazione)
        {
            ArrayList titolari = new ArrayList();
            try
            {
                titolari = BusinessLogic.Amministrazione.TitolarioManager.getTitolari(idAmministrazione);
                return titolari;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getTitolari", e);
                return titolari;
            }
        }

        [WebMethod]
        public virtual string getTitolarioAttivo(string idAmministrazione, out string codAmministrazione)
        {
            string idTitolario = "";
            codAmministrazione = "";
            try
            {
                idTitolario = BusinessLogic.Amministrazione.TitolarioManager.getTitolarioAttivo(idAmministrazione, out codAmministrazione);
                return idTitolario;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getTitolarioAttivo", e);
                return idTitolario;
            }
        }

        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.amministrazione.OrgTitolario))]
        public virtual ArrayList getTitolariUtilizzabili(string idAmministrazione)
        {
            ArrayList titolari = new ArrayList();
            try
            {
                titolari = BusinessLogic.Amministrazione.TitolarioManager.getTitolariUtilizzabili(idAmministrazione);
                return titolari;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getTitolariUtilizzabili", e);
                return titolari;
            }
        }

        [WebMethod]
        public virtual DocsPaVO.amministrazione.OrgTitolario getTitolarioById(string idTitolario)
        {
            DocsPaVO.amministrazione.OrgTitolario titolario;
            try
            {
                titolario = BusinessLogic.Amministrazione.TitolarioManager.getTitolarioById(idTitolario);
                return titolario;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getTitolarioById", e);
                return null;
            }
        }


        [WebMethod]
        public virtual string getRegTitolarioById(string idTitolario)
        {
            //DocsPaVO.amministrazione.OrgTitolario titolario;
            string titolario = "";
            try
            {
                titolario = BusinessLogic.Amministrazione.TitolarioManager.getRegTitolarioById(idTitolario);
                return titolario;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getRegTitolarioById", e);
                return null;
            }
        }

        /// <summary>
        /// Verifica se risulta abilitata o meno la gestione dell'interoperabilit tra AOO interne
        /// </summary>
        /// <returns></returns>
        [WebMethod]
        public bool IsEnabledInteropInterna()
        {
            try
            {
                return BusinessLogic.Interoperabilit.InteroperabilitaUtils.InteropInternaEnabled;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: IsEnabledInteropInterna", e);

                throw e;
            }
        }

        /// <summary>
        /// Ritorna true, se il documento  gi classificato nella folder specificata
        /// false altrimenti
        /// </summary>
        /// <returns></returns>
        [WebMethod]
        public bool IsDocumentoClassificatoInFolder(string idProfile, string idFolder)
        {
            bool retValue = false;
            try
            {

                retValue = BusinessLogic.Fascicoli.FascicoloManager.IsDocumentoInFolder(idProfile, idFolder);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: IsDocumentoClassificatoInFolder", e);

                throw e;
            }
            return retValue;
        }

        /// <summary>
        /// 
        /// </summary>
        /// <param name="codiceRagione"></param>
        /// <param name="idAmministrazione"></param>
        /// <param name="msgNotificaDocumenti"></param>
        /// <param name="msgNotificaFascioli"></param>
        /// <param name="allRagioni">booleano che indica se il testo viene aggiornato per tutte le
        /// regioni di trasmissione o meno</param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.Validations.ValidationResultInfo AmmUpdateMessageNotificaRagioneTrasmissione(string codiceRagione, string idAmministrazione, string msgNotificaDocumenti, string msgNotificaFascioli, bool allRagioniDoc, bool allRagioniFasc)
        {
            DocsPaVO.Validations.ValidationResultInfo retValue = null;

            try
            {
                retValue = BusinessLogic.Amministrazione.RagioniTrasmissioneManager.UpdateMessageNotificaRagioneTrasmissione(codiceRagione, idAmministrazione, msgNotificaDocumenti, msgNotificaFascioli, allRagioniDoc, allRagioniFasc);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmUpdateMsgNotificaRagioneTrasmissione", e);
            }

            return retValue;
        }


        [WebMethod]
        public bool copiaTitolario(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.amministrazione.OrgTitolario titolario, string idRegistro)
        {
            SetUserId(infoUtente);
            try
            {
                return BusinessLogic.Amministrazione.TitolarioManager.CopiaTitolario(infoUtente, titolario, idRegistro);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: copiaTitolario", e);
                return false;
            }
        }

        [WebMethod]
        public virtual DocsPaVO.documento.FileDocumento ExportTitolarioInExcel(DocsPaVO.amministrazione.OrgTitolario titolario, string idRegistro)
        {
            try
            {
                //string serverPath = System.Configuration.ConfigurationManager.AppSettings["MODELS_ROOT_PATH"];
                // PALUMBO: modificato per ovviare al blocco dell'accesso su macchina 20 in scrittura    
                //string serverPath = System.Configuration.ConfigurationManager.AppSettings["LOG_PATH"];
                string serverPath = DocsPaUtils.Configuration.InitConfigurationKeys.GetValue("0", "BE_TEMP_PATH");
                serverPath = System.IO.Path.Combine(serverPath, DateTime.Now.ToString("yyyyMMdd"));

                BusinessLogic.ExportDati.ExportDatiManager exportDati = new BusinessLogic.ExportDati.ExportDatiManager();
                DocsPaVO.documento.FileDocumento fileDocumento = exportDati.ExportTitolarioInExcel(serverPath, titolario, idRegistro);
                return fileDocumento;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ExportTitolario", e);
                return null;
            }
        }

        [WebMethod]
        public bool importFascicoliDocumenti(byte[] dati)
        {
            try
            {
                //string serverPath = System.Configuration.ConfigurationManager.AppSettings["MODELS_ROOT_PATH"];
                // PALUMBO: modificato per ovviare al blocco dell'accesso su macchina 20 in scrittura    
                //string serverPath = System.Configuration.ConfigurationManager.AppSettings["LOG_PATH"];
                string serverPath = DocsPaUtils.Configuration.InitConfigurationKeys.GetValue("0", "BE_LOG_PATH");
                serverPath = serverPath.Replace("%DATA", DateTime.Now.ToString("yyyyMMdd"));

                bool result = BusinessLogic.Amministrazione.TitolarioManager.importFascicoliDocumenti(dati, "importazioneFascicoliDocumenti.xls", serverPath);
                return result;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: importFascicoliDocumenti", e);
                return false;
            }
        }

        [WebMethod]
        [return: XmlArray()]
        public virtual ArrayList getLogImportFascicoli()
        {
            ArrayList logFile = new ArrayList();

            try
            {
                //string serverPath = System.Configuration.ConfigurationManager.AppSettings["MODELS_ROOT_PATH"];
                // PALUMBO: modificato per ovviare al blocco dell'accesso su macchina 20 in scrittura    
                //string serverPath = System.Configuration.ConfigurationManager.AppSettings["LOG_PATH"];
                string serverPath = DocsPaUtils.Configuration.InitConfigurationKeys.GetValue("0", "BE_LOG_PATH");
                serverPath = serverPath.Replace("%DATA", DateTime.Now.ToString("yyyyMMdd"));

                logFile = BusinessLogic.Amministrazione.TitolarioManager.getLogImportFascicoli(serverPath);
                return logFile;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getLogImportFascicoli", e);
                return logFile;
            }
        }

        [WebMethod]
        public DocsPaVO.ProfilazioneDinamica.Templates impostaCampiComuniFasc(DocsPaVO.ProfilazioneDinamica.Templates modello, ArrayList campiComuni)
        {
            try
            {
                return BusinessLogic.ProfilazioneDinamica.ProfilazioneFascicoli.impostaCampiComuniFasc(modello, campiComuni);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: impostaCampiComuniFasc", e);
                return null;
            }
        }

        [WebMethod]
        public bool isInUseCampoComuneFasc(string idTemplate, string idCampoComune)
        {
            try
            {
                return BusinessLogic.ProfilazioneDinamica.ProfilazioneFascicoli.isInUseCampoComuneFasc(idTemplate, idCampoComune);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: isInUseCampoComuneFasc", e);
                return false;
            }
        }

        /// <summary>
        /// Associa un RF ad un RUOLO
        /// </summary>
        /// <param name="idRf">systemId dell'RF</param>
        /// <param name="idCorrGlobRuolo">systemId del RUOLO</param>
        /// <returns></returns>
        [WebMethod]
        public virtual DocsPaVO.amministrazione.EsitoOperazione AmmAssociazioneRFRuolo(string idRf, string idCorrGlobRuolo)
        {
            DocsPaVO.amministrazione.EsitoOperazione esito = new DocsPaVO.amministrazione.EsitoOperazione();
            try
            {
                esito = BusinessLogic.Amministrazione.OrganigrammaManager.AmmAssociazioneRFRuolo(idRf, idCorrGlobRuolo);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmAssociazioneRFRuolo - ", e);
                esito.Codice = 1;
                esito.Descrizione = "si  verificato un errore";
            }

            return esito;
        }
        /// <summary>
        /// Dissassocia un RF/Registro da un RUOLO
        /// </summary>
        /// <param name="idRf"></param>
        /// <param name="idCorrGlobRuolo"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual DocsPaVO.amministrazione.EsitoOperazione AmmDeleteAssociazioneRFRuolo(string idRf, string idCorrGlobRuolo)
        {
            DocsPaVO.amministrazione.EsitoOperazione esito = new DocsPaVO.amministrazione.EsitoOperazione();
            try
            {
                esito = BusinessLogic.Amministrazione.OrganigrammaManager.AmmDeleteAssociazioneRFRuolo(idRf, idCorrGlobRuolo);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmDeleteAssociazioneRFRuolo - ", e);
                esito.Codice = 1;
                esito.Descrizione = "si  verificato un errore";
            }

            return esito;
        }


        /// <summary>
        /// Ritorna una lista di Oggetti OrgRuolo, dove i ruoli sono associati al registro o al RF
        /// passato in ingresso al webServices
        /// </summary>
        /// <param name="idRegistro">SystemId del Registro o dell'RF</param>
        /// <returns>ArrayList di oggetti OrgRuolo</returns>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.amministrazione.OrgRuolo))]
        public virtual ArrayList AmmGetListaRuoliAOO(string idRegistro)
        {
            ArrayList retValue = new ArrayList();

            try
            {
                retValue = BusinessLogic.Amministrazione.OrganigrammaManager.GetListaRuoliAOO(idRegistro);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmGetListaRuoliAOO - ", e);

            }

            return retValue;
        }

        /// <summary>
        /// Ritorna una lista di registri e RF
        /// </summary>
        /// <param name="idCorrGlobali"></param>
        /// <returns></returns>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.utente.Registro))]

        public virtual ArrayList UtenteGetRegistriWithRf(string idCorrGlobali, string all, string idAooColl)
        {
            ArrayList result = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new 

DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Utenti.RegistriManager.getListaRegistriRfRuolo(idCorrGlobali, all, idAooColl);
#if TRACE_WS
				pt.WriteLogTracer("getListaRegistriRfRuolo");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: UtenteGetRegistriWithRf", e);

                result = null;
            }
            return result;
        }

        /// <summary>
        /// Ritorna una registro con cui  stato scaricato la pec
        /// </summary>
        /// <param name="idCorrGlobali"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual DocsPaVO.utente.Registro GetRegistroDaPec(string idProfile)
        {
            DocsPaVO.utente.Registro result = null;

            try
            {
                //gestione tracer
#if TRACE_WS
                DocsPaUtils.LogsManagement.PerformaceTracer pt = new 

DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Utenti.RegistriManager.GetRegistroDaPec(idProfile);
#if TRACE_WS
                pt.WriteLogTracer("getListaRegistriRfRuolo");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: UtenteGetRegistriDaPec", e);

                result = null;
            }
            return result;
        }

        /// <summary>
        /// Ritorna un singolo elemento rubrica, sulla base della systemId passata in ingresso.
        /// </summary>
        /// <param name="systemId">systemId dell'elemento rubrica che sar ritornato</param>
        /// <param name="u">infoUtente</param>
        /// <returns></returns>
        [WebMethod]
        [XmlInclude(typeof(DocsPaVO.rubrica.ElementoRubrica))]
        public virtual DocsPaVO.rubrica.ElementoRubrica rubricaGetElementoRubricaSimpleBySystemId(string systemId, DocsPaVO.utente.InfoUtente u)
        {
            SetUserId(u);
            try
            {
                logger.Debug("WS > rubricaGetElementoRubricaSimpleBySystemId");
                BusinessLogic.Rubrica.DPA3_RubricaSearchAgent ccs = new BusinessLogic.Rubrica.DPA3_RubricaSearchAgent(u);
                return ccs.SearchSingleSimpleBySystemId(systemId);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: rubricaGetElementoRubricaSimpleBySystemId - ", e);
                return null;
            }
        }


        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.amministrazione.OrgRuolo))]
        public virtual ArrayList AmmGetListRuoli(string idAmm, string ricercaPer, string testoDaRicercare, string idRegistro, string IDesclusi)
        {
            ArrayList retValue = new ArrayList();

            try
            {
                retValue = BusinessLogic.Amministrazione.OrganigrammaManager.GetListRuoli(idAmm, ricercaPer, testoDaRicercare, idRegistro, IDesclusi);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmGetListRuoli - ", e);
            }

            return retValue;
        }

        [WebMethod]
        public virtual bool isDocRepertoriato(string docNumber, string idTipoAtto)
        {
            try
            {
                return BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.isDocRepertoriato(docNumber, idTipoAtto);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: isDocRepertoriato", e);
                return false;
            }
        }

        /// <summary>
        /// Reperisce l'oggetto FILEDOCUMENTO per i report avanzati in excel
        /// </summary>
        /// <param name="objStampaReport"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.documento.FileDocumento stampaReportAvanzatiXLS(DocsPaVO.ExportData.ExportExcelClass objStampaReport)
        {
            DocsPaVO.documento.FileDocumento file = null;
            try
            {
                BusinessLogic.ExportDati.ExportDatiManager manager = new BusinessLogic.ExportDati.ExportDatiManager();
                file = manager.ExportReportAvanzati(objStampaReport);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: stampaReportAvanzatiXLS", e);
            }
            return file;
        }

        [WebMethod]
        public virtual DocsPaVO.ExportData.CampoSelezionato getCampoSelezionato()
        {
            try
            {
                return new DocsPaVO.ExportData.CampoSelezionato();
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getCampoSelezionato", e);
                return null;
            }
        }

        [WebMethod]
        public virtual bool existRf(string idAmministrazione)
        {
            try
            {
                return BusinessLogic.Utenti.RegistriManager.existRf(idAmministrazione);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: existRf", e);
                return false;
            }
        }

        #region Gestione note in documento e fascicolo

        /// <summary>
        /// Aggiornamento in batch delle note
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <param name="oggettoAssociato"></param>
        /// <param name="note"></param>
        /// <returns></returns>
        [WebMethod(Description = "Aggiornamento in batch delle note")]
        public DocsPaVO.Note.InfoNota[] UpdateNote(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.Note.AssociazioneNota oggettoAssociato, DocsPaVO.Note.InfoNota[] note)
        {
            SetUserId(infoUtente);
            return BusinessLogic.Note.NoteManager.Update(infoUtente, oggettoAssociato, note);
        }

        /// <summary>
        /// Inserimento di una nuova nota da associare ad un documento / fascicolo
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <param name="idDocumento"></param>
        /// <param name="nota"></param>
        /// <returns></returns>
        [WebMethod(Description = "Inserimento di una nuova nota da associare ad un oggetto")]
        public DocsPaVO.Note.InfoNota InsertNota(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.Note.AssociazioneNota oggettoAssociato, DocsPaVO.Note.InfoNota nota)
        {
            SetUserId(infoUtente);
            return BusinessLogic.Note.NoteManager.InsertNota(infoUtente, oggettoAssociato, nota);
        }

        /// <summary>
        /// 
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <param name="nota"></param>
        /// <returns></returns>
        [WebMethod(Description = "Aggiornamento di una nota associata ad un oggetto")]
        public DocsPaVO.Note.InfoNota UpdateNota(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.Note.InfoNota nota)
        {
            SetUserId(infoUtente);
            return BusinessLogic.Note.NoteManager.UpdateNota(infoUtente, nota);
        }

        /// <summary>
        /// Cancellazione di una nota esistente
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <param name="idNota"></param>
        [WebMethod(Description = "Cancellazione di una nota esistente")]
        public void DeleteNota(DocsPaVO.utente.InfoUtente infoUtente, string idNota)
        {
            SetUserId(infoUtente);
            BusinessLogic.Note.NoteManager.DeleteNota(infoUtente, idNota);
        }

        /// <summary>
        /// Reperimento di una nota esistente
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <param name="idNota"></param>
        /// <returns></returns>
        [WebMethod(Description = "Reperimento di una nota esistente")]
        public DocsPaVO.Note.InfoNota GetNota(DocsPaVO.utente.InfoUtente infoUtente, string idNota)
        {
            SetUserId(infoUtente);
            return BusinessLogic.Note.NoteManager.GetNota(infoUtente, idNota);
        }

        /// <summary>
        /// Reperimento ultima nota inserita per un documento / fascicolo in ordine cronologico
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <param name="idDocumento"></param>
        /// <returns></returns>
        [WebMethod(Description = "Reperimento dell'ultima inserita e visibile dall'utente in ordine cronologico associata ad un oggetto")]
        public DocsPaVO.Note.InfoNota GetUltimaNota(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.Note.AssociazioneNota oggettoAssociato)
        {
            SetUserId(infoUtente);
            return BusinessLogic.Note.NoteManager.GetUltimaNota(infoUtente, oggettoAssociato);
        }

        /// <summary>
        /// Reperimento della lista delle note associate ad un documento / fascicolo
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <param name="idDocumento"></param>
        /// <param name="filtroRicerca"></param>
        /// <returns></returns>
        [WebMethod(Description = "Reperimento della lista delle note visibili dall'utente associate ad un oggetto")]
        public DocsPaVO.Note.InfoNota[] GetNote(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.Note.AssociazioneNota oggettoAssociato, DocsPaVO.Note.FiltroRicercaNote filtroRicerca)
        {
            SetUserId(infoUtente);
            return BusinessLogic.Note.NoteManager.GetNote(infoUtente, oggettoAssociato, filtroRicerca);
        }

        /// <summary>
        /// Determina se l'oggetto cui sono associate le note  in sola lettura per l'utente corrente
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <param name="oggettoAssociato"></param>
        /// <returns></returns>
        [WebMethod(Description = "Determina se l'oggetto cui sono associate le note  in sola lettura per l'utente corrente")]
        public bool IsNoteSolaLettura(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.Note.AssociazioneNota oggettoAssociato)
        {
            SetUserId(infoUtente);
            return BusinessLogic.Note.NoteManager.IsNoteSolaLettura(infoUtente, oggettoAssociato);
        }

        #endregion

        /// <summary>
        /// GIUGNO 2008 - Adamo
        /// MODELLI DI TRASMISSIONE:
        /// Gestione della notifica trasmissione degli utenti inserito nei modelli di trasmissione
        /// </summary> 
        /// <param name="objTrasm">Oggetto Modelli_Trasmissioni.ModelloTrasmissione</param>
        /// <param name="operazione">Tipo di operazione da effettuare sul db:   'GET' = reperimento dati,   'SET' = modifica dei dati </param>
        /// <returns>L'oggetto stesso passato come parametro. Oggetto NULL se ci sono state eccezioni nel metodo</returns>
        [WebMethod]
        public DocsPaVO.Modelli_Trasmissioni.ModelloTrasmissione UtentiConNotificaTrasm(DocsPaVO.Modelli_Trasmissioni.ModelloTrasmissione objModTrasm, ArrayList utentiDaInserire, ArrayList utentiDaCancellare, string operazione)
        {
            try
            {
                return BusinessLogic.Trasmissioni.ModelliTrasmissioni.UtentiConNotificaTrasm(objModTrasm, utentiDaInserire, utentiDaCancellare, operazione);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: UtentiConNotificaTrasm", e);
                objModTrasm = null;
                return objModTrasm;
            }
        }

        /// <summary>
        /// GIUGNO 2008 - Adamo
        /// MODELLI DI TRASMISSIONE:
        /// Salva i dati di cessione dei diritti su modello di trasmissione
        /// </summary>
        /// <param name="objTrasm">Oggetto Modelli_Trasmissioni.ModelloTrasmissione</param>        
        /// <returns>True se esito positivo</returns>
        [WebMethod]
        public bool SalvaCessioneDirittiSuModelliTrasm(DocsPaVO.Modelli_Trasmissioni.ModelloTrasmissione objTrasm)
        {
            try
            {
                return BusinessLogic.Trasmissioni.ModelliTrasmissioni.SalvaCessioneDirittiSuModelliTrasm(objTrasm);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: CessioneDirittiSuModelliTrasm", e);
                return false;
            }
        }


        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.utente.Utente))]
        public virtual ArrayList GetListaUtentiByIdRuolo(string idRuolo)
        {
            ArrayList retValue = new ArrayList();

            try
            {
                retValue = BusinessLogic.Utenti.UserManager.getListaUtentiByIdRuolo(idRuolo);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetListaUtentiByIdRuolo - ", e);
            }

            return retValue;
        }

        /// <summary>
        /// Elimina la trasmissione in toto (trasm.ni singole e trasm.ni utente)
        /// </summary>
        /// <param name="objTrasm">oggetto trasmissione</param>
        /// <returns></returns>
        [WebMethod]
        public bool TrasmissioniDeleteTrasmissione(DocsPaVO.trasmissione.Trasmissione objTrasm)
        {
            try
            {
                return BusinessLogic.Trasmissioni.TrasmManager.DeleteTrasmissione(objTrasm);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: TrasmissioniDeleteTrasmissione", e);
                return false;
            }
        }

        [WebMethod]
        public virtual bool checkTrasm_UNO_TUTTI_AccettataRifiutata(DocsPaVO.trasmissione.TrasmissioneSingola trasmSingola)
        {
            try
            {
                return BusinessLogic.Trasmissioni.TrasmManager.checkTrasm_UNO_TUTTI_AccettataRifiutata(trasmSingola);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: checkTrasm_UNO_TUTTI_AccettataRifiutata", e);
                return false;
            }
        }

        /// <summary>
        /// Verifica se  abilitata la gestione della profilazione allegati
        /// </summary>
        /// <returns></returns>
        [WebMethod(Description = "Verifica se  abilitata la gestione della profilazione allegati")]
        public bool IsEnabledProfilazioneAllegati()
        {
            return BusinessLogic.Documenti.AllegatiManager.isEnabledProfilazioneAllegati();
        }

        /// <summary>
        /// 
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <param name="idProfile"></param>
        /// <param name="docNumber"></param>
        /// <returns></returns>
        [WebMethod(Description = "Reperimento oggetto InfoDocumento")]
        public DocsPaVO.documento.InfoDocumento GetInfoDocumento(DocsPaVO.utente.InfoUtente infoUtente, string idProfile, string docNumber)
        {
            SetUserId(infoUtente);
            return BusinessLogic.Documenti.DocManager.GetInfoDocumento(infoUtente, idProfile, docNumber);
        }

        /// <summary>
        /// Aggiuge una nuova voce all'indice sistematico
        /// </summary>
        /// <returns></returns>
        [WebMethod]
        public void addNuovaVoceIndice(DocsPaVO.fascicolazione.VoceIndiceSistematico voceIndice)
        {
            try
            {
                BusinessLogic.fascicoli.IndiceSistematico.addNuovaVoceIndice(voceIndice);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: addNuovaVoceIndice", e);
            }
        }

        /// <summary>
        /// Elimina una nuova voce dall'indice sistematico
        /// </summary>
        /// <returns></returns>
        [WebMethod]
        public void removeVoceIndice(DocsPaVO.fascicolazione.VoceIndiceSistematico voceIndice)
        {
            try
            {
                BusinessLogic.fascicoli.IndiceSistematico.removeVoceIndice(voceIndice);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: removeVoceIndice", e);
            }
        }

        /// <summary>
        /// Recupera l'indice sistematico per una determinata amministrazione
        /// </summary>
        /// <returns></returns>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.fascicolazione.VoceIndiceSistematico))]
        public ArrayList getIndiceByIdAmm(string idAmm)
        {
            try
            {
                return BusinessLogic.fascicoli.IndiceSistematico.getIndiceByIdAmm(idAmm);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getIndiceByIdAmm", e);
                return null;
            }
        }

        /// <summary>
        /// Associa una voce di sistematico ad un nodo titolario
        /// </summary>
        /// <returns></returns>
        [WebMethod]
        public void associaVoceIndice(DocsPaVO.fascicolazione.VoceIndiceSistematico voceIndice)
        {
            try
            {
                BusinessLogic.fascicoli.IndiceSistematico.associaVoceIndice(voceIndice);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: associaVoceIndice", e);
            }
        }

        /// <summary>
        /// Disassocia una voce di sistematico da un nodo titolario
        /// </summary>
        /// <returns></returns>
        [WebMethod]
        public void dissociaVoceIndice(DocsPaVO.fascicolazione.VoceIndiceSistematico voceIndice)
        {
            try
            {
                BusinessLogic.fascicoli.IndiceSistematico.dissociaVoceIndice(voceIndice);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: dissociaVoceIndice", e);
            }
        }

        /// <summary>
        /// Recupera l'indice sistematico per un determinato nodo di titolario
        /// </summary>
        /// <returns></returns>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.fascicolazione.VoceIndiceSistematico))]
        public ArrayList getIndiceByIdProject(string idProject)
        {
            try
            {
                return BusinessLogic.fascicoli.IndiceSistematico.getIndiceByIdProject(idProject);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getIndiceByIdProject", e);
                return null;
            }
        }

        /// <summary>
        /// Recupera i nodi associati all'indice
        /// </summary>
        /// <returns></returns>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.fascicolazione.VoceIndiceSistematico))]
        public ArrayList getCodNodiByIndice(string indice, string idTitolario)
        {
            try
            {
                return BusinessLogic.fascicoli.IndiceSistematico.getCodNodiByIndice(indice, idTitolario);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getCodNodiByIndice", e);
                return null;
            }
        }

        /// <summary>
        /// Verifica se  abilitato o meno l'indice sistematico
        /// </summary>
        /// <returns></returns>
        [WebMethod]
        public bool isEnableIndiceSistematico()
        {
            if (System.Configuration.ConfigurationManager.AppSettings["INDICE_SISTEMATICO"] != null && System.Configuration.ConfigurationManager.AppSettings["INDICE_SISTEMATICO"] == "1")
                return true;
            else
                return false;
        }

        [WebMethod]
        public virtual DocsPaVO.documento.FileDocumento ExportIndiceSistematico(DocsPaVO.amministrazione.OrgTitolario titolario)
        {
            try
            {
                //string serverPath = System.Configuration.ConfigurationManager.AppSettings["MODELS_ROOT_PATH"];
                // PALUMBO: modificato per ovviare al blocco dell'accesso su macchina 20 in scrittura    
                //string serverPath = System.Configuration.ConfigurationManager.AppSettings["LOG_PATH"];
                string serverPath = DocsPaUtils.Configuration.InitConfigurationKeys.GetValue("0", "BE_TEMP_PATH");
                serverPath = System.IO.Path.Combine(serverPath, DateTime.Now.ToString("yyyyMMdd"));

                BusinessLogic.ExportDati.ExportDatiManager exportDati = new BusinessLogic.ExportDati.ExportDatiManager();
                DocsPaVO.documento.FileDocumento fileDocumento = exportDati.ExportIndiceSistematico(serverPath, titolario);
                return fileDocumento;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ExportIndiceSistematico", e);
                return null;
            }
        }

        [WebMethod]
        public bool importIndice(byte[] dati, DocsPaVO.amministrazione.OrgTitolario titolario, DocsPaVO.utente.InfoUtente infoUtente)
        {
            SetUserId(infoUtente);
            try
            {
                //string serverPath = System.Configuration.ConfigurationManager.AppSettings["MODELS_ROOT_PATH"];
                // PALUMBO: modificato per ovviare al blocco dell'accesso su macchina 20 in scrittura    
                //string serverPath = System.Configuration.ConfigurationManager.AppSettings["LOG_PATH"];
                string serverPath = System.Configuration.ConfigurationManager.AppSettings["DOC_ROOT"];
                serverPath = System.IO.Path.Combine(serverPath, DateTime.Now.ToString("yyyyMMdd"));

                bool result = BusinessLogic.Amministrazione.TitolarioManager.importaIndice(dati, "importazioneIndice.xls", serverPath, infoUtente, titolario);
                return result;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: importIndice", e);
                return false;
            }
        }

        [WebMethod]
        public DocsPaVO.fascicolazione.VoceIndiceSistematico existVoceIndice(DocsPaVO.fascicolazione.VoceIndiceSistematico voceIndice)
        {
            try
            {
                return BusinessLogic.fascicoli.IndiceSistematico.existVoceIndice(voceIndice);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: existVoceIndice", e);
                return null;
            }
        }

        /// <summary>
        /// Verifica se la voce di indice  associata o meno a un nodo nel caso 
        /// la variabile "suSingoloNodo"  true, altrimenti la verifica di associazione 
        /// viene fatta sull'intero titolario
        /// </summary>
        /// <returns></returns>
        [WebMethod]
        public bool isAssociataVoce(DocsPaVO.fascicolazione.VoceIndiceSistematico voceIndice, bool suSingoloNodo)
        {
            try
            {
                return BusinessLogic.fascicoli.IndiceSistematico.isAssociataVoce(voceIndice, suSingoloNodo);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: isAssociataVoce", e);
                return false;
            }
        }

        [WebMethod]
        [return: XmlArray()]
        public virtual ArrayList getLogImportIndice()
        {
            ArrayList logFile = new ArrayList();

            try
            {
                //string serverPath = System.Configuration.ConfigurationManager.AppSettings["MODELS_ROOT_PATH"];
                // PALUMBO: modificato per ovviare al blocco dell'accesso su macchina 20 in scrittura    
                //string serverPath = System.Configuration.ConfigurationManager.AppSettings["LOG_PATH"];
                string serverPath = System.Configuration.ConfigurationManager.AppSettings["DOC_ROOT"];
                serverPath = System.IO.Path.Combine(serverPath, DateTime.Now.ToString("yyyyMMdd"));

                logFile = BusinessLogic.Amministrazione.TitolarioManager.getLogImportIndice(serverPath);
                return logFile;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getLogImportIndice", e);
                return logFile;
            }
        }

        [WebMethod]
        public virtual bool ImportaRubrica(DocsPaVO.utente.InfoUtente infoUtente, byte[] dati, int flagListe, string nomeFile, ref int corrInseriti, ref int corrAggiornati, ref int corrRimossi, ref int corrNonInseriti, ref int corrNonAggiornati, ref int corrNonRimossi)
        {
            SetUserId(infoUtente);
            try
            {
                // PALUMBO: modificato per ovviare al blocco dell'accesso su macchina 20 in scrittura    
                //string serverPath = System.Configuration.ConfigurationManager.AppSettings["LOG_PATH"];
                //string serverPath = DocsPaUtils.Configuration.InitConfigurationKeys.GetValue("0", "BE_LOG_PATH");
                //serverPath = serverPath.Replace("%DATA", DateTime.Now.ToString("yyyyMMdd"));
                string serverPath = System.Configuration.ConfigurationManager.AppSettings["DOC_ROOT"];
                serverPath = System.IO.Path.Combine(serverPath, DateTime.Now.ToString("yyyyMMdd"));
                bool result = BusinessLogic.Rubrica.DPA3_RubricaSearchAgent.ImportaRubrica(infoUtente, dati, flagListe, nomeFile, serverPath, ref corrInseriti, ref corrAggiornati, ref corrRimossi, ref corrNonInseriti, ref corrNonAggiornati, ref corrNonRimossi);
                return result;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: importaUtenti", e);
                return false;
            }
        }
        [WebMethod]
        public virtual int getDiagrammaAssociatoFasc(string idTipoFasc)
        {
            try
            {
                return BusinessLogic.DiagrammiStato.DiagrammiStato.getDiagrammaAssociatoFasc(idTipoFasc);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getDiagrammaAssociatoFasc", e);
                return 0;
            }
        }

        [WebMethod]
        [return: XmlArrayItem(typeof(DocsPaVO.Modelli_Trasmissioni.AssDocDiagTrasm))]
        public virtual ArrayList getIdModelliTrasmAssociatiFasc(string idTipoFasc, string idDiagramma, string idStato)
        {
            try
            {
                return BusinessLogic.ProfilazioneDinamica.ProfilazioneFascicoli.getIdModelliTrasmAssociatiFasc(idTipoFasc, idDiagramma, idStato);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getIdModelliTrasmAssociatiFasc", e);
                return null;
            }
        }

        [WebMethod]
        public virtual void salvaAssociazioneModelliFasc(string idTipoFasc, string idDiagramma, ArrayList modelliSelezionati, string idStato)
        {
            try
            {
                BusinessLogic.ProfilazioneDinamica.ProfilazioneFascicoli.salvaAssociazioneModelliFasc(idTipoFasc, idDiagramma, modelliSelezionati, idStato);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: salvaAssociazioneModelliFasc", e);
            }

        }

        [WebMethod]
        public virtual void updateScadenzeTipoFasc(int systemId_template, string scadenza, string preScadenza)
        {
            try
            {
                BusinessLogic.ProfilazioneDinamica.ProfilazioneFascicoli.updateScadenzeTipoFasc(systemId_template, scadenza, preScadenza);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: updateScadenzeTipoFasc", e);
            }
        }

        [WebMethod]
        public virtual bool associaTipoFascDiagramma(string idTipoFasc, string idDiagramma)
        {
            try
            {
                return BusinessLogic.DiagrammiStato.DiagrammiStato.associaTipoFascDiagramma(idTipoFasc, idDiagramma);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: associaTipoFascDiagramma", e);
                return false;
            }
        }

        [WebMethod]
        public virtual bool isFascicoliInStatoFinale(string idDiagramma, string idTemplate)
        {
            try
            {
                return BusinessLogic.DiagrammiStato.DiagrammiStato.isFascicoliInStatoFinale(idDiagramma, idTemplate);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: isFascicoliInStatoFinale", e);
                return false;
            }
        }

        [WebMethod]
        public virtual void disassociaTipoFascDiagramma(string idTipoFasc)
        {
            try
            {
                BusinessLogic.DiagrammiStato.DiagrammiStato.disassociaTipoFascDiagramma(idTipoFasc);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: disassociaTipoFascDiagramma", e);
            }
        }

        [WebMethod]
        public virtual DocsPaVO.DiagrammaStato.DiagrammaStato getDgByIdTipoFasc(string systemIdTipoFasc, string idAmm)
        {
            try
            {
                if (systemIdTipoFasc != "")
                    return BusinessLogic.DiagrammiStato.DiagrammiStato.getDgByIdTipoFasc(systemIdTipoFasc, idAmm);
                else
                    return null;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getDgByIdTipoFasc", e);
                return null;
            }
        }

        [WebMethod]
        public virtual void salvaModificaStatoFasc(string idProject, string idStato, DocsPaVO.DiagrammaStato.DiagrammaStato diagramma, string idUtente, DocsPaVO.utente.InfoUtente user, string dataScadenza)
        {
            SetUserId(user);
            try
            {
                BusinessLogic.DiagrammiStato.DiagrammiStato.salvaModificaStatoFasc(idProject, idStato, diagramma, idUtente, user, dataScadenza);

                //BusinessLogic.UserLog.UserLog.WriteLog(infoUtente,"salvaModificaStato",docNumber,"",DocsPaVO.Logger.CodAzione.Esito.OK);				
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: salvaModificaStatoFasc", e);

            }
        }

        //Verifica se alla stato  associata una trasmissione automatica 
        //eventualmente ritorna il modello della trasmissione
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.Modelli_Trasmissioni.ModelloTrasmissione))]
        public virtual ArrayList isStatoTrasmAutoFasc(string idAmm, string idStato, string idTipoFasc)
        {
            try
            {
                return BusinessLogic.DiagrammiStato.DiagrammiStato.isStatoTrasmAutoFasc(idAmm, idStato, idTipoFasc);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: isStatoTrasmAutoFasc", e);
                return null;
            }
        }

        [WebMethod]
        public virtual void salvaStoricoTrasmDiagrammiFasc(string idTrasm, string idProject, string idStato)
        {
            try
            {
                BusinessLogic.DiagrammiStato.DiagrammiStato.salvaStoricoTrasmDiagrammiFasc(idTrasm, idProject, idStato);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: salvaStoricoTrasmDiagrammiFasc", e);
            }
        }

        [WebMethod]
        public virtual DocsPaVO.DiagrammaStato.Stato getStatoFasc(string idProject)
        {
            try
            {
                return BusinessLogic.DiagrammiStato.DiagrammiStato.getStatoFasc(idProject);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getStatoFasc", e);
                return null;
            }
        }

        [WebMethod]
        public virtual void salvaDataScadenzaFasc(string idProject, string dataScadenza, string idTipoFasc)
        {
            try
            {
                BusinessLogic.DiagrammiStato.DiagrammiStato.salvaDataScadenzaFasc(idProject, dataScadenza, idTipoFasc);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: salvaDataScadenzaFasc", e);

            }
        }

        [WebMethod]
        public virtual void salvaDataScadenzaDoc(string docNumber, string dataScadenza, string idTipoAtto)
        {
            try
            {
                BusinessLogic.DiagrammiStato.DiagrammiStato.salvaDataScadenzaDoc(docNumber, dataScadenza, idTipoAtto);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: salvaDataScadenzaDoc", e);

            }
        }

        [WebMethod]
        public virtual DataSet getDiagrammaStoricoFasc(string idProject)
        {
            try
            {
                return BusinessLogic.DiagrammiStato.DiagrammiStato.getDiagrammaStoricoFasc(idProject);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getDiagrammaStoricoFasc", e);
                return null;
            }
        }

        [WebMethod]
        public virtual void deleteStoricoTrasmDiagrammiFasc(string idProject, string idStato)
        {
            try
            {
                BusinessLogic.DiagrammiStato.DiagrammiStato.deleteStoricoTrasmDiagrammiFasc(idProject, idStato);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: deleteStoricoTrasmDiagrammiFasc", e);
            }
        }

        [WebMethod]
        public virtual string getIdTemplateFasc(string idProject)
        {
            string idTemplate = "";
            try
            {
                return BusinessLogic.ProfilazioneDinamica.ProfilazioneFascicoli.getIdTemplateFasc(idProject);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getIdTemplateFasc", e);
                return idTemplate;
            }
        }

        [WebMethod]
        public virtual DocsPaVO.DiagrammaStato.Stato getStatoSuccessivoAutomaticoFasc(string idProject)
        {
            try
            {
                return BusinessLogic.DiagrammiStato.DiagrammiStato.getStatoSuccessivoAutomaticoFasc(idProject);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getStatoSuccessivoAutomaticoFasc", e);
                return null;
            }
        }

        [WebMethod]
        public virtual bool SelectSecurity(out string accessRights, out string idGruppoTrasm, out string tipoDiritto, string thing, string personOrgroup, string accessRightsToTest)
        {
            accessRights = string.Empty;
            idGruppoTrasm = string.Empty;
            tipoDiritto = string.Empty;

            bool retValue = false;
            try
            {
                retValue = BusinessLogic.Trasmissioni.ExecTrasmManager.SelectSecurity(out accessRights, out idGruppoTrasm, out tipoDiritto, thing, personOrgroup, accessRightsToTest);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: SelectSecurity", e);
                return false;
            }
            return retValue;
        }

        /// <summary>
        /// Verifica se  abilitata la conversione in pdf lato server o meno
        /// </summary>
        /// <returns></returns>
        [WebMethod]
        public virtual bool isEnableConversionePdfLatoServer()
        {
            return BusinessLogic.Documenti.DocManager.isEnabledConversionePdfServer();
        }

        /// <summary>
        /// Verifica se  abilitata la conversione lato server sincrona
        /// </summary>
        /// <returns>True se  abilitata, false in caso contrario</returns>
        [WebMethod]
        public virtual bool IsEnabledConversionePdfLatoServerSincrona()
        {
            bool result;

            Boolean.TryParse(System.Configuration.ConfigurationManager.
                AppSettings["CONVERSIONE_PDF_SINCRONA_LC"], out result);

            return result;

        }

        /// <summary>
        /// Inserisce un documento nella coda di conversione pdf lato server
        /// </summary>
        /// <returns></returns>
        [WebMethod]
        public virtual void EnqueueServerPdfConversion(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.documento.ObjServerPdfConversion objServerPdfConversion)
        {
            SetUserId(infoUtente);
            BusinessLogic.LiveCycle.LiveCyclePdfConverter.EnqueueServerPdfConversion(infoUtente, objServerPdfConversion, null);
            //Il documento qui viene inserito nella coda di onversione.
            //Traccio in DequeueServerPdfConversion la conversione del documento
            //BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOCONVERSIONEPDF", objServerPdfConversion.idProfile, string.Format("{0}{1}", "Conversione pdf del doc: ", objServerPdfConversion.idProfile), DocsPaVO.Logger.CodAzione.Esito.OK);

            //try
            //{
            //    logger.Debug("INIZIO : EnqueueServerPdfConversion");
            //    if (BusinessLogic.Documenti.FileManager.getExtFileFromPath(objServerPdfConversion.fileName).ToUpper() != "PDF".ToUpper())
            //    {
            //        if (!BusinessLogic.Documenti.DocManager.isDocInConversionePdf(objServerPdfConversion.idProfile))
            //        {

            //            logger.Debug("Creazione file xml");
            //            //Creo il file xml
            //            byte[] xmlByteArray = BusinessLogic.Documenti.FileManager.creaXmlCOnversionePdfServer(infoUtente, objServerPdfConversion);

            //            logger.Debug("Creazione file da convertire");
            //            //Creo il file da convertire
            //            byte[] docByteArray = objServerPdfConversion.content;

            //            logger.Debug("Invio file alla coda di conversione");
            //            //Invio i due file alla coda
            //            WebClient webClient = new WebClient();
            //            string addressServerCodaPdf = System.Configuration.ConfigurationManager.AppSettings["ADDRESS_SERVER_CODA_PDF"];
            //            string fileName = Guid.NewGuid().ToString();
            //            string urlDoc = string.Format("{0}{1}.{2}", addressServerCodaPdf, fileName, BusinessLogic.Documenti.FileManager.getExtFileFromPath(objServerPdfConversion.fileName));
            //            webClient.UploadData(urlDoc, "PUT", docByteArray);
            //            string urlXml = string.Format("{0}{1}.{2}", addressServerCodaPdf, fileName, "");
            //            webClient.UploadData(urlXml, "PUT", xmlByteArray);

            //            //Inserisco il documento nella tabella di richiesta conversione
            //            logger.Debug("Inserimento doc nella tabella di richiesta conversione");
            //            BusinessLogic.Documenti.DocManager.insDocRichiestaConversionePdf(objServerPdfConversion.idProfile);

            //            //Metto in checkout il documento
            //            logger.Debug("Checkout del documento");
            //            DocsPaVO.Validations.ValidationResultInfo retValue = null;
            //            DocsPaVO.CheckInOut.CheckOutStatus checkOutStatus;
            //            checkOutStatus = null;
            //            retValue = BusinessLogic.CheckInOut.CheckInOutServices.CheckOut(objServerPdfConversion.idProfile, objServerPdfConversion.docNumber, null, null, infoUtente, out checkOutStatus);

            //        }
            //    }
            //    logger.Debug("FINE : EnqueueServerPdfConversion");                
            //}
            //catch (Exception ex)
            //{
            //    logger.Debug("Errore in DocsPaWS.asmx  - metodo: EnqueueServerPdfConversion", ex);
            //}
        }

        /// <summary>
        /// Inserisce un documento nella coda di conversione pdf lato server
        /// </summary>
        /// <returns></returns>
        [WebMethod]
        public virtual void EnqueueServerPdfConversionAM(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.documento.ObjServerPdfConversion objServerPdfConversion)
        {
            SetUserId(infoUtente);
            BusinessLogic.LiveCycle.LiveCyclePdfConverter.EnqueueServerPdfConversion(infoUtente, objServerPdfConversion, null);
            //Il documento qui viene inserito nella coda di onversione.
            //Traccio in DequeueServerPdfConversion la conversione del documento
            //BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOCONVERSIONEPDF", objServerPdfConversion.idProfile, string.Format("{0}{1}", "Azione Massiva - Conversione pdf del doc: ", objServerPdfConversion.idProfile), DocsPaVO.Logger.CodAzione.Esito.OK);
        }

        /// <summary>
        /// Elimina il documento della coda di conversione pdf lato server
        /// </summary>
        /// <returns></returns>
        [WebMethod]
        public virtual void DequeueServerPdfConversion(string nameDocConvertito, string nameFileXml, byte[] docConvertito, byte[] xml)
        {
            DocsPaVO.utente.InfoUtente infoUser = new InfoUtente();
            DocsPaVO.documento.SchedaDocumento schDoc = new DocsPaVO.documento.SchedaDocumento();
            string noteLog = string.Empty;
            BusinessLogic.LiveCycle.LiveCyclePdfConverter.DequeueServerPdfConversion(nameDocConvertito, nameFileXml, docConvertito, xml, ref infoUser, ref noteLog, ref schDoc);
            BusinessLogic.UserLog.UserLog.WriteLog(infoUser.userId, infoUser.idPeople, infoUser.idGruppo,
                infoUser.idAmministrazione, "DOCUMENTOCONVERSIONEPDF", schDoc.systemId, noteLog,
                DocsPaVO.Logger.CodAzione.Esito.OK, (infoUser != null && infoUser.delegato != null ? infoUser.delegato : null),
                "1");

            //MEV 1.5 F02_01 conservazione - controllo se  stato convertito un documento di un istanza in conversione automatica.
            //Viene eseguito ogni volta che viene convertito un file, si controlla che 
            BusinessLogic.Conservazione.ConservazioneManager consManager = new BusinessLogic.Conservazione.ConservazioneManager();
            consManager.handleConsAutomaticConversion(infoUser, schDoc);

            //try
            //{
            //    logger.Debug("INIZIO : DequeueServerPdfConversion");

            //    logger.Debug("Lettura file xml");
            //    //Lettura file xml
            //    MemoryStream ms = new MemoryStream(xml);
            //    XmlDocument xDoc = new XmlDocument();
            //    xDoc.Load(ms);
            //    XmlNode node = xDoc.DocumentElement;

            //    logger.Debug("Creazione infoUtente");
            //    //Creazione infoUtente
            //    DocsPaVO.utente.InfoUtente infoUtente = new DocsPaVO.utente.InfoUtente();
            //    infoUtente.dst = node.SelectSingleNode("DST").InnerText.ToString();
            //    infoUtente.idAmministrazione = node.SelectSingleNode("ID_AMM").InnerText.ToString();
            //    infoUtente.idCorrGlobali = node.SelectSingleNode("ID_CORR_GLOBALI").InnerText.ToString();
            //    infoUtente.idGruppo = node.SelectSingleNode("ID_GRUPPO").InnerText.ToString();
            //    infoUtente.idPeople = node.SelectSingleNode("ID_PEOPLE").InnerText.ToString();
            //    infoUtente.sede = node.SelectSingleNode("SEDE").InnerText.ToString();
            //    infoUtente.urlWA = node.SelectSingleNode("URLWA").InnerText.ToString();
            //    infoUtente.userId = node.SelectSingleNode("USERID").InnerText.ToString();

            //    logger.Debug("Creazione fileRequest");
            //    //Creazione FileRequest
            //    DocsPaVO.documento.FileRequest fileRequest = new DocsPaVO.documento.FileRequest();
            //    fileRequest.autore = node.SelectSingleNode("AUTORE").InnerText.ToString();
            //    fileRequest.dataInserimento = node.SelectSingleNode("DATA_INSERIMENTO").InnerText.ToString();
            //    fileRequest.descrizione = node.SelectSingleNode("DESCRIZIONE").InnerText.ToString();
            //    fileRequest.docNumber = node.SelectSingleNode("DOCNUMBER").InnerText.ToString();

            //    logger.Debug("Informazioni documento");
            //    //Recupero informazioni del documento 
            //    string idProfile = node.SelectSingleNode("ID_PROFILE").InnerText.ToString();
            //    string docNumber = node.SelectSingleNode("DOCNUMBER").InnerText.ToString();

            //    //Controllo che il documento sia ancora in checkout dallo stesso utente
            //    DocsPaVO.CheckInOut.CheckOutStatus statusCheckOut = BusinessLogic.CheckInOut.CheckInOutServices.GetCheckOutStatus(idProfile, docNumber, infoUtente);

            //    logger.Debug("DocNumber CheckOut : " + statusCheckOut.DocumentNumber);
            //    logger.Debug("DocNumber FileRequest : " + fileRequest.docNumber);
            //    logger.Debug("IdRole CheckOut : " + statusCheckOut.IDRole);
            //    logger.Debug("IdCorrGlobali infoUtente : " + infoUtente.idCorrGlobali);
            //    logger.Debug("UserName CheckOut : " + statusCheckOut.UserName);
            //    logger.Debug("UserName infoUtente : " + infoUtente.userId);

            //    if (statusCheckOut != null && statusCheckOut.DocumentNumber == fileRequest.docNumber && statusCheckOut.UserName.ToUpper() == infoUtente.userId.ToUpper())
            //    {
            //        logger.Debug("Recupero scheda documento");

            //        //Recupero la schedaDocumento 
            //        DocsPaVO.documento.SchedaDocumento schDoc = BusinessLogic.Documenti.DocManager.getDettaglio(infoUtente, idProfile, docNumber);

            //        //CheckIn
            //        statusCheckOut.DocumentLocation = nameDocConvertito;
            //        DocsPaVO.Validations.ValidationResultInfo result;

            //        //Se il parametro "docConvertito"  null allora ci sono stati problemi nella conversione
            //        if (docConvertito != null)
            //            result = BusinessLogic.CheckInOut.CheckInOutServices.CheckIn(statusCheckOut, infoUtente, docConvertito, "Documento convertito in pdf lato server");
            //        else
            //            result = BusinessLogic.CheckInOut.CheckInOutServices.UndoCheckOut(statusCheckOut, infoUtente);

            //        if (result.Value)
            //        {
            //            //Elimino il documento nella tabella di richiesta conversione
            //            logger.Debug("Eliminazione documento");
            //            BusinessLogic.Documenti.DocManager.delDocRichiestaConversionePdf(schDoc.systemId);

            //            //Trasmissione
            //            logger.Debug("Tramissione");

            //            //Effettuo una trasmissione all'utente per comunicare l'avvenuta conversione pdf
            //            DocsPaVO.trasmissione.Trasmissione trasmissione = new DocsPaVO.trasmissione.Trasmissione();

            //            // Verifico se il doc convertito  un allegato
            //            bool isAllegato = (schDoc.documentoPrincipale != null);

            //            DocsPaVO.documento.SchedaDocumento schedaDocPrincipale = null;

            //            if (isAllegato)
            //            {
            //                // Reperimetno scheda doc principale
            //                schedaDocPrincipale = BusinessLogic.Documenti.DocManager.getDettaglio(infoUtente, schDoc.documentoPrincipale.idProfile, schDoc.documentoPrincipale.docNumber);
            //                trasmissione.noteGenerali = string.Format("Allegato con id {0} convertito in PDF.", schDoc.docNumber);
            //            }
            //            else
            //            {
            //                schedaDocPrincipale = schDoc;
            //                trasmissione.noteGenerali = "Il documento  stato convertito in PDF.";
            //            }

            //            //Se il parametro "docConvertito"  null allora ci sono stati problemi nella conversione
            //            if (docConvertito == null)
            //                trasmissione.noteGenerali = "Problemi durante la conversione in PDF. Riprovare l'operazione";

            //            // Si trasmette il documento principale, anche se si  convertito in pdf un allegato
            //            trasmissione.tipoOggetto = DocsPaVO.trasmissione.TipoOggetto.DOCUMENTO;
            //            string query = "(SELECT SYSTEM_ID FROM DPA_CORR_GLOBALI WHERE ID_GRUPPO = " + infoUtente.idGruppo + ")";
            //            trasmissione.ruolo = BusinessLogic.Utenti.UserManager.getRuolo(query);
            //            DocsPaVO.utente.Utente utente = BusinessLogic.Utenti.UserManager.getUtente(infoUtente.idPeople);
            //            trasmissione.infoDocumento = BusinessLogic.Documenti.DocManager.getInfoDocumento(schedaDocPrincipale);
            //            trasmissione.utente = utente;
            //            DocsPaVO.trasmissione.RagioneTrasmissione ragione = BusinessLogic.Trasmissioni.RagioniManager.getRagioneNotifica(trasmissione.ruolo.idAmministrazione);
            //            DocsPaVO.utente.Corrispondente corr = (DocsPaVO.utente.Corrispondente)BusinessLogic.Utenti.UserManager.getRuolo(query);
            //            trasmissione = BusinessLogic.Trasmissioni.TrasmManager.addTrasmissioneSingola(trasmissione, corr, ragione, "Il documento  stato convertito in PDF.", "S");
            //            trasmissione = BusinessLogic.Trasmissioni.TrasmManager.saveTrasmMethod(trasmissione);
            //            BusinessLogic.Trasmissioni.ExecTrasmManager.executeTrasmMethod(null, trasmissione);
            //        }
            //        else
            //        {
            //            logger.Debug(string.Format("Si  verificato un errore nel checkin del documento con id {0}", schDoc.docNumber));
            //        }
            //    }
            //    else
            //    {
            //        logger.Debug("La versione convertita in pdf per il documento DocNumber : " + fileRequest.docNumber + " non  stata creata. Il documento non risulta in checkout dall'utente che ha richiesto al conversione");
            //    }

            //    logger.Debug("FINE : DequeueServerPdfConversion");
            //}
            //catch (Exception ex)
            //{
            //    logger.Debug("Errore in DocsPaWS.asmx  - metodo: DequeueServerPdfConversion", ex);
            //}
        }

        /// <summary>
        /// Verifico che per il documento non sia stata richiesta una conversione in pdf lato server
        /// </summary>
        /// <returns></returns>
        [WebMethod]
        public virtual bool isDocInConversionePdf(DocsPaVO.utente.InfoUtente infoUtente, string idProfile)
        {
            try
            {
                SetUserId(infoUtente);
                return BusinessLogic.Documenti.DocManager.isDocInConversionePdf(idProfile);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: isDocInConversionePdf", ex);
                return false;
            }
        }

        /// <summary>
        /// Elimino il documento per cui  stata richiesta una conversione in pdf lato server
        /// </summary>
        /// <returns></returns>
        [WebMethod]
        public virtual void delDocRichiestaConversionePdf(DocsPaVO.utente.InfoUtente infoUtente, string idProfile)
        {
            SetUserId(infoUtente);
            try
            {
                BusinessLogic.Documenti.DocManager.delDocRichiestaConversionePdf(idProfile);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: delDocRichiestaConversionePdf", ex);
            }
        }

        [WebMethod]
        public void AsposeServerPdfConversion(byte[] content, DocsPaVO.documento.FileRequest fileReq, DocsPaVO.utente.InfoUtente infoUtente)
        {
            BusinessLogic.Modelli.AsposeModelProcessor.DocModelProcessor processor = new BusinessLogic.Modelli.AsposeModelProcessor.DocModelProcessor();
            processor.ConvertToPdfAsync(content, fileReq, infoUtente);
        }

        [WebMethod]
        public virtual DocsPaVO.ProfilazioneDinamica.Templates getTemplateDettagli(string docNumber)
        {
            try
            {
                return BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.getTemplateDettagli(docNumber);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getTemplateDettagli", e);
                return null;
            }
        }

        [WebMethod]
        public string getCssAmministrazione(string idAmm)
        {
            string result = string.Empty;
            try
            {
                BusinessLogic.Utenti.UserManager um = new BusinessLogic.Utenti.UserManager();
                result = um.getCssAmministrazione(idAmm);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS  - metodo: getCssAmministrazione", e);
            }
            return result;
        }


        [WebMethod]
        public string getSegnAmm(string idAmm)
        {
            string result = string.Empty;
            try
            {
                BusinessLogic.Utenti.UserManager um = new BusinessLogic.Utenti.UserManager();
                result = um.getSegnAmm(idAmm);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS  - metodo: getSegnAmm", e);
            }
            return result;
        }

        [WebMethod]
        public ArrayList getListaTemi()
        {
            ArrayList result = new ArrayList();
            try
            {
                BusinessLogic.Amministrazione.AmministraManager am = new BusinessLogic.Amministrazione.AmministraManager();
                result = am.getListaTemi();
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS  - metodo: getListaTemi", e);
            }
            return result;
        }

        [WebMethod]
        public bool setTemaAmministrazione(string idAmm, int valore)
        {
            bool result = false;
            BusinessLogic.Amministrazione.AmministraManager am = new BusinessLogic.Amministrazione.AmministraManager();
            result = am.setTemaAmministrazione(idAmm, valore);

            return result;
        }

        [WebMethod]
        public bool setColoreSegnatura(string idAmm, int valore)
        {
            bool result = false;
            BusinessLogic.Amministrazione.AmministraManager am = new BusinessLogic.Amministrazione.AmministraManager();
            result = am.setColoreSegnatura(idAmm, valore);

            return result;
        }

        /// <summary>
        /// Verifica esistenza di docmenti predisposti in un registro
        /// </summary>
        /// <param name="registro"></param>
        /// <returns></returns>
        [WebMethod()]
        public bool AmmPredispostiInRegistro(ref DocsPaVO.amministrazione.OrgRegistro registro)
        {
            bool retValue = false;

            try
            {
                retValue = BusinessLogic.Amministrazione.RegistroManager.AmmPredispostiInRegistro(registro);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmPredispostiInRegistro", e);
            }

            return retValue;
        }

        [WebMethod]
        public virtual DocsPaVO.ProfilazioneDinamica.Templates getTemplate(string idAmministrazione, string tipoAtto, string docNumber)
        {
            try
            {
                // return BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.getTemplate(idAmministrazione, tipoAtto, docNumber);
                return BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.getTemplate(docNumber);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getTemplate", e);
                return null;
            }
        }

        [WebMethod]
        public virtual void salvaInserimentoUtenteProfDim(DocsPaVO.utente.InfoUtente info, DocsPaVO.ProfilazioneDinamica.Templates template, string docNumber, string tipoOperazione)
        {
            SetUserId(info);
            // tipoOperazione [P =protocolla, S=salvataggio, ""=GRIGIO ]
            try
            {
                BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.salvaInserimentoUtenteProfDim(info, template, docNumber);
                if (tipoOperazione != "" && tipoOperazione.Equals("P"))
                    BusinessLogic.AS400.AS400.setAs400(info, docNumber, "", "2");

            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: salvaInserimentoUtenteProfDim", e);
            }
        }
        #region areaConservazione

        /// <summary>
        /// Validazione istanza di conservazione
        /// </summary>
        /// <param name="idConservazione"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.areaConservazione.AreaConservazioneValidationResult ValidateIstanzaConservazione(string idConservazione)
        {
            try
            {
                DocsPaConservazione.DocsPaConsManager consManager = new DocsPaConservazione.DocsPaConsManager();

                return consManager.validateIstanzaConservazione(idConservazione);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ConservazioneGetItemsById", ex);

                throw DocsPaUtils.Exceptions.SoapExceptionFactory.Create(ex);
            }
        }

        #region mev 1.5 F02_01

        /// <summary>
        /// Verifica e valida l'istanza di conservazione (items e allegati) 
        /// </summary>
        /// <param name="idConservazione"></param>
        /// <returns></returns>
        [WebMethod()]
        public bool CheckAndValidateIstanzaConservazione(string idConservazione)
        {
            try
            {
                BusinessLogic.Conservazione.ConservazioneManager consManager = new BusinessLogic.Conservazione.ConservazioneManager();
                consManager.startCheckAndValidateIstanzaConservazione(idConservazione);
                return true;
            }
            catch (Exception ex)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: CheckAndValidateIstanzaConservazione", ex);
                return false;
                //throw DocsPaUtils.Exceptions.SoapExceptionFactory.Create(ex);
            }
        }

        /// <summary>
        /// Verifica e valida l'istanza di conservazione (items e allegati) in maniera asincrona 
        /// </summary>
        [WebMethod]
        public bool asyncCheckAndValidateIstanzaConservazione(string idConservazione)
        {
            bool esito = false;

            try
            {
                //DocsPaConservazione.DocsPaConsManager.UpdateStatoIstanzaConservazione(idConservazione, DocsPaConservazione.StatoIstanza.IN_VERIFICA);

                BusinessLogic.Conservazione.ConservazioneManager ConsManager = new BusinessLogic.Conservazione.ConservazioneManager();
                ConsManager.updateStatoConservazioneWhithEsitoVerifica(idConservazione, DocsPaConservazione.StatoIstanza.IN_VERIFICA, (int)DocsPaVO.areaConservazione.InfoConservazione.EsitoVerifica.NonEffettuata);

                asyncDelegateCons mDelegate = new asyncDelegateCons(CheckAndValidateIstanzaConservazione);
                IAsyncResult result = mDelegate.BeginInvoke(idConservazione, new AsyncCallback(asyncCheckAndVAlidate), null);
                esito = true;

            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: asyncCheckAndValidateIstanzaConservazione", e);
            }

            return esito;
        }

        private delegate bool asyncDelegateCons(string idConservazione);

        private delegate bool asyncDelegateCons2(string idConservazione, HttpContext context);

        private void asyncCheckAndVAlidate(IAsyncResult ar)
        {
        }


        /// <summary>
        /// Conversione e invio, al Centro Servizi, di un'istanza di conservazione, in maniera asincrona 
        /// </summary>
        [WebMethod]
        public bool asyncConvertAndSendForConservation(string idConservazione, string tipo_cons, string note, string descr, string idTipoSupp, bool consolida)
        {
            bool esito = false;

            try
            {
                //DocsPaConservazione.DocsPaConsManager.UpdateStatoIstanzaConservazione(idConservazione, DocsPaConservazione.StatoIstanza.IN_CONVERSIONE);
                BusinessLogic.Conservazione.ConservazioneManager ConsManager = new BusinessLogic.Conservazione.ConservazioneManager();
                ConsManager.updateStatoConservazione(idConservazione, DocsPaConservazione.StatoIstanza.IN_CONVERSIONE, tipo_cons, note, descr, idTipoSupp, consolida);


                asyncDelegateCons2 mDelegate = new asyncDelegateCons2(convertAndSendForConservation);
                IAsyncResult result = mDelegate.BeginInvoke(idConservazione, HttpContext.Current, new AsyncCallback(asyncConvertAndSend), null);
                esito = true;

            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: asyncCheckAndValidateIstanzaConservazione", e);
                esito = false;
            }

            return esito;
        }


        private bool convertAndSendForConservation(string idConservazione, HttpContext context)
        {
            bool esito = false;


            try
            {
                BusinessLogic.Conservazione.ConservazioneManager ConsManager = new BusinessLogic.Conservazione.ConservazioneManager();

                esito = ConsManager.convertAndSendForConservation(idConservazione, true, context);

            }
            catch (Exception ex)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: convertAndSendForConservation", ex);
                esito = false;
                //throw DocsPaUtils.Exceptions.SoapExceptionFactory.Create(ex);
            }
            return esito;
        }


        /// <summary>
        /// Conversione e invio, al Centro Servizi, di un'istanza di conservazione
        /// </summary>
        [WebMethod]
        public bool convertAndSendForConservation(string idConservazione)
        {
            bool esito = false;


            try
            {
                BusinessLogic.Conservazione.ConservazioneManager ConsManager = new BusinessLogic.Conservazione.ConservazioneManager();

                esito = ConsManager.convertAndSendForConservation(idConservazione, true, HttpContext.Current);

            }
            catch (Exception ex)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: convertAndSendForConservation", ex);
                esito = false;
                //throw DocsPaUtils.Exceptions.SoapExceptionFactory.Create(ex);
            }
            return esito;
        }



        private void asyncConvertAndSend(IAsyncResult ar)
        {
        }

        /// <summary>
        /// 
        /// </summary>
        /// <results> </results>
        [WebMethod]
        public virtual List<DocsPaVO.areaConservazione.ReportFormatiConservazione> getDettaglioListReportFormatiConservazioneByIdCons(string idIstanzaCons)
        {
            try
            {
                BusinessLogic.Conservazione.ConservazioneManager ConsManager = new BusinessLogic.Conservazione.ConservazioneManager();
                return ConsManager.getDettaglioListReportFormatiConservazioneByIdCons(idIstanzaCons);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Conservazione.ConservazioneManager.getListReportFormatiConservazioneByIdCons", e);
                return null;
            }
        }

        /// <summary>
        /// Metodo che crea un 
        /// </summary>
        /// <param name="filtriReport"></param>
        /// <param name="tipoRep"></param>
        [WebMethod]
        public DocsPaVO.documento.FileDocumento createReport(DocsPaVO.filtri.FiltroRicerca[] filtriReport, DataSet dataSet,
                                string tipoRep, string titoloReport, string Sottotitolo, string reportKey, string contextName, InfoUtente infoUt)
        {
            try
            {
                BusinessLogic.Conservazione.ConservazioneManager ConsManager = new BusinessLogic.Conservazione.ConservazioneManager();
                return ConsManager.createReport(filtriReport, dataSet, tipoRep, titoloReport, Sottotitolo, reportKey, contextName, infoUt);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BusinessLogic.Conservazione.ConservazioneManager.createReport", e);
                return null;
            }

        }

        #endregion

        [WebMethod]
        public DocsPaVO.areaConservazione.ItemsConservazione[] ConservazioneGetItemsById(string idConservazione)
        {
            DocsPaVO.areaConservazione.ItemsConservazione[] itemsCons = null;
            try
            {
                DocsPaConservazione.DocsPaConsManager consManager = new DocsPaConservazione.DocsPaConsManager();
                itemsCons = consManager.getItemsConservazioneById(idConservazione, null);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ConservazioneGetItemsById", e);
            }
            return itemsCons;
        }

        [WebMethod]
        public virtual string DocumentoExecAddConservazione(string idProfile, string idProject, string docNumber, DocsPaVO.utente.InfoUtente infoUtente, string tipoOggetto)
        {
            SetUserId(infoUtente);
            string result = String.Empty;
            try
            {
                result = BusinessLogic.Documenti.areaConservazioneManager.CreateAndAddDocInAreaConservazione(infoUtente, idProfile, idProject, docNumber, tipoOggetto, string.Empty);
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOCONSERVAZIONE", idProfile, string.Format("{0}{1}", "Invio in conservazione del doc: ", idProfile), DocsPaVO.Logger.CodAzione.Esito.OK);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoExecAddConservazione", e);
                result = "-1";
            }
            return result;
        }

        [WebMethod]
        public virtual string DocumentoExecAddConservazioneAM(string idProfile, string idProject, string docNumber, DocsPaVO.utente.InfoUtente infoUtente, string tipoOggetto)
        {
            SetUserId(infoUtente);
            string result = String.Empty;
            try
            {
                result = BusinessLogic.Documenti.areaConservazioneManager.CreateAndAddDocInAreaConservazione(infoUtente, idProfile, idProject, docNumber, tipoOggetto, string.Empty);
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOCONSERVAZIONE", idProfile, string.Format("{0}{1}", "Azione Massiva - Invio in conservazione del doc: ", idProfile), DocsPaVO.Logger.CodAzione.Esito.OK);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoExecAddConservazione", e);
                result = "-1";
            }
            return result;
        }

        [WebMethod]
        public virtual bool DocumentoUpdateAreaCons(string sysId, string tipo_cons, string note, string descr, string idTipoSupp, InfoUtente infoUtente, bool consolida)
        {
            bool result = true;
            DocsPaVO.Logger.CodAzione.Esito logResponse = DocsPaVO.Logger.CodAzione.Esito.OK;
            try
            {
                BusinessLogic.Documenti.areaConservazioneManager.updateAreaConservazione(sysId, tipo_cons, note, descr, idTipoSupp, consolida);
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente,
                       "INVIO_ISTANZA",
                       sysId,
                       String.Format("Invio in conservazione dell' istanza {0}", sysId),
                       logResponse);


                //GESTIONE UTENZA DI SISTEMA PER REGISTRO CONSERVAZIONE
                //DocsPaVO.utente.Ruolo r = null;

                DocsPaVO.utente.Utente u = null;
                u = BusinessLogic.Utenti.UserManager.getUtente("UTENTECONSERVAZIONE", infoUtente.idAmministrazione);

                DocsPaVO.utente.InfoUtente infoUtSistema = new DocsPaVO.utente.InfoUtente();
                if (u == null || string.IsNullOrEmpty(u.systemId))
                {
                    u = new Utente();
                    u.idPeople = infoUtente.idPeople;
                    u.idAmministrazione = infoUtente.idAmministrazione;

                }

                infoUtSistema.idPeople = u.idPeople;
                infoUtSistema.idAmministrazione = u.idAmministrazione;
                infoUtSistema.codWorkingApplication = "CS";
                infoUtSistema.idGruppo = "0";
                infoUtSistema.idCorrGlobali = "0";
                infoUtSistema.userId = "UTENTECONSERVAZIONE";

                // SCRITTURA NEL REGISTRO DI CONSERVAZIONE
                DocsPaVO.Conservazione.RegistroCons regCons = new DocsPaVO.Conservazione.RegistroCons();
                regCons.idAmm = infoUtSistema.idAmministrazione;
                regCons.idIstanza = sysId;
                //regCons1.idOggetto =  regCons1. itemsCon.ID_Profile;
                regCons.tipoOggetto = "I";
                regCons.tipoAzione = "";
                regCons.userId = infoUtSistema.userId;
                regCons.codAzione = "INVIO_ISTANZA";
                regCons.descAzione = "Ricezione in conservazione istanza id: " + sysId;
                regCons.esito = "1";
                DocsPaConservazione.RegistroConservazione rc = new DocsPaConservazione.RegistroConservazione();
                rc.inserimentoInRegistroCons(regCons, infoUtSistema);

            }
            catch (Exception e)
            {
                logResponse = DocsPaVO.Logger.CodAzione.Esito.KO;
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente,
                       "INVIO_ISTANZA",
                       sysId,
                       String.Format("Errore invio in conservazione dell' istanza {0}", sysId),
                       logResponse);

                DocsPaVO.Conservazione.RegistroCons regCons = new DocsPaVO.Conservazione.RegistroCons();
                regCons.idAmm = infoUtente.idAmministrazione;
                regCons.idIstanza = sysId;
                //regCons1.idOggetto =  regCons1. itemsCon.ID_Profile;
                regCons.tipoOggetto = "I";
                regCons.tipoAzione = "";
                regCons.userId = infoUtente.userId;
                regCons.codAzione = "INVIO_ISTANZA";
                regCons.descAzione = "Invio in conservazione istanza id: " + sysId;
                regCons.esito = "0";
                DocsPaConservazione.RegistroConservazione rc = new DocsPaConservazione.RegistroConservazione();
                rc.inserimentoInRegistroCons(regCons, infoUtente);


                result = false;
            }
            return result;
        }

        [WebMethod]
        public virtual bool DocumentoCancellaAreaConservazione(string idProfile, DocsPaVO.fascicolazione.Fascicolo fasc, string idIstanza, bool deleteIstanza, string systemId)
        {
            bool result = true;
            try
            {
                BusinessLogic.Documenti.areaConservazioneManager.cancellaAreaConservazione(idProfile, fasc, idIstanza, deleteIstanza, systemId);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoCancellaAreaConservazione", e);
                result = false;
            }
            return result;
        }
        [WebMethod]
        public virtual int CanDeleteFromItemCons(string idProfile, string idPeople, string idGruppo)
        {
            int result = 0;
            try
            {
                result = BusinessLogic.Documenti.areaConservazioneManager.canDeleteItemConservazione(idProfile, idPeople, idGruppo);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: CanDeleteFromItemCons", e);
                result = -1;
            }
            return result;
        }
        [WebMethod]
        public virtual int DocumentoIsPrimaIstanzaCons(string idPeople, string idGruppo)
        {
            int result = 0;
            try
            {
                result = BusinessLogic.Documenti.areaConservazioneManager.isPrimaIstanzaCons(idPeople, idGruppo);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoIsPrimaIstanzaCons", e);
                result = -1;
            }
            return result;
        }

        /// <summary>
        /// Metodo per ottenere la prima istanza nuova in area conservazione. Utilizzato per eseguire un controllo sui documenti
        /// fascicolati gi inseriti.
        /// </summary>
        /// <param name="idPeople"></param>
        /// <param name="idGruppo"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual string getPrimaIstanzaAreaCons(string idPeople, string idGruppo)
        {
            string result = string.Empty;
            try
            {
                result = BusinessLogic.Documenti.areaConservazioneManager.getPrimaIstanzaCons(idPeople, idGruppo);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getPrimaIstanzaAreaCons", e);
                result = "Errore";
            }
            return result;
        }



        [WebMethod]
        public DocsPaVO.areaConservazione.InfoConservazione[] ConservazioneGetInfoById(string idPeople, string idRuoloInUO)
        {
            DocsPaVO.areaConservazione.InfoConservazione[] infoCons = null;
            try
            {
                DocsPaConservazione.DocsPaConsManager consManager = new DocsPaConservazione.DocsPaConsManager();
                infoCons = consManager.getInfoConservazioneById(idPeople, idRuoloInUO);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ConservazioneGetInfoById", e);
            }
            return infoCons;
        }


        [WebMethod]
        public DocsPaVO.areaConservazione.TipoSupporto[] getListaTipoSupporto()
        {
            DocsPaVO.areaConservazione.TipoSupporto[] tipoSupp = null;
            try
            {
                DocsPaConservazione.DocsPaConsManager consManager = new DocsPaConservazione.DocsPaConsManager();
                tipoSupp = consManager.getListaTipoSupporto();
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getListaTipoSupporto", e);
            }
            return tipoSupp;
        }

        [WebMethod]
        public int SerializeScheda(DocsPaVO.documento.SchedaDocumento schDoc, string systemID)
        {
            int size_xml = 0;
            try
            {
                DocsPaConservazione.InfoDocXml DocXml = new DocsPaConservazione.InfoDocXml();
                size_xml = System.Convert.ToInt32(DocXml.serializeScheda(schDoc, systemID));
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: SerializeScheda", e);
            }
            return size_xml;
        }

        [WebMethod]

        public virtual bool UpdateSizeItemCons(string sysId, int size)
        {
            bool result = true;
            try
            {
                BusinessLogic.Documenti.areaConservazioneManager.updateSizeItemCons(sysId, size);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: UpdateSizeItemCons", e);
                result = false;
            }
            return result;
        }

        [WebMethod]
        public virtual List<SearchResultInfo> getDocumentiInFascicolo(string idProject)
        {
            List<SearchResultInfo> result = BusinessLogic.Documenti.areaConservazioneManager.getListaDocumentiByIdProject(idProject);
            return result;
        }

        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.documento.InfoDocumento))]
        public virtual ArrayList DocumentoGetAll(DocsPaVO.filtri.FiltroRicerca[][] objFiltri, DocsPaVO.utente.InfoUtente Safe)
        {
            SetUserId(Safe);
            ArrayList listaDoc = new ArrayList();
            try
            {
                listaDoc = BusinessLogic.Documenti.InfoDocManager.getQuery(Safe.idGruppo, Safe.idPeople, objFiltri);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoGetAll", e);
                listaDoc = null;
            }
            return listaDoc;
        }

        [WebMethod]
        public virtual int DocumentoInsertAllInConservazione(DocsPaVO.filtri.FiltroRicerca[][] objFiltri, DocsPaVO.utente.InfoUtente Safe, String[] documentsSystemId)
        {
            SetUserId(Safe);
            int result = 1;
            string idGruppo = Safe.idGruppo;
            string idPeople = Safe.idPeople;
            int docFileNonAcq = 0;
            try
            {
                ArrayList listaD = BusinessLogic.Documenti.InfoDocManager.getQueryExport(Safe, objFiltri, false, documentsSystemId);

                for (int i = 0; i < listaD.Count; i++)
                {
                    DocsPaVO.documento.InfoDocumentoExport infoDoc = (DocsPaVO.documento.InfoDocumentoExport)listaD[i];
                    if (infoDoc.inConservazione == "0")
                    {
                        DocsPaVO.documento.SchedaDocumento schedaSel = this.DocumentoGetDettaglioDocumento(Safe, infoDoc.systemId, infoDoc.docNumber);
                        if (schedaSel != null && Convert.ToInt32(((DocsPaVO.documento.Documento)schedaSel.documenti[0]).fileSize) > 0)
                        {
                            string sysId = BusinessLogic.Documenti.areaConservazioneManager.CreateAndAddDocInAreaConservazione(Safe, infoDoc.systemId, "", infoDoc.docNumber, "D", string.Empty);

                            int size_xml = this.SerializeScheda(schedaSel, sysId);
                            int doc_size = Convert.ToInt32(((DocsPaVO.documento.Documento)schedaSel.documenti[0]).fileSize);
                            int size_allegati = 0;
                            for (int j = 0; j < schedaSel.allegati.Count; j++)
                            {
                                size_allegati = size_allegati + Convert.ToInt32(((DocsPaVO.documento.Allegato)schedaSel.allegati[j]).fileSize);
                            }
                            int total_size = size_allegati + doc_size + size_xml;
                            this.UpdateSizeItemCons(sysId, total_size);

                            int numeroAllegati = schedaSel.allegati.Count;
                            string fileName = ((DocsPaVO.documento.Documento)schedaSel.documenti[0]).fileName;
                            string tipoFile = System.IO.Path.GetExtension(fileName);
                            this.updateItemsCons(tipoFile, Convert.ToString(numeroAllegati), sysId);
                        }
                        else
                        {
                            docFileNonAcq++;
                        }
                    }
                }
                if (docFileNonAcq == listaD.Count)
                {
                    result = -1;
                }
                else if (docFileNonAcq > 0)
                {
                    result = 0;
                }
                else result = 1;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoInsertAllInConservazione", e);
                result = -2;
            }
            return result;
        }

        [WebMethod]
        public virtual bool updateItemsCons(string tipoFile, string numAllegati, string systemId)
        {
            bool result = true;
            try
            {
                BusinessLogic.Documenti.areaConservazioneManager.updateItemsCons(tipoFile, numAllegati, systemId);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: updateItemsCons", e);
                result = false;
            }
            return result;
        }

        [WebMethod]

        public virtual DocsPaVO.areaConservazione.DettItemsConservazione[] gettDettaglioItemsCons(string idProfile)
        {
            DocsPaVO.areaConservazione.DettItemsConservazione[] dettItemsCons = null;
            try
            {
                DocsPaConservazione.DocsPaConsManager consManager = new DocsPaConservazione.DocsPaConsManager();
                dettItemsCons = consManager.getDettaglioItemsCons(idProfile);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: gettDettaglioItemsCons", e);
            }
            return dettItemsCons;
        }


        [WebMethod]

        public virtual DocsPaVO.areaConservazione.DettItemsConservazione[] gettDettaglioConsFasc(string idProject)
        {
            DocsPaVO.areaConservazione.DettItemsConservazione[] dettItemsCons = null;
            try
            {
                DocsPaConservazione.DocsPaConsManager consManager = new DocsPaConservazione.DocsPaConsManager();
                dettItemsCons = consManager.getDettaglioItemsConsFasc(idProject);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: gettDettaglioItemsCons", e);
            }
            return dettItemsCons;
        }

        [WebMethod]
        public DocsPaVO.areaConservazione.InfoConservazione[] ConservazioneGetInfoByFiltro(string filtro)
        {
            DocsPaVO.areaConservazione.InfoConservazione[] infoCons = null;
            try
            {
                DocsPaConservazione.DocsPaConsManager consManager = new DocsPaConservazione.DocsPaConsManager();
                infoCons = consManager.RicercaInfoConservazione(filtro);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ConservazioneGetInfoByFiltro", e);
            }
            return infoCons;
        }
        [WebMethod]
        public bool ConservazioneDeleteFromItemsCons(string idIstanza, string systemId, string idProject)
        {
            bool result = false;
            try
            {
                result = BusinessLogic.Documenti.areaConservazioneManager.DeleteFromDpaItemsCons(idIstanza, systemId, idProject);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ConservazioneDeleteFromItemsCons", e);
            }
            return result;
        }
        #endregion



        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(string))]
        public ArrayList DocumentoGetTipoProtoRisposta(string docNumber)
        {
            ArrayList result = null;
            try
            {
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                BusinessLogic.Documenti.DocManager dm = new BusinessLogic.Documenti.DocManager();
                result = dm.documentoGetTipoProtoRisposta(docNumber);
#if TRACE_WS
				pt.WriteLogTracer("DocumentoGetTipoProto");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoGetTipoProto", e);
            }
            return result;
        }

        #region Gestione rubrica comune

        /// <summary>
        /// Reperimento delle configurazioni per l'utilizzo del sistema rubrica comune
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.RubricaComune.ConfigurazioniRubricaComune GetConfigurazioniRubricaComune(DocsPaVO.utente.InfoUtente infoUtente)
        {
            SetUserId(infoUtente);
            return BusinessLogic.RubricaComune.Configurazioni.GetConfigurazioni(infoUtente);
        }

        /// <summary>
        /// Reperimento dei dati di una uo da inviare a rubrica comune
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <param name="idUo"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.RubricaComune.ElementoRubricaUO GetElementoRubricaUO(DocsPaVO.utente.InfoUtente infoUtente, string idUo)
        {
            SetUserId(infoUtente);
            return BusinessLogic.RubricaComune.RubricaServices.GetElementoRubricaUO(infoUtente, idUo);
        }

        #endregion


        #region trasferimento in deposito
        [WebMethod]
        public virtual DocsPaVO.fascicolazione.Fascicolo FascicolazioneGetFascicoloDaArchiviare(DocsPaVO.utente.InfoUtente infoUtente, string codiceFascicolo)
        {
            SetUserId(infoUtente);
            DocsPaVO.fascicolazione.Fascicolo result = null;
            try
            {

                result = BusinessLogic.Fascicoli.FascicoloManager.getFascicoloDaArchiviare(infoUtente, codiceFascicolo);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneGetFascicoloDaArchiviare", e);
                result = null;
            }

            return result;
        }

        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.fascicolazione.Fascicolo))]
        public virtual ArrayList FascicolazioneGetListaFascicoliDaArchiviare(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.fascicolazione.Classificazione classificazione, DocsPaVO.utente.Registro registro, DocsPaVO.filtri.FiltroRicerca[] listaFiltri, bool enableUfficioRef, bool enableProfilazione, bool childs, int numPage, out int numTotPage, out int nRec, int pageSize)
        {
            SetUserId(infoUtente);
            ArrayList result = null;
            nRec = 0;
            numTotPage = 0;
            try
            {
                result = BusinessLogic.Fascicoli.FascicoloManager.getListaFascicoliDaArchiviare(infoUtente, classificazione, registro, listaFiltri, enableUfficioRef, enableProfilazione, childs, out numTotPage, out nRec, numPage, pageSize);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneGetListaFascicoliDaArchiviare", e);
                result = null;
            }
            return result;
        }

        /// <summary>
        /// Restituisce la lista di documenti classificati in un dato fascicolo generale
        /// che si possono archiviare
        /// </summary>
        /// <param name="anno"></param>
        /// <param name="idGruppo"></param>
        /// <param name="idPeople"></param>
        /// <param name="fascicolo"></param>
        /// <param name="numPage"></param>
        /// <param name="numTotPage"></param>
        /// <param name="nRec"></param>
        /// <returns></returns>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.documento.InfoDocumento))]
        //public virtual ArrayList FascicolazioneGetDocumentiDaArchiviare(string anno, string idGruppo, string idPeople, DocsPaVO.fascicolazione.Fascicolo fascicolo, out int nRec)
        public virtual ArrayList FascicolazioneGetDocumentiDaArchiviare(string anno, string idGruppo, string idPeople, DocsPaVO.fascicolazione.Fascicolo fascicolo, int numPage, out int numTotPage, out int nRec)
        {
            nRec = 0;
            numTotPage = 0;
            ArrayList objListaDocumenti = null;

            try
            {
                objListaDocumenti = BusinessLogic.Fascicoli.FolderManager.getDocumentiDaArchiviare(idGruppo, idPeople, fascicolo, numPage, out numTotPage, out nRec, anno);
                //objListaDocumenti = BusinessLogic.Fascicoli.FolderManager.getDocumentiDaArchiviare(idGruppo, idPeople, fascicolo, out nRec, anno);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneGetDocumentiDaArchiviare", e);
                objListaDocumenti = null;
            }

            return objListaDocumenti;
        }


        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.ProfilazioneDinamica.Templates))]
        public virtual ArrayList getTemplatesArchivioDeposito(DocsPaVO.utente.InfoUtente infoUtente, string idAmm, bool seRepertorio)
        {
            ArrayList result = null;
            try
            {
                SetUserId(infoUtente);
                result = BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.getTemplatesArchivioDeposito(idAmm, seRepertorio);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getTemplatesArchivioDeposito", e);
                result = null;
            }
            return result;
        }

        /// <summary>
        /// Restituisce una lista di documenti appartenenti ad una data serie repertoriata        
        /// </summary>
        /// <param name="idGruppo"></param>
        /// <param name="idPeople"></param>
        /// <param name="template"></param>
        /// <param name="numPage"></param>
        /// <param name="numTotPage"></param>
        /// <param name="nRec"></param>
        /// <returns></returns>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.documento.InfoDocumento))]
        //public virtual ArrayList DocumentoGetDocInSerie(string idGruppo, string idPeople, DocsPaVO.ProfilazioneDinamica.Templates template, out int nRec)
        public virtual ArrayList DocumentoGetDocInSerie(string idGruppo, string idPeople, DocsPaVO.ProfilazioneDinamica.Templates template, int numPage, out int numTotPage, out int nRec, string oggetto, string anno, string rfAOO)
        {
            nRec = 0;
            numTotPage = 0;
            ArrayList objListaInfoDocumenti = null;
            try
            {
                objListaInfoDocumenti = BusinessLogic.Documenti.InfoDocManager.getDocInSerie(idGruppo, template, numPage, out numTotPage, out nRec, oggetto, anno, rfAOO);
                //objListaInfoDocumenti = BusinessLogic.Documenti.InfoDocManager.getDocInSerie(template, out nRec);

            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoGetDocInSerie", e);
                objListaInfoDocumenti = null;
            }
            return objListaInfoDocumenti;
        }

        /// <summary>
        /// Trasferimento in deposito di un singolo documento
        /// </summary>
        /// <param name="idProfile"></param>
        /// <param name="idProject"></param>
        /// <param name="docNumber"></param>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual string ExecTrasfInDepositoDocumento(string idProfile, DocsPaVO.utente.InfoUtente infoUtente, string serieOrFasc, string tipoOp)
        {
            SetUserId(infoUtente);
            string result = String.Empty;
            try
            {
                result = BusinessLogic.Documenti.ArchivioManager.TrasfInDepositoDoc(idProfile, serieOrFasc, tipoOp);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ExecTrasfInDepositoDocumento", e);
                result = "-1";
            }
            return result;
        }

        [WebMethod]
        public virtual bool ExecTrasfInDepositoFascicoloProc(string idProject, DocsPaVO.utente.InfoUtente infoUtente, string tipoOp)
        {
            SetUserId(infoUtente);
            bool result = false;
            try
            {
                result = BusinessLogic.Documenti.ArchivioManager.TrasfInDepositoFascicoloProc(idProject, tipoOp);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ExecTrasfInDepositoFascicoloProc", e);
                result = false;
            }
            return result;
        }

        [WebMethod]
        public virtual bool ExecTrasfInDepositoALLFascicoliProc(DocsPaVO.filtri.FiltroRicerca[][] filtriRic, DocsPaVO.utente.InfoUtente infoUtente, string tipoOperazione)
        {
            SetUserId(infoUtente);
            bool result = false;
            try
            {
                result = BusinessLogic.Documenti.ArchivioManager.TrasfInDepositoAllFascProc(filtriRic, infoUtente, tipoOperazione);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ExecTrasfInDepositoALLFascicoliProc", e);
                result = false;
            }
            return result;
        }

        [WebMethod]
        public virtual int ExecTrasfInDepositoALLDocsFascicoloGen(DocsPaVO.fascicolazione.Fascicolo fascicolo, string anno, DocsPaVO.utente.InfoUtente infoUtente, string tipoOp)
        {
            SetUserId(infoUtente);
            int result = 0;
            try
            {
                result = BusinessLogic.Documenti.ArchivioManager.TrasfInDepositoAllDocsFascGen(fascicolo, anno, infoUtente, tipoOp);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ExecTrasfInDepositoALLFascicoliProc", e);
                result = -1;
            }
            return result;
        }

        [WebMethod]
        public virtual int ExecTrasfInDepositoSerie(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.ProfilazioneDinamica.Templates template, string anno, string valOggetto, string tipoOp, string rfAOO)
        {
            SetUserId(infoUtente);
            int result = 0;
            try
            {
                result = BusinessLogic.Documenti.ArchivioManager.TrasfInDepositoSerie(infoUtente, template, anno, valOggetto, tipoOp, rfAOO);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ExecTrasfInDepositoSerie", e);
                result = -1;
            }
            return result;
        }


        #endregion

        #region Area Scarto
        /// <summary>
        /// Recupera la lista dei fascicoli procedimentali chiusi in deposito per un dato fascicolo generale
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <param name="fascicolo"></param>
        /// <param name="numPage"></param>
        /// <param name="numTotPage"></param>
        /// <param name="nRec"></param>
        /// <returns></returns>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.fascicolazione.Fascicolo))]
        public virtual ArrayList ScartoGetFascicoliInDeposito(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.fascicolazione.Fascicolo fascicolo, int numPage, out int numTotPage, out int nRec, string tipoRic)
        {
            nRec = 0;
            numTotPage = 0;
            ArrayList objListaFascicoli = null;
            try
            {
                SetUserId(infoUtente);
                objListaFascicoli = BusinessLogic.fascicoli.AreaScartoManager.getListaFascicoliInDeposito(infoUtente, fascicolo, numPage, out numTotPage, out nRec, tipoRic);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ScartoGetFascicoliInDeposito", e);
                objListaFascicoli = null;
            }

            return objListaFascicoli;
        }

        /// <summary>
        /// Verifica che non ci sia gi una nuova istanza di scarto per un dato utente e gruppo
        /// </summary>
        /// <param name="idPeople"></param>
        /// <param name="idGruppo"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual int ScartoIsPrimaIstanzaFascicolo(string idPeople, string idGruppo)
        {
            int result = 0;
            try
            {
                result = BusinessLogic.fascicoli.AreaScartoManager.isPrimaIstanzaScarto(idPeople, idGruppo);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ScartoIsPrimaIstanzaFascicolo", e);
                result = -1;
            }
            return result;
        }

        /// <summary>
        /// Aggiunge i documenti di un fascicolo all'area di scarto
        /// </summary>
        /// <param name="idProfile"></param>
        /// <param name="idProject"></param>
        /// <param name="docNumber"></param>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual string ScartoAddFascicolo(string idProfile, string idProject, string docNumber, DocsPaVO.utente.InfoUtente infoUtente)
        {
            string result = String.Empty;
            try
            {
                SetUserId(infoUtente);
                result = BusinessLogic.fascicoli.AreaScartoManager.addDocumentiFascicoloInAreaScarto(idProfile, idProject, docNumber, infoUtente);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ScartoAddFascicolo", e);
                result = "-1";
            }
            return result;
        }

        /// <summary>
        /// Elimina i documenti di un fascicolo dall'istanza dell'area di scarto
        /// </summary>
        /// <param name="fasc"></param>
        /// <param name="idIstanza"></param>
        /// <param name="deleteIstanza"></param>
        /// <param name="systemId"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual bool ScartoDeleteFascicolo(DocsPaVO.fascicolazione.Fascicolo fasc, string idIstanza, bool deleteIstanza, string systemId)
        {
            bool result = true;
            try
            {
                BusinessLogic.fascicoli.AreaScartoManager.cancellaFascAreaScarto(fasc, idIstanza, deleteIstanza, systemId);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ScartoDeleteFascicolo", e);
                result = false;
            }
            return result;
        }


        [WebMethod]
        public virtual bool ScartoAddAllFasc(DocsPaVO.fascicolazione.Fascicolo fascicolo, DocsPaVO.utente.InfoUtente infoUtente, string tipoRic)
        {
            bool result = true;
            try
            {
                SetUserId(infoUtente);
                result = BusinessLogic.fascicoli.AreaScartoManager.addAllFascInScarto(fascicolo, infoUtente, tipoRic);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ScartoAddAllFasc", e);
                result = false;
            }
            return result;
        }

        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.AreaScarto.InfoScarto))]
        public virtual ArrayList ScartoGetListaScarto(DocsPaVO.utente.InfoUtente infoUtente, int numPage, out int numTotPage, out int nRec)
        {
            nRec = 0;
            numTotPage = 0;
            ArrayList listaScarto = null;
            try
            {
                SetUserId(infoUtente);
                listaScarto = BusinessLogic.fascicoli.AreaScartoManager.getListaScarto(infoUtente, numPage, out numTotPage, out nRec);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ScartoGetListaScarto", e);
            }
            return listaScarto;
        }

        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.fascicolazione.Fascicolo))]
        public virtual ArrayList ScartoGetFascicoliInScarto(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.AreaScarto.InfoScarto infoScarto, int numPage, out int numTotPage, out int nRec)
        {
            nRec = 0;
            numTotPage = 0;
            ArrayList objListaFascicoli = null;
            try
            {
                SetUserId(infoUtente);
                objListaFascicoli = BusinessLogic.fascicoli.AreaScartoManager.getListaFascicoliInScarto(infoUtente, infoScarto, numPage, out numTotPage, out nRec);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ScartoGetFascicoliInScarto", e);
                objListaFascicoli = null;
            }

            return objListaFascicoli;
        }

        [WebMethod]
        public virtual bool ScartoUpdateScarto(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.AreaScarto.InfoScarto infoScarto)
        {
            bool retValue = true;
            try
            {
                SetUserId(infoUtente);
                retValue = BusinessLogic.fascicoli.AreaScartoManager.updateScarto(infoUtente, infoScarto);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ScartoUpdateScarto", e);
                retValue = false;
            }

            return retValue;
        }


        [WebMethod]
        public virtual bool ScartoCambiaStato(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.AreaScarto.InfoScarto infoScarto, string nuovoCampo)
        {
            bool retValue = true;
            try
            {
                SetUserId(infoUtente);
                retValue = BusinessLogic.fascicoli.AreaScartoManager.cambiaStatoScarto(infoUtente, infoScarto, nuovoCampo);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ScartoCambiaStato", e);
                retValue = false;
            }

            return retValue;
        }



        [WebMethod]
        public virtual DocsPaVO.documento.FileDocumento ExportScarto(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.AreaScarto.InfoScarto infoScarto, string exportType, string title, DocsPaVO.ricerche.FullTextSearchContext context, ArrayList campiSelezionati)
        {
            SetUserId(infoUtente);
            DocsPaVO.documento.FileDocumento file = null;

            try
            {
                BusinessLogic.ExportDati.ExportDatiManager manager = new BusinessLogic.ExportDati.ExportDatiManager();
                file = manager.ExportScarto(infoUtente, infoScarto, exportType, title, context, campiSelezionati);
                if (file != null)
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "EXPORTSCARTO", "0", "Export in " + exportType + " dello scarto dei fascicoli", DocsPaVO.Logger.CodAzione.Esito.OK);
            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "EXPORTSCARTO", "0", "Export in " + exportType + " dello scarto dei fascicoli", DocsPaVO.Logger.CodAzione.Esito.KO);
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ExportScarto", e);
                file = null;
            }

            return file;
        }
        #endregion




        #region Integrazione LDAP

        /// <summary>
        /// 
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <param name="idAmministrazione"></param>
        /// <returns></returns>
        [WebMethod(Description = "Reperimento configurazioni per l'integrazione LDAP nell'amministrazione")]
        public DocsPaVO.Ldap.LdapConfig GetLdapConfig(DocsPaVO.utente.InfoUtente infoUtente, string idAmministrazione)
        {
            try
            {
                SetUserId(infoUtente);
                return BusinessLogic.Ldap.LdapConfigurationsServices.GetLdapConfig(infoUtente, idAmministrazione);
            }
            catch (Exception ex)
            {
                throw DocsPaUtils.Exceptions.SoapExceptionFactory.Create(ex);
            }
        }

        /// <summary>
        /// Impostazione configurazioni per l'integrazione LDAP nell'amministrazione
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <param name="idAmministrazione"></param>
        /// <param name="ldapInfo"></param>
        [WebMethod(Description = "Impostazione configurazioni per l'integrazione LDAP nell'amministrazione")]
        public void SaveLdapConfig(DocsPaVO.utente.InfoUtente infoUtente, string idAmministrazione, DocsPaVO.Ldap.LdapConfig ldapInfo)
        {
            SetUserId(infoUtente);
            try
            {
                BusinessLogic.Ldap.LdapConfigurationsServices.SaveLdapConfig(infoUtente, idAmministrazione, ldapInfo);
            }
            catch (Exception ex)
            {
                throw DocsPaUtils.Exceptions.SoapExceptionFactory.Create(ex);
            }
        }

        ///// <summary>
        ///// 
        ///// </summary>
        ///// <param name="infoUtente"></param>
        ///// <param name="idUser"></param>
        ///// <returns></returns>
        //[WebMethod(Description = "Reperimento configurazioni per l'integrazione LDAP per l'utente")]
        //public DocsPaVO.Ldap.LdapUserConfig GetLdapUserConfig(DocsPaVO.utente.InfoUtente infoUtente, string idUser)
        //{
        //    try
        //    {
        //        return BusinessLogic.Ldap.LdapUserConfigurationServices.GetLdapUserConfig(infoUtente, idUser);
        //    }
        //    catch (Exception ex)
        //    {
        //        throw DocsPaUtils.Exceptions.SoapExceptionFactory.Create(ex);
        //    }
        //}

        ///// <summary>
        ///// Impostazione configurazioni per l'integrazione LDAP per un utente
        ///// </summary>
        ///// <param name="infoUtente"></param>
        ///// <param name="idUser"></param>
        ///// <param name="ldapInfo"></param>
        //[WebMethod(Description = "Impostazione configurazioni per l'integrazione LDAP per un utente")]
        //public void SaveLdapUserConfig(DocsPaVO.utente.InfoUtente infoUtente, string idUser, DocsPaVO.Ldap.LdapConfig ldapInfo)
        //{
        //    try
        //    {
        //        BusinessLogic.Ldap.LdapUserConfigurationServices.SaveLdapUserConfig(infoUtente, idUser, ldapInfo);
        //    }
        //    catch (Exception ex)
        //    {
        //        throw DocsPaUtils.Exceptions.SoapExceptionFactory.Create(ex);
        //    }
        //}

        /// <summary>
        /// Task di sincronizzazione delle utenze LDAP in docspa
        /// </summary>
        /// <param name="request"></param>
        /// <returns></returns>
        [WebMethod(Description = "Task di sincronizzazione delle utenze provenienti da LDAP")]
        public DocsPaVO.Ldap.LdapSyncronizationResponse SyncronizeLdapUsers(DocsPaVO.Ldap.LdapSyncronizationRequest request)
        {
            try
            {
                return BusinessLogic.Ldap.LdapUserSyncronizationServices.SyncronizeLdapUsers(request);
            }
            catch (Exception ex)
            {
                throw DocsPaUtils.Exceptions.SoapExceptionFactory.Create(ex);
            }
        }

        /// <summary>
        /// 
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <param name="idAmministrazione"></param>
        /// <returns></returns>
        [WebMethod(Description = "Reperimento delle informazioni sulle sincronizzazioni LDAP effettuate per l'amministrazione richiesta")]
        public DocsPaVO.Ldap.LdapSyncronizationHistoryItem[] GetLdapSyncHistory(DocsPaVO.utente.InfoUtente infoUtente, string idAmministrazione)
        {
            try
            {
                SetUserId(infoUtente);
                return BusinessLogic.Ldap.LdapUserSyncronizationServices.GetLdapSyncHistory(infoUtente, idAmministrazione);
            }
            catch (Exception ex)
            {
                throw DocsPaUtils.Exceptions.SoapExceptionFactory.Create(ex);
            }
        }

        /// <summary>
        /// 
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <param name="idHistoryItem"></param>
        /// <returns></returns>
        [WebMethod(Description = "Reperimento delle informazioni dettagliate sull'esito di una singola sincronizzazione LDAP effettuata")]
        public DocsPaVO.Ldap.LdapSyncronizationResponse GetLdapSyncResponse(DocsPaVO.utente.InfoUtente infoUtente, int idHistoryItem)
        {
            try
            {
                SetUserId(infoUtente);
                return BusinessLogic.Ldap.LdapUserSyncronizationServices.GetLdapSyncResponse(infoUtente, idHistoryItem);
            }
            catch (Exception ex)
            {
                throw DocsPaUtils.Exceptions.SoapExceptionFactory.Create(ex);
            }
        }

        /// <summary>
        /// 
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <param name="idHistoryItem"></param>
        /// <returns></returns>
        [WebMethod(Description = "Rimozione delle informazioni dettagliate sull'esito di una singola sincronizzazione LDAP effettuata")]
        public void DeleteLdapSyncHistoryItem(DocsPaVO.utente.InfoUtente infoUtente, int idHistoryItem)
        {
            SetUserId(infoUtente);
            try
            {
                BusinessLogic.Ldap.LdapUserSyncronizationServices.DeleteLdapSyncHistoryItem(infoUtente, idHistoryItem);
            }
            catch (Exception ex)
            {
                throw DocsPaUtils.Exceptions.SoapExceptionFactory.Create(ex);
            }
        }

        #endregion

        [WebMethod]
        public virtual bool isUserDisabled(string username, string idAmm)
        {
            SetUserId(username);
            bool result = false;
            try
            {
                result = BusinessLogic.Utenti.UserManager.isUserDisabled(username, idAmm);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: isUserDisabled", e);
                result = true;
            }
            return result;
        }

        #region Gestione elaborazione documenti (modelli client side)

        /// <summary>
        /// Reperimento dei metadati del modello
        /// </summary>
        /// <param name="modelRequest"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.Modelli.ModelResponse GetDocumentModelResponse(DocsPaVO.Modelli.ModelRequest modelRequest)
        {
            BusinessLogic.Modelli.ModelProcessor modelProcessor = new BusinessLogic.Modelli.ModelProcessor();

            return modelProcessor.ProcessModel(modelRequest);
        }

        /// <summary>
        /// Reperimento dei metadati del modello
        /// </summary>
        /// <param name="modelRequestAsXml">
        /// Dati di richiesta in formato XML
        /// </param>
        /// <returns></returns>
        [WebMethod()]
        public string GetDocumentModelResponseAsXml(string modelRequestAsXml)
        {
            // Deserializzazione xml e creazione corrispondente oggetto di dominio
            DocsPaVO.Modelli.ModelRequest modelRequest = DocsPaVO.Modelli.ModelRequest.Parse(modelRequestAsXml);

            // Elaborazione dei dati del modello
            DocsPaVO.Modelli.ModelResponse modelResponse = this.GetDocumentModelResponse(modelRequest);

            return DocsPaVO.Modelli.ModelResponse.ToXml(modelResponse);
        }

        /// <summary>
        /// Reperimento dei metadati del modello
        /// </summary>
        /// <param name="modelRequestAsXml">
        /// Dati di richiesta in formato XML
        /// </param>
        /// <returns></returns>
        [WebMethod()]
        public string GetDocumentModelAsXml(DocsPaVO.Modelli.ModelRequest modelRequest)
        {
            BusinessLogic.Modelli.ModelProcessor modelProcessor = new BusinessLogic.Modelli.ModelProcessor();
            DocsPaVO.Modelli.ModelResponse modelResponse = modelProcessor.ProcessModel(modelRequest);

            return DocsPaVO.Modelli.ModelResponse.ToXml(modelResponse);
        }

        /// <summary>
        /// Reperimento dei metadati relativi ai wordprocessor clientside supportati dal sistema
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.Modelli.ModelProcessorInfo[] GetModelProcessors(DocsPaVO.utente.InfoUtente infoUtente)
        {
            SetUserId(infoUtente);
            return BusinessLogic.Modelli.ModelliManager.GetModelProcessors(infoUtente);
        }

        /// <summary>
        /// Reperimento dei metadati relativi al wordprocessor clientside impostato per l'utente
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.Modelli.ModelProcessorInfo GetCurrentModelProcessor(DocsPaVO.utente.InfoUtente infoUtente)
        {
            SetUserId(infoUtente);
            return BusinessLogic.Modelli.ModelliManager.GetCurrentModelProcessor(infoUtente);
        }

        /// 
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <param name="idDocument"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.documento.FileDocumento StampaRicevutaProtocolloPdf(DocsPaVO.utente.InfoUtente infoUtente, string idDocument)
        {
            try
            {
                SetUserId(infoUtente);
                return BusinessLogic.Modelli.StampaRicevutaProtocolloPdf.Create(infoUtente, idDocument);
            }
            catch (Exception ex)
            {
                throw DocsPaUtils.Exceptions.SoapExceptionFactory.Create(ex);
            }
        }

        #endregion




        [WebMethod]
        public virtual bool TrasmissioneExecuteTrasmDocDaModello(DocsPaVO.utente.InfoUtente infoUtente, string serverPath, DocsPaVO.documento.SchedaDocumento scheda, DocsPaVO.Modelli_Trasmissioni.ModelloTrasmissione modello)
        {
            SetUserId(infoUtente);
            try
            {
                DocsPaVO.trasmissione.Trasmissione trasmissione = new DocsPaVO.trasmissione.Trasmissione();

                //Parametri della trasmissione
                trasmissione.noteGenerali = modello.VAR_NOTE_GENERALI;

                trasmissione.tipoOggetto = DocsPaVO.trasmissione.TipoOggetto.DOCUMENTO;
                //trasmissione.infoDocumento = DocumentManager.getInfoDocumento(scheda);
                trasmissione.infoDocumento = BusinessLogic.Documenti.DocManager.getInfoDocumento(scheda);


                trasmissione.utente = BusinessLogic.Utenti.UserManager.getUtente(infoUtente.idPeople);
                trasmissione.ruolo = BusinessLogic.Utenti.UserManager.getRuolo(infoUtente.idCorrGlobali);

                if (infoUtente.delegato != null)
                    trasmissione.delegato = ((DocsPaVO.utente.InfoUtente)(infoUtente.delegato)).idPeople;

                //Parametri delle trasmissioni singole
                for (int i = 0; i < modello.RAGIONI_DESTINATARI.Count; i++)
                {
                    DocsPaVO.Modelli_Trasmissioni.RagioneDest ragDest = (DocsPaVO.Modelli_Trasmissioni.RagioneDest)modello.RAGIONI_DESTINATARI[i];
                    ArrayList destinatari = new ArrayList(ragDest.DESTINATARI);
                    for (int j = 0; j < destinatari.Count; j++)
                    {
                        DocsPaVO.Modelli_Trasmissioni.MittDest mittDest = (DocsPaVO.Modelli_Trasmissioni.MittDest)destinatari[j];

                        //DocsPaVO.utente.Corrispondente corr = UserManager.getCorrispondenteByCodRubricaIE(this,mittDest.VAR_COD_RUBRICA,DocsPaWR.AddressbookTipoUtente.INTERNO);
                        DocsPaVO.utente.Corrispondente corr = BusinessLogic.Utenti.UserManager.getCorrispondenteByCodRubrica(mittDest.VAR_COD_RUBRICA, infoUtente);

                        //DocsPaVO.trasmissione.RagioneTrasmissione ragione = wws.getRagioneById(mittDest.ID_RAGIONE.ToString());
                        DocsPaVO.trasmissione.RagioneTrasmissione ragione = BusinessLogic.Trasmissioni.QueryTrasmManager.getRagioneById(mittDest.ID_RAGIONE.ToString());
                        trasmissione = BusinessLogic.Trasmissioni.TrasmManager.addTrasmissioneSingola(trasmissione, corr, ragione, mittDest.VAR_NOTE_SING, mittDest.CHA_TIPO_TRASM);
                    }
                }
                //trasmissione = BusinessLogic.Trasmissioni.TrasmManager.saveTrasmMethod(trasmissione);
                //BusinessLogic.Trasmissioni.ExecTrasmManager.executeTrasmMethod(serverPath, trasmissione);
                trasmissione = BusinessLogic.Trasmissioni.ExecTrasmManager.saveExecuteTrasmMethod(serverPath, trasmissione);

                DocsPaVO.trasmissione.Trasmissione result = trasmissione;

                string method = string.Empty;
                string desc = string.Empty;

                if (result != null)
                {
                    // LOG per documento
                    if (result.infoDocumento != null && !string.IsNullOrEmpty(result.infoDocumento.idProfile))
                    {
                        foreach (DocsPaVO.trasmissione.TrasmissioneSingola single in result.trasmissioniSingole)
                        {
                            method = "TRASM_DOC_" + single.ragione.descrizione.ToUpper().Replace(" ", "_");
                            if (result.infoDocumento.segnatura == null)
                                desc = "Trasmesso Documento : " + result.infoDocumento.docNumber.ToString();
                            else
                                desc = "Trasmesso Documento : " + result.infoDocumento.segnatura.ToString();
                            BusinessLogic.UserLog.UserLog.WriteLog(result.utente.userId, result.utente.idPeople, result.ruolo.idGruppo, result.utente.idAmministrazione, method, result.infoDocumento.docNumber, desc, DocsPaVO.Logger.CodAzione.Esito.OK,
                                (infoUtente != null && infoUtente.delegato != null ? infoUtente.delegato : null), "1", single.systemId);
                        }
                    }

                    // LOG per fascicolo
                    else if (result.infoFascicolo != null && !string.IsNullOrEmpty(result.infoFascicolo.idFascicolo))
                    {
                        foreach (DocsPaVO.trasmissione.TrasmissioneSingola single in result.trasmissioniSingole)
                        {
                            method = "TRASM_FOLDER_" + single.ragione.descrizione.ToUpper().Replace(" ", "_");
                            desc = "Trasmesso Fascicolo: " + result.infoFascicolo.codice;
                            BusinessLogic.UserLog.UserLog.WriteLog(result.utente.userId, result.utente.idPeople, result.ruolo.idGruppo, result.utente.idAmministrazione, method, result.infoFascicolo.idFascicolo, desc, DocsPaVO.Logger.CodAzione.Esito.OK,
                                (infoUtente != null && infoUtente.delegato != null ? infoUtente.delegato : null), "1", single.systemId);
                        }
                    }
                }

                return true;
            }
            catch (Exception e)
            {
                return false;
                throw e;
            }
        }


        //gestione chiavi di configurazione
        [WebMethod]
        public virtual void clearHashTableChiaviConfig(string idAmm)
        {
            DocsPaUtils.Configuration.InitConfigurationKeys.remove(idAmm);
        }

        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.amministrazione.ChiaveConfigurazione))]
        //[XmlInclude(typeof(DocsPaVO.amministrazione.ChiaveConfigurazione))] //Aggiunto
        public virtual ArrayList getListaChiaviConfig(string idAmm)
        {
            DocsPaVO.amministrazione.ConfigRepository chiaviAmm = DocsPaUtils.Configuration.InitConfigurationKeys.getInstance(idAmm);
            ArrayList lista = new ArrayList(chiaviAmm.ListaChiavi);
            return lista;
        }

        [WebMethod]
        //Undo Modifiche Lorusso 22-10-2012
        public virtual DocsPaVO.Validations.ValidationResultInfo updateChiaveConfig(DocsPaVO.utente.InfoUtente infoUtente, ChiaveConfigurazione chiave)
        //public virtual DocsPaVO.Validations.ValidationResultInfo updateChiaveConfig(ChiaveConfigurazione chiave)
        {
            //Undo Modifiche Lorusso 22-10-2012
            DocsPaVO.Validations.ValidationResultInfo retValue = DocsPaUtils.Configuration.ChiaviConfigManager.UpdateChiaveConfigurazione(chiave);
            if (infoUtente != null)
            {
                if (retValue.Value)
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMMODCHIAVI", infoUtente.idAmministrazione, string.Format("{0}{1}{2}{3}", "Modifica della chiave ", chiave.Codice, " - Nuovo valore : ", chiave.Valore), DocsPaVO.Logger.CodAzione.Esito.OK);
                else
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "AMMMODCHIAVI", infoUtente.idAmministrazione, string.Format("{0}{1}{2}{3}", "Errore nella modifica della chiave ", chiave.Codice, " - Nuovo valore : ", chiave.Valore), DocsPaVO.Logger.CodAzione.Esito.KO);
            }
            return retValue;
            //End Undo Lorusso 22-10-2012

            //return DocsPaUtils.Configuration.ChiaviConfigManager.UpdateChiaveConfigurazione(chiave);
        }

        /// <summary>
        /// Aggiunge una chiave di configurazione
        /// La rende invisibile in amministrazione
        /// Questo  per uso interno
        /// </summary>
        /// <param name="chiaveConfig"></param>
        [WebMethod]
        public virtual void addChiaveConfigurazione(DocsPaVO.amministrazione.ChiaveConfigurazione chiaveConfig)
        {
            DocsPaConservazione.DocsPaConsManager.addChiaveConfigurazione(chiaveConfig);
        }

        [WebMethod]
        [XmlInclude(typeof(DocsPaVO.utente.Corrispondente))]

        public virtual DocsPaVO.utente.Corrispondente AddressbookGetCorrispondenteByIdPeople(string idPeople, DocsPaVO.addressbook.TipoUtente tipoIE, DocsPaVO.utente.InfoUtente u)
        {
            SetUserId(u);
            DocsPaVO.utente.Corrispondente corr = null;

            try
            {
                logger.Debug("WS > AddressbookGetCorrispondenteByIdPeople");
                corr = BusinessLogic.Utenti.UserManager.getCorrispondenteByIdPeople(idPeople, tipoIE, u);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AddressbookGetCorrispondenteByIdPeople - ", e);
            }
            return corr;
        }

        [WebMethod]
        [XmlInclude(typeof(DocsPaVO.utente.Corrispondente))]

        public virtual DocsPaVO.utente.Corrispondente AddressbookGetCorrispondenteCompletoBySystemId(string systemId, DocsPaVO.addressbook.TipoUtente tipoIE, DocsPaVO.utente.InfoUtente u)
        {
            SetUserId(u);
            DocsPaVO.utente.Corrispondente corr = null;

            try
            {
                logger.Debug("WS > AddressbookGetCorrispondenteCompletoBySystemId");
                corr = BusinessLogic.Utenti.UserManager.getCorrispondenteCompletoBySystemId(systemId, tipoIE, u);//.getCorrispondenteByIdPeople(idPeople, tipoIE, u);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AddressbookGetCorrispondenteCompletoBySystemId - ", e);
            }
            return corr;
        }

        [WebMethod]
        public virtual string AddressbookGetRuoloRespUoFromUo(string idCorrGlobaliUo, string tipoRuolo, string idCorr)
        {
            string result = string.Empty;

            try
            {
                logger.Debug("WS > AddressbookGetRuoloRespUoFromUo");
                result = BusinessLogic.Utenti.UserManager.getRuoloRespUofromUo(idCorrGlobaliUo, tipoRuolo, idCorr);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AddressbookGetRuoloRespUoFromUo - ", e);
            }
            return result;
        }


        [WebMethod]
        public virtual ArrayList getModelliByAmmConRicerca(string idAmm, string codiceRicerca, string tipoRicerca)
        {
            ArrayList listaModelli = new ArrayList();
            try
            {
                listaModelli = BusinessLogic.Trasmissioni.ModelliTrasmissioni.getModelliByAmmConRicerca(idAmm, codiceRicerca, tipoRicerca);
                return listaModelli;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getModelliByAmmConRicerca", e);
                return null;
            }
        }

        #region Gestione spedizione documento

        /// <summary>
        /// Reperimento delle informazioni relative alle spedizioni effettuate per un documento
        /// </summary>
        /// <param name="infoUtente">Utente che richiede le informazioni</param>
        /// <param name="documento">Documento oggetto della spedizione</param>
        /// <returns>
        /// Informazioni relative ai destinatari del documento
        /// </returns>
        [WebMethod(Description = "Reperimento delle informazioni relative alle spedizioni effettuate per un documento")]
        public DocsPaVO.Spedizione.SpedizioneDocumento GetSpedizioneDocumento(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.documento.SchedaDocumento documento)
        {
            SetUserId(infoUtente);
            return BusinessLogic.Spedizione.SpedizioneManager.GetSpedizioneDocumento(infoUtente, documento);
        }

        /// <summary>
        /// Reperimento dell'informazione sullo stato di spedizione di un protocollo in partenza.
        /// Per ottimizzazione.
        /// </summary>
        /// <param name="idDocument"></param>
        /// <returns></returns>
        [WebMethod(Description = "Controllo dell'avvenuta spedizione di un protocollo in partenza.")]
        public bool DocumentAlreadySent_Opt(string idDocument)
        {
            return BusinessLogic.Spedizione.SpedizioneManager.DocumentAlreadySent_Opt(idDocument);
        }

        /// <summary>
        /// Verifico se il documento  stato spedito, indipendentemente se a cossispondenti esterni o interni
        /// </summary>
        /// <param name="idDocument"></param>
        /// <returns></returns>
        [WebMethod]
        public bool CheckDocumentIsSent(string idDocument)
        {
            if (!string.IsNullOrEmpty(idDocument))
                return BusinessLogic.Documenti.DocManager.CheckDocumentIsSent(idDocument);
            else
                return false;
        }

        /// <summary>
        /// Reperimento dell'informazione sullo stato di Trasmissione di un protocollo interno.
        /// Per ottimizzazione.
        /// </summary>
        /// <param name="idDocument"></param>
        /// <returns></returns>
        [WebMethod(Description = "Controllo dell'avvenuta trasmissione di un protocollo interno.")]
        public bool DocumentAlreadyTransmitted_Opt(string idDocument)
        {
            return BusinessLogic.Trasmissioni.TrasmManager.DocumentAlreadyTransmitted_Opt(idDocument);
        }

        /// <summary>
        /// Task di spedizione di un documento
        /// </summary>
        /// <param name="infoUtente">Utente che richiede le informazioni</param>
        /// <param name="documento">Documento oggetto della spedizione</param>
        /// <param name="infoSpedizione"></param>
        /// <returns>
        /// Informazioni relative ai destinatari del documento successivamente alla spedizione
        /// </returns>
        [WebMethod(Description = "Task di spedizione di un documento ai destinatari richiesti")]
        public DocsPaVO.Spedizione.SpedizioneDocumento SpedisciDocumento(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.documento.SchedaDocumento documento, DocsPaVO.Spedizione.SpedizioneDocumento infoSpedizione)
        {
            SetUserId(infoUtente);
            BusinessLogic.Spedizione.SpedizioneManager.SpedisciDocumento(infoUtente, documento, infoSpedizione);
            if (!infoSpedizione.Spedito)
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOSPEDISCI", documento.docNumber, string.Format("{0}{1}", "Spedizione del doc: ", documento.docNumber), DocsPaVO.Logger.CodAzione.Esito.KO);
            else
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOSPEDISCI", documento.docNumber, string.Format("{0}{1}", "Spedizione del doc: ", documento.docNumber), DocsPaVO.Logger.CodAzione.Esito.OK);

            return infoSpedizione;
        }

        /// <summary>
        /// Task di spedizione automatica di un documento a tutti i destinatari
        /// </summary>
        /// <param name="infoUtente">Utente che richiede le informazioni</param>
        /// <param name="documento">Documento oggetto della spedizione</param>
        /// <returns></returns>
        [WebMethod(Description = "Task di spedizione automatica di un documento a tutti i destinatari")]
        public DocsPaVO.Spedizione.SpedizioneDocumento SpedisciDocumentoInAutomatico(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.documento.SchedaDocumento documento)
        {
            SetUserId(infoUtente);
            DocsPaVO.Spedizione.SpedizioneDocumento infoSpedizioni = null;
            infoSpedizioni = BusinessLogic.Spedizione.SpedizioneManager.SpedisciDocumento(infoUtente, documento);
            if (!infoSpedizioni.Spedito)
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOSPEDISCI", documento.docNumber, string.Format("{0}{1}", "Spedizione del doc: ", documento.docNumber), DocsPaVO.Logger.CodAzione.Esito.KO);
            else
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOSPEDISCI", documento.docNumber, string.Format("{0}{1}", "Spedizione del doc: ", documento.docNumber), DocsPaVO.Logger.CodAzione.Esito.OK);

            return infoSpedizioni;
        }

        /// <summary>
        /// Reperimento delle informazioni riguardo la modalit di spedizione del documento nell'ambito dell'amministrazione
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod(Description = "Reperimento delle informazioni riguardo la modalit di spedizione del documento nell'ambito dell'amministrazione")]
        public DocsPaVO.Spedizione.ConfigSpedizioneDocumento GetConfigSpedizioneDocumento(DocsPaVO.utente.InfoUtente infoUtente)
        {
            SetUserId(infoUtente);
            return BusinessLogic.Spedizione.SpedizioneManager.GetConfigSpedizioneDocumento(infoUtente);
        }

        /// <summary>
        /// PEC 4 - requisito 5 - storico spedizioni
        /// </summary>
        /// <param name="idDocument"></param>
        /// <returns></returns>
        [WebMethod(Description = "Prelievo elementi storico spedizione")]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.Spedizione.ElStoricoSpedizioni))]
        public virtual ArrayList SpedizioneGetElementiStoricoSpedizione(string idDocument)
        {
            return BusinessLogic.Spedizione.SpedizioneManager.GetElementiStoricoSpedizione(idDocument);
        }

        /// <summary>
        /// PEC 4 - requisito 4 - report spedizioni
        /// </summary>
        /// <param name="Filtrer">Elenco filtri</param>
        /// <returns></returns>
        [WebMethod(Description = "Lista report spedizioni")]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.Spedizione.InfoDocumentoSpedito))]
        public virtual List<DocsPaVO.Spedizione.InfoDocumentoSpedito> GetReportSpedizioni(DocsPaVO.Spedizione.FiltriReportSpedizioni filters, DocsPaVO.utente.InfoUtente infoUtente)
        {
            return BusinessLogic.Spedizione.SpedizioneManager.GetReportSpedizioni(filters, infoUtente);
        }

        [WebMethod(Description = "Lista report spedizioni documenti")]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.Spedizione.InfoDocumentoSpedito))]
        public virtual List<DocsPaVO.Spedizione.InfoDocumentoSpedito> GetReportSpedizioniDocumenti(DocsPaVO.Spedizione.FiltriReportSpedizioni filters, List<string> idDocumenti, DocsPaVO.utente.InfoUtente infoUtente)
        {
            return BusinessLogic.Spedizione.SpedizioneManager.GetReportSpedizioniDocumenti(filters, idDocumenti, infoUtente);
        }

        #endregion

        [WebMethod]
        public virtual ArrayList getListaExtFileAcquisiti(string idamm)
        {
            ArrayList fileAcquisiti = new ArrayList();
            try
            {
                fileAcquisiti = BusinessLogic.Documenti.DocManager.getListaExtFileAcquisiti(idamm);
                return fileAcquisiti;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getListaExtFileAcquisiti", e);
                return null;
            }
        }

        [WebMethod]
        public virtual ArrayList getModelliAssDiagrammi(string idTipo, string idDiagramma, string stato, string idAmm, bool selezionati, string tipo)
        {
            ArrayList listaModelli = new ArrayList();
            try
            {
                listaModelli = BusinessLogic.Trasmissioni.ModelliTrasmissioni.getModelliAssDiagrammi(idTipo, idDiagramma, stato, idAmm, selezionati, tipo);
                return listaModelli;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getModelliAssDiagrammi", e);
                return null;
            }
        }

        /// <summary>
        /// Verifica se  abilitata la funzione di protocollo titolario
        /// </summary>
        /// <returns></returns>
        [WebMethod]
        public virtual string isEnableContatoreTitolario()
        {
            return DocsPaUtils.Configuration.CustomConfigurationBaseManager.isEnableContatoreTitolario();
        }

        [WebMethod]
        public virtual string isEnableProtocolloTitolario()
        {
            return DocsPaUtils.Configuration.CustomConfigurationBaseManager.isEnableProtocolloTitolario();
        }

        /// <summary>
        /// Imposta le etichette di un titolario
        /// </summary>
        /// <returns></returns>
        [WebMethod]
        public virtual void setEtichetteTitolario(DocsPaVO.amministrazione.OrgTitolario titolario)
        {
            try
            {
                BusinessLogic.Amministrazione.TitolarioManager.setEtichetteTitolario(titolario);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: setEtichetteTitolario", e);
            }
        }

        /// <summary>
        /// Restituisce un nodo di titolario
        /// </summary>
        /// <returns></returns>
        [WebMethod]
        public virtual DocsPaVO.amministrazione.OrgNodoTitolario getNodoTitolarioById(string idNodoTitolario)
        {
            try
            {
                return BusinessLogic.Amministrazione.TitolarioManager.getNodoTitolario(idNodoTitolario);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getNodoTitolarioById", e);
                return null;
            }
        }

        /// <summary>
        /// Restituisce il numero di protocollo titolario
        /// </summary>
        /// <returns></returns>
        [WebMethod]
        public virtual int getContatoreProtTitolario(DocsPaVO.amministrazione.OrgNodoTitolario nodoTitolario)
        {
            try
            {
                return BusinessLogic.Amministrazione.TitolarioManager.getContatoreProtTitolario(nodoTitolario);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getContatoreProtTitolario", e);
                return 0;
            }
        }

        /// <summary>
        /// Restituisce il protocollo di titolario del documento
        /// </summary>
        /// <returns></returns>
        [WebMethod]
        public virtual string getProtocolloTitolario(DocsPaVO.documento.SchedaDocumento schedaDoc)
        {
            try
            {
                return BusinessLogic.Documenti.DocManager.getProtocolloTitolario(schedaDoc);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getProtocolloTitolario", e);
                return null;
            }
        }

        /// <summary>
        /// Restituisce i nodi di titolario a partire dal numero di protocollo titolario
        /// </summary>
        /// <returns></returns>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.amministrazione.OrgNodoTitolario))]
        public virtual ArrayList getNodiFromProtoTit(DocsPaVO.utente.Registro registro, string idAmministrazione, string numProtoPratica, string idTitolario)
        {
            try
            {
                return BusinessLogic.Amministrazione.TitolarioManager.getNodiFromProtoTit(registro, idAmministrazione, numProtoPratica, idTitolario);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getNodiFromProtoTit", e);
                return null;
            }
        }

        [WebMethod]
        public bool ereditaVisibilita(string idAmm, string idModello)
        {
            DocsPaDB.Query_DocsPAWS.Trasmissione trasm = new DocsPaDB.Query_DocsPAWS.Trasmissione();

            if (BusinessLogic.Amministrazione.AmministraManager.IsEnabledTrasmissioneAutomaticaAmm(idAmm) || !idModello.Equals("null"))
                return trasm.GetEstensioneVisibilita(idAmm, idModello);
            else
                return false;

        }


        #region DELEGHE
        [WebMethod]
        public virtual bool DelegaCreaNuova(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.Deleghe.InfoDelega delega)
        {
            SetUserId(infoUtente);
            bool result = false;
            try
            {
                result = BusinessLogic.Deleghe.DelegheManager.creaNuovaDelega(infoUtente, delega);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DelegaCreaNuova", e);
            }
            return result;
        }

        [WebMethod]
        public virtual bool DelegaModifica(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.Deleghe.InfoDelega delega, string tipoDelega, string idRuoloOld, string idUtenteOld, string dataScadenzaOld, string dataDecorrenzaOld, string idRuoloDeleganteOld)
        {
            SetUserId(infoUtente);
            bool result = false;
            try
            {
                result = BusinessLogic.Deleghe.DelegheManager.modificaDelega(infoUtente, delega, tipoDelega, idRuoloOld, idUtenteOld, dataScadenzaOld, dataDecorrenzaOld, idRuoloDeleganteOld);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DelegaModifica", e);
            }
            return result;
        }

        [WebMethod]
        public virtual bool DelegaModificaAmm(DocsPaVO.Deleghe.InfoDelega delegaOld, DocsPaVO.Deleghe.InfoDelega delegaNew, string tipoDelega, string dataScadenzaOld, string dataDecorrenzaOld)
        {
            bool result = false;
            try
            {
                result = BusinessLogic.Deleghe.DelegheManager.modificaDelegaAmm(delegaOld, delegaNew, tipoDelega, dataScadenzaOld, dataDecorrenzaOld);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DelegaModificaAmm", e);
            }
            return result;
        }


        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.Deleghe.InfoDelega))]
        public virtual ArrayList DelegaGetLista(DocsPaVO.utente.InfoUtente infoUtente, string tipoDelega, string statoDelega, string idAmm, out int numDeleghe)
        {
            SetUserId(infoUtente);
            ArrayList deleghe = null;
            numDeleghe = 0;
            try
            {
                deleghe = BusinessLogic.Deleghe.DelegheManager.getListaDeleghe(infoUtente, tipoDelega, statoDelega, idAmm, out numDeleghe);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetDelegheAssegnate", e);
            }
            return deleghe;
        }

        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.Deleghe.InfoDelega))]
        public virtual List<InfoDelega> DelegaSearch(InfoUtente utente, SearchDelegaInfo searchInfo, ref SearchPagingContext pagingContext)
        {
            SetUserId(utente);
            List<InfoDelega> deleghe = null;
            try
            {
                deleghe = BusinessLogic.Deleghe.DelegheManager.searchDeleghe(utente, searchInfo, pagingContext);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DelegaSearch", e);
            }
            return deleghe;
        }

        [WebMethod]
        public virtual DocsPaVO.utente.Utente DelegaEsercita(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.utente.UserLogin login, string webSessionId, string id_delega, string idRuoloDelegante, out DocsPaVO.utente.UserLogin.LoginResult loginResult)
        {
            SetUserId(infoUtente);
            DocsPaVO.utente.Utente utente = null;
            loginResult = DocsPaVO.utente.UserLogin.LoginResult.OK;
            try
            {
                utente = BusinessLogic.Deleghe.DelegheManager.esercitaDelega(infoUtente, login, webSessionId, id_delega, idRuoloDelegante, out loginResult);
                if (utente != null)
                    BusinessLogic.UserLog.UserLog.WriteLog(utente.userId, utente.idPeople, login.IdAmministrazione, ((DocsPaVO.utente.Corrispondente)(utente)).idAmministrazione, "ESERCITADELEGA", utente.systemId, utente.systemId, DocsPaVO.Logger.CodAzione.Esito.OK, null);
            }
            catch (Exception e)
            {
                logger.Debug("Errore durante il webmethod DelegaEsercita", e);
                if (utente != null)
                    BusinessLogic.UserLog.UserLog.WriteLog(null, utente.idPeople, null, null, "ESERCITADELEGA", null, utente.systemId, DocsPaVO.Logger.CodAzione.Esito.KO, null);
            }
            return utente;
        }



        [WebMethod]
        public virtual bool DelegaDismetti(DocsPaVO.utente.InfoUtente infoUtente, string userIdDelegante)
        {
            SetUserId(infoUtente);
            bool result = false;
            try
            {
                result = BusinessLogic.Deleghe.DelegheManager.dismettiDelega(infoUtente, userIdDelegante);
            }
            catch (Exception e)
            {
                logger.Debug("Errore durante il webmethod DelegaDismetti", e);
            }
            return result;
        }

        [WebMethod]
        public virtual bool DelegaRevoca(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.Deleghe.InfoDelega[] listaDeleghe, out string msg)
        {
            SetUserId(infoUtente);
            bool result = false;
            msg = string.Empty;
            try
            {
                result = BusinessLogic.Deleghe.DelegheManager.revocaDelega(infoUtente, listaDeleghe, out msg);
            }
            catch (Exception e)
            {
                logger.Debug("Errore durante il web method DelegaRevoca", e);
            }
            return result;
        }

        [WebMethod]
        public virtual bool DelegaVerificaUnicaAssegnata(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.Deleghe.InfoDelega delega)
        {
            SetUserId(infoUtente);
            bool result = false;
            try
            {
                result = BusinessLogic.Deleghe.DelegheManager.verificaUnicaDelega(infoUtente, delega);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DelegaVerificaUnicaAssegnata", e);
            }
            return result;
        }

        [WebMethod]
        public virtual int DelegaCheckAttiva(DocsPaVO.utente.InfoUtente infoUtente)
        {
            SetUserId(infoUtente);
            int result = 0;
            try
            {
                result = BusinessLogic.Deleghe.DelegheManager.checkDelegaAttiva(infoUtente);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DelegaCheckAttiva", e);
            }
            return result;
        }


        [WebMethod]
        public virtual bool DelegaVerificaUnicaAssegnataAmm(DocsPaVO.Deleghe.InfoDelega delega)
        {
            bool result = false;
            try
            {
                result = BusinessLogic.Deleghe.DelegheManager.verificaUnicaDelegaAmm(delega);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DelegaVerificaUnicaAssegnata", e);
            }
            return result;
        }

        #endregion
        [WebMethod]
        public bool importOrganigramma(DocsPaVO.utente.InfoUtente infoUtente, byte[] dati)
        {
            SetUserId(infoUtente);
            try
            {
                //string serverPath = System.Configuration.ConfigurationManager.AppSettings["MODELS_ROOT_PATH"];
                // PALUMBO: modificato per ovviare al blocco dell'accesso su macchina 20 in scrittura    
                //string serverPath = System.Configuration.ConfigurationManager.AppSettings["LOG_PATH"];
                string serverPath = System.Configuration.ConfigurationManager.AppSettings["DOC_ROOT"];
                serverPath = System.IO.Path.Combine(serverPath, DateTime.Now.ToString("yyyyMMdd"));


                bool result = BusinessLogic.Amministrazione.OrganigrammaManager.importOrganigramma(dati, "importazioneOrganigramma.xls", serverPath, infoUtente);
                return result;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: importaOrganigramma", e);
                return false;
            }
        }

        [WebMethod]
        [return: XmlArray()]
        public virtual ArrayList getLogImportOrganigramma()
        {
            ArrayList logFile = new ArrayList();

            try
            {
                //string serverPath = System.Configuration.ConfigurationManager.AppSettings["MODELS_ROOT_PATH"];
                // PALUMBO: modificato per ovviare al blocco dell'accesso su macchina 20 in scrittura    
                //string serverPath = System.Configuration.ConfigurationManager.AppSettings["LOG_PATH"];
                string serverPath = System.Configuration.ConfigurationManager.AppSettings["DOC_ROOT"];
                serverPath = System.IO.Path.Combine(serverPath, DateTime.Now.ToString("yyyyMMdd"));

                logFile = BusinessLogic.Amministrazione.OrganigrammaManager.getLogImportOrganigramma(serverPath);
                return logFile;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getLogImportOrganigramma", e);
                return logFile;
            }
        }

        [WebMethod]
        public virtual DocsPaVO.ProfilazioneDinamica.Templates getTemplateFascCampiComuniById(DocsPaVO.utente.InfoUtente infoUtente, string idTemplate)
        {
            try
            {
                SetUserId(infoUtente);
                return BusinessLogic.ProfilazioneDinamica.ProfilazioneFascicoli.getTemplateFascCampiComuniById(infoUtente, idTemplate);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getTemplateFascCampiComuniById", e);
                return null;
            }
        }

        [WebMethod]
        public virtual string getFirstDayOfWeek()
        {
            try
            {
                return BusinessLogic.Documenti.InfoDocManager.getFirstDayOfWeek();
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getFirstDayOfWeek", e);
                return null;
            }
        }

        [WebMethod]
        public virtual string getFirstDayOfMonth()
        {
            try
            {
                return BusinessLogic.Documenti.InfoDocManager.getFirstDayOfMonth();
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getFirstDayOfMonth", e);
                return null;
            }
        }

        [WebMethod]
        public virtual string getLastDayOfWeek()
        {
            try
            {
                return BusinessLogic.Documenti.InfoDocManager.getLastDayOfWeek();
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getLastDayOfWeek", e);
                return null;
            }
        }

        [WebMethod]
        public virtual string getLastDayOfMonth()
        {
            try
            {
                return BusinessLogic.Documenti.InfoDocManager.getLastDayOfMonth();
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getLastDayOfMonth", e);
                return null;
            }
        }

        [WebMethod]
        public virtual string toDay()
        {
            try
            {
                return BusinessLogic.Documenti.InfoDocManager.toDay();
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: toDay", e);
                return null;
            }
        }

        [WebMethod]
        public virtual string toFirstDayOfYear()
        {
            try
            {
                return BusinessLogic.Documenti.InfoDocManager.toFirstDayOfYear();
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: toFirstDayOfYear", e);
                return null;
            }
        }

        [WebMethod]
        public virtual string GetYesterday()
        {
            try
            {
                return BusinessLogic.Documenti.InfoDocManager.GetYesterday();
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetYesterday", e);
                return null;
            }
        }

        [WebMethod]
        public virtual string GetLastSevenDay()
        {
            try
            {
                return BusinessLogic.Documenti.InfoDocManager.GetLastSevenDay();
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetLastSevenDay", e);
                return null;
            }
        }

        [WebMethod]
        public virtual string GetLastThirtyOneDay()
        {
            try
            {
                return BusinessLogic.Documenti.InfoDocManager.GetLastThirtyOneDay();
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetLastThirtyOneDay", e);
                return null;
            }
        }

        [WebMethod]
        public virtual bool isEnableRiferimentiMittente()
        {
            return DocsPaUtils.Configuration.CustomConfigurationBaseManager.isEnableRiferimentiMittente();
        }

        [WebMethod]
        public virtual void creaRiscontroMittente(DocsPaVO.fascicolazione.RiscontroMittente riscontroMittente)
        {
            try
            {
                BusinessLogic.Fascicoli.FascicoloManager.creaRiscontroMittente(riscontroMittente);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: creaRiscontroMittente", e);
            }
        }

        [WebMethod]
        public virtual void eliminaRiscontroMittente(DocsPaVO.fascicolazione.RiscontroMittente riscontroMittente)
        {
            try
            {
                BusinessLogic.Fascicoli.FascicoloManager.eliminaRiscontroMittente(riscontroMittente);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: eliminaRiscontroMittente", e);
            }
        }

        [WebMethod]
        public virtual DocsPaVO.fascicolazione.RiscontroMittente cercaRiscontroMittente(DocsPaVO.fascicolazione.RiscontroMittente riscontroMittente)
        {
            try
            {
                return BusinessLogic.Fascicoli.FascicoloManager.cercaRiscontroMittente(riscontroMittente);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: cercaRiscontroMittente", e);
                return null;
            }
        }

        [WebMethod]
        public DocsPaVO.utente.Canale associaCanalePrefDestinatario(string idProfile, string idDestinatario)
        {
            try
            {
                return BusinessLogic.Documenti.InfoDocManager.associaCanalePrefDestinatario(idProfile, idDestinatario);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: associaCanalePrefDestinatario", e);
                return null;
            }
        }

        [WebMethod]
        public DocsPaVO.utente.Canale getCanaleBySystemId(string idDocumenttypes)
        {
            try
            {
                return BusinessLogic.Documenti.InfoDocManager.getCanaleBySystemId(idDocumenttypes);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getCanaleBySystemId", e);
                return null;
            }
        }

        [WebMethod]
        public int getNumFolderDoc(string idProfile)
        {
            try
            {
                return BusinessLogic.Documenti.InfoDocManager.getNumFolderDoc(idProfile);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getNumFolderDoc", e);
                return -1;
            }
        }

        #region Gestione Export Fascicolo

        /// <summary>
        /// Web service per l'esportazione delle metainfrmazioni relative ad un fascicolo,
        /// ai suoi sottofascicoli e ai documenti contenuti nel fascicolo e nei suoi 
        /// sottofascicoli.
        /// </summary>
        /// <param name="requestAsXml">Richiesta xml serializzata</param>
        /// <returns></returns>
        [WebMethod()]
        public string GetInfoFascicoloAsXml(string requestAsXml)
        {
            // Deserializzazione contenuto xml
            DocsPaVO.ExportFascicolo.ExportFascicoloRequest request = DocsPaVO.ExportFascicolo.ExportFascicoloRequest.Parse(requestAsXml);

            DocsPaVO.ExportFascicolo.MetaInfoFascicolo fascicolo = BusinessLogic.ExportFascicolo.ExportFascicoloManager.GetInfoFascicolo(request.UserInfo, request.IdFascicolo);

            return DocsPaVO.ExportFascicolo.ExportFascicoloRequest.ToXml(fascicolo);
        }

        /// <summary>
        /// Web service per l'esportazione con applet delle metainfrmazioni relative ad un fascicolo,
        /// ai suoi sottofascicoli e ai documenti contenuti nel fascicolo e nei suoi 
        /// sottofascicoli.
        /// </summary>
        /// <param name="UserInfo">InfoUtente</param>
        /// <param name="IdFascicolo">String</param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.ExportFascicolo.MetaInfoFascicolo GetInfoFascicolo(InfoUtente UserInfo, string IdFascicolo)
        {
            DocsPaVO.ExportFascicolo.MetaInfoFascicolo fascicolo = null;
            try
            {
                fascicolo = BusinessLogic.ExportFascicolo.ExportFascicoloManager.GetInfoFascicolo(UserInfo, IdFascicolo);
            }
            catch (Exception ex)
            {
                logger.Debug(ex.Message.ToString());
            }

            return fascicolo;
        }

        /// <summary>
        /// Web service per l'esportazione con applet del documento relativo ad un fascicolo.
        /// </summary>
        /// <param name="UserInfo">InfoUtente</param>
        /// <param name="docNumber">String</param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.ExportFascicolo.ContentDocumento GetFileDocumento(InfoUtente UserInfo, string docNumber)
        {
            DocsPaVO.ExportFascicolo.ContentDocumento contentDocumento = null;
            try
            {
                contentDocumento = BusinessLogic.ExportFascicolo.ExportFascicoloManager.GetFileDocumento(UserInfo, docNumber);
                logger.Debug(contentDocumento.FileContent.Length.ToString());
            }
            catch (Exception ex)
            {
                logger.Debug(ex.Message.ToString());
            }

            return contentDocumento;
        }

        /// <summary>
        /// Web service per la richiesta del file di un documento
        /// </summary>
        /// <param name="requestAsXml"></param>
        /// <returns></returns>
        [WebMethod()]
        public string GetFileDocumentoAsXml(string requestAsXml)
        {
            // Deserializzazione contenuto xml
            DocsPaVO.ExportFascicolo.DocumentoRequest request = DocsPaVO.ExportFascicolo.DocumentoRequest.Parse(requestAsXml);
            DocsPaVO.ExportFascicolo.ContentDocumento contentDocumento = null;
            if (request.numDocumento.StartsWith("OFN-FASCID:"))
                contentDocumento = BusinessLogic.ExportFascicolo.ExportFascicoloManager.GeneraReportOfn(request.UserInfo, request.numDocumento.Replace("OFN-FASCID:", string.Empty));
            else
                contentDocumento = BusinessLogic.ExportFascicolo.ExportFascicoloManager.GetFileDocumento(request.UserInfo, request.numDocumento);

            if (contentDocumento != null)
                return DocsPaVO.ExportFascicolo.DocumentoRequest.ToXml(contentDocumento);
            else
                return string.Empty;
        }


        #endregion
        [WebMethod()]
        public bool resetCacheQuery(string password)
        {
            // Deserializzazione contenuto xml
            try
            {
                if (password.ToLower() == "valueteam")
                {
                    DocsPaUtils.InitQuery.resetInstance();
                    return true;
                }
                else return false;
            }
            catch (Exception ex)
            {
                logger.Debug(ex.Message.ToString());
                return false;
            }



        }
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(string))]
        public virtual ArrayList SmistaGetRegistriRuolo(string idRuolo)
        {
            ArrayList retValue = null;

            try
            {
                retValue = BusinessLogic.SmistamentoDocumenti.SmistamentoManager.GetListaRegistriRuolo(idRuolo);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: SmistaGetRegistriRuolo - ", e);
            }

            return retValue;
        }

        [WebMethod]
        public virtual void getDatiAggiuntiviUtenteSmistamento(ref DocsPaVO.Smistamento.UtenteSmistamento utenteSmistamento, string idUtente)
        {
            try
            {
                BusinessLogic.SmistamentoDocumenti.SmistamentoManager.GetDatiAggUtente(ref utenteSmistamento, idUtente);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getDatiAggiuntiviUtenteSmistamento - ", e);
            }
        }

        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.Smistamento.UtenteSmistamento))]
        public virtual ArrayList getUtentiRuoloSmistamento(string id, string queryParam)
        {
            ArrayList result = null;
            try
            {
                result = BusinessLogic.SmistamentoDocumenti.SmistamentoManager.GetUtentiSmistamentoRuolo(id, queryParam);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getUtentiRuoloSmistamento - ", e);
            }
            return result;
        }

        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.Smistamento.RuoloSmistamento))]
        //[XmlInclude(typeof(DocsPaVO.Smistamento.RuoloSmistamento))]  //AGGIUNTO 
        public virtual ArrayList getRuoliUoSmistamento(string idUo)
        {
            ArrayList result = null;
            try
            {
                result = BusinessLogic.SmistamentoDocumenti.SmistamentoManager.GetRuoliUoSmista(idUo);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getUtentiRuoloSmistamento - ", e);
            }
            return result;
        }
        [WebMethod]
        public virtual bool FunzioneEsistente(string codiceFunzione)
        {
            bool result = false;
            try
            {
                result = BusinessLogic.Amministrazione.FunzioniManager.FunzioneEsistente(codiceFunzione);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FunzioneEsistente - ", e);
            }
            return result;

        }
        [WebMethod]
        public virtual bool RefreshQueryList(string password)
        {
            bool rtn = false;
            try
            {
                DocsPaUtils.InitQuery.resetInstance();
                //Aggiorna chiavi di configurazione
                DocsPaUtils.Configuration.InitConfigurationKeys.resetKeys();
                //Aggiornamento griglie
                BusinessLogic.Grids.GridManager.refreshAllGrid();
                rtn = true;
                return rtn;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: RefreshQueryList - ", e);
                return rtn;
            }

        }
        [WebMethod]
        public virtual bool InteroperabilitaRicezioneProtocollazione(string serverName, DocsPaVO.utente.Registro reg, DocsPaVO.utente.Utente ut, DocsPaVO.utente.Ruolo ruolo, out DocsPaVO.Interoperabilita.MailAccountCheckResponse mailCheckResponse)
        {
            SetUserId(ut);
            bool result = true; // Presume successo
            mailCheckResponse = null;

            DocsPaVO.Logger.CodAzione.Esito esito = DocsPaVO.Logger.CodAzione.Esito.OK;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Interoperabilit.InteroperabilitaRicezione.interopRiceviMethodProtocollazione(serverName, reg, ut, ruolo, null, out mailCheckResponse);
#if TRACE_WS
				pt.WriteLogTracer("InteroperabilitaRicezione");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: InteroperabilitaRicezione", e);
                result = false;

                esito = DocsPaVO.Logger.CodAzione.Esito.KO;
            }
            finally
            {
                string email = reg.email;
                if (email == null || email == string.Empty)
                    email = "NON DEFINITO";

                string logInfo = "Registro: " + reg.codRegistro + " - " +
                                "Indirizzo mail: " + email + " - ";

                if (mailCheckResponse.ErrorMessage != string.Empty)
                {
                    logInfo += "Errore nella connessione al server di posta";
                    esito = DocsPaVO.Logger.CodAzione.Esito.KO;
                }
                else if (mailCheckResponse.InvalidMailProcessedCount > 0)
                {
                    logInfo += mailCheckResponse.InvalidMailProcessedCount.ToString() + " messaggi non processati";
                    esito = DocsPaVO.Logger.CodAzione.Esito.KO;
                }
                else
                {
                    logInfo += "Processati " + mailCheckResponse.MailProcessedList.Count.ToString() + " messaggi";
                }

                BusinessLogic.UserLog.UserLog.WriteLog(
                            ut.userId,
                            ut.idPeople,
                            ((DocsPaVO.utente.Ruolo)ut.ruoli[0]).idGruppo,
                            ut.idAmministrazione,
                            "INTEROPERABILITARICEZIONE",
                            reg.systemId,
                            logInfo,
                            esito, null);
            }

            return result;
        }



        #region cache
        //modifica
        [WebMethod]
        public DocsPaVO.Caching.CacheConfig getConfigurazioneCache(string idAmministrazione)
        {
            DocsPaVO.Caching.CacheConfig config = null;
            try
            {
                config = BusinessLogic.Documenti.CacheFileManager.GetInstance(idAmministrazione);
            }
            catch (Exception e)
            {
                logger.Debug("errore nel web method getconfigurazionecache errore: " + e.Message);
            }

            return config;
        }

        //        [WebMethod]
        //        public string ricercaPathInCache(DocsPaVO.Caching.InfoFileCaching info)
        //        {
        //            DocsPaDB.Query_DocsPAWS.Caching query = new DocsPaDB.Query_DocsPAWS.Caching();
        //            return query.recuperaPathCache(info);
        //        }



        [WebMethod]
        public bool setConfigurazioneCache(DocsPaVO.Caching.CacheConfig info)
        {
            bool resul = false;
            try
            {
                resul = BusinessLogic.Documenti.CacheFileManager.setConfigurazioneCache(info);
            }
            catch (Exception e)
            {
                logger.Debug("errore nel web method setconfigurazionecache errore: " + e.Message);
            }

            //        [WebMethod]
            //        public string recuperaPathComponents(string docNumber, string versionId)
            //        {
            //            DocsPaDB.Query_DocsPAWS.Caching query = new DocsPaDB.Query_DocsPAWS.Caching();
            //            return query.recuperaPathComponents(docNumber, versionId);
            //        }

            return resul;
        }
        [WebMethod]
        public bool updateConfigurazioneCache(DocsPaVO.Caching.CacheConfig info)
        {
            bool result = false;
            try
            {
                result = BusinessLogic.Documenti.CacheFileManager.updateConfigurazioneCache(info);
            }
            catch (Exception e)
            {
                logger.Debug("errore nel web method updateconfigurazionecache errore: " + e.Message);
            }
            return result;

        }
        [WebMethod]
        public void deleteConfigurazioneCache(string idAmministrazione)
        {
            try
            {
                BusinessLogic.Documenti.CacheFileManager.deleteConfigurazioneCache(idAmministrazione);
            }
            catch (Exception e)
            {
                logger.Debug("errore nel web method deleteconfigurazionecache errore: " + e.Message);
            }
        }

        [WebMethod]
        public string ricercaPathInCache(DocsPaVO.Caching.InfoFileCaching info)
        {
            string path = string.Empty;
            try
            {
                path = BusinessLogic.Documenti.CacheFileManager.ricercaPathCaching(info.DocNumber.ToString(), info.Version_id.ToString(), info.idAmministrazione);
            }
            catch (Exception e)
            {
                logger.Debug("errore nel web method ricvercapathincache errore: " + e.Message);
            }

            return path;
        }

        [WebMethod]
        public DocsPaVO.Caching.InfoFileCaching massimaVersioneDelDocumento(string docNumber)
        {
            DocsPaVO.Caching.InfoFileCaching Info = null;
            try
            {
                Info = BusinessLogic.Documenti.CacheFileManager.massimaVersioneDelDocumento(docNumber);
            }
            catch (Exception e)
            {
                logger.Debug("errore nel web method massimaversionedeldocumento errore: " + e.Message);
            }

            return Info;
        }

        //[WebMethod]
        //public bool inCache1(string docNumber, string versionId, string idAmministrazione)
        //{
        //    bool result = false;
        //    try
        //    {

        //        DocsPaVO.documento.FileRequest fr = new DocsPaVO.documento.FileRequest();
        //        fr.docNumber = docNumber;
        //        fr.versionId = versionId;
        //        result = BusinessLogic.Documenti.CacheFileManager.verificaEsistenzaFileInCache(fr, idAmministrazione);
        //    }
        //    catch (Exception e)
        //    {
        //        logger.Debug("errore nel web method inccache1 " + e.Message);
        //    }

        //    return result;

        //}

        [WebMethod]
        public string recuperaPathComponents(string docNumber, string versionId)
        {
            string path = string.Empty;
            try
            {
                path = BusinessLogic.Documenti.CacheFileManager.ricercaPathComponents(docNumber, versionId);
            }
            catch (Exception e)
            {
                logger.Debug("errore nel web method recuperaPathcomponents errore: " + e.Message);
            }

            return path;
        }

        [WebMethod]
        public bool inCache(string docNumber, string versionId, string idAmministrazione)
        {
            bool result = false;
            try
            {
                DocsPaVO.documento.FileRequest fr = new DocsPaVO.documento.FileRequest();
                fr.docNumber = docNumber;
                fr.versionId = versionId;
                result = BusinessLogic.Documenti.CacheFileManager.verificaEsistenzaFileInCache(fr, idAmministrazione);
            }
            catch (Exception e)
            {
                logger.Debug("errore nel web method incache errore: " + e.Message);
            }

            return result;
        }


        [WebMethod]
        public DocsPaVO.documento.FileRequest FileInCache(DocsPaVO.documento.FileRequest fileRequest, string idAmministrazione)
        {
            DocsPaVO.documento.FileRequest fr = null;
            try
            {
                fr = BusinessLogic.Documenti.CacheFileManager.FileInCache(fileRequest, idAmministrazione);
            }
            catch (Exception e)
            {
                logger.Debug("errore nel web method fileincache errore: " + e.Message);
            }


            return fr;
        }

        [WebMethod]
        public DocsPaVO.Caching.InfoFileCaching getFileInCache(string docNumber, string versionId, string idAmministrazione)
        {
            DocsPaVO.Caching.InfoFileCaching info = null;
            try
            {
                info = BusinessLogic.Documenti.CacheFileManager.getFileDaCache(docNumber, versionId, idAmministrazione);
            }
            catch (Exception e)
            {
                logger.Debug("errore nel web method getfileincache errore: " + e.Message);
            }

            return info;
        }

        [WebMethod]
        public DocsPaVO.Caching.InfoFileCaching getFileInCacheByDocNumber(string docNumber)
        {
            DocsPaVO.Caching.InfoFileCaching info = null;
            try
            {
                info = BusinessLogic.Documenti.CacheFileManager.getFileDaCache(docNumber);
            }
            catch (Exception e)
            {
                logger.Debug("errore nel web method getfileincache errore: " + e.Message);
            }

            return info;
        }

        [WebMethod]
        public byte[] streamFileDalServerGenerale(string docnumber, string versionId)
        {
            byte[] stream = null;
            try
            {
                stream = BusinessLogic.Documenti.CacheFileManager.streamFileDalServerGenerale(docnumber, versionId);
            }
            catch (Exception e)
            {
                logger.Debug("errore nel web method streamfiledalservergenerale errore: " + e.Message);
            }

            return stream;

        }


        [WebMethod]
        public bool isActiveCache(string idAmministrazione)
        {
            try
            {

                return BusinessLogic.Documenti.CacheFileManager.isActiveCaching(idAmministrazione);
            }
            catch (Exception e)
            {
                logger.Debug("Errore nel web method isActiveCache: " + e.Message);
            }

            return false;
        }


        #endregion

        [WebMethod]
        public virtual DocsPaVO.LiveCycle.ProcessFormOutput ProcessFormPdf(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.LiveCycle.ProcessFormInput processFormInput)
        {
            try
            {
                SetUserId(infoUtente);
                return BusinessLogic.LiveCycle.LiveCycle.processFormPdf(infoUtente, processFormInput);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: processFormPdf - ", e);
                return null;
            }
        }

        /// <summary>
        /// Web service per l'invocazione del servizio di conversione PDF sincrona
        /// </summary>
        /// <param name="docToConvert">Oggetto con le informazioni sul documento da convertire</param>
        /// <returns>Un oggetto con le informazioni sul documento convertito in PDF</returns>
        [WebMethod]
        public virtual DocsPaVO.documento.FileDocumento GeneratePDFInSyncMod(DocsPaVO.documento.FileDocumento docToConvert)
        {
            logger.Info("BEGIN");
            try
            {
                return BusinessLogic.LiveCycle.LiveCycle.GeneratePDFInSyncMod(docToConvert);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: processFormPdf - ", e);
                return null;
            }
            logger.Info("END");
        }


        [WebMethod]
        [XmlInclude(typeof(DocsPaVO.utente.Corrispondente))]
        public virtual DocsPaVO.utente.Corrispondente GetCorrRubricaComune(string codice, DocsPaVO.utente.InfoUtente u)
        {
            SetUserId(u);
            DocsPaVO.utente.Corrispondente corr = null;

            try
            {
                logger.Debug("WS > AddressbookGetCorrispondenteByCodRubrica");
                corr = BusinessLogic.Utenti.UserManager.getCorrispondenteByCodRubricaRubricaComune(codice, u);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getCorrispondenteByCodRubricaRubricaComune - ", e);
            }
            return corr;
        }

        [WebMethod]
        public virtual DocsPaVO.LiveCycle.ProcessFormOutput ProcessBarcodeFormPdf(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.LiveCycle.ProcessFormInput processFormInput)
        {
            try
            {
                SetUserId(infoUtente);
                return BusinessLogic.LiveCycle.LiveCycle.processBarcodeFormPdf(infoUtente, processFormInput);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ProcessBarcodeFormPdf - ", e);
                return null;
            }
        }

        //[WebMethod]
        //[return: XmlArray()]
        //[return: XmlArrayItem(typeof(DocsPaVO.rubrica.ElementoRubrica))]
        //public virtual ArrayList rubricaGetElementiRubricaControl(string cod, DocsPaVO.utente.InfoUtente u, DocsPaVO.rubrica.SmistamentoRubrica smistamentoRubrica)
        //{

        //    try
        //    {
        //        logger.Debug("WS > rubricaGetElementiRubricaControl");
        //        BusinessLogic.Rubrica.DPA3_RubricaSearchAgent ccs = new BusinessLogic.Rubrica.DPA3_RubricaSearchAgent(u);
        //        return ccs.SearchForCorr(cod, smistamentoRubrica);
        //    }
        //    catch (Exception e)
        //    {
        //        logger.Debug("Errore in DocsPaWS.asmx  - metodo: rubricaGetElementiRubricaControl - ", e);
        //        return null;
        //    }
        //}

        /// <summary>
        /// Data il system_id di una tipologia fascicolo restituisce la lista dei suoi attributi 
        /// </summary>
        /// <param name="idTipoFasc"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual DocsPaVO.ProfilazioneDinamica.Templates getAttributiTipoFasc(DocsPaVO.utente.InfoUtente infoUtente, string idTipoFasc)
        {
            SetUserId(infoUtente);
            DocsPaVO.ProfilazioneDinamica.Templates result = null;
            try
            {
                return BusinessLogic.ProfilazioneDinamica.ProfilazioneFascicoli.getAttributiTipoFasc(infoUtente, idTipoFasc);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getAttributiTipoFasc", e);
                result = null;
            }
            return result;
        }

        /// <summary>
        /// web method ch epermette la ricerca di elementi nella rubrica utilizzando i parametri di ricerca 
        /// </summary>
        /// <param name="qc">oggetto contenente i parametri di ricreca</param>
        /// <param name="infoUtente">oggetto infoutente</param>
        /// <returns>ritorna un arraylist pieno nel caso in cui trova elementi altrimenti null</returns>
        [WebMethod]
        public virtual ArrayList GetElementiRubrica(DocsPaVO.rubrica.ParametriRicercaRubrica qc, DocsPaVO.utente.InfoUtente infoUtente)
        {
            SetUserId(infoUtente);
            if (qc != null)
            {
                DocsPaDB.Query_DocsPAWS.Rubrica query = new DocsPaDB.Query_DocsPAWS.Rubrica(infoUtente);
                ArrayList Spartacus = query.GetElementiRubrica(qc);
                return Spartacus;
            }

            return null;
        }
        /// <summary>
        /// Servizio web per il reprimento delle informazioni di base su uno specifico documento e sui
        /// suoi eventuali allegati
        /// </summary>
        /// <param name="idProfile">L'id del documento di cui recuperare le informazioni</param>
        /// <param name="docNumber">Il numero del documento</param>
        /// <param name="versionNumber">Il numero di versione</param>
        /// <returns>Le informazioni di base sul documento richiesto e sui suoi allegati</returns>
        [WebMethod]
        [XmlInclude(typeof(DocsPaVO.documento.BaseInfoDoc))]
        public virtual System.Collections.Generic.List<DocsPaVO.documento.BaseInfoDoc> GetBaseInfoForDocument(string idProfile, string docNumber, string versionNumber)
        {
            try
            {
                return BusinessLogic.Documenti.DocManager.GetBaseInfoForDocument(idProfile,
                    docNumber, versionNumber);
            }
            catch (Exception e)
            {
                throw e;
            }
        }

        #region Importazione

        #region Importazione fascicoli

        /// <summary>
        /// Servizio web per l'importazione di fascicoli a partire da dati riportati all'interno di un
        /// file Excel
        /// </summary>
        /// <param name="content">Il contenuto del file Excel</param>
        /// <param name="fileName">Il nome da attribuire al file temporaneo</param>
        /// <param name="serverPath">Il path del frontend</param>
        /// <param name="userInfo">Le informazioni sull'utente che ha lanciato la procedura</param>
        /// <param name="role">Il ruolo dell'utente che ha lanciato la procedura</param>
        /// <param name="isSmistamentoEnabled">True se  abilitato lo smistamento</param>
        /// <returns>Un array rappresentante un report dell'esecuzione</returns>
        [WebMethod(Description = "Web service per l'importazione di fascicoli a partire da dati riportati all'interno di un file Excel.")]
        [XmlInclude(typeof(DocsPaVO.PrjDocImport.ImportResult))]
        public virtual System.Collections.Generic.List<DocsPaVO.PrjDocImport.ImportResult>
            ImportProjects(byte[] content,
                    string fileName,
                    string serverPath,
                    DocsPaVO.utente.InfoUtente userInfo,
                    DocsPaVO.utente.Ruolo role,
                    bool isSmistamentoEnabled)
        {
            try
            {
                SetUserId(userInfo);
                return new BusinessLogic.Import.ImportProjects.ImportProjects().ImportProject(
                    content,
                    fileName,
                    serverPath,
                    // PALUMBO: modificato per ovviare al blocco dell'accesso su macchina 20 in scrittura
                    //System.Configuration.ConfigurationManager.AppSettings["MODELS_ROOT_PATH"],
                    DocsPaUtils.Configuration.InitConfigurationKeys.GetValue("0", "BE_LOG_PATH"),
                    userInfo,
                    role,
                    isSmistamentoEnabled);

            }
            catch (Exception e)
            {
                logger.Debug(
                    String.Format("Errore durante l'importazione dei fascicoli. Dettagli: {0}",
                        e.Message));

                return new System.Collections.Generic.List<DocsPaVO.PrjDocImport.ImportResult>()
                    {
                        new DocsPaVO.PrjDocImport.ImportResult()
                            {
                                Message = e.Message,
                                Outcome = DocsPaVO.PrjDocImport.ImportResult.OutcomeEnumeration.KO
                            }
                    };
            }

        }

        /// <summary>
        /// Metodo web per la lettura di dati su fascicoli da foglio Excel
        /// </summary>
        /// <param name="content">Il contenuto del foglio Excel da cui estrarre i dati</param>
        /// <param name="fileName">Il nome del file temporaneo</param>
        /// <param name="userInfo">Le informazioni sull'utente che ha lanciato la procedura</param>
        /// <param name="role">Il ruolo con cui  stata lanciata la procedura</param>
        /// <returns>La lista dei dati sui fascicoli descritti all'interno del foglio Excel</returns>
        [WebMethod(Description = "Metodo Web per la lettura di dati su fascicoli da foglio excel")]
        public virtual System.Collections.Generic.List<DocsPaVO.PrjDocImport.ProjectRowData> ReadProjectDataFromExcel(
            byte[] content,
            string fileName,
            DocsPaVO.utente.InfoUtente userInfo,
            DocsPaVO.utente.Ruolo role)
        {
            SetUserId(userInfo);
            // L'oggetto da restituire
            System.Collections.Generic.List<DocsPaVO.PrjDocImport.ProjectRowData> toReturn;

            logger.Debug(String.Format(
                @"Inizio lettura dati su fascicoli da foglio Excel. Nome file: {0}, Username: {1}, Id amministrazione: {2}, Ora di inizio: {3}",
                fileName, userInfo.userId, userInfo.idAmministrazione, DateTime.Now));

            try
            {
                toReturn = new BusinessLogic.Import.ImportProjects.ImportProjects().ReadDataFromExcel(
                    content,
                    // PALUMBO: modificato per ovviare al blocco dell'accesso su macchina 20 in scrittura
                    //System.Configuration.ConfigurationManager.AppSettings["MODELS_ROOT_PATH"],
                    DocsPaUtils.Configuration.InitConfigurationKeys.GetValue("0", "BE_TEMP_PATH"),
                    fileName,
                    System.Configuration.ConfigurationManager.AppSettings["DS_PROVIDER"],
                    System.Configuration.ConfigurationManager.AppSettings["DS_EXTENDED_PROPERTIES"],
                    userInfo,
                    role);

                logger.Debug(String.Format(
                @"Fine lettura dati su fascicoli da foglio Excel. Nome file: {0}, Username: {1}, Id amministrazione: {2}, Numero fascicoli individuati: {3}, Ora di fine: {4}",
                fileName, userInfo.userId, userInfo.idAmministrazione, toReturn.Count, DateTime.Now));

            }
            catch (Exception e)
            {
                toReturn = null;

                logger.Debug(String.Format(
                    @"Eccezione durante la lettura dei dati su fascicoli da foglio Excel. Dettagli: {0}, Ora: {1}",
                    e.Message, DateTime.Now));

                throw DocsPaUtils.Exceptions.SoapExceptionFactory.Create(e);
            }

            // Restituzione lista risultati
            return toReturn;

        }

        /// <summary>
        /// Metodo web per l'importazione di un fascicolo a partire da dati descrittivi contenuti all'interno di un apposito oggetto
        /// </summary>
        /// <param name="rowData">L'oggetto con i dati sul fascicolo da importare</param>
        /// <param name="userInfo">Le informazioni sull'utente che ha lanciato la procedura</param>
        /// <param name="role">Il ruolo ocn cui  stata lanciata la procedura</param>
        /// <param name="isEnabledSmistamento">True se  abilitato lo smistamento</param>
        /// <param name="serverPath">L'indirizzo web della WA</param>
        /// <returns>Il risultato dell'importazione</returns>
        [WebMethod(Description = "Metodo Web per l'importazione di un fascicolo i cui dati descrittivi sono descritti in un apposito oggetto.")]
        public virtual DocsPaVO.PrjDocImport.ImportResult ImportProject(
            DocsPaVO.PrjDocImport.ProjectRowData rowData,
            DocsPaVO.utente.InfoUtente userInfo,
            DocsPaVO.utente.Ruolo role,
            bool isEnabledSmistamento,
            string serverPath)
        {
            // L'oggetto da restituire
            DocsPaVO.PrjDocImport.ImportResult toReturn;
            SetUserId(userInfo);
            logger.Debug(String.Format(
                @"Inizio importazione fascicolo. Username: {0}, Id amministrazione: {1}, Ora di inizio: {2}",
                userInfo.userId, userInfo.idAmministrazione, DateTime.Now));

            try
            {
                toReturn = new BusinessLogic.Import.ImportProjects.ImportProjects().ImportProject(
                    rowData,
                    userInfo,
                    role,
                    isEnabledSmistamento,
                    serverPath);

                logger.Debug(String.Format(
                    @"Fine importazione fascicolo. Username: {0}, Id amministrazione: {1}, Risultato: {2}, Ora di fine: {3}",
                    userInfo.userId, userInfo.idAmministrazione, toReturn.Outcome.ToString(), DateTime.Now));
            }
            catch (Exception e)
            {
                toReturn = new DocsPaVO.PrjDocImport.ImportResult()
                {
                    Outcome = DocsPaVO.PrjDocImport.ImportResult.OutcomeEnumeration.KO,
                    Message = "Si  verificato un errore irreversibile durante l'importazione del fascicolo.",
                };

                toReturn.OtherInformation.Add(e.Message);

                logger.Debug(String.Format(
                @"Eccezione durante la lettura dei dati su fascicoli da foglio Excel. Dettagli: {0}. Ora: {1}",
                e.Message, DateTime.Now));
            }

            // Restituzione lista risultati
            return toReturn;

        }

        #endregion

        #region Importazione Documenti

        /// <summary>
        /// Servizio web per l'importazione di documenti a partire da dati riportati all'interno di un
        /// file Excel
        /// </summary>
        /// <param name="content">Il contenuto del file Excel</param>
        /// <param name="fileName">Il nome da attribuire al file temporaneo</param>
        /// <param name="serverPath">Il path del frontend</param>
        /// <param name="userInfo">Le informazioni sull'utente che ha lanciato la procedura</param>
        /// <param name="role">Il ruolo dell'utente che ha lanciato la procedura</param>
        /// <param name="isProfilationRequired">True se  richiesta profilazione obbligatoria</param>
        /// <param name="isRapidClassificationRequired">True se  richiesta classificazione obbligatoria</param>
        /// <returns>Un array rappresentante un report dell'esecuzione</returns>
        [WebMethod(Description = "Web service per l'importazione di documenti a partire da dati riportati all'interno di un file Excel.")]
        [XmlInclude(typeof(DocsPaVO.PrjDocImport.ResultsContainer))]
        public virtual DocsPaVO.PrjDocImport.ResultsContainer
            ImportDocuments(byte[] content,
                    string fileName,
                    string serverPath,
                    DocsPaVO.utente.InfoUtente userInfo,
                    DocsPaVO.utente.Ruolo role,
                    bool isProfilationRequired,
                    bool isRapidClassificationRequired,
                    bool isSmistamentoEnabled,
                    bool isEnabledPregressi)
        {
            SetUserId(userInfo);
            try
            {
                return BusinessLogic.Import.ImportDocuments.ImportDocumentsManager.ImportDocuments(
                    content,
                    fileName,
                    serverPath,
                    // PALUMBO: modificato per ovviare al blocco dell'accesso su macchina 20 in scrittura
                    //System.Configuration.ConfigurationManager.AppSettings["MODELS_ROOT_PATH"],
                    DocsPaUtils.Configuration.InitConfigurationKeys.GetValue("0", "BE_LOG_PATH"),
                    userInfo,
                    role,
                    isProfilationRequired,
                    isRapidClassificationRequired,
                    System.Configuration.ConfigurationManager.AppSettings["FTP_ADDRESS"],
                    isSmistamentoEnabled,
                    System.Configuration.ConfigurationManager.AppSettings["FTP_USERNAME"],
                    System.Configuration.ConfigurationManager.AppSettings["FTP_PASSWORD"],
                    isEnabledPregressi);

            }
            catch (Exception e)
            {
                logger.Debug(
                    String.Format("Errore durante l'importazione dei documenti. Dettagli: {0}",
                        e.Message));

                DocsPaVO.PrjDocImport.ResultsContainer toReturn = new DocsPaVO.PrjDocImport.ResultsContainer();

                toReturn.General.Add(new DocsPaVO.PrjDocImport.ImportResult()
                {
                    Message = e.Message,
                    Outcome = DocsPaVO.PrjDocImport.ImportResult.OutcomeEnumeration.KO
                });

                return toReturn;

            }

        }

        /// <summary>
        /// Servizio web per la lettura dei dati da foglio excel
        /// </summary>
        /// <param name="content">Il contenuto del file excel</param>
        /// <param name="userInfo">Le informazioni sull'utente che ha lanciato la procedura</param>
        /// <param name="role">Il ruolo con cui  stata lanciata la procedura</param>
        /// <param name="error">L'eventuale errore avvenuto in fase di lettura</param>
        /// <returns>Un oggetto con le informazioni estratte dal foglio excel</returns>
        [WebMethod(Description = "Web service per la lettura di dati su documenti da importare da una sorgente dati excel")]
        [XmlInclude(typeof(DocsPaVO.PrjDocImport.DocumentRowDataContainer))]
        public virtual DocsPaVO.PrjDocImport.DocumentRowDataContainer ReadDocumentDataFromExcelFile(
            byte[] content,
            DocsPaVO.utente.InfoUtente userInfo,
            DocsPaVO.utente.Ruolo role,
            out string error,
            bool isEnabledPregressi,
            bool isStampaUnione)
        {
            SetUserId(userInfo);
            // L'oggetto da restituire
            DocsPaVO.PrjDocImport.DocumentRowDataContainer toReturn = null;

            try
            {
                logger.Debug("Inizio lettura dati da foglio Excel - ReadDocumentDataFromExcelFile");
                toReturn = BusinessLogic.Import.ImportDocuments.ImportDocumentsManager.ReadDataFromExcelFile(
                    content,
                    // PALUMBO: modificato per ovviare al blocco dell'accesso su macchina 20 in scrittura
                    //System.Configuration.ConfigurationManager.AppSettings["MODELS_ROOT_PATH"],
                    DocsPaUtils.Configuration.InitConfigurationKeys.GetValue("0", "BE_TEMP_PATH"),
                    Guid.NewGuid().ToString() + ".xls",
                    userInfo,
                    role,
                    isEnabledPregressi,
                    isStampaUnione,
                    System.Configuration.ConfigurationManager.AppSettings["DS_PROVIDER"],
                    System.Configuration.ConfigurationManager.AppSettings["DS_EXTENDED_PROPERTIES"]);

                logger.Debug("Fine lettura dati da foglio Excel - ReadDocumentDataFromExcelFile");

                error = String.Empty;

            }
            catch (Exception e)
            {
                error = e.Message;
            }

            // Restituzione del risultato
            return toReturn;

        }

        /// <summary>
        /// Servizio web per l'importazione dei documenti a partire da un array con oggetti
        /// contenenti i dati sui documenti da importare
        /// </summary>
        /// <param name="documentToImport">Array di oggetti con le informazioni sui documenti da creare</param>
        /// <param name="docType">Il tipo di documento da creare</param>
        /// <param name="serverPath">L'indirizzo web della WA (utilizzato per le trasmissioni)</param>
        /// <param name="userInfo">Le informazioni sull'utente che ha lanciato la procedura</param>
        /// <param name="role">Il ruolo con cui  stata lanciata la procedura</param>
        /// <param name="isProfilationRequired">True se  richiesta profilazione del documento obbligatoria</param>
        /// <param name="isRapidClassificationRequired">True se  richiesta classificazione rapida obbligatoria</param>
        /// <param name="isSmistamentoEnabled">True se  abilitato lo smistamento</param>
        /// <param name="protoType">Tipo di documento</param>
        /// <param name="resultsContainer"></param>
        /// <param name="sharedDirectoryPath"></param>
        /// <returns>Un array di oggetti con il risultato dell'elaborazione</returns>
        [WebMethod(Description = "Web service per l'importazione di documenti da un array di oggetti descrittivi dei documenti da importare")]
        [XmlInclude(typeof(DocsPaVO.PrjDocImport.ResultsContainer))]
        public virtual System.Collections.Generic.List<DocsPaVO.PrjDocImport.ImportResult> ImportDocumentsFromArray(
            DocsPaVO.PrjDocImport.DocumentRowData[] documentToImport,
            BusinessLogic.Import.ImportDocuments.ImportDocumentsManager.ProtoType protoType,
            string serverPath,
            DocsPaVO.utente.InfoUtente userInfo,
            DocsPaVO.utente.Ruolo role,
            bool isProfilationRequired,
            bool isRapidClassificationRequired,
            bool isSmistamentoEnabled,
            ref DocsPaVO.PrjDocImport.ResultsContainer resultsContainer,
            bool isEnabledPregressi)
        {
            SetUserId(userInfo);
            // L'oggetto da restituire
            System.Collections.Generic.List<DocsPaVO.PrjDocImport.ImportResult> toReturn;

            try
            {
                toReturn = BusinessLogic.Import.ImportDocuments.ImportDocumentsManager.ImportDocuments(
                    new System.Collections.Generic.List<DocsPaVO.PrjDocImport.DocumentRowData>(documentToImport),
                    userInfo,
                    role,
                    serverPath,
                    isProfilationRequired,
                    isRapidClassificationRequired,
                    System.Configuration.ConfigurationManager.AppSettings["FTP_ADDRESS"],
                    isSmistamentoEnabled,
                    protoType,
                    ref resultsContainer,
                    System.Configuration.ConfigurationManager.AppSettings["FTP_USERNAME"],
                    System.Configuration.ConfigurationManager.AppSettings["FTP_PASSWORD"],
                    isEnabledPregressi);

            }
            catch (Exception e)
            {
                logger.Debug(
                    String.Format("Errore durante l'importazione dei documenti. Dettagli: {0}",
                        e.Message));

                toReturn = new System.Collections.Generic.List<DocsPaVO.PrjDocImport.ImportResult>();

                toReturn.Add(new DocsPaVO.PrjDocImport.ImportResult()
                {
                    Message = e.Message,
                    Outcome = DocsPaVO.PrjDocImport.ImportResult.OutcomeEnumeration.KO
                });

            }

            return toReturn;

        }

        /// <summary>
        /// Servizio web per l'importazione di un documento descritto in un particolare oggetto
        /// </summary>
        /// <param name="documentToImport">Oggetto con le informazioni sul documento da creare</param>
        /// <param name="docType">Il tipo di documento da creare</param>
        /// <param name="serverPath">L'indirizzo web della WA (utilizzato per le trasmissioni)</param>
        /// <param name="userInfo">Le informazioni sull'utente che ha lanciato la procedura</param>
        /// <param name="role">Il ruolo con cui  stata lanciata la procedura</param>
        /// <param name="isProfilationRequired">True se  richiesta profilazione del documento obbligatoria</param>
        /// <param name="isRapidClassificationRequired">True se  richiesta classificazione rapida obbligatoria</param>
        /// <param name="isSmistamentoEnabled">True se  abilitato lo smistamento</param>
        /// <param name="protoType"></param>
        /// <param name="resultsContainer"></param>
        /// <param name="sharedDirectoryPath"></param>
        /// <returns>L'oggetto con il risultato dell'elaborazione</returns>
        [WebMethod(Description = "Web service per l'importazione di un documento descritto in un particolare oggetto")]
        [XmlInclude(typeof(DocsPaVO.PrjDocImport.ResultsContainer))]
        public virtual DocsPaVO.PrjDocImport.ImportResult ImportDocument(
            DocsPaVO.PrjDocImport.DocumentRowData documentToImport,
            BusinessLogic.Import.ImportDocuments.ImportDocumentsManager.ProtoType protoType,
            string serverPath,
            DocsPaVO.utente.InfoUtente userInfo,
            DocsPaVO.utente.Ruolo role,
            bool isProfilationRequired,
            bool isRapidClassificationRequired,
            bool isSmistamentoEnabled,
            ref DocsPaVO.PrjDocImport.ResultsContainer resultsContainer,
            bool isEnabledPregressi)
        {
            SetUserId(userInfo);
            // L'oggetto da restituire
            DocsPaVO.PrjDocImport.ImportResult toReturn;

            try
            {
                toReturn = BusinessLogic.Import.ImportDocuments.ImportDocumentsManager.ImportDocument(
                    documentToImport,
                    userInfo,
                    role,
                    serverPath,
                    isProfilationRequired,
                    isRapidClassificationRequired,
                    System.Configuration.ConfigurationManager.AppSettings["FTP_ADDRESS"],
                    isSmistamentoEnabled,
                    protoType,
                    ref resultsContainer,
                    System.Configuration.ConfigurationManager.AppSettings["FTP_USERNAME"],
                    System.Configuration.ConfigurationManager.AppSettings["FTP_PASSWORD"],
                    isEnabledPregressi);

            }
            catch (Exception e)
            {
                logger.Debug(
                    String.Format("Errore durante l'importazione dei documenti. Dettagli: {0}",
                        e.Message));

                toReturn = new DocsPaVO.PrjDocImport.ImportResult()
                {
                    Message = e.Message,
                    Outcome = DocsPaVO.PrjDocImport.ImportResult.OutcomeEnumeration.KO
                };

            }

            return toReturn;

        }

        /// <summary>
        /// Servizio web per l'importazione di un documento descritto in un particolare oggetto
        /// </summary>
        /// <param name="documentToImport">Oggetto con le informazioni sul documento da creare</param>
        /// <param name="docType">Il tipo di documento da creare</param>
        /// <param name="serverPath">L'indirizzo web della WA (utilizzato per le trasmissioni)</param>
        /// <param name="userInfo">Le informazioni sull'utente che ha lanciato la procedura</param>
        /// <param name="role">Il ruolo con cui  stata lanciata la procedura</param>
        /// <param name="isProfilationRequired">True se  richiesta profilazione del documento obbligatoria</param>
        /// <param name="isRapidClassificationRequired">True se  richiesta classificazione rapida obbligatoria</param>
        /// <param name="isSmistamentoEnabled">True se  abilitato lo smistamento</param>
        /// <param name="protoType"></param>
        /// <param name="resultsContainer"></param>
        /// <param name="sharedDirectoryPath"></param>
        /// <returns>L'oggetto con il risultato dell'elaborazione</returns>
        [WebMethod(Description = "Web service per l'importazione di un documento descritto in un particolare oggetto; viene fatta anche l'acquisizione del file (come rtf) a partire dal modello associato al tipo di documento")]
        [XmlInclude(typeof(DocsPaVO.PrjDocImport.ResultsContainer))]
        public virtual DocsPaVO.PrjDocImport.ImportResult ImportAndAcquireDocument(
            DocsPaVO.PrjDocImport.DocumentRowData documentToImport,
            BusinessLogic.Import.ImportDocuments.ImportDocumentsManager.ProtoType protoType,
            string serverPath,
            DocsPaVO.utente.InfoUtente userInfo,
            DocsPaVO.utente.Ruolo role,
            bool isProfilationRequired,
            bool isRapidClassificationRequired,
            bool isSmistamentoEnabled,
            ref DocsPaVO.PrjDocImport.ResultsContainer resultsContainer,
            bool isEnabledPregressi)
        {
            SetUserId(userInfo);
            // L'oggetto da restituire
            DocsPaVO.PrjDocImport.ImportResult toReturn;

            try
            {
                toReturn = BusinessLogic.Import.ImportDocuments.ImportDocumentsManager.ImportAndAcquireDocument(
                    documentToImport,
                    userInfo,
                    role,
                    serverPath,
                    isProfilationRequired,
                    isRapidClassificationRequired,
                    System.Configuration.ConfigurationManager.AppSettings["FTP_ADDRESS"],
                    isSmistamentoEnabled,
                    protoType,
                    ref resultsContainer,
                    System.Configuration.ConfigurationManager.AppSettings["FTP_USERNAME"],
                    System.Configuration.ConfigurationManager.AppSettings["FTP_PASSWORD"],
                    isEnabledPregressi);

            }
            catch (Exception e)
            {
                logger.Debug(
                    String.Format("Errore durante l'importazione dei documenti. Dettagli: {0}",
                        e.Message));

                toReturn = new DocsPaVO.PrjDocImport.ImportResult()
                {
                    Message = e.Message,
                    Outcome = DocsPaVO.PrjDocImport.ImportResult.OutcomeEnumeration.KO
                };

            }

            return toReturn;

        }
        [WebMethod(Description = "Web service per la creazione dello zip contenente i documenti importati")]
        public byte[] CreateZipFromReport(ResultsContainer report, InfoUtente infoUtente)
        {
            SetUserId(infoUtente);
            try
            {
                byte[] toReturn = BusinessLogic.Import.ImportDocuments.ImportDocumentsManager.CreateZipFromReport(report, infoUtente);
                return toReturn;
            }
            catch (Exception e)
            {
                logger.Debug(String.Format("Errore durante l'importazione dei documenti. Dettagli: {0}", e.Message));
                return null;
            }
        }

        #endregion

        #region Importazione RDE

        /// <summary>
        /// Servizio web per l'importazione RDE
        /// </summary>
        /// <param name="content">Il contenuto del file Excel con i dati sui protocolli da importare</param>
        /// <param name="fileName">Il nome da assegnare al file temporaneo</param>
        /// <param name="serverPath">L'indirizzo web della WA</param>
        /// <param name="userInfo">Le informazioni sull'utente che ha lanciato la procedura</param>
        /// <param name="role">Il ruolo con cui  stata lanciata la procedura</param>
        /// <param name="isRapidClassificationRequired">True se  richiesta classificazione rapida</param>
        /// <param name="isSmistamentoEnabled">True se  abilitato lo smistamento</param>
        /// <param name="versionNumber">Il numero della versione dell'importer da utilizzare.
        ///     - 1 per la versione che non contempla i protocolli interni ed i corrispondenti identificati tramite codice
        ///     - 2 per la versione che contempla i protocollo interni ed i corrispondenti identificati tramite codice</param>
        /// <returns>Un oggetto con il dettaglio sui risultati dell'elaborazione</returns>
        [WebMethod(Description = "Web service per l'importazione del Registro Documenti di Emergenza")]
        [XmlInclude(typeof(DocsPaVO.PrjDocImport.ResultsContainer))]
        public virtual DocsPaVO.PrjDocImport.ResultsContainer ImportRDE(
            byte[] content,
            string fileName,
            string serverPath,
            DocsPaVO.utente.InfoUtente userInfo,
            DocsPaVO.utente.Ruolo role,
            bool isRapidClassificationRequired,
            bool isSmistamentoEnabled,
            int versionNumber)
        {
            try
            {
                SetUserId(userInfo);
                return BusinessLogic.Import.RDE.ImportRDE.CreateRDA(
                    content,
                    fileName,
                    serverPath,
                    // PALUMBO: modificato per ovviare al blocco dell'accesso su macchina 20 in scrittura
                    //System.Configuration.ConfigurationManager.AppSettings["MODELS_ROOT_PATH"],
                    DocsPaUtils.Configuration.InitConfigurationKeys.GetValue("0", "BE_LOG_PATH"),
                    userInfo,
                    role,
                    isRapidClassificationRequired,
                    isSmistamentoEnabled,
                    System.Configuration.ConfigurationManager.AppSettings["FTP_ADDRESS"],
                    System.Configuration.ConfigurationManager.AppSettings["DS_PROVIDER"],
                    System.Configuration.ConfigurationManager.AppSettings["DS_EXTENDED_PROPERTIES"],
                    versionNumber,
                    System.Configuration.ConfigurationManager.AppSettings["FTP_USERNAME"],
                    System.Configuration.ConfigurationManager.AppSettings["FTP_PASSWORD"],
                    false);


            }
            catch (Exception e)
            {
                logger.Debug(
                    String.Format("Errore durante l'importazione dei documenti. Dettagli: {0}",
                        e.Message));

                DocsPaVO.PrjDocImport.ResultsContainer toReturn = new DocsPaVO.PrjDocImport.ResultsContainer();

                toReturn.General.Add(new DocsPaVO.PrjDocImport.ImportResult()
                {
                    Message = e.Message,
                    Outcome = DocsPaVO.PrjDocImport.ImportResult.OutcomeEnumeration.KO
                });

                return toReturn;

            }

        }

        /// <summary>
        /// Metodo web per l'importazione l'inserimento dei di un documento RDE di una determinata tipologia.
        /// </summary>
        /// <param name="rowData">L'oggetto in cui sono descritti i dati sul documento da importare</param>
        /// <param name="userInfo">Le informazioni sull'utente che ha lanciato la procedura</param>
        /// <param name="role">Il ruolo con cui  stata lanciata la procedura</param>
        /// <param name="serverPath">L'indirizzo della WA</param>
        /// <param name="isRapidClassificationRequired">True se  richiesta la classificazione rapida</param>
        /// <param name="isSmistamentoEnabled">True se  abilitato lo smistamento</param>
        /// <param name="isProfilationRequired">True se  obbligatoria la profilazione dinamica</param>
        /// <param name="protoType">Il tipo di documento da creare</param>
        /// <returns>L'oggetto con il risultato dell'inserimento</returns>
        [WebMethod(Description = "Web service per l'importazione di un documento del Registro Documenti di Emergenza")]
        [XmlInclude(typeof(DocsPaVO.PrjDocImport.ImportResult))]
        public virtual DocsPaVO.PrjDocImport.ImportResult ImportRDEDocument(
            DocsPaVO.PrjDocImport.DocumentRowData rowData,
            DocsPaVO.utente.InfoUtente userInfo,
            DocsPaVO.utente.Ruolo role,
            string serverPath,
            bool isRapidClassificationRequired,
            bool isSmistamentoEnabled,
            bool isProfilationRequired,
            BusinessLogic.Import.ImportDocuments.ImportDocumentsManager.ProtoType protoType)
        {
            try
            {
                SetUserId(userInfo);
                return BusinessLogic.Import.RDE.ImportRDE.ImportRDEDocument(
                    rowData,
                    userInfo,
                    role,
                    serverPath,
                    isRapidClassificationRequired,
                    isSmistamentoEnabled,
                    System.Configuration.ConfigurationManager.AppSettings["FTP_ADDRESS"],
                    isProfilationRequired,
                    protoType,
                    System.Configuration.ConfigurationManager.AppSettings["FTP_USERNAME"],
                    System.Configuration.ConfigurationManager.AppSettings["FTP_PASSWORD"],
                    false);     // Impostare questo parametro a true per abilitare l'RDE Corte dei Conti (protocollazione libera)

            }
            catch (Exception e)
            {
                logger.Debug(
                    String.Format("Errore durante l'importazione dei documenti. Dettagli: {0}",
                        e.Message));

                DocsPaVO.PrjDocImport.ImportResult toReturn = new DocsPaVO.PrjDocImport.ImportResult()
                {
                    Message = e.Message,
                    Outcome = DocsPaVO.PrjDocImport.ImportResult.OutcomeEnumeration.KO
                };

                return toReturn;

            }

        }

        /// <summary>
        /// Metodo web per la lettura dei dati sui documenti RDE da importare.
        /// </summary>
        /// <param name="content">Il contenuto del foglio Excel</param>
        /// <param name="fileName">Il nome da attribuire al file temporaneo</param>
        /// <param name="versionNumber">Il numero di versione dell'importer da utilizzare.
        ///     - 1 per la versione che non contempla i protocolli interni ed i corrispondenti identificati tramite codice
        ///     - 2 per la versione che contempla i protocolli interni ed i corrispondenti identificati tramite codice</param>
        /// <param name="error">L'eventuale errore verificatosi in fase di creazione del documento di emergenza</param>
        /// <returns>L'insieme degli oggetti con i dati sui documenti da creare</returns>
        [WebMethod(Description = "Web service per l'estrazione dei dati relativi al Registro Documenti di Emergenza da foglio Excel.")]
        [XmlInclude(typeof(DocsPaVO.PrjDocImport.DocumentRowDataContainer))]
        [XmlInclude(typeof(DocsPaVO.PrjDocImport.RDEDocumentRowData))]
        public virtual DocsPaVO.PrjDocImport.DocumentRowDataContainer ReadRDEDataFromExcel(
            byte[] content,
            string fileName,
            int versionNumber,
            out string error)
        {
            // L'oggetto da restituire
            DocsPaVO.PrjDocImport.DocumentRowDataContainer toReturn = null;

            try
            {
                error = String.Empty;

                toReturn = BusinessLogic.Import.RDE.ImportRDE.ReadDataFromExcel(
                    // PALUMBO: modificato per ovviare al blocco dell'accesso su macchina 20 in scrittura
                    //System.Configuration.ConfigurationManager.AppSettings["MODELS_ROOT_PATH"],
                    DocsPaUtils.Configuration.InitConfigurationKeys.GetValue("0", "BE_TEMP_PATH"),
                    System.Configuration.ConfigurationManager.AppSettings["DS_PROVIDER"],
                    System.Configuration.ConfigurationManager.AppSettings["DS_EXTENDED_PROPERTIES"],
                    fileName,
                    content,
                    versionNumber);

            }
            catch (Exception e)
            {
                logger.Debug(
                    String.Format("Errore durante l'estrazione dei dati dal foglio Excel. Dettagli: {0}",
                        e.Message));

                error = e.Message;

            }

            return toReturn;

        }

        #endregion

        #region Importazione Rubrica

        /// <summary>
        /// Funzione per l'estrazione di dati sui corrispondenti da foglio Excel
        /// </summary>
        /// <param name="content">Il contenuto del foglio Excel</param>
        /// <param name="fileName">Il nome da attribuire al file temporaneo</param>
        /// <param name="userInfo">Le informazioni sull'utente che ha lanciato la procedura</param>
        /// <param name="error">L'eventuale errore verificatosi in fase di estrazione dati</param>
        /// <returns>La lista dei dati sui corrispondenti</returns>
        [WebMethod(Description = "Metodo web per l'estrazione di dati su corrispondenti da foglio Excel.")]
        [XmlInclude(typeof(DocsPaVO.Import.AddressBook.AddressBookImportResultContainer))]
        public virtual DocsPaVO.Import.AddressBook.AddressBookRowDataContainer ReadAddressBookImportDataFromExcel(
            byte[] content,
            string fileName,
            DocsPaVO.utente.InfoUtente userInfo,
            out string error)
        {
            SetUserId(userInfo);
            // L'oggetto da restituire
            DocsPaVO.Import.AddressBook.AddressBookRowDataContainer toReturn = null;

            // L'eventuale errore
            string errorInExtraction = String.Empty;

            try
            {
                logger.Debug(
                    String.Format("Inizio procedura per l'estrazione dei dati sui corrispondenti da foglio Excel. Utente: {0}, Ora: {1}",
                        userInfo.userId,
                        DateTime.Now.ToString()));

                toReturn = new BusinessLogic.Import.ImportAddressBook.ImportAddressBook().ReadDataFromExcelFile(
                    // PALUMBO: modificato per ovviare al blocco dell'accesso su macchina 20 in scrittura
                    //System.Configuration.ConfigurationManager.AppSettings["MODELS_ROOT_PATH"],
                    DocsPaUtils.Configuration.InitConfigurationKeys.GetValue("0", "BE_LOG_PATH"),
                    System.Configuration.ConfigurationManager.AppSettings["DS_PROVIDER"],
                    System.Configuration.ConfigurationManager.AppSettings["DS_EXTENDED_PROPERTIES"],
                    fileName,
                    content);

                logger.Debug(
                    String.Format("Fine procedura per l'estrazione dei dati sui corrispondenti da foglio Excel. Utente: {0}, Ora: {1}",
                        userInfo.userId,
                        DateTime.Now.ToString()));
            }
            catch (Exception e)
            {
                logger.Debug(
                    String.Format("Errore durante l'estrazione dei dati sui corrispondenti da foglio Excel. Dettagli: {0}, Utente: {1}, Ora: {2}",
                        e.Message,
                        userInfo.userId,
                        DateTime.Now.ToString()));

                errorInExtraction = e.Message;

            }

            // Impostazione dell'errore
            error = errorInExtraction;

            // Restituzione del risultato
            return toReturn;

        }

        /// <summary>
        /// Metodo web per l'importazione di un corrispondente esterna nella rubrica
        /// </summary>
        /// <param name="userInfo">Le informazioni sull'utente che ha lanciato la procedura</param>
        /// <param name="role">Il ruolo con cui  stata lanciata la procedura</param>
        /// <param name="listsFlag"></param>
        /// <param name="operation">L'operazione da compiere sul corrispondente</param>
        /// <param name="rowData">Le informazioni sul corrispondente su cui compiere l'operazione</param>
        /// <returns>Il risultato dell'operazione di importazione</returns>
        [WebMethod(Description = "Metodo web per l'importazione di un corrispondente nella rubrica.")]
        [XmlInclude(typeof(DocsPaVO.Import.AddressBook.AddressBookImportResult))]
        public virtual DocsPaVO.Import.AddressBook.AddressBookImportResult ImportAddressBookElement(
            DocsPaVO.utente.InfoUtente userInfo,
            DocsPaVO.utente.Ruolo role,
            int listsFlag,
            BusinessLogic.Import.ImportAddressBook.ImportAddressBook.OperationEnum operation,
            DocsPaVO.Import.AddressBook.AddressBookRowData rowData)
        {
            SetUserId(userInfo);
            // L'oggetto da restituire
            DocsPaVO.Import.AddressBook.AddressBookImportResult toReturn = null;

            try
            {
                logger.Debug(
                    String.Format("Inizio procedura per l'importazione di un corrispondente esterno nella rubrica con dati provenienti da foglio Excel. Utente: {0}, Ora: {1}",
                        userInfo.userId,
                        DateTime.Now.ToString()));

                // Importazione del corrispondente
                toReturn = new BusinessLogic.Import.ImportAddressBook.ImportAddressBook().Import(
                    userInfo,
                    role,
                    listsFlag,
                    operation,
                    rowData);

                logger.Debug(
                    String.Format("Fine procedura per l'estrazione dei dati sui corrispondenti da foglio Excel. Utente: {0}, Ora: {1}",
                        userInfo.userId,
                        DateTime.Now.ToString()));
            }
            catch (Exception e)
            {
                logger.Debug(
                    String.Format("Errore durante la procedura per l'estrazione dei dati sui corrispondenti da foglio Excel. Dettagli: {0}, Utente: {1}, Ora: {2}",
                        e.Message,
                        userInfo.userId,
                        DateTime.Now.ToString()));
            }

            // Restituzione del risultato 
            return toReturn;

        }

        #endregion

        #endregion

        /*
        [WebMethod]
        public virtual ArrayList getRuoliOggCustomFasc(string idOggCustom)
        {
            try
            {
                return BusinessLogic.ProfilazioneDinamica.ProfilazioneFascicoli.getRuoliOggCustomFasc(idOggCustom);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getRuoliOggCustomFasc", e);
                return null;
            }
        }

        [WebMethod]
        public virtual void cancellaAssociazioneRuoloOggettoCustomFasc(string idOggettoCustom, string idRuolo)
        {
            try
            {
                BusinessLogic.ProfilazioneDinamica.ProfilazioneFascicoli.cancellaAssociazioneRuoloOggettoCustomFasc(idOggettoCustom, idRuolo);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: cancellaAssociazioneRuoloOggettoCustomFasc", e);
            }
        }

        [WebMethod]
        public virtual void salvaAssociazioneRuoloOggettoCustomFasc(string idOggettoCustom, string[] listaRuoliSelezionati, string idTipoFasc)
        {
            try
            {
                BusinessLogic.ProfilazioneDinamica.ProfilazioneFascicoli.salvaAssociazioneRuoloOggettoCustomFasc(idOggettoCustom, listaRuoliSelezionati, idTipoFasc);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: salvaAssociazioneRuoloOggettoCustomFasc", e);
            }

        }
        */

        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.ProfilazioneDinamica.AssDocFascRuoli))]
        public virtual ArrayList getDirittiCampiTipologiaDoc(string idRuolo, string idTemplate)
        {
            try
            {
                return BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.getDirittiCampiTipologiaDoc(idRuolo, idTemplate);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getDirittiCampiTipologiaDoc", e);
                return null;
            }

        }

        [WebMethod]
        public virtual void salvaDirittiCampiTipologiaDoc(ArrayList listaDirittiCampiSelezionati)
        {
            try
            {
                BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.salvaDirittiCampiTipologiaDoc(listaDirittiCampiSelezionati);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: salvaDirittiCampiTipologiaDoc", e);
            }

        }

        [WebMethod]
        public virtual void estendiDirittiCampiARuoliDoc(ArrayList listaDirittiCampiSelezionati, ArrayList listaRuoli)
        {
            try
            {
                BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.estendiDirittiCampiARuoliDoc(listaDirittiCampiSelezionati, listaRuoli);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: estendiDirittiCampiARuoli", e);
            }

        }

        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.ProfilazioneDinamica.AssDocFascRuoli))]
        public virtual ArrayList getDirittiCampiTipologiaFasc(string idRuolo, string idTemplate)
        {
            try
            {
                return BusinessLogic.ProfilazioneDinamica.ProfilazioneFascicoli.getDirittiCampiTipologiaFasc(idRuolo, idTemplate);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getDirittiCampiTipologiaFasc", e);
                return null;
            }

        }

        [WebMethod]
        public virtual void salvaDirittiCampiTipologiaFasc(ArrayList listaDirittiCampiSelezionati)
        {
            try
            {
                BusinessLogic.ProfilazioneDinamica.ProfilazioneFascicoli.salvaDirittiCampiTipologiaFasc(listaDirittiCampiSelezionati);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: salvaDirittiCampiTipologiaFasc", e);
            }

        }

        [WebMethod]
        public virtual void estendiDirittiCampiARuoliFasc(ArrayList listaDirittiCampiSelezionati, ArrayList listaRuoli)
        {
            try
            {
                BusinessLogic.ProfilazioneDinamica.ProfilazioneFascicoli.estendiDirittiCampiARuoliFasc(listaDirittiCampiSelezionati, listaRuoli);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: estendiDirittiCampiARuoliFasc", e);
            }

        }

        [WebMethod]
        public virtual DocsPaVO.ProfilazioneDinamica.AssDocFascRuoli getDirittiCampoTipologiaDoc(string idRuolo, string idTemplate, string idOggettoCustom)
        {
            try
            {
                return BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.getDirittiCampoTipologiaDoc(idRuolo, idTemplate, idOggettoCustom);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getDirittiCampoTipologiaDoc", e);
                return null;
            }
        }


        [WebMethod]
        public virtual DocsPaVO.ProfilazioneDinamica.AssDocFascRuoli getDirittiCampoTipologiaFasc(string idRuolo, string idTemplate, string idOggettoCustom)
        {
            try
            {
                return BusinessLogic.ProfilazioneDinamica.ProfilazioneFascicoli.getDirittiCampoTipologiaFasc(idRuolo, idTemplate, idOggettoCustom);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getDirittiCampoTipologiaFasc", e);
                return null;
            }
        }

        [WebMethod]
        public virtual void estendiDirittiRuoloACampiDoc(ArrayList listaDirittiRuoli, ArrayList listaCampi)
        {
            try
            {
                BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.estendiDirittiRuoloACampiDoc(listaDirittiRuoli, listaCampi);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: estendiDirittiRuoloACampiDoc", e);
            }

        }

        [WebMethod]
        public virtual void estendiDirittiRuoloACampiFasc(ArrayList listaDirittiRuoli, ArrayList listaCampi)
        {
            try
            {
                BusinessLogic.ProfilazioneDinamica.ProfilazioneFascicoli.estendiDirittiRuoloACampiFasc(listaDirittiRuoli, listaCampi);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: estendiDirittiRuoloACampiFasc", e);
            }

        }

        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.ProfilazioneDinamica.AssDocFascRuoli))]
        public virtual ArrayList getRuoliFromOggettoCustomDoc(string idTemplate, string idOggettoCustom)
        {
            try
            {
                return BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.getRuoliFromOggettoCustomDoc(idTemplate, idOggettoCustom);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getRuoliFromOggettoCustomDoc", e);
                return null;
            }

        }

        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.ProfilazioneDinamica.AssDocFascRuoli))]
        public virtual ArrayList getRuoliFromOggettoCustomFasc(string idTemplate, string idOggettoCustom)
        {
            try
            {
                return BusinessLogic.ProfilazioneDinamica.ProfilazioneFascicoli.getRuoliFromOggettoCustomFasc(idTemplate, idOggettoCustom);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getRuoliFromOggettoCustomFasc", e);
                return null;
            }

        }

        [WebMethod]
        public virtual DocsPaVO.utente.Ruolo getRuoloByIdGruppo(string idGruppo)
        {
            try
            {
                return BusinessLogic.Utenti.UserManager.getRuoloByIdGruppo(idGruppo);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getRuoloByIdGruppo", e);
                throw new Exception(e.Message);
            }
        }

        /// <summary>
        /// Indica se la gestione dei repository temporanei  disabilitata
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod()]
        public bool IsDisabledSessionRepositoryContext(DocsPaVO.utente.InfoUtente infoUtente)
        {
            return BusinessLogic.Documenti.SessionRepositoryFileManager.IsSessionRepositoryDisabled(infoUtente);
        }

        /// <summary>
        /// Inserimento di una nuova nota da inserire in un elenco preconfigurato di note
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <param name="nota"></param>
        /// <returns></returns>
        [WebMethod]
        public bool InsertNotaInElenco(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.Note.NotaElenco nota, out string message)
        {
            SetUserId(infoUtente);
            message = "";
            return BusinessLogic.Note.NoteManager.InsertNotaInElenco(infoUtente, nota, out message);
        }

        [WebMethod(Description = "Web service per l'importazione di un elenco di note a partire da dati riportati all'interno di un file Excel.")]
        [XmlInclude(typeof(DocsPaVO.PrjDocImport.ImportResult))]
        public virtual System.Collections.Generic.List<DocsPaVO.PrjDocImport.ImportResult>
            InsertNotaInElencoDaExcel(DocsPaVO.utente.InfoUtente infoUtente, byte[] dati, string nomeFile)
        {
            try
            {
                SetUserId(infoUtente);
                return BusinessLogic.Import.ImportNote.ImportNote.ImportElencoNote(
                    dati, nomeFile,
                    // PALUMBO: modificato per ovviare al blocco dell'accesso su macchina 20 in scrittura
                    //System.Configuration.ConfigurationManager.AppSettings["MODELS_ROOT_PATH"],
                    DocsPaUtils.Configuration.InitConfigurationKeys.GetValue("0", "BE_TEMP_PATH"),
                    infoUtente);
            }
            catch (Exception e)
            {
                logger.Debug(
                    String.Format("Errore durante l'importazione di un elenco di note. Dettagli: {0}",
                        e.Message));

                return new System.Collections.Generic.List<DocsPaVO.PrjDocImport.ImportResult>()
                    {
                        new DocsPaVO.PrjDocImport.ImportResult()
                            {
                                Message = e.Message,
                                Outcome = DocsPaVO.PrjDocImport.ImportResult.OutcomeEnumeration.KO
                            }
                    };
            }
        }





        [WebMethod]
        public bool ModNotaInElenco(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.Note.NotaElenco nota, out string message)
        {
            SetUserId(infoUtente);
            return BusinessLogic.Note.NoteManager.ModNotaInElenco(infoUtente, nota, out message);
        }

        [WebMethod]
        public bool DeleteNoteInElenco(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.Note.NotaElenco[] listaNote)
        {
            SetUserId(infoUtente);
            return BusinessLogic.Note.NoteManager.DeleteNoteInElenco(infoUtente, listaNote);
        }

        [WebMethod]
        public string[] GetElencoNote(string idRegistroRf, string prefixText)
        {
            return BusinessLogic.Note.NoteManager.GetElencoNote(idRegistroRf, prefixText);
        }

        /// <summary>
        /// Restituisce la lista delle NOTE presenti nell'elenco preconfigurato (dpa_elenco_note)
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <param name="idRegRf"></param>
        /// <returns></returns>
        [WebMethod]
        public DocsPaVO.Note.NotaElenco[] GetListaNote(DocsPaVO.utente.InfoUtente infoUtente, string idRF, string descNota, out int numNote)
        {
            SetUserId(infoUtente);
            return BusinessLogic.Note.NoteManager.GetListaNote(infoUtente, idRF, descNota, out numNote);
        }

        [WebMethod]
        public bool testConnessione(OrgRegistro.MailRegistro mailRegistro, string tipoConnessione, out string messaggioDiErrore)
        {
            messaggioDiErrore = string.Empty;
            try
            {
                BusinessLogic.Interoperabilit.SvrPosta sv = new BusinessLogic.Interoperabilit.SvrPosta();
                return sv.provaConnessione(mailRegistro, out messaggioDiErrore, tipoConnessione);
            }
            catch (Exception e)
            {
                logger.Debug("errore nel web method test connessione - errore: " + e.Message);
            }

            return false;
        }


        /// <summary>
        /// Indica se la gestione dei repository temporanei  disabilitata
        /// </summary>
        /// <returns></returns>
        [WebMethod]
        [XmlInclude(typeof(DocsPaVO.rubrica.ElementoRubrica))]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.rubrica.ElementoRubrica))]
        public virtual ArrayList rubricaGetElementiRubricaRangeCodSysID(string[] valoriRicerca, DocsPaVO.utente.InfoUtente u)
        {
            SetUserId(u);
            ArrayList objElementiRubrica = null;

            try
            {
                logger.Debug("WS > rubricaGetElementiRubricaRangeCodSysID");
                BusinessLogic.Rubrica.DPA3_RubricaSearchAgent ccs = new BusinessLogic.Rubrica.DPA3_RubricaSearchAgent(u);
                objElementiRubrica = ccs.SearchRangeSystemID(valoriRicerca);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: rubricaGetElementiRubricaRangeCodSysID - ", e);
            }
            return objElementiRubrica;
        }


        /// <summary>
        /// Reperimento della data di scadenza della password per l'utente
        /// </summary>
        /// <param name="userId"></param>
        /// <returns></returns>
        [WebMethod]
        public bool isCorrispondenteValid(string userId)
        {
            try
            {
                SetUserId(userId);
                return BusinessLogic.Utenti.addressBookManager.isCorrispondenteValido(userId);
            }
            catch (Exception e)
            {
                throw new ApplicationException("Errore in DocsPaWS.asmx  - metodo: isCorrispondenteValid", e);
            }
        }

        /// <summary>
        /// controlla se il documento  presente nella todolist dell'utente
        /// </summary>
        /// <param name="idProfile"></param>
        /// <param name="idPeople"></param>
        /// <returns></returns>
        [WebMethod]
        public int isDocInADL(string idProfile, string idPeople)
        {
            try
            {
                return BusinessLogic.Documenti.DocManager.IsDocInADL(idProfile, idPeople);
            }
            catch (Exception e)
            {
                throw new ApplicationException("Errore in DocsPaWS.asmx  - metodo: isDocInADL", e);
            }
        }

        /// <summary>
        /// Ritorna le etichette per la protocollazione dell'amministrazione o se non inserite quelle di default (Fabio)
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        [XmlInclude(typeof(DocsPaVO.documento.EtichettaInfo))]
        public virtual DocsPaVO.documento.EtichettaInfo[] getEtichetteDocumenti(DocsPaVO.utente.InfoUtente infoUtente, string idAmm)
        {
            SetUserId(infoUtente);
            DocsPaVO.documento.EtichettaInfo[] etichettaInfo = null;
            try
            {
                etichettaInfo = BusinessLogic.Documenti.EtichetteManager.GetInstance(infoUtente, idAmm);
            }
            catch (Exception e)
            {
                throw e;
            }
            return etichettaInfo;
        }

        /// <summary>
        /// Setta la nuove etichette per l'amministrazione selezionata (Fabio)
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        [XmlInclude(typeof(DocsPaVO.documento.EtichettaInfo))]
        public virtual bool setEtichetteDocumenti(DocsPaVO.utente.InfoUtente infoUtente, string idAmm, DocsPaVO.documento.EtichettaInfo[] etichette)
        {
            SetUserId(infoUtente);
            bool success = false;
            try
            {
                success = BusinessLogic.Documenti.EtichetteManager.SetInstance(infoUtente, idAmm, etichette);
                return success;
            }
            catch (Exception e)
            {
                throw e;
            }
        }

        [WebMethod]
        public bool isInUseCampoComuneDoc(string idTemplate, string idCampoComune)
        {
            try
            {
                return BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.isInUseCampoComuneDoc(idTemplate, idCampoComune);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: isInUseCampoComuneDoc", e);
                return false;
            }
        }

        [WebMethod]
        public DocsPaVO.ProfilazioneDinamica.Templates impostaCampiComuniDoc(DocsPaVO.ProfilazioneDinamica.Templates modello, ArrayList campiComuni)
        {
            try
            {
                return BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.impostaCampiComuniDoc(modello, campiComuni);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: impostaCampiComuniDoc", e);
                return null;
            }
        }

        /// <summary>
        /// questo metodo imposta la datavista sul documento/fascicolo
        /// </summary>
        /// <param name="infoutente"></param>
        /// <param name="idProfile"></param>
        /// <param name="docOrFasc"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual bool SetDataVistaSP(DocsPaVO.utente.InfoUtente infoutente, string docNumber, string docOrFasc)
        {
            SetUserId(infoutente);
            return BusinessLogic.Documenti.DocManager.setDataVistaSP(infoutente, docNumber, docOrFasc);
        }

        [WebMethod]
        public virtual DocsPaVO.ProfilazioneDinamica.Templates getTemplateCampiComuniById(DocsPaVO.utente.InfoUtente infoUtente, string idTemplate)
        {
            try
            {
                SetUserId(infoUtente);
                return BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.getTemplateCampiComuniById(infoUtente, idTemplate);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getTemplateCampiComuniById", e);
                return null;
            }
        }

        [WebMethod]
        [XmlInclude(typeof(DocsPaVO.ProfilazioneDinamica.ItemRicCampiComuni))]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.ProfilazioneDinamica.ItemRicCampiComuni))]
        public virtual ArrayList eseguiRicercaCampiComuni(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.filtri.FiltroRicerca[][] listaFiltri, int numPage, int pageSize, out int nRec)
        {
            SetUserId(infoUtente);
            ArrayList result = null;
            nRec = 0;

            try
            {
                result = BusinessLogic.ProfilazioneDinamica.RicercaCampiComuni.eseguiRicercaCampiComuni(infoUtente, listaFiltri, numPage, pageSize, out nRec);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: eseguiRicercaCampiComuni", e);
                result = null;
            }

            return result;
        }

        [WebMethod]
        public virtual bool isFiltroAooEnabled()
        {
            bool filtroAOO = false;
            if (System.Configuration.ConfigurationManager.AppSettings["NO_FILTRO_AOO"] != null && System.Configuration.ConfigurationManager.AppSettings["NO_FILTRO_AOO"] == "1")
                filtroAOO = true;
            return filtroAOO;
        }

        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.documento.DocumentoStoricoDataArrivo))]
        public virtual ArrayList DocumentoGetListaStoricoData(string docnumber)
        {
            ArrayList res = null;
            try
            {

                res = BusinessLogic.Documenti.DocManager.getListaStoricoDataArrivo(docnumber);

            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoGetListaStoricoData", e);
                res = null;
            }
            return res;
        }

        /// <summary>
        /// Metodo web per il conteggio del numero di trasmissioni che coinvolgono un fascicolo
        /// </summary>
        /// <param name="idProject">L'id del fascicolo di cui contare il numero di trasmissioni</param>
        /// <returns>Il numero di trasmissioni che coinvolgono il fascicolo</returns>
        [WebMethod(Description = "Metodo web per la richiesta del numero di trasmissioni che coinvolgono un determinato fascicolo")]
        public virtual int FascicoloGetCountTrasmissioniFascicolo(int idProject)
        {
            int retValue = 0;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                retValue = BusinessLogic.Fascicoli.FascicoloManager.GetCountTrasmissioniFascicolo(idProject);
#if TRACE_WS
				pt.WriteLogTracer("FascicoloGetCountTrasmissioniFascicolo");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicoloGetCountTrasmissioniFascicolo", e);
                retValue = 0;
            }

            return retValue;
        }

        [WebMethod]
        public virtual string getTipoDocObbl(string idAmministrazione)
        {
            string result = "0";
            try
            {
                result = BusinessLogic.Documenti.DocManager.getTipoDocObbl(idAmministrazione);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getTipoDocObbl", e);
            }
            return result;
        }

        /// <summary>
        /// Ritorna  la trasmissione utente associata alla trasmissioe singola(Fabio)
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        [XmlInclude(typeof(DocsPaVO.trasmissione.TrasmissioneUtente))]
        public virtual DocsPaVO.trasmissione.TrasmissioneUtente[] getTrasmissioneUtenteInRuolo(DocsPaVO.utente.InfoUtente infoUtente, string trasmissione)
        {
            SetUserId(infoUtente);
            DocsPaVO.trasmissione.TrasmissioneUtente[] trasmissioniUtenteInRuolo = null;
            try
            {
                DocsPaVO.utente.Utente utente = null;
                string idUtente = infoUtente.idPeople;
                utente = BusinessLogic.Utenti.UserManager.getUtenteById(idUtente);
                trasmissioniUtenteInRuolo = BusinessLogic.Trasmissioni.TrasmManager.getTrasmissioneUtenteInRuolo(infoUtente, trasmissione, utente);
            }
            catch (Exception e)
            {
                throw e;
            }
            return trasmissioniUtenteInRuolo;
        }

        /// <summary>
        /// Prende in ingresso un id di un corrispondente di un ruolo e ritorna il dataset degli utenti nel ruolo con id e nome(Fabio)
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual DataSet getUtentiInRuoloSottoposto(DocsPaVO.utente.InfoUtente infoUtente, string corrispondente)
        {
            SetUserId(infoUtente);
            DataSet ds = new DataSet();
            try
            {
                ds = BusinessLogic.Utenti.UserManager.getUtentiInRuoloSottoposto(infoUtente, corrispondente);
            }
            catch (Exception e)
            {
                throw e;
            }
            return ds;
        }

        /// <summary>
        /// Verifica se sono abilitati i mittenti multipli per il protocollo in entrata
        /// </summary>
        /// <returns></returns>
        [WebMethod]
        public virtual bool isEnableMittentiMultipli()
        {
            return BusinessLogic.Documenti.DocManager.isEnableMittentiMultipli();
        }

        [WebMethod(Description = "Ricerca delle notifiche delle mail di tipoPec")]
        public DocsPaVO.DatiCert.Notifica[] ricercaNotifica(string docNumber)
        {

            DocsPaVO.DatiCert.Notifica[] notifica = null;
            try
            {
                notifica = BusinessLogic.interoperabilita.InteroperabilitaManager.ricercaNotifiche(docNumber);
            }
            catch (Exception e)
            {
                logger.Debug("errore nel web method ricercaNotifica: " + e.Message);
                throw e;
            }
            return notifica;
        }

        [WebMethod(Description = "Ricerca delle notifiche delle mail di tipoPec(applicando i filtri settati da UI)")]
        public DocsPaVO.DatiCert.Notifica[] ricercaNotificaFiltra(DocsPaVO.filtri.FiltroRicerca[] filtri)
        {

            DocsPaVO.DatiCert.Notifica[] notifica = null;
            try
            {
                notifica = BusinessLogic.interoperabilita.InteroperabilitaManager.ricercaNotificheFiltrate(filtri);
            }
            catch (Exception e)
            {
                logger.Debug("errore nel web method ricercaNotificaFiltra: " + e.Message);
                throw e;
            }
            return notifica;
        }

        [WebMethod(Description = "Restituisce il tipo di notifica")]
        public DocsPaVO.DatiCert.TipoNotifica getTipoNotifica(string systemIdTipoNotifica)
        {
            DocsPaVO.DatiCert.TipoNotifica tiponotifica = null;
            try
            {
                tiponotifica = BusinessLogic.interoperabilita.InteroperabilitaManager.GetInstance(systemIdTipoNotifica);
            }

            catch (Exception e)
            {
                logger.Debug("Errore nel web method getTiponotifica: " + e.Message);
                throw e;
            }
            return tiponotifica;
        }


        /// <summary>
        /// Crea una nuova versione da un TSR e un documento.
        /// </summary>
        /// <param name="infoUtente">Oggetto InfoUtente</param>
        /// <param name="fileRequest">Oggetto FileRequest del documento attuale a cui  associata una marca</param>
        /// <returns>Oggetto filerequest a cui  associata una nuova versione con il TSD associato.</returns>
        [WebMethod]
        public virtual DocsPaVO.documento.FileRequest CreateTSDVersion(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.documento.FileRequest fileRequest)
        {
            SetUserId(infoUtente);
            return BusinessLogic.Documenti.TimestampManager.CreateTSDVersion(infoUtente, fileRequest);
        }

        /// <summary>
        /// Effettua una richiesta di marca temporale e verifica la validit della marca ottenuta prima di restituirla come output.
        /// </summary>
        /// <param name="richiesta"></param>
        /// <param name="utente"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual DocsPaVO.areaConservazione.OutputResponseMarca executeAndSaveTSR(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.areaConservazione.InputMarca richiesta, DocsPaVO.documento.FileRequest fileRequest)
        {
            SetUserId(infoUtente);
            DocsPaVO.areaConservazione.OutputResponseMarca ret = null;
            ret = BusinessLogic.Documenti.TimestampManager.executeAndSaveTSR(infoUtente, richiesta, fileRequest);
            if (ret == null)
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOTIMESTAMP", fileRequest.docNumber, string.Format("{0}{1}", "Marca Temporale del doc: ", fileRequest.docNumber), DocsPaVO.Logger.CodAzione.Esito.KO);
            else
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOTIMESTAMP", fileRequest.docNumber, string.Format("{0}{1}", "Marca Temporale del doc: ", fileRequest.docNumber), DocsPaVO.Logger.CodAzione.Esito.OK);
            return ret;
        }

        /// <summary>
        /// Effettua una richiesta di marca temporale e verifica la validit della marca ottenuta prima di restituirla come output.
        /// </summary>
        /// <param name="richiesta"></param>
        /// <param name="utente"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual DocsPaVO.areaConservazione.OutputResponseMarca executeAndSaveTSR_AM(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.areaConservazione.InputMarca richiesta, DocsPaVO.documento.FileRequest fileRequest)
        {
            SetUserId(infoUtente);
            DocsPaVO.areaConservazione.OutputResponseMarca ret = null;
            ret = BusinessLogic.Documenti.TimestampManager.executeAndSaveTSR(infoUtente, richiesta, fileRequest);
            if (ret == null)
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOTIMESTAMP", fileRequest.docNumber, string.Format("{0}{1}", "Azione Massiva - Marca Temporale del doc: ", fileRequest.docNumber), DocsPaVO.Logger.CodAzione.Esito.KO);
            else
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOTIMESTAMP", fileRequest.docNumber, string.Format("{0}{1}", "Azione Massiva - Marca Temporale del doc: ", fileRequest.docNumber), DocsPaVO.Logger.CodAzione.Esito.OK);
            return ret;
        }

        /// <summary>
        /// Restituisce tutti i timestamp relativi alla specifica versione del documento
        /// </summary>
        /// <param name="richiesta"></param>
        /// <param name="utente"></param>
        /// <returns></returns>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.documento.TimestampDoc))]
        public virtual ArrayList getTimestampsDoc(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.documento.FileRequest fileRequest)
        {
            SetUserId(infoUtente);
            return BusinessLogic.Documenti.TimestampManager.getTimestampsDoc(infoUtente, fileRequest);
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.fascicolazione.Fascicolo))]
        public virtual ArrayList FascicolazioneGetFascicoliDaDocNoSecurity(DocsPaVO.utente.InfoUtente infoUtente, string idProfile)
        {
            SetUserId(infoUtente);
            ArrayList result = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                if (idProfile != null)
                {
                    result = BusinessLogic.Fascicoli.FascicoloManager.getFascicoliDaDocNoSecurity(infoUtente, idProfile);
#if TRACE_WS
					pt.WriteLogTracer("FascicolazioneGetFascicoliDaDoc");
#endif
                }
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneGetFascicoliDaDoc", e);
                result = null;
            }

            return result;
        }


        [WebMethod]
        public virtual byte[] GetFileFromPath(string path)
        {
            byte[] result;
            try
            {
                result = BusinessLogic.Modelli.ModelliManager.GetFileFromPath(path);
            }
            catch (Exception e)
            {
                logger.Debug("Errore nella ricerca del file: " + e.Message);
                throw e;
            }
            return result;
        }

        [WebMethod]
        public bool getIfDocOrFascIsInToDoList(DocsPaVO.utente.InfoUtente infoUtente, string idTrasmissione)
        {
            SetUserId(infoUtente);
            try
            {
                return BusinessLogic.Documenti.DocManager.getIfDocOrFascIsInToDoList(infoUtente.idPeople, idTrasmissione);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getIfDocOrFascIsInToDoList", e);
                return false;
            }
        }

        /// <summary>
        /// Metodo invoca dalla rubrica ajax
        /// </summary>
        [WebMethod]
        public virtual string[] getElementiRubricaVeloce(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.rubrica.ParametriRicercaRubrica qco)
        {
            SetUserId(infoUtente);
            string[] result = null;

            try
            {

#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Rubrica.DPA3_RubricaSearchAgent.getElementiRubricaVeloce(infoUtente, qco);
#if TRACE_WS
					pt.WriteLogTracer("getElementiRubricaVeloce");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getElementiRubricaVeloce", e);
                return result;
            }

            return result;
        }

        [WebMethod]
        public string VerificaDocErrati(string idAmm)
        {
            string retvalue = string.Empty;
            try
            {
                retvalue = BusinessLogic.Documenti.DocManager.VerificaDocErrati(idAmm);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx - metodo VerificaDocErrati", e);
                throw e;
            }
            return retvalue;
        }

        [WebMethod]
        public string getAccessRightFascBySystemID(string fascSystemId, DocsPaVO.utente.InfoUtente infoUtente)
        {
            SetUserId(infoUtente);
            try
            {
                return BusinessLogic.Fascicoli.FascicoloManager.getAccessRightFascBySystemID(fascSystemId, infoUtente);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getAccessRightFascBySystemID", e);
                return null;
            }
        }

        /// <summary>
        /// Verifica se l'utente  abilitato all'utilizzo dei componenti SmartClient sulla propria postazione di lavoro
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.SmartClient.SmartClientConfigurations GetSmartClientConfigurationsPerUser(DocsPaVO.utente.InfoUtente infoUtente)
        {
            SetUserId(infoUtente);
            return BusinessLogic.SmartClient.SmartClientManager.GetConfigurationsPerUser(infoUtente);
        }

        #region Modelli di delega
        [WebMethod()]
        public List<ModelloDelega> SearchModelliDelega(DocsPaVO.utente.InfoUtente utente, SearchModelloDelegaInfo searchInfo, ref SearchPagingContext pagingContext)
        {
            SetUserId(utente);
            List<ModelloDelega> res = null;
            try
            {
                res = BusinessLogic.Deleghe.ModelliDelegaManager.searchModelliDelega(utente, searchInfo, pagingContext);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: SearchModelliDelega", e);
            }
            return res;
        }

        [WebMethod()]
        public ModelloDelega GetModelloDelegaById(string id)
        {
            try
            {
                return BusinessLogic.Deleghe.ModelliDelegaManager.getModelloDelegaById(id);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetModelloDelegaById", e);
                return null;
            }
        }

        [WebMethod()]
        public List<ModelloDelega> GetModelliDelegaByStato(InfoUtente utente, StatoModelloDelega stato)
        {
            SetUserId(utente);
            try
            {
                return BusinessLogic.Deleghe.ModelliDelegaManager.getModelliDelegaByStato(utente, stato);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetModelliDelegaByStato", e);
                return null;
            }
        }

        [WebMethod()]
        public bool InsertModelloDelega(ModelloDelega input)
        {
            try
            {
                return BusinessLogic.Deleghe.ModelliDelegaManager.insertModelloDelega(input);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: InsertModelloDelega", e);
                return false;
            }
        }

        [WebMethod()]
        public bool UpdateModelloDelega(ModelloDelega input)
        {
            try
            {
                return BusinessLogic.Deleghe.ModelliDelegaManager.updateModelloDelega(input);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: UpdateModelloDelega", e);
                return false;
            }
        }

        [WebMethod()]
        public bool DeleteModelliDelega(List<string> ids)
        {
            try
            {
                return BusinessLogic.Deleghe.ModelliDelegaManager.deleteModelliDelega(ids);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DeleteModelloDelega", e);
                return false;
            }
        }
        #endregion

        [WebMethod]
        public string getRootFolderFasc(string idFasc)
        {
            try
            {
                return BusinessLogic.Fascicoli.FascicoloManager.getRootFolderFasc(idFasc);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getRootFolderFasc", e);
                return null;
            }
        }

        [WebMethod]
        public Disservizio getInfoDisservizio()
        {
            return BusinessLogic.Amministrazione.AmministraManager.getDisservizio();
        }

        //crea il disservizio e setta lo stato di accettazione degli utenti a N = non accettato
        [WebMethod]
        public bool creaDisservizio(Disservizio disservizio)
        {
            if (BusinessLogic.Amministrazione.AmministraManager.creaDisservizio(disservizio))
                //A = esiste diss e accett ; N = non accettato ; F = non esiste disservizio
                return this.setStatoAccettazioneDisservizio("F");
            else
                return false;
        }

        //Quando viene cambiato il disservizio viene anche risettato lo stato degli utenti a N = non accettato
        [WebMethod]
        public bool updateDisservizio(Disservizio disservizio)
        {
            if (BusinessLogic.Amministrazione.AmministraManager.updateDisservizio(disservizio))
                //A = esiste diss e accett ; N = non accettato ; F = non esiste disservizio
                return this.setStatoAccettazioneDisservizio("F");
            else
                return false;
        }

        //Attiva o disattiva lo stato del disservizio
        //attivo = stato del disservizio attivo
        //disattivo = stato del disservizio disattivo
        [WebMethod]
        public bool cambiaStatoDisservizio(string stato, string system_id)
        {
            if (BusinessLogic.Amministrazione.AmministraManager.cambiaStatoDisservizio(stato, system_id))
                return this.setStatoAccettazioneDisservizio("F");
            else
                return false;
        }

        [WebMethod]
        public bool deleteDisservizio(string system_id)
        {
            if (BusinessLogic.Amministrazione.AmministraManager.deleteDisservizio(system_id))
                //A = esiste diss e accett ; N = non accettato ; F = non esiste disservizio
                return this.setStatoAccettazioneDisservizio("F");
            else
                return false;
        }

        //Setta lo stato di accettazione di tutti gli utenti
        [WebMethod]
        public bool setStatoAccettazioneDisservizio(string stato)
        {
            //A = esiste diss e accett ; N = non accettato ; F = non esiste disservizio
            return BusinessLogic.Amministrazione.AmministraManager.setStatoAccettazioneDisservizio(stato);
        }

        //Lo stato della notifica lo gestisco con la colonna Notificato nella tabella Disservizio
        // '0' = non notificato via email 
        // '1' = notifica disservizio via email
        // '2' = notifica ripresa del servizio
        // '3' = Notificato via email (viene settato dal servizio di notifica, dopo aver mandato le email agli utenti)
        [WebMethod]
        public bool setStatoNotificaDisservizio(string systemId, string stato)
        {
            if (BusinessLogic.Amministrazione.AmministraManager.setStatoNotificaDisservizio(systemId, stato))
            {
                //A = esiste diss e accett ; N = non accettato ; F = non esiste disservizio
                if (stato == "2")
                    return this.setStatoAccettazioneDisservizio("F");
                else
                    return this.setStatoAccettazioneDisservizio("N");

            }
            else
                return false;

        }

        //Setta lo stato di accettazione di un dissservizio da parte dell'utente a F = Dissesrvizio accettato
        [WebMethod]
        public bool accettaDisservizio(string systemId)
        {
            return BusinessLogic.Amministrazione.AmministraManager.accettaDisservizio(systemId);
        }

        [WebMethod]
        public string getStatoAccettazioneUtente(string systemId)
        {
            return BusinessLogic.Amministrazione.AmministraManager.getStatoAccettazioneUtente(systemId);
        }

        [WebMethod]
        [XmlInclude(typeof(ProspettiRiepilogativi.Parametro[]))]
        public virtual DataSet DO_StampaReportFascExcel(string timeStamp, DocsPaVO.utente.InfoUtente infoUtente, string searchType, string tipo_ricerca, string tipo_scelta, string valore_scelta, bool sottoposti, string dataC, string dataCdal, string dataCal, string dataCh, string dataChdal, string dataChal, string idTitolario)
        {
            SetUserId(infoUtente);
            DataSet result = new DataSet();
            try
            {
                String[] ruoliUoSottoposti = null;
                ProspettiRiepilogativi.Model objM = new ProspettiRiepilogativi.Model();
                if (sottoposti == true && tipo_scelta.Equals("uo"))
                {
                    ruoliUoSottoposti = BusinessLogic.Amministrazione.UOManager.getListaRuoliSoppopostiUO(infoUtente, valore_scelta);
                }
                result = objM.DO_StampaReportFascExcel(timeStamp, searchType, infoUtente.idAmministrazione, tipo_ricerca, tipo_scelta, valore_scelta, sottoposti, dataC, dataCdal, dataCal, dataCh, dataChdal, dataChal, idTitolario, ruoliUoSottoposti);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore nel - metodo: DO_StampaReportFascExcel", ex);
            }
            return result;
        }

        /// <summary>
        /// Reperimento lista titoli corrispondente
        /// </summary>
        /// <param name="codiceAmministrazione"></param>
        /// <returns></returns>
        [WebMethod()]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(String))]
        public ArrayList GetListaTitoli()
        {
            ArrayList retValue = new ArrayList();

            try
            {
                retValue = BusinessLogic.Utenti.UserManager.getListaTitoli();
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetListaTitoli", e);
            }

            return retValue;
        }

        /// <summary>
        /// Metodo web per la generazione di una scheda documento per 
        /// l'inoltro massivo
        /// </summary>
        /// <param name="idProfiles">Lista degli id dei documenti con cui creare gli allegati del documento</param>
        /// <param name="userInfo">Le informazioni sull'utente che ha richiesto la creazione dell'utente</param>
        /// <param name="userRole">Il ruolo con cui creare il documento</param>
        /// <param name="error">L'errore da visualizzare</param>
        /// <returns>La scheda da inoltrare</returns>
        [WebMethod]
        public DocsPaVO.documento.SchedaDocumento GetSchedaDocumentoInoltroMassivo(
            List<String> idProfiles,
            DocsPaVO.utente.InfoUtente userInfo,
            DocsPaVO.utente.Ruolo userRole,
            out String error)
        {
            SetUserId(userInfo);
            try
            {
                return BusinessLogic.Documenti.DocManager.GetSchedaDocumentoInoltroMassivo(
                    idProfiles,
                    userInfo,
                    userRole,
                    out error);
            }
            catch (Exception e)
            {

                logger.Debug("Errore durante la creazione della scheda documento per l'inoltro.", e);
                error = "Errore non identificato durante la creazione della scheda documento per l'inoltro.";
                return null;
            }
        }

        /// <summary>
        /// Dato l'idProfile di un documento fascicolato restituisce il nome del fascicolo "primario" che lo contiene
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <param name="idProfile"></param>
        /// <returns></returns>
        [WebMethod]
        public string GetFascicolazionePrimaria(DocsPaVO.utente.InfoUtente infoUtente, string idProfile)
        {
            SetUserId(infoUtente);
            try
            {
                return BusinessLogic.Fascicoli.FascicoloManager.GetFascicolazionePrimaria(infoUtente, idProfile);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetFascicolazionePrimaria", e);
                return null;
            }
        }


        /// <summary>
        /// Per un dato documento classificato in pi fascicoli imposta come fascicolo principale un nuovo dato fascicolo
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <param name="idProject"></param>
        /// <param name="idProfile"></param>
        /// <returns></returns>
        [WebMethod]
        public bool CambiaFascicolazionePrimaria(DocsPaVO.utente.InfoUtente infoUtente, string idProject, string idProfile)
        {
            SetUserId(infoUtente);
            try
            {
                return BusinessLogic.Fascicoli.FascicoloManager.CambiaFascicolazionePrimaria(infoUtente, idProject, idProfile);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: CambiaFascicolazionePrimaria", e);
                return false;
            }
        }

        [WebMethod]
        public bool isExsistDocumentPubblicazione(string id_tipo_documento)
        {
            try
            {
                return BusinessLogic.Pubblicazione.PubblicazioneDocumenti.isexsistdocumentpubblicazione(id_tipo_documento);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: isExsistDocumentPubblicazione", e);
            }
            return false;
        }

        [WebMethod]
        public DocsPaVO.Pubblicazione.PubblicazioneDocumenti getPubblicazioneDocumentiByIdProfile(string id_profile)
        {

            DocsPaVO.Pubblicazione.PubblicazioneDocumenti pubblicazione = null;
            try
            {
                pubblicazione = BusinessLogic.Pubblicazione.PubblicazioneDocumenti.getPubblicazioneDocumentiByIdProfile(id_profile);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getPubblicazioneDocumentiByIdProfile", e);
            }
            return pubblicazione;
        }

        [WebMethod]
        public virtual bool isRFEnabled()
        {
            bool rfEnabled = false;
            if (System.Configuration.ConfigurationManager.AppSettings["ENABLE_RF"].ToString() == "1")
                rfEnabled = true;
            return rfEnabled;
        }

        [WebMethod]
        public virtual bool IsVisibleUObyRuolo(DocsPaVO.utente.InfoUtente infoUtente, string idUO, string idMiaUo)
        {
            SetUserId(infoUtente);
            bool result = false;
            try
            {
                result = BusinessLogic.Amministrazione.UOManager.IsVisibleUObyRuolo(infoUtente, idUO, idMiaUo);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore nel - metodo: getRuoliSottopostiUO", ex);
            }

            return result;
        }

        #region Azioni di consolidamento del documento

        /// <summary>
        /// 
        /// </summary>
        /// <returns></returns>
        [WebMethod(Description = "Verifica la funzione di consolidamento  abilitata o meno")]
        public bool IsConsolidationEnabled()
        {
            try
            {
                return BusinessLogic.Documenti.DocumentConsolidation.IsConfigEnabled();
            }
            catch (Exception ex)
            {
                throw DocsPaUtils.Exceptions.SoapExceptionFactory.Create(ex);
            }
        }

        /// <summary>
        /// 
        /// </summary>
        /// <param name="userInfo"></param>
        /// <returns></returns>
        [WebMethod(Description = "Verifica se l'utente  abilitato all'utilizzo della funzione di consolidamento")]
        public bool HasDocumentConsolidationRights(DocsPaVO.utente.InfoUtente userInfo)
        {
            SetUserId(userInfo);
            try
            {
                return BusinessLogic.Documenti.DocumentConsolidation.HasDocumentConsolidationRights(userInfo);
            }
            catch (Exception ex)
            {
                throw DocsPaUtils.Exceptions.SoapExceptionFactory.Create(ex);
            }
        }

        /// <summary>
        /// 
        /// </summary>
        /// <param name="userInfo"></param>
        /// <param name="idDocument"></param>
        /// <returns></returns>
        [WebMethod(Description = "Reperimento dello stato di consolidamento attuale del documento")]
        public DocsPaVO.documento.DocumentConsolidationStateInfo GetDocumentConsolidationState(DocsPaVO.utente.InfoUtente userInfo, string idDocument)
        {
            SetUserId(userInfo);
            try
            {
                return BusinessLogic.Documenti.DocumentConsolidation.GetState(userInfo, idDocument);
            }
            catch (Exception ex)
            {
                throw DocsPaUtils.Exceptions.SoapExceptionFactory.Create(ex);
            }
        }

        /// <summary>
        /// 
        /// </summary>
        /// <param name="userInfo"></param>
        /// <param name="idDocument"></param>
        /// <param name="toState"></param>
        [WebMethod(Description = "Azione di consolidamento di un documento")]
        public DocsPaVO.documento.DocumentConsolidationStateInfo ConsolidateDocumentById(DocsPaVO.utente.InfoUtente userInfo, string idDocument, DocsPaVO.documento.DocumentConsolidationStateEnum toState)
        {
            SetUserId(userInfo);
            DocsPaVO.Logger.CodAzione.Esito logResponse = DocsPaVO.Logger.CodAzione.Esito.OK;

            try
            {
                return BusinessLogic.Documenti.DocumentConsolidation.Consolidate(userInfo, idDocument, toState);
            }
            catch (Exception ex)
            {
                logResponse = DocsPaVO.Logger.CodAzione.Esito.KO;

                throw DocsPaUtils.Exceptions.SoapExceptionFactory.Create(ex);
            }
            finally
            {
                DocsPaVO.documento.InfoDocumento documentInfo = BusinessLogic.Documenti.DocManager.GetInfoDocumento(userInfo, idDocument, idDocument);

                string description = string.Empty;

                if (!string.IsNullOrEmpty(documentInfo.segnatura))
                    description = string.Format("Consolidamento N.ro Doc.:{0} / Segnatura:{1}", "", documentInfo.docNumber, documentInfo.segnatura);
                else
                    description = string.Format("Consolidamento N.ro Doc.:{0}", documentInfo.docNumber);

                description += Environment.NewLine + DocsPaVO.documento.DocumentConsolidationStateDescriptionAttribute.GetDescription(toState);

                BusinessLogic.UserLog.UserLog.WriteLog(userInfo,
                            "CONSOLIDADOCUMENTO",
                            idDocument,
                            description,
                            logResponse);
            }
        }

        /// <summary>
        /// 
        /// </summary>
        /// <param name="userInfo"></param>
        /// <param name="idDocument"></param>
        /// <param name="toState"></param>
        [WebMethod(Description = "Azione di consolidamento di un documento")]
        public DocsPaVO.documento.DocumentConsolidationStateInfo ConsolidateDocumentById_AM(DocsPaVO.utente.InfoUtente userInfo, string idDocument, DocsPaVO.documento.DocumentConsolidationStateEnum toState)
        {
            SetUserId(userInfo);
            DocsPaVO.Logger.CodAzione.Esito logResponse = DocsPaVO.Logger.CodAzione.Esito.OK;

            try
            {
                return BusinessLogic.Documenti.DocumentConsolidation.Consolidate(userInfo, idDocument, toState);
            }
            catch (Exception ex)
            {
                logResponse = DocsPaVO.Logger.CodAzione.Esito.KO;

                throw DocsPaUtils.Exceptions.SoapExceptionFactory.Create(ex);
            }
            finally
            {
                DocsPaVO.documento.InfoDocumento documentInfo = BusinessLogic.Documenti.DocManager.GetInfoDocumento(userInfo, idDocument, idDocument);

                string description = string.Empty;

                if (!string.IsNullOrEmpty(documentInfo.segnatura))
                    description = string.Format("Azioni Massive - Consolidamento N.ro Doc.:{0} / Segnatura:{1}", "", documentInfo.docNumber, documentInfo.segnatura);
                else
                    description = string.Format("Azioni Massive - Consolidamento N.ro Doc.:{0}", documentInfo.docNumber);

                description += Environment.NewLine + DocsPaVO.documento.DocumentConsolidationStateDescriptionAttribute.GetDescription(toState);

                BusinessLogic.UserLog.UserLog.WriteLog(userInfo,
                            "CONSOLIDADOCUMENTO",
                            idDocument,
                            description,
                            logResponse);
            }
        }

        #endregion

        [WebMethod]
        public virtual string VerifyAndSetTipoDoc(DocsPaVO.utente.InfoUtente infoUtente, ref DocsPaVO.documento.SchedaDocumento schedaDocumento)
        {
            SetUserId(infoUtente);
            string message = string.Empty;
            try
            {
                message = VerifyAndSetTypeDocOrFasc.VerifyAndSetManager.Instance.verifyTipoDoc(infoUtente, ref schedaDocumento);
            }
            catch (Exception e)
            {
                logger.Debug("Errore durante la verifica di una tipologia di documento.", e);
                message = "KO";
            }
            return message;
        }

        [WebMethod]
        public virtual string VerifyAndSetTipoFasc(DocsPaVO.utente.InfoUtente infoUtente, ref DocsPaVO.fascicolazione.Fascicolo fascicolo)
        {
            SetUserId(infoUtente);
            string message = string.Empty;
            try
            {
                message = VerifyAndSetTypeDocOrFasc.VerifyAndSetManager.Instance.verifyTipoFasc(infoUtente, ref fascicolo);
            }
            catch (Exception e)
            {
                logger.Debug("Errore durante la verifica di una tipologia di fascicolo.", e);
                message = "KO";
            }
            return message;
        }

        [WebMethod]
        public virtual DataSet DO_CDCGetDSReportControlloPreventivo(InfoUtente infoUtente, string CDCDataDa, string CDCDataA, string CDCCodiceUffici, string CDCCodiceMagistrato, string CDCCodiceRevisore)
        {
            SetUserId(infoUtente);
            DataSet result = new DataSet();
            try
            {
                ProspettiRiepilogativi.Model objM = new ProspettiRiepilogativi.Model();
                result = objM.DO_CDCGetDSReportControlloPreventivo(infoUtente.idAmministrazione, CDCDataDa, CDCDataA, CDCCodiceUffici, CDCCodiceMagistrato, CDCCodiceRevisore);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore nel recupero della connectionString - metodo: DO_GetDSReportControlloPreventivo", ex);
            }
            return result;
        }

        [WebMethod]
        public virtual DataSet DO_CDCGetDSReportControlloSuccessivo(InfoUtente infoUtente, string CDCDataDa, string CDCDataA, string CDCCodiceUffici, string CDCCodiceMagistrato, string CDCCodiceRevisore)
        {
            SetUserId(infoUtente);
            DataSet result = new DataSet();
            try
            {
                ProspettiRiepilogativi.Model objM = new ProspettiRiepilogativi.Model();
                result = objM.DO_CDCGetDSReportControlloSuccessivoSCCLA(infoUtente.idAmministrazione, CDCDataDa, CDCDataA, CDCCodiceUffici, CDCCodiceMagistrato, CDCCodiceRevisore);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore nel recupero della connectionString - metodo: DO_GetDSReportControlloSuccessivo", ex);
            }
            return result;
        }


        [WebMethod]
        public virtual DataSet DO_CDCGetDSReportControlloPreventivoSRC(InfoUtente infoUtente, string CDCDataDa, string CDCDataA, string CDCCodiceUffici, string CDCCodiceMagistrato, string CDCCodiceRevisore)
        {
            SetUserId(infoUtente);
            DataSet result = new DataSet();
            try
            {
                ProspettiRiepilogativi.Model objM = new ProspettiRiepilogativi.Model();
                result = objM.DO_CDCGetDSReportControlloPreventivoSRC(infoUtente.idAmministrazione, CDCDataDa, CDCDataA, CDCCodiceUffici, CDCCodiceMagistrato, CDCCodiceRevisore);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore nel recupero della connectionString - metodo: DO_GetDSReportControlloPreventivoSRC", ex);
            }
            return result;
        }


        [WebMethod]
        public virtual DataSet DO_CDCGetDSReportPensioniCivili(InfoUtente infoUtente, string CDCDataDa, string CDCDataA, string CDCCodiceUffici, string CDCCodiceMagistrato, string CDCCodiceRevisore)
        {
            SetUserId(infoUtente);
            DataSet result = new DataSet();
            try
            {
                ProspettiRiepilogativi.Model objM = new ProspettiRiepilogativi.Model();
                result = objM.DO_CDCGetDSReportPensioniCivili(infoUtente.idAmministrazione, CDCDataDa, CDCDataA, CDCCodiceUffici, CDCCodiceMagistrato, CDCCodiceRevisore);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore nel recupero della connectionString - metodo: DO_CDCGetDSReportPensioniCivili", ex);
            }
            return result;
        }

        [WebMethod]
        public virtual DataSet DO_CDCGetDSReportPensioniMilitari(InfoUtente infoUtente, string CDCDataDa, string CDCDataA, string CDCCodiceUffici, string CDCCodiceMagistrato, string CDCCodiceRevisore)
        {
            SetUserId(infoUtente);
            DataSet result = new DataSet();
            try
            {
                ProspettiRiepilogativi.Model objM = new ProspettiRiepilogativi.Model();
                result = objM.DO_CDCGetDSReportPensioniMilitari(infoUtente.idAmministrazione, CDCDataDa, CDCDataA, CDCCodiceUffici, CDCCodiceMagistrato, CDCCodiceRevisore);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore nel recupero della connectionString - metodo: DO_CDCGetDSReportPensioniMilitari", ex);
            }
            return result;
        }

        #region Gestione griglie

        /// <summary>
        /// Metodo web per il recupero delle informazioni su una griglia.
        /// </summary>
        /// <param name="gridId">Identificativo della griglia da caricare (null se si desidera caricare la griglia standard)</param>
        /// <param name="gridType">Tipo di ricerca in cui  inserita la griglia</param>
        /// <param name="userInfo">Informazioni sull'utente proprietario della griglia</param>
        /// <param name="role">Informazioni sul ruolo dell'utente properietario della griglia</param>
        /// <param name="templateId">Identificativo del template (eventualmente null se )</param>
        /// <returns></returns>
        [WebMethod(Description = "Metodo web per il reperimento di una griglia di ricerca")]
        [XmlInclude(typeof(DocsPaVO.Grid.Grid.GridTypeEnumeration))]
        [XmlInclude(typeof(DocsPaVO.Grid.SpecialField))]
        public DocsPaVO.Grid.Grid LoadGrid(
            String gridId,
            DocsPaVO.Grid.Grid.GridTypeEnumeration gridType,
            InfoUtente userInfo,
            Ruolo role,
            List<String> templatesId)
        {
            SetUserId(userInfo);
            // Valore da restituire
            DocsPaVO.Grid.Grid toReturn = null;

            try
            {
                toReturn = BusinessLogic.Grids.GridManager.LoadGrid(
                    gridId,
                    gridType,
                    userInfo,
                    role,
                    templatesId);

            }
            catch (Exception e)
            {
                logger.Debug("Errore durante il reperimento delle informazioni sulla griglia di ricerca.", e);

                // Caricamento della griglia standard
                toReturn = BusinessLogic.Grids.GridManager.GetEmergencyGrid(gridType);

            }

            // Restituzione della griglia
            return toReturn;

        }

        /// <summary>
        /// Funzione per il salvataggio della griglia
        /// </summary>
        /// <param name="grid"></param>
        /// <param name="userInfo"></param>
        /// <param name="role"></param>
        /// <returns>System id della griglia salvata o aggiornata</returns>
        [WebMethod]
        [XmlInclude(typeof(DocsPaVO.Grid.Grid.GridTypeEnumeration))]
        public String SaveGrid(
            DocsPaVO.Grid.Grid grid,
            InfoUtente userInfo,
            Ruolo role,
            String gridName,
            Boolean isTemporary,
            String isActive, String visibility)
        {
            try
            {
                return BusinessLogic.Grids.GridManager.SaveGrid(
                    grid,
                    userInfo,
                    role,
                    gridName,
                    isTemporary,
                    isActive, visibility);

            }
            catch (Exception e)
            {
                logger.Debug("Errore durante il salvataggio delle informazioni sulla griglia di ricerca.", e);

            }

            return String.Empty;

        }

        [WebMethod()]
        public DocsPaVO.Grid.Grid GetStandardGridForUser(
            InfoUtente userInfo,
            DocsPaVO.Grid.Grid.GridTypeEnumeration gridType)
        {

            // Griglia da restituire
            DocsPaVO.Grid.Grid toReturn = null;

            try
            {
                toReturn = BusinessLogic.Grids.GridManager.GetStandardGridForUser(
                    userInfo,
                    gridType);

            }
            catch (Exception e)
            {
                logger.Debug("Errore durante il reperimento delle informazioni sulla griglia di ricerca standard.", e);

                // Caricamento della griglia standard
                toReturn = BusinessLogic.Grids.GridManager.GetEmergencyGrid(gridType);
            }

            return toReturn;

        }

        [WebMethod()]
        public DocsPaVO.Grid.Grid GetGridFromSearchId(
            InfoUtente userInfo,
            string searchId, DocsPaVO.Grid.Grid.GridTypeEnumeration gridType)
        {
            // Griglia da restituire
            DocsPaVO.Grid.Grid toReturn = null;
            try
            {
                toReturn = BusinessLogic.Grids.GridManager.GetGridFromSearchId(
                    userInfo,
                    searchId,
                    gridType);

            }
            catch (Exception e)
            {
                logger.Debug("Errore durante il reperimento delle informazioni sulla griglia di ricerca standard.", e);

                // Caricamento della griglia standard
                toReturn = BusinessLogic.Grids.GridManager.GetEmergencyGrid(gridType);
            }

            return toReturn;

        }

        #endregion


        [WebMethod]
        [XmlInclude(typeof(ProspettiRiepilogativi.Parametro[]))]
        public virtual DataSet DO_StampaExportLogExcel(InfoUtente infoUtente, string data_inizio_iop, string data_fine_iop, string periodo_ipa, bool sottoposti, string ampiezza_ipa, string numero_ampiezza_ipa, string iagg, string ruolo, string uo, string rf, string aoo, string evento, string evento_secondario, string idAmministrazione, string descrizione_evento_secondario, string tipo_ruolo)
        {
            SetUserId(infoUtente);
            DataSet result = new DataSet();
            try
            {

                ProspettiRiepilogativi.Model objM = new ProspettiRiepilogativi.Model();

                result = objM.DO_StampaExportLogExcel(data_inizio_iop, data_fine_iop, periodo_ipa, sottoposti, ampiezza_ipa, numero_ampiezza_ipa, iagg, ruolo, uo, rf, aoo, evento, evento_secondario, idAmministrazione, descrizione_evento_secondario, tipo_ruolo);

            }
            catch (Exception ex)
            {
                logger.Debug("Errore nel - metodo: DO_StampaExportLogExcel", ex);
            }
            return result;
        }

        [WebMethod]
        public DocsPaVO.ProfilazioneDinamica.OggettoCustom[] GetValuesDropDownList(string oggettoCustomId, string tipo)
        {
            try
            {
                return BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.GetValuesDropDownList(oggettoCustomId, tipo);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore nel - metodo: GetValuesDropDownList", ex);
                return null;
            }
        }

        [WebMethod]
        public DocsPaVO.ProfilazioneDinamica.Contatore[] GetValuesContatoriDoc(DocsPaVO.ProfilazioneDinamica.OggettoCustom oggettoCustom)
        {
            try
            {
                return BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.GetValuesContatoriDoc(oggettoCustom);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore nel - metodo: GetValuesContatoriDoc", ex);
                return null;
            }
        }

        [WebMethod]
        public void SetValuesContatoreDoc(DocsPaVO.ProfilazioneDinamica.Contatore contatore)
        {
            try
            {
                BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.SetValuesContatoreDoc(contatore);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore nel - metodo: SetValuesContatoreDoc", ex);
            }
        }

        [WebMethod]
        public void DeleteValueContatoreDoc(DocsPaVO.ProfilazioneDinamica.Contatore contatore)
        {
            try
            {
                BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.DeleteValueContatoreDoc(contatore);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore nel - metodo: deleteValueContatoreDoc", ex);
            }
        }

        [WebMethod]
        public void InsertValuesContatoreDoc(DocsPaVO.ProfilazioneDinamica.Contatore contatore)
        {
            try
            {
                BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.InsertValuesContatoreDoc(contatore);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore nel - metodo: InsertValuesContatoreDoc", ex);
            }
        }

        [WebMethod(Description = "Metodo web per il recupero del nome di un modello di documenti a partire dal suo system id")]
        public String GetDocModelNameById(String modelId)
        {
            return BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.GetModelNameById(modelId);
        }

        [WebMethod(Description = "Metodo web per il recupero del nome di un modello di fascicoli a partire dal suo system id")]
        public String GetFascModelNameById(String modelId)
        {
            return BusinessLogic.ProfilazioneDinamica.ProfilazioneFascicoli.GetModelNameById(modelId);
        }

        [WebMethod]
        public bool IsDocAnnullatoByIdProfile(string idProfile)
        {
            bool success = false;
            try
            {
                success = BusinessLogic.Documenti.ProtoManager.IsDocAnnullatoByIdProfile(idProfile);
                return success;
            }
            catch (Exception ex)
            {
                logger.Debug("Errore nel - metodo: isDocAnnullato", ex);
                return success;
            }
        }

        [WebMethod()]
        public bool ExistGridPersonalizationFunction()
        {
            return BusinessLogic.Grids.GridManager.ExistGridPersonalizationFunction();
        }

        #region setUserId
        private void SetUserId(InfoUtente infoUtente)
        {
            if (infoUtente != null) SetUserId(infoUtente.userId);
        }

        private void SetUserId(OrgUtente infoUtente)
        {
            if (infoUtente != null) SetUserId(infoUtente.UserId);
        }

        private void SetUserId(Utente infoUtente)
        {
            if (infoUtente != null) SetUserId(infoUtente.userId);
        }

        private void SetUserId(string userId)
        {
            if (!string.IsNullOrEmpty(userId)) LogicalThreadContext.Properties["userId"] = userId.ToUpper();
        }
        #endregion

        /// <summary>
        /// Controllo della connessione al database
        /// </summary>
        [WebMethod]
        public bool CheckConnection(out string exceptionMessage)
        {
            bool result = true; // Presume successo
            exceptionMessage = null;

            try
            {
                result = BusinessLogic.Amministrazione.UtenteManager.Checkconnection();

            }
            catch (Exception ex)
            {
                exceptionMessage = ex.Message + " " + ex.StackTrace;
                result = false;
            }

            return result;
        }

        /// <summary>
        /// Funzione per il restore della griglia standard relativa ad un utente per una specifica tipologia di ricerca
        /// </summary>
        /// <param name="userId">Identificativo dell'utente per cui ripristinare la griglia</param>
        /// <param name="roleId">Id del ruolo proprietario della griglia</param>
        /// <param name="administrationId">Identificativo dell'amministrazione cui appartiene l'utente</param>
        /// <param name="gridType">Tipo di griglia da restituire</param>
        /// <returns>Griglia standard</returns>
        /*   [WebMethod()]
           public DocsPaVO.Grid.Grid RestoreStandardGridForUser(String userId, String roleId, String administrationId, DocsPaVO.Grid.Grid.GridTypeEnumeration gridType)
           {
               return BusinessLogic.Grids.GridManager.RestoreStandardGridForUser(userId, roleId, administrationId, gridType);
            
           }*/

        [WebMethod()]
        public ArrayList getModelliByDdlAmmPaging(string idAmm, int nPagina, DocsPaVO.filtri.FiltroRicerca[] filtriRicerca, out int numTotPag)
        {
            return BusinessLogic.Trasmissioni.ModelliTrasmissioni.getModelliByDdlAmmPaging(idAmm, nPagina, filtriRicerca, out numTotPag);
        }

        #region Impersonate utente

        [WebMethod(Description = "Metodo web per l'autenticazione di un utente e l'impersonificazione di un altro utente.")]
        public DocsPaVO.utente.InfoUtente LoginAndImpersonate(DocsPaVO.utente.UserLogin userLogin, String userToImpersonate)
        {
            return BusinessLogic.Utenti.Login.LoginAndImpersonate(userLogin, userToImpersonate);
        }

        #endregion

        /// <summary>
        /// </summary>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.documento.DirittoOggetto))]
        public virtual ArrayList DocumentoGetVisibilitaSemplificata(DocsPaVO.utente.InfoUtente infoUtente, string idProfile, bool cercaRimossi)
        {
            ArrayList objListaDiritti = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                objListaDiritti = BusinessLogic.Utenti.DirittiManager.getListaDirittiSemplificato(infoUtente, idProfile, cercaRimossi);
#if TRACE_WS
				pt.WriteLogTracer("DocumentoGetVisibilita");
#endif

            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoGetVisibilita", e);
                objListaDiritti = null;
            }

            return objListaDiritti;
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.fascicolazione.DirittoOggetto))]
        public virtual ArrayList FascicolazioneGetVisibilitaSemplificata(DocsPaVO.fascicolazione.InfoFascicolo infoFascicolo, bool cercaRimossi, string rootFolder)
        {
            ArrayList objListaDiritti = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                objListaDiritti = BusinessLogic.Utenti.DirittiManager.getListaDirittiFascSemplificata(infoFascicolo, cercaRimossi, rootFolder);
#if TRACE_WS
				pt.WriteLogTracer("FascicolazioneGetVisibilita");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneGetVisibilita", e);
                objListaDiritti = null;
            }

            return objListaDiritti;
        }

        [WebMethod]
        public virtual List<DispositivoStampaEtichetta> AmministrazioneGetDispositivoStampaEtichetta()
        {
            List<DispositivoStampaEtichetta> objListaDispositivi = null;
            try
            {
                objListaDispositivi = BusinessLogic.Amministrazione.AmministraManager.GetDispositiviStampaEtichetta();
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmministrazioneGetDispositivoStampaEtichetta", e);
                objListaDispositivi = null;
            }
            return objListaDispositivi;
        }
        [WebMethod]
        public virtual string GetDispositivoStampaUtente(string idPeople)
        {
            string dispositivostampaUtente = null;
            try
            {
                dispositivostampaUtente = BusinessLogic.Amministrazione.UtenteManager.GetDispositivoStampaUtente(idPeople);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetDispositivoStampaUtente", e);
                dispositivostampaUtente = null;
            }
            return dispositivostampaUtente;
        }

        #region M/Text CS

        [WebMethod(Description = "Funzione per il salvataggio del path di un documento M/Text associato ad una data versione di un documento")]
        public void SetMTextFullQualifiedName(DocsPaVO.MText.MTextDocumentInfo mTextDocInfo)
        {
            try
            {
                BusinessLogic.MText.MText.SetMTextFullQualifiedName(mTextDocInfo);

            }
            catch (Exception e)
            {
                throw DocsPaUtils.Exceptions.SoapExceptionFactory.Create(e);
            }
        }

        [WebMethod(Description = "Funzione per il reperimento del path di un documento M/Text associato ad una data versione di un documento")]
        public DocsPaVO.MText.MTextDocumentInfo GetMTextFullQualifiedName(DocsPaVO.MText.MTextDocumentInfo mTextDocInfo)
        {
            try
            {
                return BusinessLogic.MText.MText.GetMTextFullQualifiedName(mTextDocInfo);

            }
            catch (Exception e)
            {

                throw DocsPaUtils.Exceptions.SoapExceptionFactory.Create(e);
            }

        }

        #endregion

        /// <summary>
        /// Funzione per verificare se un documento  fascicolato in un fascicolo / sottofascicolo
        /// </summary>
        /// <param name="userInfo">Informazioni sull'utente richiedente</param>
        /// <param name="idProfile">Id del documento da verificare</param>
        /// <param name="project">Id del fascicolo da verificare. Valorizzare folderSelezionato per effettuare la verifica di fascicolazione in un sottofascicolo</param>
        /// <returns>True se il documento  gi fascicolato nel fascicolo / sottofascicolo</returns>
        [WebMethod(Description = "Funzione per verificare se un documento  fascicolato in un fascicolo / sottofascicolo")]
        public bool IsDocumentInFolderOrSubFolder(DocsPaVO.utente.InfoUtente userInfo, String idProfile, DocsPaVO.fascicolazione.Fascicolo project)
        {
            bool retVal = false;
            try
            {
                retVal = BusinessLogic.Fascicoli.FascicoloManager.IsDocumentInFolderOrSubFolder(userInfo, idProfile, project);
            }
            catch (Exception e)
            {
                throw DocsPaUtils.Exceptions.SoapExceptionFactory.Create(e);
            }

            return retVal;

        }

        [WebMethod]
        public virtual bool BonificaVisFascicoloAccettato(DocsPaVO.trasmissione.TrasmissioneUtente trasmissioneUtente, string idTrasmissione, DocsPaVO.utente.Ruolo ruolo, DocsPaVO.utente.InfoUtente infoUtente, out string errore)
        {
            logger.Info("BEGIN - Web Service - BonificaVisFascicoloAccettato");
            bool result = true;
            errore = string.Empty;

            try
            {
                result = BusinessLogic.Trasmissioni.ExecTrasmManager.BonificaVisFascicoloAccettato(trasmissioneUtente, idTrasmissione, ruolo, infoUtente, out errore);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: BonificaVisFascicoloAccettato", e);
                result = false;
            }
            logger.Info("END - Web Service - BonificaVisFascicoloAccettato");
            return result;
        }

        [WebMethod]
        public virtual System.Data.DataSet getTrasmissioneUtenteById(string idTrasmissioneUtente)
        {
            logger.Info("BEGIN - Web Service - getTrasmissioneUtenteById");
            System.Data.DataSet dsTrasmUtente = null;
            try
            {
                DocsPaDB.Query_DocsPAWS.Trasmissione trasm = new DocsPaDB.Query_DocsPAWS.Trasmissione();
                dsTrasmUtente = trasm.getTrasmissioneUtenteById(idTrasmissioneUtente);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getTrasmissioneUtenteById", e);
            }
            logger.Info("END - Web Service - getTrasmissioneUtenteById");
            return dsTrasmUtente;
        }

        [WebMethod]
        public virtual System.Data.DataSet getTrasmissioneSingolaById(string idTrasmissioneSingola)
        {
            logger.Info("BEGIN - Web Service - getTrasmissioneSingolaById");
            System.Data.DataSet dsTrasmSingola = null;
            try
            {
                DocsPaDB.Query_DocsPAWS.Trasmissione trasm = new DocsPaDB.Query_DocsPAWS.Trasmissione();
                dsTrasmSingola = trasm.getTrasmissioneSingolaById(idTrasmissioneSingola);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getTrasmissioneSingolaById", e);
            }
            logger.Info("END - Web Service - getTrasmissioneSingolaById");
            return dsTrasmSingola;
        }

        [WebMethod]
        public virtual ArrayList getModelliPerTrasmLite(string idAmm, DocsPaVO.utente.Registro[] registri, string idPeople, string idCorrGlobali, string idTipoDoc, string idDiagramma, string idStato, string cha_tipo_oggetto, string system_id, string idRuoloUtente, bool AllReg, string accessrights)
        {
            try
            {
                return BusinessLogic.Trasmissioni.ModelliTrasmissioni.getModelliPerTrasmLite(idAmm, registri, idPeople, idCorrGlobali, idTipoDoc, idDiagramma, idStato, cha_tipo_oggetto, system_id, idRuoloUtente, AllReg, accessrights);

            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getModelliPerTrasmLite", e);
                return null;
            }
        }

        [WebMethod]
        public virtual ArrayList getModelliPerTrasmLiteFasc(string idAmm, DocsPaVO.utente.Registro[] registri, string idPeople, string idCorrGlobali, string idTipoFasc, string idDiagramma, string idStato, string cha_tipo_oggetto, string system_id, string idRuoloUtente, bool AllReg, string accessrights)
        {
            try
            {
                return BusinessLogic.Trasmissioni.ModelliTrasmissioni.getModelliPerTrasmLiteFasc(idAmm, registri, idPeople, idCorrGlobali, idTipoFasc, idDiagramma, idStato, cha_tipo_oggetto, system_id, idRuoloUtente, AllReg, accessrights);

            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getModelliPerTrasmLiteFasc", e);
                return null;
            }
        }

        [WebMethod]
        public virtual string DocumentoGetCodiciClassifica(string idProfile, DocsPaVO.utente.InfoUtente infoUtente)
        {
            try
            {
                return BusinessLogic.Documenti.DocManager.DocumentoGetCodiciClassifica(idProfile, infoUtente);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoGetCodiciClassifica", e);
                return null;
            }
        }

        /// Imposta la ricevuta PEC
        /// 
        /// </summary>
        /// <param name="idRegistro" id registro o RF/>
        /// <param name="ricevutaPecDefault" valore di default, se impostato null, non viene modificato/>
        /// <param name="ricevutaPecOneTime" valore di invio temporaneo/>
        /// <param name="getData" se true fa una sola lettura, se false imposta pure i valori>
        /// <returns></returns>
        [WebMethod]
        public virtual string getSetRicevutaPec(string idRegistro, string ricevutaPecDefault, string ricevutaPecOneTime, bool getData, string addressMail)
        {
            string ricevutaPecLetta = string.Empty;
            try
            {
                CasellaRegistro[] caselle = BusinessLogic.Amministrazione.RegistroManager.GetMailRegistro(idRegistro);
                if (caselle != null && caselle.Length > 0)
                {
                    foreach (CasellaRegistro c in caselle)
                    {
                        if (c.EmailRegistro.Equals(addressMail))
                        {
                            ricevutaPecLetta = (!string.IsNullOrEmpty(c.RicevutaPEC)) ? c.RicevutaPEC : string.Empty;
                            if (getData)
                                return ricevutaPecLetta;

                            string ricevutaPecDefaultLetta = string.Empty;
                            if (ricevutaPecLetta == null)
                                ricevutaPecDefaultLetta = " ";
                            else
                                ricevutaPecDefaultLetta = ricevutaPecLetta.Substring(0, 1);

                            if (ricevutaPecDefault == null)
                                ricevutaPecDefault = ricevutaPecDefaultLetta;

                            if (ricevutaPecOneTime == ricevutaPecDefaultLetta)
                                ricevutaPecOneTime = string.Empty;
                            c.RicevutaPEC = (ricevutaPecLetta = string.Format("{0}{1}", ricevutaPecDefault, ricevutaPecOneTime));
                            new DocsPaDB.Query_DocsPAWS.Interoperabilita().setRicevutaPec(idRegistro, new DocsPaVO.amministrazione.CasellaRegistro[] { c });
                            break;
                        }
                    }
                }
                else
                {
                    logger.Debug("Errore in DocsPaWS.asmx  - metodo: setRicevutaPec, id Registro non trovato :" + idRegistro);
                }
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: setRicevutaPec", e);
            }
            return ricevutaPecLetta;
        }

        [WebMethod]
        public virtual DocsPaVO.ProfilazioneDinamica.Templates getTemplateDettagliFilterObjects(string docNumber, string idTipoAtto, string[] visibleFields)
        {
            try
            {
                return BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.getTemplateDettagliFilterObjects(docNumber, idTipoAtto, visibleFields);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getTemplateDettagli", e);
                return null;
            }
        }

        /// <summary>
        /// Trasmissione protocollo all'ufficio referente
        /// </summary>
        /// <param name="schedaDoc"></param>
        /// <param name="ruolo"></param>
        /// <param name="serverName"></param>
        /// <param name="RagioniVerificate"></param>
        /// <returns>bool</returns>
        [WebMethod]
        public bool TrasmettiProtocolloUfficioReferente(DocsPaVO.documento.SchedaDocumento schedaDoc, DocsPaVO.utente.Ruolo ruolo, string serverName, bool isEnableRef, DocsPaVO.utente.InfoUtente infoUtente, out bool RagioniVerificate, out string message)
        {
            bool result = true;
            message = "";
            RagioniVerificate = true;
            bool destTo = false;
            bool destCC = false;
            message = "";


            try
            {
                BusinessLogic.trasmissioni.TrasmProtoIntManager trasmProtoInt = new BusinessLogic.trasmissioni.TrasmProtoIntManager();

                /*       if (schedaDoc.tipoProto.Equals("P"))//se il protocollo  in partenza
                       {
                           if (((DocsPaVO.documento.ProtocolloUscita)(schedaDoc.protocollo)).destinatari != null && ((DocsPaVO.documento.ProtocolloUscita)(schedaDoc.protocollo)).destinatari.Count > 0)
                           {
                               destTo = true;
                               if (((DocsPaVO.documento.ProtocolloUscita)(schedaDoc.protocollo)).destinatariConoscenza != null && ((DocsPaVO.documento.ProtocolloUscita)(schedaDoc.protocollo)).destinatariConoscenza.Count > 0)
                               {
                                   destCC = true;
                               }
                           }
                       }
                       else if (schedaDoc.tipoProto.Equals("I"))//se il protocollo  interno
                       {
                           if (((DocsPaVO.documento.ProtocolloInterno)(schedaDoc.protocollo)).destinatari != null && ((DocsPaVO.documento.ProtocolloInterno)(schedaDoc.protocollo)).destinatari.Count > 0)
                           {
                               destTo = true;
                               if (((DocsPaVO.documento.ProtocolloInterno)(schedaDoc.protocollo)).destinatariConoscenza != null && ((DocsPaVO.documento.ProtocolloInterno)(schedaDoc.protocollo)).destinatariConoscenza.Count > 0)
                               {
                                   destCC = true;
                               }
                           }
                       }
       */
                // Verifica ragioni trasmissione
                if (!BusinessLogic.trasmissioni.TrasmProtoIntManager.VerificaRagioni(ruolo.idAmministrazione, isEnableRef, schedaDoc.tipoProto, destTo, destCC, out message)) throw new BusinessLogic.trasmissioni.TrasmProtoIntManager.RagioniNotFoundException();

                // Predisponi trasmissioni ai destinatari
                //DocsPaVO.trasmissione.Trasmissione trasmissione = trasmProtoInt.SetCorrispondentiTrasmissione(schedaDoc, ruolo, infoUtente);
                DocsPaVO.trasmissione.Trasmissione trasmissione = trasmProtoInt.SetCorrispondentiTrasmissioneUfficioReferente(schedaDoc, ruolo, infoUtente, out message);

                if (trasmissione.trasmissioniSingole.Count > 0)
                {

                    //Verifico se abilitare l'estensione gerarchica della visibilit per il documento
                    //da trasmettere.
                    if (!string.IsNullOrEmpty(schedaDoc.eredita))
                    {
                        ArrayList appoTrasmSingole = new ArrayList();
                        for (int i = 0; i < trasmissione.trasmissioniSingole.Count; i++)
                        {
                            DocsPaVO.trasmissione.TrasmissioneSingola trasmSing = new DocsPaVO.trasmissione.TrasmissioneSingola();
                            trasmSing = (DocsPaVO.trasmissione.TrasmissioneSingola)trasmissione.trasmissioniSingole[i];
                            trasmSing.ragione.eredita = schedaDoc.eredita;
                            appoTrasmSingole.Add(trasmSing);
                        }
                        trasmissione.trasmissioniSingole = appoTrasmSingole;
                    }
                    if (infoUtente.delegato != null)
                        trasmissione.delegato = ((DocsPaVO.utente.InfoUtente)(infoUtente.delegato)).idPeople;

                    // Salvataggio e Esecuzione della trasmissione solamente se il destinatario != mittente
                    this.TrasmissioneSaveTrasm(trasmissione);
                    this.TrasmissioneExecuteTrasm(serverName, trasmissione);
                }
            }
            catch (BusinessLogic.trasmissioni.TrasmProtoIntManager.RagioniNotFoundException)
            {
                RagioniVerificate = false;
            }
            catch (Exception)
            {
                result = false;
            }

            return result;
        }

        [WebMethod]

        public virtual DocsPaVO.documento.FileDocumento ExportDocRicOrder(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.filtri.FiltroRicerca[][] filtri, string exportType, string title, DocsPaVO.ricerche.FullTextSearchContext context, ArrayList campiSelezionati, String[] documentsSystemId, DocsPaVO.Grid.Grid grid, bool useTraditionaExport)
        {
            DocsPaVO.documento.FileDocumento file = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                bool mittDettIndirizzo = false;
                if (System.Configuration.ConfigurationManager.AppSettings["MITT_DEST_ADDRESS"] != null && System.Configuration.ConfigurationManager.AppSettings["MITT_DEST_ADDRESS"].ToUpper() == "TRUE")
                    mittDettIndirizzo = Convert.ToBoolean(System.Configuration.ConfigurationManager.AppSettings["MITT_DEST_ADDRESS"]);

                BusinessLogic.ExportDati.ExportDatiManager manager = new BusinessLogic.ExportDati.ExportDatiManager();
                file = manager.ExportDocRicOrder(infoUtente, filtri, exportType, title, context, campiSelezionati, mittDettIndirizzo, documentsSystemId, grid, useTraditionaExport);
#if TRACE_WS
				pt.WriteLogTracer("ExportRicercaDoc");
#endif
                if (file != null)
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "EXPORTRICERCA", "0", "Export in " + exportType + " del risultato ricerca documenti", DocsPaVO.Logger.CodAzione.Esito.OK);
            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "EXPORTRICERCA", "0", "Export in " + exportType + " del risultato ricerca documenti", DocsPaVO.Logger.CodAzione.Esito.KO);
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ExportRicercaDoc", e);
                file = null;
            }

            return file;
        }

        /// <summary>
        /// WS per effettuare l'export dei risultati della ricerca dei fascicoli
        /// </summary>
        /// <param name="userInfo">info utente</param>
        /// <param name="registro">info registro</param>
        /// <param name="enableUfficioRef">ufficio referente abilitato</param>
        /// <param name="enableChilds">'Mostra tutti i fascicoli' abilitato</param>
        /// <param name="classificazione">classificazione impostata dall'utente</param>
        /// <param name="filtri">filtri impostati dall'utente</param>
        /// <param name="exportType">possibili valori: PDF o XLS</param>
        /// <param name="title">titolo che dovr comparire al file di export</param>
        /// <param name="idProjectsList">Array dei system id dei fascicoli selezionati</param>
        /// <param name="grid">Griglia da utilizzare per l'export</param>
        /// <returns>oggetto FileDocumento</returns>
        [WebMethod]
        public virtual DocsPaVO.documento.FileDocumento ExportRicercaFascRicOrder(DocsPaVO.utente.InfoUtente userInfo, DocsPaVO.utente.Registro registro, bool enableUfficioRef, bool enableProfilazione, bool enableChilds, DocsPaVO.fascicolazione.Classificazione classificazione, DocsPaVO.filtri.FiltroRicerca[][] filtri, string exportType, string title, ArrayList campiSelezionati, String[] idProjectsList, DocsPaVO.Grid.Grid grid, bool useTraditionaExport)
        {
            DocsPaVO.documento.FileDocumento file = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                BusinessLogic.ExportDati.ExportDatiManager manager = new BusinessLogic.ExportDati.ExportDatiManager();
                file = manager.ExportFascRicOrder(userInfo, registro, enableUfficioRef, enableProfilazione, enableChilds, classificazione, filtri, exportType, title, campiSelezionati, idProjectsList, grid, useTraditionaExport);
#if TRACE_WS
				pt.WriteLogTracer("ExportRicercaFasc");
#endif
                if (file != null)
                    BusinessLogic.UserLog.UserLog.WriteLog(userInfo, "EXPORTRICERCA", registro.systemId, "Export in " + exportType + " del risultato ricerca fascicoli nel registro " + registro.codRegistro, DocsPaVO.Logger.CodAzione.Esito.OK);
            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(userInfo, "EXPORTRICERCA", registro.systemId, "Export in " + exportType + " del risultato ricerca fascicoli nel registro " + registro.codRegistro, DocsPaVO.Logger.CodAzione.Esito.KO);
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ExportRicercaFasc", e);
                file = null;
            }

            return file;
        }

        /// <summary>
        /// Servizio web per il caricamento delle informazioni di base relative alle griglie salvate per un dato utente
        /// appartenente ad un dato ruolo definito per una certa amministrazione e per un particolare tipo di ricerca
        /// </summary>
        /// <param name="userId">Identificativo dell'utente</param>
        /// <param name="roleId">Identificativo del ruolo</param>
        /// <param name="administrationId">Identificativo dell'amministrazione</param>
        /// <param name="gridType">Tipo di griglia</param>
        ///<returns>Lista di oggetti con le informazioni di base sulle griglie  definite da un utente</returns>
        [WebMethod(Description = "Reperimento informazioni di base sulle griglie")]
        public List<DocsPaVO.Grid.GridBaseInfo> GetGridsBaseInfo(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.Grid.Grid.GridTypeEnumeration gridType, bool allGrids)
        {
            return BusinessLogic.Grids.GridManager.GetGridsBaseInfo(infoUtente, gridType, allGrids);
        }

        [WebMethod]
        public bool verificaNomeRicercaModifica(string nome, DocsPaVO.utente.InfoUtente infoUtente, string pagina, string idRicerca)
        {
            return BusinessLogic.Documenti.InfoDocManager.ExistsSearchNameModify(nome, infoUtente, pagina, idRicerca);
        }

        [WebMethod]
        public DocsPaVO.ricerche.SearchItem ModificaRicerca(DocsPaVO.ricerche.SearchItem item, DocsPaVO.utente.InfoUtente infoUtente, bool customGrid, string gridId, Grid tempGrid, Grid.GridTypeEnumeration gridType)
        {
            DocsPaVO.ricerche.SearchItem returnItem = null;
            try
            {
                returnItem = BusinessLogic.Documenti.InfoDocManager.ModifySearchItem(item, customGrid, gridId, tempGrid, infoUtente, gridType);
                if (returnItem != null)
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "MODIFICARICERCA", item.system_id.ToString(), "Modifica ricerca salvata " + item.system_id, DocsPaVO.Logger.CodAzione.Esito.OK);
            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "MODIFICARICERCA", item.system_id.ToString(), "Modifica ricerca salvata " + item.system_id, DocsPaVO.Logger.CodAzione.Esito.KO);
                logger.Debug("Errore nella modifica della ricerca");
            }
            return returnItem;
        }

        [WebMethod()]
        public DocsPaVO.Grid.Grid GetUserGridCustom(
            InfoUtente userInfo,
            DocsPaVO.Grid.Grid.GridTypeEnumeration gridType)
        {

            // Griglia da restituire
            DocsPaVO.Grid.Grid toReturn = null;

            try
            {
                toReturn = BusinessLogic.Grids.GridManager.GetUserGridCustom(
                    userInfo,
                    gridType);

            }
            catch (Exception e)
            {
                logger.Debug("Errore durante il reperimento delle informazioni sulla griglia di ricerca standard.", e);

                // Caricamento della griglia standard
                toReturn = BusinessLogic.Grids.GridManager.GetEmergencyGrid(gridType);
            }

            return toReturn;

        }

        /// Funzione per il salvataggio della griglia
        /// </summary>
        /// <param name="grid"></param>
        /// <param name="userInfo"></param>
        /// <param name="role"></param>
        /// <returns>System id della griglia salvata o aggiornata</returns>
        [WebMethod]
        public bool RemoveGrid(GridBaseInfo gridBase,
            InfoUtente userInfo)
        {
            bool result = false;
            try
            {
                result = BusinessLogic.Grids.GridManager.RemoveUserGrid(gridBase, userInfo);
                //result = BusinessLogic.Grids.GridManager.RemoveUserGrid(gridId,userInfo,isActive);

            }
            catch (Exception e)
            {
                logger.Debug("Errore durante la rimozione della griglia di ricerca di un utente.", e);

            }

            return result;

        }

        [WebMethod()]
        public Boolean RemovePreferred(
            string userSystemId,
            string roleId,
            string administrationId,
            DocsPaVO.Grid.Grid.GridTypeEnumeration gridType)
        {

            bool success = false;

            try
            {
                BusinessLogic.Grids.GridManager.RemovePreferred(userSystemId, roleId, administrationId, gridType);

            }
            catch (Exception e)
            {
                logger.Debug("Errore durante la cancellazione delel griglie preferite", e);

                success = false;
            }

            return success;

        }

        /// <summary>
        /// Funzione per il salvataggio della griglia
        /// </summary>
        /// <param name="grid"></param>
        /// <param name="userInfo"></param>
        /// <param name="role"></param>
        /// <returns>System id della griglia salvata o aggiornata</returns>
        [WebMethod]
        [XmlInclude(typeof(DocsPaVO.Grid.Grid.GridTypeEnumeration))]
        public String SaveNewGrid(
            DocsPaVO.Grid.Grid grid,
            InfoUtente userInfo,
            String gridName,
            String visibility,
            Boolean isPreferred)
        {
            try
            {
                return BusinessLogic.Grids.GridManager.SaveNewGrid(
                    grid, userInfo, gridName, visibility, isPreferred);

            }
            catch (Exception e)
            {
                logger.Debug("Errore durante il salvataggio delle informazioni sulla griglia di ricerca.", e);

            }

            return String.Empty;

        }

        /// <summary>
        /// Funzione per il salvataggio della griglia
        /// </summary>
        /// <param name="grid"></param>
        /// <param name="userInfo"></param>
        /// <param name="role"></param>
        /// <returns>System id della griglia salvata o aggiornata</returns>
        [WebMethod]
        [XmlInclude(typeof(DocsPaVO.Grid.Grid.GridTypeEnumeration))]
        public void RemovePreferredTypeGrid(
            InfoUtente infoUser, DocsPaVO.Grid.Grid.GridTypeEnumeration gridType)
        {
            try
            {
                BusinessLogic.Grids.GridManager.RemovePreferredTypeGrid(
                    infoUser, gridType);

            }
            catch (Exception e)
            {
                logger.Debug("Errore durante il salvataggio delle informazioni sulla griglia di ricerca.", e);

            }

        }

        /// <summary>
        /// Funzione per il salvataggio della griglia
        /// </summary>
        /// <param name="grid"></param>
        /// <param name="userInfo"></param>
        /// <param name="role"></param>
        /// <returns>System id della griglia salvata o aggiornata</returns>
        [WebMethod]
        [XmlInclude(typeof(DocsPaVO.Grid.Grid.GridTypeEnumeration))]
        public void AddPreferredGrid(String gridId,
            InfoUtente infoUser, DocsPaVO.Grid.Grid.GridTypeEnumeration gridType)
        {
            try
            {
                BusinessLogic.Grids.GridManager.AddPreferredGrid(gridId,
                    infoUser, gridType);

            }
            catch (Exception e)
            {
                logger.Debug("Errore durante il salvataggio delle informazioni sulla griglia di ricerca.", e);

            }

        }

        /// <summary>
        /// Funzione per il salvataggio della griglia
        /// </summary>
        /// <param name="grid"></param>
        /// <param name="userInfo"></param>
        /// <param name="role"></param>
        /// <returns>System id della griglia salvata o aggiornata</returns>
        [WebMethod]
        [XmlInclude(typeof(DocsPaVO.Grid.Grid.GridTypeEnumeration))]
        public String ModifyGrid(
            DocsPaVO.Grid.Grid grid,
            InfoUtente userInfo,
            String visibility,
            Boolean isPreferred)
        {
            try
            {
                return BusinessLogic.Grids.GridManager.ModifyGrid(
                    grid, userInfo, visibility, isPreferred);

            }
            catch (Exception e)
            {
                logger.Debug("Errore durante il salvataggio delle informazioni sulla griglia di ricerca.", e);

            }

            return String.Empty;

        }

        /// <summary>
        /// Nuova funzione di ricerca documenti
        /// </summary>
        [WebMethod]
        [XmlInclude(typeof(DocsPaVO.Grids.SearchObjectField))]
        [XmlInclude(typeof(DocsPaVO.Grid.Field))]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.Grids.SearchObject))]
        public virtual ArrayList DocumentoGetQueryDocumentoPagingCustom(InfoUtente infoUtente, DocsPaVO.filtri.FiltroRicerca[][] queryList, int numPage, bool security, int pageSize, out int numTotPage, out int nRec, bool getIdProfilesList, bool gridPersonalization, bool export, Field[] visibleFieldsTemplate, String[] documentsSystemId, out List<SearchResultInfo> idProfileList)
        {
            List<SearchResultInfo> toSet = new List<SearchResultInfo>();
            ArrayList objListaInfoDocumenti = null;
            numTotPage = 0;
            nRec = 0;

            try
            {
                objListaInfoDocumenti = BusinessLogic.Documenti.InfoDocManager.getQueryPagingCustom(infoUtente, queryList, numPage, pageSize, security, export, gridPersonalization, visibleFieldsTemplate, documentsSystemId, out numTotPage, out nRec, getIdProfilesList, out toSet);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoGetQueryDocumentoPagingCustom", e);

                objListaInfoDocumenti = null;
            }
            idProfileList = toSet;
            return objListaInfoDocumenti;
        }

        [WebMethod]
        public virtual DocsPaVO.documento.FileDocumento ExportDocCustom(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.filtri.FiltroRicerca[][] filtri, string exportType, string title, DocsPaVO.ricerche.FullTextSearchContext context, ArrayList campiSelezionati, String[] documentsSystemId, DocsPaVO.Grid.Grid grid, bool gridPersonalization, Field[] visibleFieldsTemplate)
        {
            DocsPaVO.documento.FileDocumento file = null;

            try
            {
                BusinessLogic.ExportDati.ExportDatiManager manager = new BusinessLogic.ExportDati.ExportDatiManager();
                file = manager.ExportDocCustom(infoUtente, filtri, exportType, title, context, campiSelezionati, documentsSystemId, grid, gridPersonalization, visibleFieldsTemplate);

                if (file != null)
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "EXPORTRICERCA", "0", "Export in " + exportType + " del risultato ricerca documenti", DocsPaVO.Logger.CodAzione.Esito.OK);
            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "EXPORTRICERCA", "0", "Export in " + exportType + " del risultato ricerca documenti", DocsPaVO.Logger.CodAzione.Esito.KO);
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ExportDocCustom", e);
                file = null;
            }

            return file;
        }

        [WebMethod]
        [XmlInclude(typeof(DocsPaVO.Grids.SearchObjectField))]
        [XmlInclude(typeof(DocsPaVO.Grid.Field))]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.Grids.SearchObject))]
        public virtual ArrayList FascicolazioneGetListaFascicoliPagingCustom(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.fascicolazione.Classificazione classificazione, DocsPaVO.utente.Registro registro, DocsPaVO.filtri.FiltroRicerca[] listaFiltri, bool enableUfficioRef, bool enableProfilazione, bool childs, int numPage, out int numTotPage, out int nRec, int pageSize, bool getSystemIdList, out List<SearchResultInfo> idProjectList, byte[] excelDati, bool showGridPersonalization, bool export, Field[] visibleFieldsTemplate, String[] documentsSystemId, bool security)
        {
            ArrayList result = null;
            nRec = 0;
            numTotPage = 0;

            // Lista dei system id dei fascicoli restituiti dalla ricerca
            List<SearchResultInfo> idProjects = null;

            // PALUMBO: modificato per ovviare al blocco dell'accesso su macchina 20 in scrittura    
            //string serverPath = System.Configuration.ConfigurationManager.AppSettings["LOG_PATH"];
            string serverPath = DocsPaUtils.Configuration.InitConfigurationKeys.GetValue("0", "BE_LOG_PATH");
            if (!string.IsNullOrEmpty(serverPath))
            {
                serverPath = serverPath.Replace("%DATA", DateTime.Now.ToString("yyyyMMdd"));
            }

            try
            {
                result = BusinessLogic.Fascicoli.FascicoloManager.getListaFascicoliPagingCustom(infoUtente, classificazione, registro, listaFiltri, enableUfficioRef, enableProfilazione, childs, out numTotPage, out nRec, numPage, pageSize, getSystemIdList, out idProjects, excelDati, serverPath, showGridPersonalization, export, visibleFieldsTemplate, documentsSystemId, security);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneGetListaFascicoliPagingCustom", e);
                result = null;
            }

            // Assegnazione della lista dei system id dei fascicoli
            idProjectList = idProjects;

            return result;
        }

        [WebMethod]
        public virtual DocsPaVO.documento.FileDocumento ExportRicercaFascCustom(DocsPaVO.utente.InfoUtente userInfo, DocsPaVO.utente.Registro registro, bool enableUfficioRef, bool enableProfilazione, bool enableChilds, DocsPaVO.fascicolazione.Classificazione classificazione, DocsPaVO.filtri.FiltroRicerca[][] filtri, string exportType, string title, ArrayList campiSelezionati, String[] idProjectsList, DocsPaVO.Grid.Grid grid, bool gridPersonalization, Field[] visibleFieldsTemplate, bool security)
        {
            SetUserId(userInfo);
            DocsPaVO.documento.FileDocumento file = null;

            try
            {

                BusinessLogic.ExportDati.ExportDatiManager manager = new BusinessLogic.ExportDati.ExportDatiManager();
                file = manager.ExportFascCustom(userInfo, registro, enableUfficioRef, enableProfilazione, enableChilds, classificazione, filtri, exportType, title, campiSelezionati, idProjectsList, grid, gridPersonalization, visibleFieldsTemplate, security);

                if (file != null)
                    BusinessLogic.UserLog.UserLog.WriteLog(userInfo, "EXPORTRICERCA", registro.systemId, "Export in " + exportType + " del risultato ricerca fascicoli nel registro " + registro.codRegistro, DocsPaVO.Logger.CodAzione.Esito.OK);
            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(userInfo, "EXPORTRICERCA", registro.systemId, "Export in " + exportType + " del risultato ricerca fascicoli nel registro " + registro.codRegistro, DocsPaVO.Logger.CodAzione.Esito.KO);
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ExportRicercaFasc", e);
                file = null;
            }

            return file;
        }

        [WebMethod]
        [XmlInclude(typeof(DocsPaVO.Grids.SearchObjectField))]
        [XmlInclude(typeof(DocsPaVO.Grids.SearchObject))]
        public virtual SearchObject GetObjectFascicoloBySystemId(string systemId, InfoUtente infoUtente)
        {
            SearchObject result = null;


            try
            {
                result = BusinessLogic.Fascicoli.FascicoloManager.GetObjectFascicoloBySystemId(systemId, infoUtente);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetObjectFascicoloBySystemId", e);
                result = null;
            }

            return result;
        }

        [WebMethod]
        [XmlInclude(typeof(DocsPaVO.Grids.SearchObjectField))]
        [XmlInclude(typeof(DocsPaVO.Grid.Field))]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.Grids.SearchObject))]
        public virtual ArrayList FascicolazioneGetDocumentiPagingWithFiltersCustom(
            DocsPaVO.utente.InfoUtente infoUtente,
            DocsPaVO.fascicolazione.Folder folder,
            DocsPaVO.filtri.FiltroRicerca[][] filtriRicerca,
            int numPage,
            out int numTotPage,
            out int nRec,
            bool compileIdProfileList,
            bool showGridPersonalization,
            bool export,
            Field[] visibleFieldsTemplate,
            String[] documentsSystemId,
            int pageSize,
            DocsPaVO.filtri.FiltroRicerca[][] orderRicerca,
            out List<SearchResultInfo> idProfiles)
        {
            nRec = 0;
            numTotPage = 0;
            ArrayList objListaDocumenti = null;
            List<SearchResultInfo> idProfileList = null;
            try
            {

                objListaDocumenti = BusinessLogic.Fascicoli.FolderManager.getDocumentiPagingCustom(infoUtente, folder, filtriRicerca, numPage, out numTotPage, out nRec, compileIdProfileList, out idProfileList, showGridPersonalization, export, visibleFieldsTemplate, documentsSystemId, pageSize, orderRicerca);

            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneGetDocumentiPagingWithFiltersCustom", e);
                objListaDocumenti = null;
            }

            idProfiles = idProfileList;
            return objListaDocumenti;
        }

        ///<summary>
        ///WS per effettuare l'export dei risultati della ricerca dei documenti di un dato fascicolo
        ///</summary>
        [WebMethod]
        public virtual DocsPaVO.documento.FileDocumento ExportRicercaDocInFascCustom(DocsPaVO.fascicolazione.Folder folder, string codFascicolo, string exportType, string title, DocsPaVO.filtri.FiltroRicerca[][] filtriRicerca, DocsPaVO.utente.InfoUtente infoUtente, ArrayList campiSelezionati, String[] documentsSystemId, DocsPaVO.Grid.Grid grid, bool gridPersonalization, Field[] visibleFieldsTemplate, DocsPaVO.filtri.FiltroRicerca[][] filtriRicercaOrdinamento)
        {
            SetUserId(infoUtente);
            DocsPaVO.documento.FileDocumento file = null;

            try
            {
                bool mittDettIndirizzo = false;
                if (System.Configuration.ConfigurationManager.AppSettings["MITT_DEST_ADDRESS"] != null && System.Configuration.ConfigurationManager.AppSettings["MITT_DEST_ADDRESS"].ToUpper() == "TRUE")
                    mittDettIndirizzo = Convert.ToBoolean(System.Configuration.ConfigurationManager.AppSettings["MITT_DEST_ADDRESS"]);

                BusinessLogic.ExportDati.ExportDatiManager manager = new BusinessLogic.ExportDati.ExportDatiManager();
                file = manager.ExportDocInFascCustom(infoUtente, folder, codFascicolo, exportType, title, filtriRicerca, campiSelezionati, documentsSystemId, grid, gridPersonalization, visibleFieldsTemplate, filtriRicercaOrdinamento);
                if (file != null)
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "EXPORTRICERCA", folder.systemID, "Export in " + exportType + " del risultato ricerca documenti nel fascicolo " + codFascicolo, DocsPaVO.Logger.CodAzione.Esito.OK);
            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "EXPORTRICERCA", folder.systemID, "Export in " + exportType + " del risultato ricerca documenti nel fascicolo " + codFascicolo, DocsPaVO.Logger.CodAzione.Esito.KO);
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ExportRicercaDocInFascCustom", e);
                file = null;
            }

            return file;
        }


        /// <summary>
        /// Servizio web per la generazione del report
        /// </summary>
        /// <param name="request">Informazioni sulla richiesta</param>
        /// <returns>Response</returns>
        [WebMethod()]
        [XmlInclude(typeof(DocsPaVO.Report.PrintReportRequestDataset))]
        public DocsPaVO.Report.PrintReportResponse GenerateReport(DocsPaVO.Report.PrintReportRequest request)
        {
            DocsPaVO.Report.PrintReportResponse response = null;

            try
            {
                response = BusinessLogic.Reporting.ReportGeneratorCommand.GetReport(request);
            }
            catch (Exception e)
            {
                logger.DebugFormat("Errore durante la generazione del file di report {0}.", request.ReportKey, e);
                throw DocsPaUtils.Exceptions.SoapExceptionFactory.Create(e);

            }

            return response;
        }

        /// <summary>
        /// Servizio web per il reperimento dell'anagrafica dei report registrati
        /// </summary>
        /// <param name="contextName">Nome del contesto da cui viene richiesta l'anagrafica</param>
        /// <returns>Response contente l'anagrafica valorizzata</returns>
        [WebMethod()]
        [XmlInclude(typeof(DocsPaVO.Report.PrintReportObjectTransformationRequest))]
        public DocsPaVO.Report.PrintReportResponse GetReportRegistry(String contextName)
        {
            DocsPaVO.Report.PrintReportResponse response = null;

            try
            {
                response = BusinessLogic.Reporting.ReportGeneratorCommand.GetRegisteredReport(contextName);
            }
            catch (Exception e)
            {
                logger.Debug("Errore durante la generazione dell'anagrafica dei report registrati nel sistema.", e);
                throw DocsPaUtils.Exceptions.SoapExceptionFactory.Create(e);

            }

            return response;
        }

        /// <summary>
        /// Funzione per la ricerca e la sostituzione dei ruoli nei modelli di trasmissione
        /// </summary>
        /// <param name="request">Informazioni sull'azione da compiere</param>
        /// <returns>Risultato dell'operazione</returns>
        [WebMethod(Description = "Ricerca e sostituzione di ruoli in modelli di trasmissione")]
        public DocsPaVO.Modelli_Trasmissioni.FindAndReplaceResponse FindAndReplaceRoleInModelliTrasmissione(DocsPaVO.Modelli_Trasmissioni.FindAndReplaceRequest request)
        {
            DocsPaVO.Modelli_Trasmissioni.FindAndReplaceResponse response = null;

            try
            {
                response = BusinessLogic.Trasmissioni.ModelliTrasmissioni.FindAndReplaceRoleInModelliTrasmissione(request);
            }
            catch (Exception e)
            {
                DocsPaUtils.Exceptions.SoapExceptionFactory.Create(e);
            }

            return response;
        }

        [WebMethod(Description = "Metodo web per verificare se un fascicolo  un fascicolo generale")]
        public bool IsFascicoloGenerale(DocsPaVO.utente.InfoUtente userInfo, String idFascicolo)
        {
            bool retVal = false;

            try
            {
                retVal = BusinessLogic.Fascicoli.FascicoloManager.IsFascicoloGenerale(userInfo, idFascicolo);
            }
            catch (Exception e)
            {
                logger.Debug("Errore nel reperimento delle informazioni sul fascicolo", e);
                DocsPaUtils.Exceptions.SoapExceptionFactory.Create(new ApplicationException("Errore nel reperimento delle informazioni sul fascicolo"));
            }

            return retVal;
        }


        [WebMethod()]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.DiagrammaStato.Stato))]
        public ArrayList getStatiPerRicerca(String idDiagramma, string docOrFasc)
        {
            try
            {
                return BusinessLogic.DiagrammiStato.DiagrammiStato.getStatiPerRicerca(idDiagramma, docOrFasc);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getStatiPerRicerca", e);
                return null;
            }
        }

        /// <summary>
        /// Servizio web per la verifica delle esistenza di un codice uo
        /// </summary>
        /// <param name="request">XXXXXXXXXXXXXXXXXX</param>
        /// <returns> risultato dell'esistenza del codice UO</returns>
        [WebMethod()]
        public bool ammCheckCodiceUODuplicato(string id, string codice, string idAmm)
        {
            bool result = false;
            result = BusinessLogic.Amministrazione.OrganigrammaManager.ammCheckCodiceUODuplicato(id, codice, idAmm);
            return result;
        }


        /// <summary>
        /// Servizio web per il salvataggio delle modifiche apportate ad un ruolo
        /// </summary>
        /// <param name="request">Request con le informazioni sulle modifiche da compiere</param>
        /// <returns>Dettagli sul risultato del salvataggio delle modifiche</returns>
        [WebMethod()]
        [XmlInclude(typeof(DocsPaVO.amministrazione.SaveChangesToRoleReport))]
        public SaveChangesToRoleResponse SaveChangesToRole(SaveChangesToRoleRequest request)
        {
            return BusinessLogic.Amministrazione.OrganigrammaManager.SaveChangesToRole(request);
        }

        [WebMethod()]
        public virtual DocsPaVO.Security.InfoAtipicita GetInfoAtipicita(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.Security.InfoAtipicita.TipoOggettoAtipico tipoOggetto, string idDocOrFasc)
        {
            try
            {
                return BusinessLogic.Security.InfoAtipicitaManager.GetInfoAtipicita(infoUtente, tipoOggetto, idDocOrFasc);

            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getInfoAtipicita", e);
                return null;
            }
        }

        [WebMethod(Description = "Servizio per il recupero della storia delle modifiche apportate ad un ruolo")]
        public DocsPaVO.utente.RoleHistoryResponse GetRoleHistory(DocsPaVO.utente.RoleHistoryRequest request)
        {
            try
            {
                return BusinessLogic.Utenti.UserManager.GetRoleHistory(request);

            }
            catch (Exception e)
            {
                throw DocsPaUtils.Exceptions.SoapExceptionFactory.Create(e);
            }

        }


        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.trasmissione.Trasmissione))]
        public virtual ArrayList TrasmissioneGetQueryRicevuteLite(
            DocsPaVO.trasmissione.OggettoTrasm oggettoTrasmesso,
            DocsPaVO.filtri.FiltroRicerca[] listaFiltri,
            DocsPaVO.utente.Utente utente,
            DocsPaVO.utente.Ruolo ruolo,
            int pageNumber,
            bool excel,
            int pageSize,
            out int totalPageNumber,
            out int recordCount)
        {
            SetUserId(utente);
            ArrayList result = null;

            totalPageNumber = 0;
            recordCount = 0;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Trasmissioni.QueryTrasmManager.getQueryRicevuteMethodPagingLite(oggettoTrasmesso, utente, ruolo, listaFiltri, pageNumber, excel, pageSize, out totalPageNumber, out recordCount);
#if TRACE_WS
				pt.WriteLogTracer("TrasmissioneGetQueryRicevutePaging");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: TrasmissioneGetQueryRicevuteLite", e);
                result = null;
            }

            return result;
        }

        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.trasmissione.Trasmissione))]
        public virtual ArrayList TrasmissioneGetQueryRicevuteLiteWithoutTrasmUtente(
            DocsPaVO.trasmissione.OggettoTrasm oggettoTrasmesso,
            DocsPaVO.filtri.FiltroRicerca[] listaFiltri,
            DocsPaVO.utente.Utente utente,
            DocsPaVO.utente.Ruolo ruolo,
            int pageNumber,
            bool excel,
            int pageSize,
            out int totalPageNumber,
            out int recordCount)
        {
            SetUserId(utente);
            ArrayList result = null;

            totalPageNumber = 0;
            recordCount = 0;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Trasmissioni.QueryTrasmManager.getQueryRicevuteMethodPagingLiteWithoutTrasmUtente(oggettoTrasmesso, utente, ruolo, listaFiltri, pageNumber, excel, pageSize, out totalPageNumber, out recordCount);
#if TRACE_WS
				pt.WriteLogTracer("TrasmissioneGetQueryRicevutePaging");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: TrasmissioneGetQueryRicevuteLite", e);
                result = null;
            }

            return result;
        }


        [WebMethod(CacheDuration = 60, BufferResponse = true)]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.trasmissione.Trasmissione))]
        public virtual ArrayList TrasmissioneGetQueryEffettuatePagingLite(DocsPaVO.trasmissione.OggettoTrasm oggettoTrasmesso, DocsPaVO.filtri.FiltroRicerca[] listaFiltri, DocsPaVO.utente.Utente utente, DocsPaVO.utente.Ruolo ruolo, int pageNumber, bool excel,
            int pageSize, out int totalPageNumber, out int recordCount)
        {
            SetUserId(utente);
            ArrayList result = null;

            totalPageNumber = 0;
            recordCount = 0;

            try
            {
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Trasmissioni.QueryTrasmManager.getQueryEffettuateMethodPagingLite(oggettoTrasmesso, utente, ruolo, listaFiltri, pageNumber, excel, pageSize, out totalPageNumber, out recordCount);
#if TRACE_WS
				pt.WriteLogTracer("TrasmissioneGetQueryEffettuate");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: TrasmissioneGetQueryEffettuatePagingLite", e);
                result = null;
            }

            return result;
        }

        [WebMethod(CacheDuration = 60, BufferResponse = true)]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.trasmissione.Trasmissione))]
        public virtual ArrayList TrasmissioneGetQueryEffettuatePagingLiteWithoutTrasmUtente(DocsPaVO.trasmissione.OggettoTrasm oggettoTrasmesso, DocsPaVO.filtri.FiltroRicerca[] listaFiltri, DocsPaVO.utente.Utente utente, DocsPaVO.utente.Ruolo ruolo, int pageNumber, bool excel,
            int pageSize, out int totalPageNumber, out int recordCount)
        {
            SetUserId(utente);
            ArrayList result = null;

            totalPageNumber = 0;
            recordCount = 0;

            try
            {
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Trasmissioni.QueryTrasmManager.getQueryEffettuateMethodPagingLiteWithoutTrasmUtente(oggettoTrasmesso, utente, ruolo, listaFiltri, pageNumber, excel, pageSize, out totalPageNumber, out recordCount);
#if TRACE_WS
				pt.WriteLogTracer("TrasmissioneGetQueryEffettuate");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: TrasmissioneGetQueryEffettuatePagingLite", e);
                result = null;
            }

            return result;
        }

        [WebMethod]
        public virtual DocsPaVO.ProfilazioneDinamica.Templates getTemplatePerRicercaById(string idAtto)
        {
            try
            {
                return BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.getTemplatePerRicercaById(idAtto);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getTemplatePerRicerca", e);
                return null;
            }
        }
        [WebMethod()]
        public virtual EsitoOperazione CopyVisibility(InfoUtente infoUtente, DocsPaVO.Security.CopyVisibility copyVisibility)
        {
            try
            {
                return BusinessLogic.Amministrazione.OrganigrammaManager.CopyVisibility(infoUtente, copyVisibility);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: CopyVisibility", e);
                return null;
            }
        }

        /// <summary>
        /// Metodo per verificare se un ruolo  storicizzato
        /// </summary>
        /// <param name="authorCorrGlob">Id group del ruolo attuale</param>
        /// <returns>True se il ruolo  storicizzato</returns>
        [WebMethod(Description = "Servizio per verificare se un ruolo  disabilitato")]
        public bool CheckIfRoleDisabled(String authorCorrGlob)
        {
            try
            {
                //commentato perch risolve troppe risorse
                ////SAB 02052013 MIN SALUTE - perch il metodo consuma molte risorse
                //return BusinessLogic.Utenti.UserManager.CheckIfRoleDisabled(authorCorrGlob);
                return false;

            }
            catch (Exception e)
            {
                throw DocsPaUtils.Exceptions.SoapExceptionFactory.Create(e);
            }

        }

        /// <summary>
        /// Servizio per il salvataggio dello stato di abilitazione dello storico per determinati campi della tipologia
        /// </summary>
        /// <param name="request">Informazioni sull'operazione da eseguire</param>
        /// <returns>Esit dell'abilitazione</returns>
        [WebMethod(Description = "Servizio per abilitare lo storico solo su determinati campi profilati")]
        public DocsPaVO.ProfilazioneDinamica.SelectiveHistoryResponse ActiveSelectiveHistory(DocsPaVO.ProfilazioneDinamica.SelectiveHistoryRequest request)
        {
            // Risultato dell'elaborazione
            DocsPaVO.ProfilazioneDinamica.SelectiveHistoryResponse retVal = new DocsPaVO.ProfilazioneDinamica.SelectiveHistoryResponse();

            try
            {
                switch (request.ObjType)
                {
                    case DocsPaVO.ProfilazioneDinamica.SelectiveHistoryRequest.ObjectType.Document:
                        retVal = BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.ActiveSelectiveHistory(request);
                        break;
                    case DocsPaVO.ProfilazioneDinamica.SelectiveHistoryRequest.ObjectType.Folder:
                        retVal = BusinessLogic.ProfilazioneDinamica.ProfilazioneFascicoli.ActiveSelectiveHistory(request);
                        break;

                }
            }
            catch (Exception e)
            {

            }

            return retVal;
        }

        /// <summary>
        /// Metodo web per la disattivazione dello storico relativo ai campi di una specifica tipologia
        /// </summary>
        /// <param name="request">Informazioni sulla tipologia di cui disattivare la storicizzaizone dei campi</param>
        /// <returns>Esito della richiesta</returns>
        [WebMethod(Description = "Metodo web per la disattivazione dello storico relativo ai campi di una specifica tipologia")]
        public DocsPaVO.ProfilazioneDinamica.SelectiveHistoryResponse DeactivateAllHistory(DocsPaVO.ProfilazioneDinamica.SelectiveHistoryRequest request)
        {
            DocsPaVO.ProfilazioneDinamica.SelectiveHistoryResponse response = new DocsPaVO.ProfilazioneDinamica.SelectiveHistoryResponse();
            try
            {
                switch (request.ObjType)
                {
                    case DocsPaVO.ProfilazioneDinamica.SelectiveHistoryRequest.ObjectType.Document:
                        response = BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.DeactivateAllHistory(request);
                        break;
                    case DocsPaVO.ProfilazioneDinamica.SelectiveHistoryRequest.ObjectType.Folder:
                        break;
                    default:
                        break;
                }
            }
            catch (Exception e)
            {

            }

            return response;

        }

        /// <summary>
        /// Metodo web per il recupero delle informaizoni sullo stato di abilitazione dello storico per i campi di una data tipologia
        /// </summary>
        /// <param name="request">Informaizoni sulla tipologia di cui recuperare lo stato di storicizzazione dei campi</param>
        /// <returns>Lista degli stati di storicizzazione dei campi</returns>
        [WebMethod(Description = "Servizio per il recupero delle informazioni sullo stato di abilitazione dello storico relativamente ai campi di una tipologia")]
        public DocsPaVO.ProfilazioneDinamica.SelectiveHistoryResponse GetCustomHistoryList(DocsPaVO.ProfilazioneDinamica.SelectiveHistoryRequest request)
        {
            DocsPaVO.ProfilazioneDinamica.SelectiveHistoryResponse response = new DocsPaVO.ProfilazioneDinamica.SelectiveHistoryResponse();
            try
            {
                switch (request.ObjType)
                {
                    case DocsPaVO.ProfilazioneDinamica.SelectiveHistoryRequest.ObjectType.Document:
                        response = BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.GetCustomHistoryList(request);
                        break;
                    case DocsPaVO.ProfilazioneDinamica.SelectiveHistoryRequest.ObjectType.Folder:
                        response = BusinessLogic.ProfilazioneDinamica.ProfilazioneFascicoli.GetCustomHistoryList(request);
                        break;
                    default:
                        break;
                }
            }
            catch (Exception e)
            {

            }

            return response;
        }

        /// <summary>
        /// Servizio web per la costruzione della lista di id corr globali relativi ad un ruolo
        /// </summary>
        /// <param name="request">Request con i dettagli della richiesta</param>
        /// <returns>Response con le informazioni sulla catena di storicizzazione</returns>
        [WebMethod(Description = "Servizio per il recupero della lista degli identificativi dei ruoli appartenti alla catena di un dato ruolo")]
        public RoleChainResponse GetRoleChainsId(RoleChainRequest request)
        {
            RoleChainResponse response = new RoleChainResponse();
            try
            {
                response.RoleChain = BusinessLogic.Utenti.UserManager.GetRoleChain(request.IdCorrGlobRole);

            }
            catch (Exception e)
            {
                logger.Debug(
                    String.Format(
                        "Errore durante la costruzione della lista degli id dei ruoli della catena di storicizzazione per il ruolo {0}",
                        request.IdCorrGlobRole), e);

                response.RoleChain = new List<string>() { request.IdCorrGlobRole };
            }

            return response;
        }

        /// <summary>
        /// Reperimento dei tipi di file supportati da un'amministrazione per la conservazione
        /// </summary>
        /// <param name="idAmministrazione"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.FormatiDocumento.SupportedFileType[] GetSupportedFileTypesPreservation(int idAmministrazione)
        {
            try
            {
                return BusinessLogic.FormatiDocumento.SupportedFormatsManager.GetFileTypesPreservation(idAmministrazione);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetSupportedFileTypes", e);

                throw e;
            }
        }

        [WebMethod()]
        [XmlInclude(typeof(DocsPaVO.ProfilazioneDinamicaLite.TemplateLite))]
        public DocsPaVO.ProfilazioneDinamicaLite.TemplateLite[] GetTypeDocumentsWithDiagramByIdAmm(int idAmministrazione, string type)
        {
            try
            {
                TemplateLite[] result = null;
                if (type.Equals("D"))
                {
                    result = BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.getListTemplatesLite(idAmministrazione.ToString());
                }
                else
                {
                    result = BusinessLogic.ProfilazioneDinamica.ProfilazioneFascicoli.getListTemplatesLite(idAmministrazione.ToString());
                }
                return result;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetTypeDocumentsWithDiagramByIdAmm", e);

                throw e;
            }
        }

        [WebMethod()]
        [XmlInclude(typeof(DocsPaVO.utente.Registro))]
        public DocsPaVO.utente.Registro[] GetRfByIdAmm(int idAmministrazione, string tipo)
        {
            try
            {
                Registro[] result = null;

                result = BusinessLogic.Amministrazione.RegistroManager.GetRfByIdAmm(idAmministrazione, tipo);

                return result;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetTypeDocumentsWithDiagramByIdAmm", e);

                throw e;
            }
        }

        [WebMethod()]
        [XmlInclude(typeof(DocsPaVO.fascicolazione.Fascicolo))]
        public DocsPaVO.fascicolazione.Fascicolo[] GetFascicoloDaCodiceNoSecurity(string codiceFasc, string idAmm, string titolari, bool soloGenerali)
        {
            try
            {
                Fascicolo[] result = null;

                result = BusinessLogic.Fascicoli.FascicoloManager.GetFascicoloDaCodiceNoSecurity(codiceFasc, idAmm, titolari, soloGenerali);

                return result;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetFascicoloDaCodiceNoSecurity", e);

                throw e;
            }
        }

        [WebMethod()]
        [XmlInclude(typeof(DocsPaVO.Conservazione.Policy))]
        public bool InserisciPolicyConservazione(DocsPaVO.Conservazione.Policy policy)
        {
            try
            {
                bool result = false;

                result = BusinessLogic.Conservazione.Policy.PolicyManager.InsertNewPolicy(policy);

                return result;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: InserisciPolicyConservazione", e);

                throw e;
            }
        }

        [WebMethod()]
        [XmlInclude(typeof(DocsPaVO.Conservazione.Policy))]
        public DocsPaVO.Conservazione.Policy[] GetListaPolicy(int idAmm, string tipo)
        {
            try
            {
                DocsPaVO.Conservazione.Policy[] result = null;

                result = BusinessLogic.Conservazione.Policy.PolicyManager.GetListaPolicy(idAmm, tipo);

                return result;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetListaPolicy", e);

                throw e;
            }
        }

        [WebMethod()]
        [XmlInclude(typeof(DocsPaVO.Conservazione.Policy))]
        public bool DeletePolicy(string idPolicy)
        {
            try
            {
                bool result = false;

                result = BusinessLogic.Conservazione.Policy.PolicyManager.DeletePolicy(idPolicy);

                return result;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DeletePolicy", e);

                throw e;
            }
        }

        [WebMethod()]
        [XmlInclude(typeof(DocsPaVO.Conservazione.Policy))]
        public bool SvuotaCachePolicy(string idAmm, string tipo)
        {
            try
            {
                bool result = false;

                result = BusinessLogic.Conservazione.Policy.PolicyManager.SvuotaCachePolicy(idAmm, tipo);

                return result;

            }
            catch (Exception ex)
            {
                logger.Debug("Errore in DocsPaWS.asmx - metodo: SvuotaCachePolicy", ex);

                throw ex;
            }

        }

        [WebMethod()]
        [XmlInclude(typeof(DocsPaVO.Conservazione.Policy))]
        public DocsPaVO.Conservazione.Policy GetPolicyById(string idPolicy)
        {
            try
            {
                DocsPaVO.Conservazione.Policy result = null;

                result = BusinessLogic.Conservazione.Policy.PolicyManager.GetPolicyById(idPolicy);

                return result;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetPolicyById", e);

                throw e;
            }
        }

        [WebMethod()]
        [XmlInclude(typeof(DocsPaVO.Conservazione.Policy))]
        public bool SavePeriodPolicy(DocsPaVO.Conservazione.Policy policy)
        {
            try
            {
                bool result = false;

                result = BusinessLogic.Conservazione.Policy.PolicyManager.SavePeriodPolicy(policy);

                return result;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: SavePeriodPolicy", e);

                throw e;
            }
        }

        [WebMethod]
        public virtual DocsPaVO.fascicolazione.Fascicolo FascicolazioneGetFascicoloByIdNoSecurity(string idFascicolo)
        {
            DocsPaVO.fascicolazione.Fascicolo result = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                result = BusinessLogic.Fascicoli.FascicoloManager.getFascicoloByIdNoSecurity(idFascicolo);
#if TRACE_WS
				pt.WriteLogTracer("FascicolazioneGetFascicoloDaCodice");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneGetFascicoloByIdNoSecurity", e);
                result = null;
            }

            return result;
        }

        [WebMethod()]
        [XmlInclude(typeof(DocsPaVO.Conservazione.Policy))]
        public bool ModifyPolicyConservazione(DocsPaVO.Conservazione.Policy policy)
        {
            try
            {
                bool result = false;

                result = BusinessLogic.Conservazione.Policy.PolicyManager.ModifyNewPolicy(policy);

                return result;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ModifyNewPolicy", e);

                throw e;
            }
        }

        [WebMethod()]
        public Utente[] getUserInRoleByIdCorrGlobali(string idCorrGlobale)
        {
            try
            {
                Utente[] result = null;

                result = BusinessLogic.Utenti.UserManager.getUserInRoleByIdCorrGlobali(idCorrGlobale);

                return result;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ModifyNewPolicy", e);

                throw e;
            }
        }

        /// <summary>
        /// Restituisce il codice relativo alla preferenza per il tipo di firma digitale scelto
        /// </summary>
        /// <param name="idPeople">ID dell'utente</param>
        [WebMethod(Description = "Restituisce CHA_TIPO_FIRMA di PEOPLE")]
        public string GetSignTypePreference(string idPeople)
        {
            try
            {
                string result = string.Empty;

                result = BusinessLogic.Utenti.UserManager.getSignTypePreference(idPeople);

                return result;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetSignTypePreference", e);

                throw e;
            }
        }

        /// <summary>
        /// Imposta il codice preferenza per tipo di firma digitale in PEOPLE
        /// </summary>
        /// <param name="idPeople">ID dell'utente</param>
        /// <param name="chaPreference">Codice preferenza selezionata</param>
        [WebMethod(Description = "Restituisce CHA_TIPO_FIRMA di PEOPLE")]
        public bool SetSignTypePreference(string idPeople, string chaPreference)
        {
            bool retVal = false;

            try
            {
                retVal = BusinessLogic.Utenti.UserManager.setSignTypePreference(idPeople, chaPreference);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: SetSignTypePreference", e);

                throw e;
            }

            return retVal;
        }
        /// <summary>
        /// Servizio web per resettare VAR_INSERT_BY_INTEROP
        /// </summary>
        /// <param name="corrSystemId">ID del corrispondente</param>
        /// <param name="val">Valore col quale resettare il campo VAR_INSERT_BY_INTEROP</param>
        [WebMethod(Description = "Resetta VAR_INSERT_BY_INTEROP del Corrispondente")]
        public int ResetCorrVarInsertIterop(string corrSystemId, string val)
        {
            try
            {
                return BusinessLogic.Utenti.UserManager.resetCorrVarInsertIterop(corrSystemId, val);
            }
            catch (Exception e)
            {

                throw DocsPaUtils.Exceptions.SoapExceptionFactory.Create(e);
            }
        }

        /// <summary>
        /// Servizio web per resettare VAR_INSERT_BY_INTEROP
        /// </summary>
        /// <param name="corrSystemId">ID del corrispondente</param>
        /// <param name="val">Valore col quale resettare il campo VAR_COD_RUBRICA</param>
        [WebMethod(Description = "Resetta VAR_COD_RUBRICA del Corrispondente")]
        public int ResetCodRubCorrIterop(string corrSystemId, string val)
        {
            try
            {
                return BusinessLogic.Utenti.UserManager.resetCodRubCorrIterop(corrSystemId, val);
            }
            catch (Exception e)
            {

                throw DocsPaUtils.Exceptions.SoapExceptionFactory.Create(e);
            }
        }

        /// <summary>
        /// Servizio web per creare un Dataset di Corrispondenti in base alla mail e il registro
        /// </summary>
        /// <param name="email">email con cui cercare</param>
        /// <param name="idRegistri">registri su cui cercare</param>
        [WebMethod(Description = "Restituisce un dataset di Corrispondenti in base alla email ed ai registri")]
        public DataSet GetCorrByEmail(string email, string idRegistri)
        {
            DataSet ds = new DataSet();

            try
            {
                return BusinessLogic.Utenti.UserManager.GetCorrByEmail(email, idRegistri);
            }
            catch (Exception e)
            {

                throw DocsPaUtils.Exceptions.SoapExceptionFactory.Create(e);
            }
        }

        /// <summary>
        /// Servizio web per creare un Dataset di Corrispondenti in base alla mail e il registro
        /// </summary>
        /// <param name="email">email con cui cercare</param>
        /// <param name="descr">descr con cui cercare</param>
        /// <param name="idRegistri">registri su cui cercare</param>
        /// <returns>Dataset</returns>
        [WebMethod(Description = "Restituisce un dataset di Corrispondenti in base alla email, descrizione ed ai registri")]
        public DataSet GetCorrByEmailAndDescr(string email, string descr, string idRegistri)
        {
            DataSet ds = new DataSet();

            try
            {
                return BusinessLogic.Utenti.UserManager.GetCorrByEmailAndDescr(email, descr, idRegistri);
            }
            catch (Exception e)
            {

                throw DocsPaUtils.Exceptions.SoapExceptionFactory.Create(e);
            }
        }

        /// <summary>
        /// Verifica se esiste almeno un corrispondente nell'amministrazione del corrispondente passato in input al metodo
        /// </summary>
        /// <returns></returns>
        [WebMethod()]
        public bool ExistCorrInAmm(Corrispondente corr)
        {
            if (corr == null)
                return false;
            return BusinessLogic.Utenti.UserManager.ExistCorrInAmm(corr);
        }
        /// <summary>
        /// Servizio web che restituisce l'eventuale segnatura di repertorio del documento
        /// </summary>
        /// <param name="docnumber">id del documento per il quale ricercare la segnatura di repertorio</param>
        /// <returns>string</returns>
        [WebMethod(Description = "Restituisce l'eventuale segnatura di repertorio associata al documento")]
        public string GetSegnaturaRepertorio(string docnumber, string codiceAmm)
        {
            string segnaturaRepertorio = string.Empty;

            try
            {
                String dataAnnullamento = String.Empty;
                segnaturaRepertorio = BusinessLogic.Documenti.DocManager.GetSegnaturaRepertorio(docnumber, codiceAmm, true, out dataAnnullamento);
                return segnaturaRepertorio;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetSegnaturaRepertorio", e);
                return segnaturaRepertorio = null;
            }
        }

        /// <summary>
        /// Metodo per aggiornate il mittente dei documenti di un corrispondente creato da interop
        /// </summary>
        /// <param name="oldCorrId">Vecchio Id mittente</param>
        /// <param name="newCorrId">Nuovo Id mittente</param>
        /// <param name="rows">Righe aggiornate</param>
        /// <return></return>
        [WebMethod(Description = "Aggiorna il mittente dei documenti in seguito ad una storicizzazione di un interop")]
        public int UpdateDocArrivoFromInterop(string oldCorrId, string newCorrId)
        {
            int ret = 0;
            try
            {

                BusinessLogic.Utenti.UserManager.updateDocArrivoFromInterop(oldCorrId, newCorrId, out ret);
            }
            catch (Exception e)
            {

                throw DocsPaUtils.Exceptions.SoapExceptionFactory.Create(e);
            }
            return ret;
        }

        //Emanuela: creato per gestire il caso di salvataggio delmittente come occasionale nella maschera K1 
        [WebMethod(Description = "Aggiorna il mittente del documento in seguito ad una storicizzazione di un interop")]
        public int UpdateDocArrivoFromInteropOccasionale(string docId, string newCorrId)
        {
            int ret = 0;
            try
            {

                BusinessLogic.Utenti.UserManager.updateDocArrivoFromInteropOccasionale(docId, newCorrId, out ret);
            }
            catch (Exception e)
            {

                throw DocsPaUtils.Exceptions.SoapExceptionFactory.Create(e);
            }
            return ret;
        }


        [WebMethod]
        public DocsPaVO.areaConservazione.ItemsConservazione[] ConservazioneGetItemsByIdLite(string idConservazione, DocsPaVO.utente.InfoUtente infoUtente)
        {
            DocsPaVO.areaConservazione.ItemsConservazione[] itemsCons = null;
            try
            {
                DocsPaConservazione.DocsPaConsManager consManager = new DocsPaConservazione.DocsPaConsManager();
                itemsCons = consManager.getItemsConservazioneByIdLite(idConservazione, infoUtente);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ConservazioneGetItemsByIdLite", e);
            }
            return itemsCons;
        }

        [WebMethod]
        public bool ValidateIstanzaConservazioneConPolicy(string idPolicy, string idConservazione, DocsPaVO.utente.InfoUtente infoUtente)
        {
            bool result = false;
            try
            {
                DocsPaConservazione.DocsPaConsManager consManager = new DocsPaConservazione.DocsPaConsManager();
                result = consManager.ValidateIstanzaConservazioneConPolicy(idPolicy, idConservazione, infoUtente);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ValidateIstanzaConservazioneConPolicy", e);
            }
            return result;
        }

        [WebMethod]
        public bool DeleteValidateIstanzaConservazioneConPolicy(string idPolicy, string idConservazione, DocsPaVO.utente.InfoUtente infoUtente)
        {
            bool result = false;
            try
            {
                DocsPaConservazione.DocsPaConsManager consManager = new DocsPaConservazione.DocsPaConsManager();
                result = consManager.DeleteValidateIstanzaConservazioneConPolicy(idPolicy, idConservazione, infoUtente);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ValidateIstanzaConservazioneConPolicy", e);
            }
            return result;
        }

        /// <summary>
        /// Metodo web per il recupero delle informazioni minimali relative agli utenti di un ruolo
        /// </summary>
        /// <param name="request">Informazioni sul ruolo di cui recuperare gli utenti</param>
        /// <returns>Response con la lista delle informazioni minimali sugli utenti</returns>
        [WebMethod(Description = "Metodo web per il recupero delle informazioni minimali sugli utenti di un ruolo")]
        public GetUsersInRoleMinimalInfoResponse GetUsersInRoleMinimalInfo(GetUsersInRoleMinimalInfoRequest request)
        {
            GetUsersInRoleMinimalInfoResponse response = new GetUsersInRoleMinimalInfoResponse();
            try
            {
                response = new GetUsersInRoleMinimalInfoResponse() { Users = BusinessLogic.Utenti.UserManager.GetUsersInRoleMinimalInfo(request.RoleId) };

            }
            catch (Exception e)
            {
                logger.Debug("Errore durante il recupero delle informazioni minimali sugli utenti del ruolo", e);
                throw DocsPaUtils.Exceptions.SoapExceptionFactory.Create(e);
            }

            return response;
        }

        [WebMethod()]
        public String GetRoleDescriptionByIdGroup(String idGroup)
        {
            try
            {
                return BusinessLogic.Utenti.UserManager.GetRoleDescriptionByIdGroup(idGroup);
            }
            catch (Exception ex)
            {
                logger.Debug(ex);
            }

            return String.Empty;
        }

        [WebMethod(Description = "Servizio web per il recupero dei dettagli di un ruolo dell'organigramma")]
        public OrgRuolo GetRole(String idCorrGlobRuolo)
        {
            return BusinessLogic.Amministrazione.OrganigrammaManager.GetRole(idCorrGlobRuolo);
        }

        #region Gestione registri di repertorio

        /// <summary>
        /// Metodo web per il recupero dell'anagrafica dei registri di repertorio registrati per una data amministrazione
        /// </summary>
        /// <param name="request">Informazioni sull'amministrazione di cui recuperare l'anagrafica</param>
        /// <returns>Anagrafica dei registri di repertorio</returns>
        [WebMethod(Description = "Metodo web per il recupero dell'anagrafica dei registri di repertorio registrati per una data amministrazione")]
        public RegisteredRegistriRepertorioResponse GetRegisteredRegistries(RegisteredRegistriRepertorioRequest request)
        {
            RegisteredRegistriRepertorioResponse response = new RegisteredRegistriRepertorioResponse();
            try
            {
                response.RegistriRepertorio = BusinessLogic.utenti.RegistriRepertorioPrintManager.GetRegisteredRegistries(request.AdministrationId);

            }
            catch (Exception e)
            {
                logger.Debug(String.Format("Errore durante il recupero dell'anagrafica dei registri di repertorio definiti per l'amministrazione {0}", request.AdministrationId), e);
                throw DocsPaUtils.Exceptions.SoapExceptionFactory.Create(e);
            }

            return response;
        }

        /// <summary>
        /// Metodo web per il recupero delle impostazioni relative ad un registro di repertorio
        /// </summary>
        /// <param name="request">Informazioni sulle impostazioni da recuperare</param>
        [WebMethod(Description = "Metodo web per il recupero delle impostazioni relative ad un registro di repertorio")]
        public RegistroRepertorioSettingsResponse GetRegisterSettings(RegistroRepertorioSettingsRequest request)
        {
            RegistroRepertorioSettingsResponse response = new RegistroRepertorioSettingsResponse();
            try
            {
                response.RegistroRepertorioSingleSettings = BusinessLogic.utenti.RegistriRepertorioPrintManager.GetRegisterSettings(request.CounterId, request.RegistryId, request.RfId, request.TipologyKind, request.SettingsType);

            }
            catch (Exception e)
            {
                logger.Debug("Errore durante il recupero delle impostazioni relative ad un registro di repertorio", e);
                throw DocsPaUtils.Exceptions.SoapExceptionFactory.Create(e);
            }

            return response;
        }

        /// <summary>
        /// Metodo web per il recupero delle informazioni minimali relative alle impostazioni di un contatore di repertorio
        /// </summary>
        /// <param name="request">Informazioni sulle impostazioni da recuperare</param>
        [WebMethod(Description = "Metodo web per il recupero delle impostazioni minimali relative ad un registro di repertorio")]
        public GetSettingsMinimalInfoResponse GetSettingsMinimalInfo(GetSettingsMinimalInfoRequest request)
        {
            GetSettingsMinimalInfoResponse response = new GetSettingsMinimalInfoResponse();
            try
            {
                response.Settings = BusinessLogic.utenti.RegistriRepertorioPrintManager.GetSettingsMinimalInfo(request.CounterId, request.TipologyKind, request.idAmm);

            }
            catch (Exception e)
            {
                logger.Debug("Errore durante il recupero delle informazioni minimali relative alle impostazioni ad un registro di repertorio", e);
                throw DocsPaUtils.Exceptions.SoapExceptionFactory.Create(e);
            }

            return response;
        }

        /// <summary>
        /// Metodo web per il salvataggio delle modifiche apportate ad una istanza di un registro di repertorio
        /// </summary>
        /// <param name="request">Informazioni sul registro da salvare</param>
        /// <returns>Risultato dell'operazione con evenutuali errori di validazione</returns>
        [WebMethod(Description = "Metodo web per il salvataggio delle modifiche apportate ad un registo di repertorio")]
        public SaveRegistroRepertorioSettingsResponse SaveRegisterSettings(SaveRegistroRepertorioSettingsRequest request)
        {
            SaveRegistroRepertorioSettingsResponse response = new SaveRegistroRepertorioSettingsResponse();
            try
            {
                ValidationResultInfo validationResult;
                bool result = BusinessLogic.utenti.RegistriRepertorioPrintManager.SaveRegisterSettings(request.CounterId, request.Settings, request.TipologyKind, request.SettingsToSave, request.IdAdmin, out validationResult);

                response.ValidationResult = validationResult;
                response.SaveChangesResult = result;
            }
            catch (Exception e)
            {
                logger.Debug("Errore durante il salvataggio delle modifiche ad un registro di repertorio", e);
                throw DocsPaUtils.Exceptions.SoapExceptionFactory.Create(e);
            }

            return response;
        }

        /// <summary>
        /// Metodo web per la stampa di un registro di repertorio
        /// </summary>
        /// <param name="request">Informaizoni sul repertorio da stampare</param>
        /// <returns></returns>
        [WebMethod(Description = "Metodo web per la generazione di una stampa di repertorio")]
        public GeneratePrintRepertorioResponse GeneratePrintRepertorio(GeneratePrintRepertorioRequest request)
        {
            GeneratePrintRepertorioResponse response = new GeneratePrintRepertorioResponse();
            try
            {
                /*response.Document =*/
                BusinessLogic.utenti.RegistriRepertorioPrintManager.GeneratePrintRepertorio(
                    request.CounterId,
                    request.RegistryId,
                    request.RfId,
                    request.UserInfo,
                    request.Role);
            }
            catch (Exception e)
            {
                logger.ErrorFormat(String.Format("Errore durante la generazione della stampa del repertorio {0}, per il registro {1}, rf {2}", request.CounterId, request.RegistryId, request.RfId), e);
                throw DocsPaUtils.Exceptions.SoapExceptionFactory.Create(e);
            }

            // Restituzione della response
            return response;
        }

        /// <summary>
        /// Metodo web per la stampa automatica del registro di conservazione.
        /// Da schedulare.
        /// </summary>
        [WebMethod(Description = "Metodo web per la stampa automatica del registro di conservazione")]
        public void GeneratePrintRegCons()
        {

            BusinessLogic.Stampe.StampaConservazione stampaConservazione = new BusinessLogic.Stampe.StampaConservazione();

            try
            {
                stampaConservazione.GeneratePrintRegCons();
            }
            catch (Exception e)
            {
                logger.Debug("Errore durante la stampa automatica del registro di conservazione", e);
                throw DocsPaUtils.Exceptions.SoapExceptionFactory.Create(e);
            }


        }

        [WebMethod]
        public void AnnullaContatoreDiRepertorio(string idOggetto, string docNumber, InfoUtente infoUtente)
        {
            try
            {
                BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.AnnullaContatoreDiRepertorio(idOggetto, docNumber);

                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente.userId, infoUtente.idPeople, infoUtente.idGruppo, infoUtente.idAmministrazione, "DOCUMENTO_EXEC_ANNULLA_REPERTORIO", docNumber,
                                   "Annullamento del contatore di repertorio", DocsPaVO.Logger.CodAzione.Esito.OK, infoUtente.delegato, "1");
            }
            catch (Exception e)
            {
                logger.Debug("Errore WebMethod : AnnullaContatoreDiRepertorio");
                throw DocsPaUtils.Exceptions.SoapExceptionFactory.Create(e);
            }
        }

        [WebMethod]
        public void Storicizza(DocsPaVO.ProfilazioneDinamica.Storicizzazione storico)
        {
            try
            {
                BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.Storicizza(storico);
            }
            catch (Exception e)
            {
                logger.Debug("Errore WebMethod : Storicizza");
                throw DocsPaUtils.Exceptions.SoapExceptionFactory.Create(e);
            }
        }

        /// <summary>
        /// Metodo che restituisce i registri di repertorio di cui si  Repsonsabile e Stampatore o solo Responsabile o Stampatore
        /// Ogni oggetto registro di repertorio conterr al suo interno eventualmente la lista dei registri o rf a cui afferisce
        /// </summary>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.utente.Repertori.RegistroRepertorio))]
        public virtual ArrayList GetRegistriesWithAooOrRf(string idRoleResp, string idRolePrinter)
        {
            ArrayList repertori = new ArrayList();
            try
            {
                repertori = BusinessLogic.utenti.RegistriRepertorioPrintManager.GetRegistriesWithAooOrRf(idRoleResp, idRolePrinter);
            }
            catch (Exception e)
            {
                logger.Debug("Errore WebMethod : GetRegistriesWithAooOrRf");
                throw DocsPaUtils.Exceptions.SoapExceptionFactory.Create(e);
            }

            return repertori;
        }

        /// <summary>
        /// Metodo che restituisce i registri di repertorio di cui si  Repsonsabile e Stampatore o solo Responsabile o Stampatore (compresi i ruoli superiori)
        /// Ogni oggetto registro di repertorio conterr al suo interno eventualmente la lista dei registri o rf a cui afferisce
        /// </summary>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.utente.Repertori.RegistroRepertorio))]
        public virtual ArrayList GetRegistriesWithAooOrRfSup(string idRoleResp, string idRolePrinter)
        {
            ArrayList repertori = new ArrayList();
            try
            {
                repertori = BusinessLogic.utenti.RegistriRepertorioPrintManager.GetRegistriesWithAooOrRfSup(idRoleResp, idRolePrinter);
            }
            catch (Exception e)
            {
                logger.Debug("Errore WebMethod : GetRegistriesWithAooOrRf");
                throw DocsPaUtils.Exceptions.SoapExceptionFactory.Create(e);
            }

            return repertori;
        }

        /// <summary>
        /// Servizio web per cambiare lo stato di un repertorio
        /// </summary>
        /// <param name="request">Informaizoni sul repertorio da chiudere</param>
        /// <returns></returns>
        [WebMethod(Description = "Metodo web per il cambio dello stato di un repertorio")]
        public ChangeRepertorioStateResponse ChangeRepertorioState(ChangeRepertorioStateRequest request)
        {
            ChangeRepertorioStateResponse response = new ChangeRepertorioStateResponse();
            try
            {
                bool changeRes = BusinessLogic.utenti.RegistriRepertorioPrintManager.ChangeRepertorioState(
                    request.CounterId,
                    request.RegistryId,
                    request.RfId,
                    request.IdAmm);

                response.ChangeStateResult = changeRes;

            }
            catch (Exception ex)
            {
                logger.Debug("Errore in ChangeRepertorioState", ex);
                throw DocsPaUtils.Exceptions.SoapExceptionFactory.Create(ex);
            }

            return response;

        }

        [WebMethod(Description = "Metodo per il recupero dei registri di repertorio da stampare")]
        public GetRegistersToPrintAutomaticServiceResponse GetRegistersToPrint(bool repairBrokenPrint = false)
        {
            GetRegistersToPrintAutomaticServiceResponse response = new GetRegistersToPrintAutomaticServiceResponse();
            try
            {
                response.RegistersToPrint = BusinessLogic.utenti.RegistriRepertorioPrintManager.GetRegistersToPrint(repairBrokenPrint);

            }
            catch (Exception ex)
            {
                logger.Debug("Errore in GetRegistersToPrint", ex);

                throw DocsPaUtils.Exceptions.SoapExceptionFactory.Create(new Exception("Errore durante il recupero delle informazioni sui repertori da stampare"));
            }

            return response;

        }

        [WebMethod(Description = "Metodo per il recupero delle informazioni sui range di repertorio da stampare")]
        public GetRepertoriPrintRangesResponse GetRepertoriPrintRanges(GetRepertoriPrintRangesRequest request, bool repairBrokenPrint = false)
        {
            GetRepertoriPrintRangesResponse response = new GetRepertoriPrintRangesResponse();
            try
            {
                response.Ranges = BusinessLogic.utenti.RegistriRepertorioPrintManager.GetRepertoriPrintRanges(request.CounterId, request.RegistryId, request.RfId, repairBrokenPrint);

            }
            catch (Exception ex)
            {
                logger.Debug("Errore in GetRepertoriPrintRanges", ex);

                throw DocsPaUtils.Exceptions.SoapExceptionFactory.Create(new Exception("Errore durante il recupero dei range di repertori da stampare"));
            }

            return response;

        }

        [WebMethod(Description = "Metodo per il recupero dello stato di un repertorio")]
        public GetRepertorioStateResponse GetRepertorioState(GetRepertorioStateRequest request)
        {
            GetRepertorioStateResponse response = new GetRepertorioStateResponse();
            try
            {
                response.State = BusinessLogic.utenti.RegistriRepertorioPrintManager.GetRepertorioState(request.CounterId, request.RegistryId, request.RfId);

            }
            catch (Exception ex)
            {
                logger.Debug("Errore in GetRepertorioState", ex);

                throw DocsPaUtils.Exceptions.SoapExceptionFactory.Create(new Exception("Errore durante il recupero dello stato del contatore"));
            }

            return response;

        }

        #endregion

        [WebMethod(Description = "Metodo per la verifica delle stopword nella ricerca full text oracle")]
        public string VerificaStopWord(string stopword)
        {
            string retValue = string.Empty;
            try
            {
                retValue = BusinessLogic.Documenti.InfoDocManager.stopWord(stopword);
            }
            catch (Exception e)
            {
                logger.Debug("Errore nel metodo StopWord", e);
            }
            return retValue;
        }

        /// <summary>
        /// Restituisce la ragione di trasmissione NOTIFICA
        /// </summary>
        /// <param name="idAmm">id amministrazione</param>
        /// <returns>string</returns>
        [WebMethod]
        public DocsPaVO.trasmissione.RagioneTrasmissione GetRagioneNotifica(string idAmm)
        {
            DocsPaVO.trasmissione.RagioneTrasmissione ragTrasm = null;
            try
            {
                ragTrasm = BusinessLogic.Trasmissioni.RagioniManager.getRagioneNotifica(idAmm);
            }
            catch (Exception)
            {
                ragTrasm = null;
            }
            return ragTrasm;
        }


        //get lista qualifiche
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.Qualifica.Qualifica))]
        public List<DocsPaVO.Qualifica.Qualifica> GetQualifiche(int id_amm)
        {
            List<DocsPaVO.Qualifica.Qualifica> list = new List<DocsPaVO.Qualifica.Qualifica>();

            try
            {
                list = BusinessLogic.utenti.QualificheManager.GetQualifiche(id_amm);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetQualifiche", e);
            }

            return list;
        }


        /// inserimento di una qualifica
        [WebMethod()]
        public DocsPaVO.Validations.ValidationResultInfo InsertQual(DocsPaVO.Qualifica.Qualifica qual)
        {
            DocsPaVO.Validations.ValidationResultInfo retValue = null;

            try
            {
                retValue = BusinessLogic.utenti.QualificheManager.InsertQual(qual);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: InsertQual", e);
            }

            return retValue;
        }

        /// aggiornamento di una qualifica
        [WebMethod()]
        public DocsPaVO.Validations.ValidationResultInfo UpdateQual(String idQualifica, String descrizione)
        {
            DocsPaVO.Validations.ValidationResultInfo retValue = null;

            try
            {
                retValue = BusinessLogic.utenti.QualificheManager.UpdateQual(idQualifica, descrizione);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: UpdateQual", e);
            }

            return retValue;
        }

        /// cancellazione di una qualifica
        [WebMethod()]
        public DocsPaVO.Validations.ValidationResultInfo DeleteQual(String idQualifica, int idAmministrazione)
        {
            DocsPaVO.Validations.ValidationResultInfo retValue = null;

            try
            {
                retValue = BusinessLogic.utenti.QualificheManager.DeleteQual(idQualifica, idAmministrazione);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DeleteQual", e);
            }

            return retValue;
        }


        //get lista peoplegropus_qualifiche
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.Qualifica.PeopleGroupsQualifiche))]
        public List<DocsPaVO.Qualifica.PeopleGroupsQualifiche> GetPeopleGroupsQualifiche(String idAmm, String idUo, String idGruppo, String idPeople)
        {
            List<DocsPaVO.Qualifica.PeopleGroupsQualifiche> list = new List<DocsPaVO.Qualifica.PeopleGroupsQualifiche>();

            try
            {
                list = BusinessLogic.utenti.QualificheManager.GetPeopleGroupsQualifiche(idAmm, idUo, idGruppo, idPeople);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetPeopleGroupsQualifiche", e);
            }

            return list;
        }

        /// inserimento di un peoplegroups_qualifiche
        [WebMethod()]
        public DocsPaVO.Validations.ValidationResultInfo InsertPeopleGroupsQual(DocsPaVO.Qualifica.PeopleGroupsQualifiche pgq)
        {
            DocsPaVO.Validations.ValidationResultInfo retValue = null;

            try
            {
                retValue = BusinessLogic.utenti.QualificheManager.InsertPeopleGroupsQual(pgq);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: InsertPeopleGroupsQual", e);
            }

            return retValue;
        }

        /// cancellazione di un peoplegroups
        [WebMethod()]
        public DocsPaVO.Validations.ValidationResultInfo DeletePeopleGroups(String idPeopleGroups)
        {
            DocsPaVO.Validations.ValidationResultInfo retValue = null;

            try
            {
                retValue = BusinessLogic.utenti.QualificheManager.DeletePeopleGroups(idPeopleGroups);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DeletePeopleGroups", e);
            }

            return retValue;
        }

        [WebMethod()]
        [XmlInclude(typeof(DocsPaVO.areaConservazione.ItemsConservazione))]
        public bool InviaIstanzaInConservazione(DocsPaVO.areaConservazione.ItemsConservazione[] items, DocsPaVO.utente.InfoUtente infoUtente)
        {
            string idconservazione = items[0].SystemID;
            DocsPaVO.Logger.CodAzione.Esito logResponse = DocsPaVO.Logger.CodAzione.Esito.OK;

            try
            {
                bool result = false;

                result = BusinessLogic.Conservazione.Policy.PolicyManager.InviaIstanzaInConservazione(items, infoUtente);
                if (result)
                    logResponse = DocsPaVO.Logger.CodAzione.Esito.OK;

                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente,
                        "INVIO_ISTANZA",
                        idconservazione,
                        String.Format("Invio in conservazione dell' istanza {0}", idconservazione),
                        logResponse);

                return result;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: InviaIstanzaInConservazione", e);
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente,
                  "INVIO_ISTANZA",
                  idconservazione,
                  String.Format("Invio in conservazione dell' istanza {0}", DocsPaVO.Logger.CodAzione.Esito.KO),
                  logResponse);

                throw e;

            }
        }

        /// <summary>
        /// 
        /// </summary>
        /// <returns></returns>
        [WebMethod(Description = "Reperimento delle tipologie di istanze di conservazione ammesse dal sistema")]
        public DocsPaConservazione.TipoIstanzaConservazione[] GetTipologieIstanzeConservazione()
        {
            return DocsPaConservazione.TipoIstanzaConservazione.Tipi;
        }

        [WebMethod]
        public bool UpdatePreferredInstance(string idIstanza, DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.utente.Ruolo ruolo)
        {
            bool result = false;
            try
            {
                DocsPaConservazione.DocsPaConsManager consManager = new DocsPaConservazione.DocsPaConsManager();
                result = consManager.UpdatePreferredInstance(idIstanza, infoUtente, ruolo);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: UpdatePreferredInstance", e);
            }
            return result;
        }

        [WebMethod]
        public virtual bool AcquisisciDirittiDocumento(DocsPaVO.documento.SchedaDocumento schedaDocumento, DocsPaVO.utente.InfoUtente infoUtente)
        {
            bool result = false;
            try
            {
                BusinessLogic.Documenti.DocManager docManager = new BusinessLogic.Documenti.DocManager();
                result = docManager.AcquisisciDirittiDocumento(schedaDocumento, infoUtente);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AcquisisciDirittiDocumento", e);
            }
            return result;
        }

        [WebMethod]
        public bool EliminaDocumentiNonConformiPolicyDaIstanza(string idPolicy, string idConservazione, DocsPaVO.utente.InfoUtente infoUtente)
        {
            bool result = false;
            try
            {
                DocsPaConservazione.DocsPaConsManager consManager = new DocsPaConservazione.DocsPaConsManager();
                result = consManager.EliminaDocumentiNonConformiPolicyDaIstanza(idPolicy, idConservazione, infoUtente);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: EliminaDocumentiNonConformiPolicyDaIstanza", e);
            }
            return result;
        }
        //get lista utenti by CodQualifica
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.utente.Utente))]
        public List<DocsPaVO.utente.Utente> GetUtentiByCodQualifica(String codQualifica)
        {
            List<DocsPaVO.utente.Utente> list = new List<DocsPaVO.utente.Utente>();

            try
            {
                list = BusinessLogic.Utenti.UserManager.GetUtentiByCodQualifica(codQualifica);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetUtentiByCodQualifica", e);
            }

            return list;
        }

        //get lista utenti by Oggetto Qualifica
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.utente.Utente))]
        public List<DocsPaVO.utente.Utente> GetUtentiByQualifica(DocsPaVO.Qualifica.Qualifica qual)
        {
            String codQualifica = qual.CODICE;
            List<DocsPaVO.utente.Utente> list = new List<DocsPaVO.utente.Utente>();

            try
            {
                list = BusinessLogic.Utenti.UserManager.GetUtentiByCodQualifica(codQualifica);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetUtentiByQualifica", e);
            }

            return list;
        }
        #region Multi Casella Pec

        /// <summary>
        /// 1- Attiva multi casella RF/REGISTRI, destinatari esterni
        /// Se questa chiave  a 0, non sar possibile :
        /// FrontEnd: inserire pi di una casella mail per i corrispondenti esterni nuovi o in modifica. 
        /// Amm.ne: non sar possibile inserire pi di una casella mail su Registri /RF.
        /// </summary>
        /// <param name="idAmm"></param>
        /// <returns></returns>
        [WebMethod]
        public bool IsEnabledMultiMail(string idAmm)
        {
            try
            {
                return BusinessLogic.Interoperabilit.InteroperabilitaUtils.MultiMailEnabled(idAmm);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: IsEnabledMultiMail", e);
                throw e;
            }
        }
        /// <summary>
        /// 
        /// Reperimento elenco delle caselle di posta associate ad registro/rf in amministrazione
        /// </summary>
        /// <param name="idRegistro"></param>
        /// <returns></returns>
        [WebMethod]
        [XmlInclude(typeof(DocsPaVO.amministrazione.CasellaRegistro))]
        public DocsPaVO.amministrazione.CasellaRegistro[] AmmGetMailRegistro(string idRegistro)
        {
            DocsPaVO.amministrazione.CasellaRegistro[] retValue = null;

            try
            {
                retValue = BusinessLogic.Amministrazione.RegistroManager.GetMailRegistro(idRegistro);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmGetMailRegistro", e);
            }

            return retValue;
        }

        /// <summary>
        /// Aggiornamento caselle di posta di un registro in amministrazione
        /// </summary>
        /// <param name="idRegistro">id del registro</param>
        /// <param name="caselle">Caselle di posta da aggiornare</param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.Validations.ValidationResultInfo AmmUpdateMailRegistro(string idRegistro, CasellaRegistro[] caselle)
        {
            DocsPaVO.Validations.ValidationResultInfo retValue = null;

            try
            {
                retValue = BusinessLogic.Amministrazione.RegistroManager.UpdateMailRegistro(idRegistro, caselle);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmUpdateMailRegistro", e);
            }

            return retValue;
        }

        /// <summary>
        /// Inserisci una o pi caselle di posta associate al registro/RF
        /// </summary>
        /// <param name="idRegistro">id del registro</param>
        /// <param name="caselle">Caselle di posta da aggiornare</param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.Validations.ValidationResultInfo AmmInsertMailRegistro(string idRegistro, CasellaRegistro[] caselle, bool insertInteropInt)
        {
            DocsPaVO.Validations.ValidationResultInfo retValue = null;

            try
            {
                retValue = BusinessLogic.Amministrazione.RegistroManager.InsertMailRegistro(idRegistro, caselle, insertInteropInt);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmInsertMailRegistro", e);
            }
            return retValue;
        }

        /// <summary>
        /// Inserisci una o pi caselle di posta associate al registro/RF
        /// </summary>
        /// <param name="idRegistro">id del registro</param>
        /// <param name="caselle">Caselle di posta da aggiornare</param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.Validations.ValidationResultInfo AmmDeleteMailRegistro(string idRegistro, string casella)
        {
            DocsPaVO.Validations.ValidationResultInfo retValue = null;

            try
            {
                retValue = BusinessLogic.Amministrazione.RegistroManager.DeleteMailRegistro(idRegistro, casella);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmDeleteMailRegistro", e);
            }

            return retValue;
        }

        [WebMethod()]
        public string GetMailPrincipaleRegistro(string idRegistro)
        {
            string casellaPrincipale = string.Empty;
            return BusinessLogic.Amministrazione.RegistroManager.GetMailPrincipaleRegistro(idRegistro);
        }
        /// <summary>
        /// Inserisce i diritti del ruolo in registro/RF per ogni casella di posta
        /// </summary>
        /// <param name="idRegistro">id del registro</param>
        /// <param name="caselle">Caselle di posta da aggiornare</param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.Validations.ValidationResultInfo AmmInsRightMailRegistro(System.Collections.Generic.List<RightRuoloMailRegistro> rightRuoloMailRegistro)
        {
            DocsPaVO.Validations.ValidationResultInfo retValue = null;

            try
            {
                retValue = BusinessLogic.Amministrazione.RegistroManager.InsertRightRuoloMailRegistro(rightRuoloMailRegistro);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmInsRightMailRegistro", e);
            }

            return retValue;
        }

        /// <summary>
        /// Elimina i diritti del ruolo in registro/RF per ogni casella di posta
        /// </summary>
        /// <param name="idRegistro">id del registro</param>
        /// <param name="caselle">Caselle di posta da aggiornare</param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.Validations.ValidationResultInfo AmmDelRightMailRegistro(string idRegistro, string idRuoloInAoo, string indirizzoEmail)
        {
            DocsPaVO.Validations.ValidationResultInfo retValue = null;

            try
            {
                retValue = BusinessLogic.Amministrazione.RegistroManager.DeleteRightRuoloMailRegistro(idRegistro, idRuoloInAoo, indirizzoEmail);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmDelRightMailRegistro", e);
            }

            return retValue;
        }

        /// <summary>
        /// Aggiorna i diritti del ruolo in registro/RF per ogni casella di posta
        /// </summary>
        /// <param name="idRegistro">id del registro</param>
        /// <param name="caselle">Caselle di posta da aggiornare</param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.Validations.ValidationResultInfo AmmUpdRightMailRegistro(RightRuoloMailRegistro[] visRuolo)
        {
            DocsPaVO.Validations.ValidationResultInfo retValue = null;

            try
            {
                retValue = BusinessLogic.Amministrazione.RegistroManager.UpdateRightRuoloMailRegistro(visRuolo);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmUpdRightMailRegistro", e);
            }

            return retValue;
        }

        /// <summary>
        /// Restituisce le info sulla visibilit d
        /// </summary>
        /// <param name="idRegistro"></param>
        /// <param name="idRuoloInUO"></param>
        /// <returns></returns>
        [WebMethod()]
        public DataSet GetAmmRightMailRegistro(string idRegistro, string idRuoloInUO)
        {
            try
            {
                return BusinessLogic.Amministrazione.RegistroManager.GetRightRuoloMailRegistro(idRegistro, idRuoloInUO);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetAmmRightMailRegistro", e);
            }

            return new DataSet();
        }

        /// <summary>
        /// Aggiorna l'associazione tra un documento (protocollato o predisposto alla protocollazione) e il mailAddress utilizzati per 
        /// l'invio della conferma di ricezione e la notifica di annullamento al mittente
        /// Solo per doc ricevuti per interoperabilit
        /// </summary>
        /// <param name="docNumber"></param>
        /// <param name="idRegistro"></param>
        /// <param name="mailAddress"></param>
        /// <returns></returns>
        [WebMethod()]
        public bool UpdateAssDocAddress(string docNumber, string idRegistro, string mailAddress)
        {
            try
            {
                return BusinessLogic.interoperabilita.InteroperabilitaManager.UpdateAssDocAddress(docNumber, idRegistro, mailAddress);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: UpdateAssDocAddress", e);
                return false;
            }
        }

        /// <summary>
        /// Elimina dal db l'associazione tra il documento e il mailAddress utilizzati per l'invio della conferma di ricezione e la notifica 
        /// di annullamento al mittente
        /// Invocato solo dopo l'eventuale annullamento ed invio della notifica di annullamento
        /// </summary>
        /// <param name="docNumber"></param>
        /// <param name="idRegistro"></param>
        /// <param name="mailAddress"></param>
        /// <returns></returns>
        [WebMethod()]
        public bool DeleteAssDocAddress(string docNumber, string idRegistro)
        {
            try
            {
                return BusinessLogic.interoperabilita.InteroperabilitaManager.DeleteAssDocAddress(docNumber, idRegistro);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DeleteAssDocAddress", e);
                return false;
            }
        }

        /// <summary>
        /// Return l'associazione tra un documento (protocollato o predisposto alla protocollazione) e il mailAddress utilizzati per 
        /// l'invio della conferma di ricezione e la notifica di annullamento al mittente
        /// Solo per doc ricevuti per interoperabilit
        /// </summary>
        /// <param name="docNumber"></param>
        /// <param name="idRegistro"></param>
        /// <param name="mailAddress"></param>
        /// <returns></returns>
        [WebMethod()]
        public DataSet GetAssDocAddress(string docNumber)
        {
            try
            {
                return BusinessLogic.interoperabilita.InteroperabilitaManager.GetAssDocAddress(docNumber);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetAssDocAddress", e);
                return new DataSet();
            }
        }
        #endregion

        #region Multi Casella Corrispondenti Esterni

        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.utente.MailCorrispondente))]
        [WebMethod()]
        public List<DocsPaVO.utente.MailCorrispondente> GetMailCorrEsterno(string idCorrispondente)
        {
            try
            {
                return BusinessLogic.Utenti.addressBookManager.GetMailCorrispondente(idCorrispondente);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetMailCorrispondenteEsterno", e);
                return new System.Collections.Generic.List<DocsPaVO.utente.MailCorrispondente>();
            }
        }

        [WebMethod()]
        public bool InsertMailCorrispondenteEsterno(System.Collections.Generic.List<MailCorrispondente> listCaselle, string idCorrispondente)
        {
            try
            {
                return BusinessLogic.Utenti.addressBookManager.InsertMailCorrispondente(listCaselle, idCorrispondente);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: InsertMailCorrispondenteEsterno", e);
                return false;
            }
        }
        [WebMethod()]
        public bool DeleteMailCorrispondenteEsterno(string idCorrispondente)
        {
            try
            {
                return BusinessLogic.Utenti.addressBookManager.DeleteMailCorrispondente(idCorrispondente);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DeleteMailCorrispondenteEsterno", e);
                return false;
            }
        }

        /// <summary>
        /// Restituisce un dictionary con le corrispondenze Corr - elenco mail del corr
        /// </summary>
        /// <param name="idDoc">Id del protocollo in uscita</param>
        /// <returns>Dictionary</returns>
        [WebMethod()]
        public DocsPaVO.utente.MailCorrispondente[] GetMailsAllCorrProto(int idDoc)
        {
            try
            {
                return BusinessLogic.Utenti.addressBookManager.GetMailsAllCorrProto(idDoc).ToArray();
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetMailsAllCorrProto", e);
                return null;
            }
        }
        #endregion


        #region Corte dei Conti
        [WebMethod(Description = "Ritorna il numero di un dato oggetto custom presente in una data tipologia")]
        public string CountTipoFromTipologia(string tipoOggetto, string tipologiaDoc)
        {
            string ris = string.Empty;
            try
            {

                return BusinessLogic.Utenti.UserManager.countTipoFromTipologia(tipoOggetto, tipologiaDoc);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: CountTipoFromTipologia", e);
                return string.Empty;
            }
        }

        [WebMethod(Description = "Ritorna il numero di documenti con tipologia Deferimenti SCCLA creati in un intervallo di tempo")]
        public string CountDeferimenti(string from, string to, string ufficio, string idTipoAtto)
        {
            string ris = string.Empty;
            try
            {

                return BusinessLogic.Utenti.UserManager.countDeferimenti(from, to, ufficio, idTipoAtto);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: CountDeferimenti", e);
                return string.Empty;
            }
        }

        [WebMethod(Description = "Ritorna il numero dei decreti esaminati per emissione di parere")]
        public string CountDecretiEsaminati(string from, string to, string ufficio)
        {
            string ris = string.Empty;
            try
            {

                return BusinessLogic.Utenti.UserManager.countDecretiEsaminati(from, to, ufficio);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: CountDecretiEsaminati", e);
                return string.Empty;
            }
        }

        [WebMethod(Description = "Ritorna tutti i registri che possono vedere una determinata tipologia")]
        public DataSet GetRegistriByTipologia(string desc_tipologia)
        {
            DataSet result = new DataSet();
            try
            {
                return BusinessLogic.Utenti.UserManager.getRegistriByTipologia(desc_tipologia);
            }
            catch (Exception e)
            {

                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetRegistriByTipologia", e);
                return null;
            }

        }

        [WebMethod(Description = "Ritorna tutti i ruoli che possono vedere un dato Registro")]
        public DataSet GetRuoliByRegistro(string idRegistro)
        {
            DataSet result = new DataSet();
            try
            {
                return BusinessLogic.Utenti.UserManager.getRuoliByRegistro(idRegistro);
            }
            catch (Exception e)
            {

                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetRuoliByRegistro", e);
                return null;
            }

        }

        [WebMethod]
        public string GetCorrFromElencoDecreti(InfoUtente userInfo, List<DocsPaVO.filtri.FiltroRicerca> searchFilters, string query, out int numRows)
        {
            numRows = 0;
            try
            {

                return BusinessLogic.Utenti.UserManager.getCorrFromElencoDecreti(userInfo, searchFilters, query, out numRows);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetCorrFromElencoDecreti", e);
                return string.Empty;
            }
        }

        [WebMethod]
        public virtual string RemoveTipologyDoc(InfoUtente info, DocsPaVO.documento.SchedaDocumento schedaDocumento)
        {
            try
            {
                return BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.RemoveTipologyDoc(info, schedaDocumento);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: RemoveTipologyDoc", e);
                return string.Empty;
            }
        }

        /// <summary>
        /// Metodo invocato dall'AjaxProxy per trovare la parola chiave
        /// </summary>
        /// <returns>Parola chiave</returns>
        [WebMethod(Description = "Restituisce la parola chiave sfruttando la ricerca veloce di Ajax")]
        public virtual DataSet FoundKeyWord(string word, string idRegistro)
        {
            try
            {
                return BusinessLogic.Utenti.UserManager.foundKeyWord(word, idRegistro);
            }
            catch (Exception e)
            {

                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FoundKeyWord", e);
                return null;
            }
        }

        [WebMethod(Description = "Ritorna il numero di un dato oggetto custom presente in una data tipologia")]
        public string CountTipoFromTipologiaFasc(string tipoOggetto, string idTipoFasc)
        {
            string ris = string.Empty;
            try
            {

                return BusinessLogic.Utenti.UserManager.countTipoFromTipologiaFasc(tipoOggetto, idTipoFasc);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: CountTipoFromTipologiaFasc", e);
                return string.Empty;
            }
        }
        #endregion

        [WebMethod]
        public string getOldDescByCorr(string systemId)
        {
            try
            {
                return BusinessLogic.Utenti.UserManager.GetDescOldByCorr(systemId);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getOldDescByCorr", e);
                return string.Empty;
            }
        }


        #region Interoperabilit Semplificata

        /// <summary>
        /// Reperimento dei dati di un RF da inviare a rubrica comune
        /// </summary>
        /// <param name="infoUtente">Informazioni sull'utente richiedente</param>
        /// <param name="idRf">Id dell'RF</param>
        /// <returns>Dettaglio dell'RF</returns>
        [WebMethod()]
        public DocsPaVO.RubricaComune.ElementoRubricaRF GetElementoRubricaRF(DocsPaVO.utente.InfoUtente infoUtente, String idRf)
        {
            SetUserId(infoUtente);
            return BusinessLogic.RubricaComune.RubricaServices.GetElementoRubricaRF(infoUtente, idRf);
        }

        /// <summary>
        /// Metodo web per il salvataggio dei dettagli di un corrispondente di tipo RF
        /// </summary>
        /// <param name="rf">RF da salvare</param>
        /// <param name="idRegistro">Id del registro RF</param>
        /// <returns>Esito dell'inserimento</returns>
        [WebMethod(Description = "Metodo web per il salvataggio del dettaglio di un RF trattato come corrispondente")]
        public bool SaveElementoRubricaRF(RaggruppamentoFunzionale rf, String idRegistro)
        {
            return BusinessLogic.Utenti.RegistriManager.SaveRaggruppamentoFunzionaleRC(rf, idRegistro);
        }

        /// <summary>
        /// Metodo web per il salvataggio delle impostazioni di interoperabilit semplificata relative ad un registro / RF
        /// </summary>
        /// <param name="interoperabilitySettings">Impostazioni da salvare</param>
        /// <returns>Esito dell'operazione di salvataggio</returns>
        [WebMethod(Description = "Metodo web per il salvataggio delle impostazioni di interoperabilit semplificata")]
        public bool SaveSimplifiedInteroperabilitySettings(InteroperabilitySettings interoperabilitySettings)
        {
            try
            {
                return BusinessLogic.interoperabilita.Semplificata.InteroperabilitaSemplificataManager.SaveSettings(interoperabilitySettings);
            }
            catch (BusinessLogic.interoperabilita.Semplificata.Exceptions.SimplifiedInteroperabilitySaveSettingsException ex)
            {
                throw DocsPaUtils.Exceptions.SoapExceptionFactory.Create(ex);
            }
            catch (Exception e)
            {
                throw DocsPaUtils.Exceptions.SoapExceptionFactory.Create(new Exception("Errore durante il salvataggio delle impostazioni."));
            }

        }

        /// <summary>
        /// Metodo web per il caricamento delle impostazioni di interoperabilit semplificata relative ad un registro / RF
        /// </summary>
        /// <param name="registryId">Id del registro / RF</param>
        /// <returns>Impostazioni relative al registro / RF</returns>
        [WebMethod(Description = "Metodo web per il caricamento delle impostazioni di interoperabilit semplificata")]
        public InteroperabilitySettings LoadSimplifiedInteroperabilitySettings(String registryId)
        {
            try
            {
                return BusinessLogic.interoperabilita.Semplificata.InteroperabilitaSemplificataManager.LoadSettings(registryId);
            }
            catch (Exception e)
            {
                throw DocsPaUtils.Exceptions.SoapExceptionFactory.Create(new Exception("Errore durante il caricamento delle impostazioni."));
            }

        }

        /// <summary>
        /// Metodo per la verifica di abilitazione di un oggetto all'IS
        /// </summary>
        /// <param name="objectId">Id dell'oggetto</param>
        /// <param name="rf">Booleano che indica se si desidera verificare un RF</param>
        /// <returns>Esito della verifica</returns>
        [WebMethod(Description = "Metodo web per la verifica dello stato di abilitazione di un RF / UO all'interoperabilit semplificata")]
        public bool IsElementInteroperableWithSimplifiedInteroperability(String objectId, bool rf)
        {
            try
            {
                return BusinessLogic.interoperabilita.Semplificata.InteroperabilitaSemplificataManager.IsElementInteroperable(objectId, rf);
            }
            catch (Exception e)
            {
                throw DocsPaUtils.Exceptions.SoapExceptionFactory.Create(new Exception(String.Format("Errore durante la verifica di abilitazione dell'{0} {1} all'interoperabilit semplificata.",
                    rf ? "RF" : "UO",
                    objectId)));
            }
        }

        /// <summary>
        /// Questo metodo verifica se un documento ricevuto per interoperabilit semplificata
        ///  stato ricevuto marcato come privato
        /// </summary>
        /// <param name="documentId">Id del documento da controllare</param>
        /// <returns>Flag indicante se il documento  stato ricevuto marcato come privato</returns>
        [WebMethod(Description = "Metodo web per verificare se un documento ricevuto per interoperabilit semplificata  stato ricevuto marcato come privato")]
        public bool IsDocumentReceivedFromSimplifiedInteroperabilityMarkedAdPrivate(String documentId)
        {
            try
            {
                return BusinessLogic.interoperabilita.Semplificata.InteroperabilitaSemplificataManager.IsDocumentReceivedPrivate(documentId);
            }
            catch (Exception e)
            {
                throw DocsPaUtils.Exceptions.SoapExceptionFactory.Create(new Exception(String.Format("Si  verificato un errore durante il caricamento del valore che indica se un documento ricevuto per interoperabilit semplificata  stato ricevuto marcato come privato. Id documento: {0}", documentId)));
            }
        }

        [WebMethod(Description = "Metodo web per verificare se un documento  stato ricevuto per IS")]
        public bool IsDocumentReceivedWithIS(String documentId)
        {
            try
            {
                return BusinessLogic.interoperabilita.Semplificata.InteroperabilitaSemplificataManager.IsDocumentReceivedWithIS(documentId);

            }
            catch (Exception e)
            {
                throw DocsPaUtils.Exceptions.SoapExceptionFactory.Create(new Exception(String.Format("Si  verificato un errore durante il caricamento del valore che indica se un documento  stato ricevuto per IS. Id documento: {0}", documentId)));
            }

        }

        #endregion

        [WebMethod(Description = "Metodo web per il recupero della segnatura di un documento a partire dal suo ID")]
        public String GetDocumentSignatureByProfileId(String idProfile)
        {
            return BusinessLogic.Documenti.ProtoManager.GetDocumentSignatureByProfileId(idProfile);

        }

        [WebMethod]
        public virtual bool AmmVerificaGestioneChiavi(string idPeople)
        {
            bool esito = false;
            try
            {
                esito = BusinessLogic.Amministrazione.UtenteManager.AmmVerificaGestioneChiavi(idPeople);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmVerificaGestioneChiavi - ", e);
            }

            return esito;
        }

        [WebMethod]
        public bool IsCodRubricaPresente(string codRubrica, string tipoCorr, string idAmm, string idReg, bool inRubricaComune)
        {
            try
            {
                return BusinessLogic.Utenti.addressBookManager.IsCodRubricaPresente(codRubrica, tipoCorr, idAmm, idReg, inRubricaComune);
            }
            catch (Exception e)
            {
                throw DocsPaUtils.Exceptions.SoapExceptionFactory.Create(e);
            }
        }

        #region IMPORT_PREGRESSI
        /// <summary>
        /// Abbatangeli Gianluigi - Validazione File Importazione Pregressi
        /// </summary>
        /// <returns></returns>
        [WebMethod]
        public virtual DocsPaVO.Import.Pregressi.EsitoImportPregressi importPregresso(DocsPaVO.utente.InfoUtente infoUtente, byte[] dati, bool isAdministration)
        {
            SetUserId(infoUtente);
            DocsPaVO.Import.Pregressi.EsitoImportPregressi esitoImport = new DocsPaVO.Import.Pregressi.EsitoImportPregressi();
            try
            {
                // PALUMBO: modificato per ovviare al blocco dell'accesso su macchina 20 in scrittura    
                //string serverPath = System.Configuration.ConfigurationManager.AppSettings["LOG_PATH"];
                string serverPath = System.Configuration.ConfigurationManager.AppSettings["DOC_ROOT"];
                serverPath = System.IO.Path.Combine(serverPath, DateTime.Now.ToString("yyyyMMdd"));

                string name = "importPreg" + DateTime.Now.Ticks.ToString() + ".xls";

                esitoImport = BusinessLogic.Amministrazione.ImportPregressiManager.CheckFileData(dati, name, serverPath, infoUtente, isAdministration);

                return esitoImport;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: importaOrganigramma", e);
                esitoImport = null;
            }

            return esitoImport;
        }

        /// <summary>
        /// Abbatangeli Gianluigi - Importazione Pregressi
        /// Andrea - aggiunto parametro descrizione
        /// </summary>
        [WebMethod]
        public bool asyncImportPregresso(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.Import.Pregressi.EsitoImportPregressi esitoPregressi, string descrizione)
        {
            bool esito = false;
            SetUserId(infoUtente);
            try
            {
                //Andrea - parametro descrizione del report
                DocsPaVO.Import.Pregressi.ReportPregressi report = BusinessLogic.Amministrazione.ImportPregressiManager.ImportaPregresso(infoUtente, esitoPregressi, descrizione);

                if (report.itemPregressi.Count > 0)
                {
                    asyncDelegate mDelegate = new asyncDelegate(CreaDocumentiImportPregresso);
                    IAsyncResult result = mDelegate.BeginInvoke(infoUtente, report, new AsyncCallback(asyncImport), null);
                    esito = true;
                }

            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: asyncImportPregresso", e);
            }

            return esito;
        }
        private bool CreaDocumentiImportPregresso(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.Import.Pregressi.ReportPregressi report)
        {
            BusinessLogic.Amministrazione.ImportPregressiManager.CreaDocumenti(infoUtente, report);
            return true;
        }
        private delegate bool asyncDelegate(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.Import.Pregressi.ReportPregressi report);

        private void asyncImport(IAsyncResult ar)
        {
        }

        [WebMethod()]
        public DocsPaVO.documento.FileDocumento ExportPregressiExcel(DocsPaVO.Import.Pregressi.ReportPregressi report, DocsPaVO.utente.InfoUtente infoUtente)
        {

            DocsPaVO.documento.FileDocumento result = null;
            BusinessLogic.ExportDati.ExportDatiManager manager = new BusinessLogic.ExportDati.ExportDatiManager();
            result = manager.ExportReportPregresso(report, infoUtente);

            return result;
        }

        //Andrea - Esport Report in errore
        [WebMethod()]
        public DocsPaVO.documento.FileDocumento ExportReportExcel(List<DocsPaVO.Import.Pregressi.ItemReportPregressi> repInErr)
        {
            DocsPaVO.documento.FileDocumento result = null;
            BusinessLogic.ExportDati.ExportDatiManager manager = new BusinessLogic.ExportDati.ExportDatiManager();
            result = manager.ExportReportInError(repInErr);

            return result;
        }

        //Andrea De Marco - get del Report per gli Import Pregressi per systemId
        [WebMethod()]
        [XmlInclude(typeof(DocsPaVO.Import.Pregressi.ReportPregressi))]
        [XmlInclude(typeof(DocsPaVO.Import.Pregressi.ItemReportPregressi))]
        [XmlInclude(typeof(DocsPaVO.Import.Pregressi.EsitoImportPregressi))]
        public DocsPaVO.Import.Pregressi.ReportPregressi GetReportPregressi(string sysId, bool getItems)
        {
            try
            {
                DocsPaVO.Import.Pregressi.ReportPregressi result = null;

                result = BusinessLogic.Import.ImportPregressi.PregressiManager.GetReportPregressi(sysId, getItems);

                return result;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetReportPregressi", e);

                throw e;
            }
        }

        //Andrea De Marco - get di tutti i Report per gli Import Pregressi
        [WebMethod()]
        [XmlInclude(typeof(DocsPaVO.Import.Pregressi.ReportPregressi))]
        [XmlInclude(typeof(DocsPaVO.Import.Pregressi.ItemReportPregressi))]
        public DocsPaVO.Import.Pregressi.ReportPregressi[] GetReports(bool getItems, InfoUtente infoUtente, bool daAmministrazione)
        {
            try
            {
                DocsPaVO.Import.Pregressi.ReportPregressi[] result = null;

                result = BusinessLogic.Import.ImportPregressi.PregressiManager.GetReports(getItems, infoUtente, daAmministrazione);

                return result;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetReports", e);

                throw e;
            }
        }

        //Andrea De Marco - Delete dei Report e degli item dei Report Import Pregressi
        [WebMethod()]
        [XmlInclude(typeof(DocsPaVO.Import.Pregressi.ReportPregressi))]
        [XmlInclude(typeof(DocsPaVO.Import.Pregressi.ItemReportPregressi))]
        public bool DeleteReportById(string idReport)
        {
            try
            {
                bool result = false;

                result = BusinessLogic.Import.ImportPregressi.PregressiManager.DeleteReport(idReport);

                return result;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DeleteReportById", e);

                throw e;
            }
        }
        #endregion

        #region Visibilit ruolo /stati diagramma
        [WebMethod]
        public virtual DocsPaVO.DiagrammaStato.Visibility.AssRuoloStatiDiagramma[] getRuoliStatiDiagramma(int idDiagramma)
        {
            try
            {
                return BusinessLogic.DiagrammiStato.DiagrammiStato.getRuoliStatiDiagramma(idDiagramma).ToArray();
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getRuoliTipoDoc", e);
                return null;
            }
        }

        [WebMethod]
        public virtual bool ModifyRuoloStatiDiagramma(DocsPaVO.DiagrammaStato.Visibility.AssRuoloStatiDiagramma[] listAssRoleStatiDia)
        {
            return BusinessLogic.DiagrammiStato.DiagrammiStato.ModifyRuoloStatiDiagramma(new
                                                            List<DocsPaVO.DiagrammaStato.Visibility.AssRuoloStatiDiagramma>(listAssRoleStatiDia));
        }

        [WebMethod]
        public bool IsAssociatoRuoloDiagramma(string idDiagramma, string idRuolo)
        {
            try
            {
                return BusinessLogic.DiagrammiStato.DiagrammiStato.IsAssociatoRuoloDiagramma(idDiagramma, idRuolo);
            }
            catch (Exception e)
            {
                return false;
            }
        }

        [WebMethod]
        public bool IsRuoloAssociatoStatoDia(string idDiagramma, string idRuolo, string idStato)
        {
            try
            {
                return BusinessLogic.DiagrammiStato.DiagrammiStato.IsAssociatoRuoloStatoDia(idDiagramma, idRuolo, idStato);
            }
            catch (Exception e)
            {
                return false;
            }
        }

        [WebMethod]
        public List<DocsPaVO.DiagrammaStato.AvanzamentoDiagramma.AssPhaseStatoDiagramma> GetFasiStatiDiagramma(string idDiagramma, DocsPaVO.utente.InfoUtente infoUtente)
        {
            try
            {
                return BusinessLogic.DiagrammiStato.DiagrammiStato.GetFasiStatiDiagramma(idDiagramma, infoUtente);
            }
            catch (Exception e)
            {
                return null;
            }
        }
        [WebMethod]
        public List<DocsPaVO.DiagrammaStato.AvanzamentoDiagramma.AssPhaseStatoDiagramma> GetFaseDiagrammaByIdFase(string idDiagramma, string idFase, DocsPaVO.utente.InfoUtente infoUtente)
        {
            try
            {
                return BusinessLogic.DiagrammiStato.DiagrammiStato.GetFaseDiagrammaByIdFase(idDiagramma, idFase, infoUtente);
            }
            catch (Exception e)
            {
                return null;
            }
        }

        [WebMethod]
        public DocsPaVO.DiagrammaStato.Stato GetStatoById(string idStato, DocsPaVO.utente.InfoUtente infoUtente)
        {
            try
            {
                return BusinessLogic.DiagrammiStato.DiagrammiStato.GetStatoById(idStato, infoUtente);
            }
            catch (Exception e)
            {
                return null;
            }
        }

        [WebMethod]
        public ArrayList ChangeStateGetMissingRoles(string idProject, string idStato, DocsPaVO.utente.InfoUtente user, DocsPaVO.fascicolazione.InfoFascicolo infoFascicolo)
        {
            try
            {
                return BusinessLogic.DiagrammiStato.DiagrammiStato.ChangeStateGetMissingRoles(idProject, idStato, user, infoFascicolo);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore in DocsPaWs.asmx - metodo ChangeStateGetMissingRoles - " + ex);
                return null;
            }
        }

        [WebMethod]
        public void ChangeStateTransmissionsMissingRoles(string[] missingRoles, InfoUtente infoUtente, InfoFascicolo infoFascicolo, string idStato)
        {
            try
            {
                BusinessLogic.DiagrammiStato.DiagrammiStato.CreateTransmissionsForMissingRoles(missingRoles, infoUtente, infoFascicolo, idStato);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore in DocsPaWs.asmx - metodo ChangeStateTransmissionsMissingRoles - " + ex);
            }
        }

        [WebMethod]
        public void ChangeStateSendTransmissions(string idStato, InfoFascicolo infoFascicolo, InfoUtente infoUtente)
        {
            try
            {
                BusinessLogic.DiagrammiStato.DiagrammiStato.SendTransmissions(idStato, infoFascicolo, infoUtente);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore in DocsPaWs.asmx - metodo ChangeStateSendTransmissions - " + ex);
            }
        }

        #endregion

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual string AllegatoIsEsterno(string version_id)
        {
            string retValue = string.Empty;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                retValue = BusinessLogic.Documenti.AllegatiManager.getIsAllegatoEsterno(version_id);
#if TRACE_WS
				pt.WriteLogTracer("DocumentoGetAllegati");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AllegatoIsEsterno", e);
                logger.Debug(e.ToString());
                retValue = null;
            }
            return retValue;
        }
        [WebMethod]
        public string getApplicationName()
        {
            string retValue = string.Empty;
            retValue = BusinessLogic.Amministrazione.AmministraManager.getApplicationName();
            return retValue;
        }


        [WebMethod]
        public string GestioneMessaggioLogin(string message, string password)
        {
            string retValue = string.Empty;
            retValue = BusinessLogic.Amministrazione.AmministraManager.GestioneMessaggioLogin(message, password);
            return retValue;
        }

        //[WebMethod]
        //public bool UpdateMessaggioLogin(string message)
        //{
        //    bool retValue = false;
        //    retValue = BusinessLogic.Amministrazione.AmministraManager.UpdateMessaggioLogin(message);
        //    return retValue;
        //}

        /// <summary>
        /// Restituisce la lista dei 'destinatari' / 'destinatari in cc' associati ad un documento con il relativo canale preferenziale
        /// </summary>
        /// <param name="idProfile"></param>
        /// <param name="typeDest">Pu assumere D(estrai le info sui destinatari), C(estrati le info sui destinatari in CC)</param>
        /// <returns>Corrispondente[]</returns>
        [WebMethod]
        public Corrispondente[] GetPrefChannelAllDest(string idProfile, string typeDest)
        {
            return BusinessLogic.Utenti.UserManager.GetPrefChannelAllDest(idProfile, typeDest).ToArray();
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.documento.DirittoOggetto))]
        [XmlInclude(typeof(DocsPaVO.filtri.FilterVisibility))]
        public virtual ArrayList DocumentGetVisibilityWithFIlter(DocsPaVO.utente.InfoUtente infoUtente, string idProfile, bool cercaRimossi, DocsPaVO.filtri.FilterVisibility[] filters)
        {
            ArrayList objListaDiritti = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                objListaDiritti = BusinessLogic.Utenti.DirittiManager.getListaDirittiSemplificataWithFilter(infoUtente, idProfile, cercaRimossi, filters);
#if TRACE_WS
				pt.WriteLogTracer("DocumentoGetVisibilita");
#endif

            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoGetVisibilita", e);
                objListaDiritti = null;
            }

            return objListaDiritti;
        }


        /// <summary>
        /// </summary>
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.fascicolazione.DirittoOggetto))]
        [XmlInclude(typeof(DocsPaVO.filtri.FilterVisibility))]
        public virtual ArrayList FascGetVisibilityWithFIlter(DocsPaVO.utente.InfoUtente infoUtente, string idProfile, bool cercaRimossi, DocsPaVO.filtri.FilterVisibility[] filters, string rootFolder)
        {
            ArrayList objListaDiritti = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                objListaDiritti = BusinessLogic.Utenti.DirittiManager.getListaDirittiSemplificataWithFilterFasc(infoUtente, idProfile, cercaRimossi, filters, rootFolder);
#if TRACE_WS
				pt.WriteLogTracer("DocumentoGetVisibilita");
#endif

            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoGetVisibilita", e);
                objListaDiritti = null;
            }

            return objListaDiritti;
        }

        [WebMethod()]
        public DocsPaVO.trasmissione.InfoTrasmissione[] GetInfoTrasmissioniFiltered(
                DocsPaVO.utente.InfoUtente infoUtente
                , string idDocOrFasc, string docOrFasc
                , DocsPaVO.filtri.FiltroRicerca[] objListaFiltri
                , ref DocsPaVO.ricerche.SearchPagingContext pagingContext)
        {
            try
            {
                SetUserId(infoUtente);
                return BusinessLogic.Trasmissioni.QueryTrasmManager.GetInfoTrasmissioniFiltered(infoUtente, idDocOrFasc, docOrFasc, objListaFiltri, ref pagingContext);
            }
            catch (Exception e)
            {
                string errorMessage = string.Format("Errore in DocsPaWS.GetInfoTrasmissioniEffettuate:\n{0}", e.Message);

                logger.Debug(errorMessage);
                throw new ApplicationException(errorMessage);
            }
        }

        [WebMethod]
        [XmlInclude(typeof(DocsPaVO.addressbook.CorrespondentDetails))]
        public DocsPaVO.addressbook.CorrespondentDetails GetCorrespondentDetails(string idCorr)
        {
            return new DocsPaDB.Query_DocsPAWS.Utenti().getCorrespondentDetails(idCorr);
        }

        [WebMethod]
        public Corrispondente ValorizeInfoCorr(Corrispondente corr
            , string address, string city, string zipCode, string district, string country, string phone, string phone2
            , string fax, string taxId, string note, string place, string title, string birthPlace, string birthDay, string commercialId//, string codiceIpa = null
        )
        {
            DocsPaVO.addressbook.DettagliCorrispondente dettagliCorr = new DocsPaVO.addressbook.DettagliCorrispondente();
            dettagliCorr.Corrispondente.AddCorrispondenteRow(address,
                city,
                zipCode,
                district,
                country,
                phone,
                phone2,
                fax,
                taxId.Trim(),
                note,
                place,
                birthPlace,
                birthDay,
                title,
                commercialId.Trim()
                //, codiceIpa
                );

            corr.info = dettagliCorr;

            return corr;
        }

        //visualizzazione storia del documento
        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.documento.LogDocumento))]
        public virtual ArrayList DocumentoGetListaLogFilter(string idOggetto, string idFolder, string varOggetto, DocsPaVO.filtri.FilterVisibility[] filter)
        {
            ArrayList res = null;
            try
            {
                res = BusinessLogic.Documenti.Oggettario.getListaLog(idOggetto, idFolder, varOggetto, filter);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoGetListaLog", e);
            }
            return res;
        }

        [WebMethod]
        [XmlInclude(typeof(DocsPaVO.documento.Tab))]
        public DocsPaVO.documento.Tab GetDocumentTab(string documentId, InfoUtente infoUser)
        {
            return BusinessLogic.Documenti.DocManager.GetDocumentTab(documentId, infoUser);
        }

        [WebMethod]
        [XmlInclude(typeof(int))]
        public int GetDocumentTrasmToCCDest(string documentId, InfoUtente infoUser)
        {
            return BusinessLogic.Documenti.DocManager.GetDocumentTrasmToCCDest(documentId, infoUser);
        }

        [WebMethod]
        [XmlInclude(typeof(DocsPaVO.documento.Tab))]
        public DocsPaVO.documento.Tab GetProjectTab(string projectId, InfoUtente infoUser)
        {
            return BusinessLogic.Fascicoli.FascicoloManager.GetProjectTab(projectId, infoUser);
        }
        /// <summary>
        /// Servizio web che restituisce l'eventuale segnatura di repertorio del documento
        /// </summary>
        /// <param name="docnumber">id del documento per il quale ricercare la segnatura di repertorio</param>
        /// <returns>string</returns>
        [WebMethod(Description = "Restituisce l'eventuale segnatura di repertorio associata al documento")]
        public string getSegnaturaRepertorioNoHTML(string docnumber, string codiceAmm)
        {
            string segnaturaRepertorio = string.Empty;

            try
            {
                String dataAnnullamento = String.Empty;
                segnaturaRepertorio = BusinessLogic.Documenti.DocManager.GetSegnaturaRepertorio(docnumber, codiceAmm, false, out dataAnnullamento);
                return segnaturaRepertorio;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetSegnaturaRepertorio", e);
                return segnaturaRepertorio = null;
            }
        }

        /// <summary>
        /// Servizio web che restituisce l'elenco delle versioni del documento principale
        /// </summary>
        /// <param name="docnumber">id del documento per il quale ricercare l'elenco delle versione del doc principale</param>
        /// <returns>string</returns>
        [WebMethod(Description = "Restituisce l'elenco delle versioni del documento principale")]
        public DocsPaVO.documento.Documento[] GetVersionsMainDocument(InfoUtente infoUser, string docNumber)
        {
            try
            {
                return BusinessLogic.Documenti.DocManager.GetVersionsMainDocument(infoUser, docNumber);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetVersionsMainDocument", e);
                return null;
            }
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual DocsPaVO.documento.FileDocumento StampaRicevutaProtocolloRtf(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.documento.SchedaDocumento schedaDoc)
        {
            DocsPaVO.documento.FileDocumento res = null;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                res = BusinessLogic.Report.ReportManager.getRicevutaProtocolloRtf(infoUtente, schedaDoc);
#if TRACE_WS
				pt.WriteLogTracer("ReportBusta");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: StampaRicevutaProtocolloRtf", e);
                res = null;
            }

            return res;
        }

        #region Check mailbox new UI

        /// <summary>
        /// Servizio per la consultazione della casella istituzionale.
        /// </summary>
        /// <returns></returns>
        [WebMethod]
        public virtual bool CheckMailBox(string serverName, DocsPaVO.utente.Registro reg, DocsPaVO.utente.Utente ut, DocsPaVO.utente.Ruolo ruolo)
        {
            SetUserId(ut);
            bool result = true;
            DocsPaVO.Interoperabilita.MailAccountCheckResponse checkMailboxResult = new DocsPaVO.Interoperabilita.MailAccountCheckResponse();
            DocsPaVO.Logger.CodAzione.Esito esito = DocsPaVO.Logger.CodAzione.Esito.OK;

            try
            {
                BusinessLogic.Interoperabilit.InteroperabilitaRicezione.StartCheckMailbox(serverName, reg, ut, ruolo, out checkMailboxResult);
                if (checkMailboxResult != null && checkMailboxResult.MailProcessedList != null)
                {
                    logger.Debug("checkResponse.MailProcessedList: " + checkMailboxResult.MailProcessedList.Count);
                    logger.Debug("checkResponse.InvalidMailProcessedCount" + checkMailboxResult.InvalidMailProcessedCount);
                }
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: CheckMailBox", e);
                result = false;
                esito = DocsPaVO.Logger.CodAzione.Esito.KO;
            }
            finally
            {
                string email = reg.email;
                if (string.IsNullOrEmpty(email))
                    email = "NON DEFINITO";

                string logInfo = "Registro: " + reg.codRegistro + " - " + "Indirizzo mail: " + email + " - ";

                if (!string.IsNullOrEmpty(checkMailboxResult.ErrorMessage))
                {
                    logInfo += "Errore nella connessione al server di posta";
                    esito = DocsPaVO.Logger.CodAzione.Esito.KO;
                }
                else if (checkMailboxResult.InvalidMailProcessedCount > 0)
                {
                    logInfo += checkMailboxResult.InvalidMailProcessedCount.ToString() + " messaggi non processati";
                    esito = DocsPaVO.Logger.CodAzione.Esito.KO;
                }
                else
                {
                    logInfo += "Processati " + checkMailboxResult.MailProcessedList.Count.ToString() + " messaggi";
                }

                BusinessLogic.UserLog.UserLog.WriteLog(
                            ut.userId,
                            ut.idPeople,
                            ((DocsPaVO.utente.Ruolo)ut.ruoli[0]).idGruppo,
                            ut.idAmministrazione,
                            "INTEROPERABILITARICEZIONE",
                            reg.systemId,
                            logInfo,
                            esito, null);
            }

            return result;
        }

        /// <summary>
        /// Servizio per la nuova gestione di consultazione casella istituzionale
        /// Il servizio restituisce lo stato sulle n caselle passate come parametro di input
        /// </summary>
        /// <returns></returns>
        [WebMethod]
        public virtual DocsPaVO.Interoperabilita.InfoCheckMailbox[] InfoCheckMailbox(string[] emails)
        {
            return BusinessLogic.Interoperabilit.InteroperabilitaRicezione.InfoCheckMailbox(new List<string>(emails)).ToArray();
        }

        /// <summary>
        /// Elimina le informazioni sul report della mailbox appena consultato
        /// </summary>
        /// <returns></returns>
        [WebMethod]
        public virtual bool RemoveReportMailbox(string idCheckMailbox)
        {
            return BusinessLogic.Interoperabilit.InteroperabilitaRicezione.RemoveReportMailbox(idCheckMailbox);
        }

        /// <summary>
        /// Restituisce le informazioni sul report associato alla mailbox da consultare.
        /// </summary>
        /// <returns></returns>
        [WebMethod]
        public virtual DocsPaVO.Interoperabilita.MailAccountCheckResponse InfoReportMailbox(string idCheckMailbox)
        {
            return BusinessLogic.Interoperabilit.InteroperabilitaRicezione.InfoReportMailbox(idCheckMailbox);
        }

        #endregion

        [WebMethod]
        public virtual bool FascicolazioneGetIfDocumentiCountVisibleIsEgualNotVisible(
            DocsPaVO.utente.InfoUtente infoUtente,
            DocsPaVO.fascicolazione.Folder folder)
        {
            bool result = false;

            try
            {
                result = BusinessLogic.Fascicoli.FolderManager.getIfDocumentiCountVisibleIsEgualNotVisible(infoUtente, folder);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneGetIfDocumentiCountVisibleIsEgualNotVisible", e);
            }

            return result;
        }

        /// <summary>
        /// 
        /// </summary>
        /// <param name="folderId"></param>
        /// <param name="parentId"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual bool FascicolazioneMoveFolder(string folderId, string parentId)
        {
            bool result = false;

            try
            {
                result = BusinessLogic.Fascicoli.FolderManager.MoveFolder(folderId, parentId);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: FascicolazioneMoveFolder", e);
            }

            return result;
        }


        [WebMethod]
        public virtual Diagnostics A1GetDiagnostics()
        {

            Diagnostics retval = new Diagnostics();
            retval.BackedTime = DateTime.Now;

            retval.TipoDocumentale = ConfigurationManager.AppSettings["documentale"];

            if (retval.TipoDocumentale.ToLower().Equals("pitre"))
                retval.InfoDocumentale = ConfigurationManager.AppSettings["DocumentumServiceUrl"];

            if (retval.TipoDocumentale.ToLower().Equals("etdocs"))
                retval.InfoDocumentale = ConfigurationManager.AppSettings["DOC_ROOT"];

            retval.TipoDB = ConfigurationManager.AppSettings["DBType"];
            retval.UrlRubricaComune = ConfigurationManager.AppSettings["RubricaComuneConnectionString"];
            retval.UrlConvertitorePDF = ConfigurationManager.AppSettings["INLINE_CONVERTER_URL"];
            try
            {
                retval.UrlCentroNotifiche = new BusinessLogic.NotificationCenterOperationServices.NotificationServiceOperationsClient().Endpoint.Address.Uri.ToString();
            }
            catch (Exception e)
            {
                retval.UrlCentroNotifiche = "UNCONFIGURED/ERROR";
            }

            retval.VersioneWS = System.Reflection.Assembly.GetExecutingAssembly().GetName().Version.ToString();
            String DBErr = string.Empty;
            try
            {
                DocsPaUtils.Query queryDef1 = DocsPaUtils.InitQuery.getInstance().getQuery("S_CONSERVAZIONE");
                queryDef1.setParam("param1", "*");
                queryDef1.setParam("param2", "FROM (select id_versions_u from dpa_docspa order by System_Id desc)");
                queryDef1.setParam("param3", "WHERE rownum=1");
                string commandText = queryDef1.getSQL();

                using (DocsPaDB.DBProvider dbProvider = new DocsPaDB.DBProvider())
                {
                    if (dbProvider.LastExceptionMessage != null)
                        DBErr = dbProvider.LastExceptionMessage;

                    using (System.Data.IDataReader reader = dbProvider.ExecuteReader(commandText))
                    {
                        if (dbProvider.LastExceptionMessage != null)
                            DBErr = dbProvider.LastExceptionMessage;

                        while (reader.Read())
                        {
                            retval.TitoloSGD = reader.GetString(reader.GetOrdinal("id_versions_u"));
                            retval.DBok = true;

                        }
                    }

                }
            }
            catch (Exception e)
            {
                retval.TitoloSGD = e.Message + "\r\n" + DBErr;
                retval.DBok = false;
            }


            try
            {
                DocsPaUtils.Query queryDef1 = DocsPaUtils.InitQuery.getInstance().getQuery("S_CONSERVAZIONE");
                queryDef1.setParam("param1", "");
                queryDef1.setParam("param2", "sys_context('USERENV', 'CURRENT_SCHEMA') as UTENTE FROM DUAL");
                queryDef1.setParam("param3", "");
                string commandText = queryDef1.getSQL();

                using (DocsPaDB.DBProvider dbProvider = new DocsPaDB.DBProvider())
                {
                    if (dbProvider.LastExceptionMessage != null)
                        DBErr = dbProvider.LastExceptionMessage;
                    using (System.Data.IDataReader reader = dbProvider.ExecuteReader(commandText))
                    {
                        if (dbProvider.LastExceptionMessage != null)
                            DBErr = dbProvider.LastExceptionMessage;
                        while (reader.Read())
                        {
                            retval.NomeUtenteDb = reader.GetString(reader.GetOrdinal("UTENTE"));
                            retval.DBok = true;
                        }
                    }

                }
            }
            catch (Exception e)
            {
                retval.TitoloSGD = e.Message + "\r\n" + DBErr;
                retval.DBok = false;
            }


            try
            {
                DocsPaUtils.Query queryDef1 = DocsPaUtils.InitQuery.getInstance().getQuery("S_CONSERVAZIONE");
                queryDef1.setParam("param1", "");
                queryDef1.setParam("param2", "sys_context('USERENV', 'DB_NAME') as DBNAME FROM DUAL");
                queryDef1.setParam("param3", "");
                string commandText = queryDef1.getSQL();

                using (DocsPaDB.DBProvider dbProvider = new DocsPaDB.DBProvider())
                {
                    if (dbProvider.LastExceptionMessage != null)
                        DBErr = dbProvider.LastExceptionMessage;
                    using (System.Data.IDataReader reader = dbProvider.ExecuteReader(commandText))
                    {
                        if (dbProvider.LastExceptionMessage != null)
                            DBErr = dbProvider.LastExceptionMessage;
                        while (reader.Read())
                        {
                            retval.NomeDb = reader.GetString(reader.GetOrdinal("DBNAME"));
                            retval.DBok = true;
                        }
                    }

                }
            }
            catch (Exception e)
            {
                retval.TitoloSGD = e.Message + "\r\n" + DBErr;
                retval.DBok = false;
            }

            retval.PathWS = Server.MapPath("~");
            retval.WSServerName = Server.MachineName;
            retval.AppPoolWS = HttpContext.Current.Request.ServerVariables["APP_POOL_ID"];
            // retval.UrlConvertitorePDF = 


            return retval;

        }

        [WebMethod]
        public virtual string DayOnYearBeforeToday()
        {
            try
            {
                return BusinessLogic.Documenti.InfoDocManager.DayOnYearBeforeToday();
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DayOnYearBeforeToday", e);
                return null;
            }
        }


        //Laura 25 Marzo
        [WebMethod]
        [XmlInclude(typeof(DocsPaVO.Grids.SearchObjectField))]
        [XmlInclude(typeof(DocsPaVO.Grid.Field))]
        public virtual int getCountDocumentiInFolderCustom(
            DocsPaVO.utente.InfoUtente infoUtente,
            DocsPaVO.fascicolazione.Folder folder,
            DocsPaVO.filtri.FiltroRicerca[][] filtriRicerca,
            out List<SearchResultInfo> idProfiles)
        {
            int countDoc = 0;

            ArrayList objListaDocumenti = null;
            List<SearchResultInfo> idProfileList = null;
            try
            {

                countDoc = BusinessLogic.Fascicoli.FolderManager.getCountDocumentiInFolderCustom(infoUtente, folder, filtriRicerca, out idProfileList);

            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getCountDocumentiInFolderCustom", e);
                objListaDocumenti = null;
            }

            idProfiles = idProfileList;
            return countDoc;
        }

        /// <summary>
        /// Rimuove i diritti di visibilit ad un utente/ruolo per un dato documento
        /// </summary>
        /// <param name="docDiritto"></param>
        /// <param name="personOrGroup"></param>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual bool EditingACLWithType(DocsPaVO.documento.DirittoOggetto docDiritto, string personOrGroup, DocsPaVO.utente.InfoUtente infoUtente, string typeObject)
        {
            SetUserId(infoUtente);
            bool result = true;
            string descrizione = "";
            try
            {
                result = BusinessLogic.Documenti.DocManager.EditingACL(out descrizione, docDiritto, personOrGroup, infoUtente);
                if (result)
                {
                    if (!string.IsNullOrEmpty(typeObject) && typeObject.Equals("D"))
                    {
                        BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "EDITINGACL", docDiritto.idObj, descrizione, DocsPaVO.Logger.CodAzione.Esito.OK);
                    }
                    else
                    {
                        BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "EDITINGFASCACL", docDiritto.idObj, descrizione, DocsPaVO.Logger.CodAzione.Esito.OK);
                    }
                }
            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "EDITINGACL", docDiritto.idObj, descrizione, DocsPaVO.Logger.CodAzione.Esito.KO);
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: EditingACL", e);
                result = false;
            }
            return result;
        }

        /// <summary>
        /// Ripristina i diritti di visibilita per un ruolo/utente di un documento precedentemente revocati
        /// </summary>
        /// <param name="docDiritto"></param>
        /// <param name="personOrGroup"></param>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual bool RipristinaACLWithType(DocsPaVO.documento.DirittoOggetto docDiritto, string personOrGroup, DocsPaVO.utente.InfoUtente infoUtente, string typeObject)
        {
            SetUserId(infoUtente);
            bool result = true;
            string descrizione = "";
            try
            {
                result = BusinessLogic.Documenti.DocManager.RipristinaACL(out descrizione, docDiritto, personOrGroup, infoUtente);
                if (result)
                {
                    if (!string.IsNullOrEmpty(typeObject) && typeObject.Equals("D"))
                    {
                        BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "EDITINGACL", docDiritto.idObj, descrizione, DocsPaVO.Logger.CodAzione.Esito.OK);
                    }
                    else
                    {
                        BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "EDITINGFASCACL", docDiritto.idObj, descrizione, DocsPaVO.Logger.CodAzione.Esito.OK);
                    }
                }
            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "EDITINGACL", docDiritto.idObj, descrizione, DocsPaVO.Logger.CodAzione.Esito.KO);
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: RipristinaACL", e);
                result = false;
            }
            return result;
        }

        /// <summary>

        /// Reperimento dei SystemID delle trasmissioni ricevute da un utente (tab Notify)

        /// </summary>

        /// <param name="mittente"></param>

        /// <param name="filtriRicerca"></param>

        /// <returns></returns>

        [WebMethod]

        [return: XmlArray()]

        [return: XmlArrayItem(typeof(DocsPaVO.Smistamento.DatiTrasmissioneDocumento))]

        public virtual ArrayList GetListDocumentiTrasmessiNotifyFilters(DocsPaVO.Smistamento.MittenteSmistamento mittente, DocsPaVO.filtri.FiltroRicerca[] filtriRicerca)
        {

            // Lnr 22/05/2013



            ArrayList retValue = new ArrayList();



            try
            {

                retValue = BusinessLogic.SmistamentoDocumenti.SmistamentoManager.GetListDocumentiTrasmessiNotifyFilters(mittente, filtriRicerca);

            }

            catch (Exception e)
            {

                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetListDocumentiTrasmessiNotifyFilters - ", e);

            }



            return retValue;

        }



        /// <summary>

        /// Reperimento dei SystemID delle trasmissioni ricevute da un utente (tab Notify)

        /// </summary>

        /// <param name="infoUtente">Contesto utente</param>

        /// <returns></returns>

        [WebMethod]

        [return: XmlArray()]

        [return: XmlArrayItem(typeof(DocsPaVO.Smistamento.DatiTrasmissioneDocumento))]

        public virtual ArrayList GetListDocumentiTrasmessiNotify(List<Notification> notifications, DocsPaVO.Smistamento.MittenteSmistamento mittente)
        {
            ArrayList retValue = new ArrayList();
            try
            {

                retValue = BusinessLogic.SmistamentoDocumenti.SmistamentoManager.GetListDocumentiTrasmessiNotify(notifications, mittente);

            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetListDocumentiTrasmessiNotify - ", e);
            }
            return retValue;
        }

        #region Notification Center

        /// <summary>
        /// Return the list of notifications that are directed to:
        /// 1. the couple user role.
        /// 2. user
        /// </summary>
        /// <returns></returns>
        [WebMethod]
        public DocsPaVO.Notification.Notification[] ReadNotifications(string idPeople, string idGroup)
        {
            List<DocsPaVO.Notification.Notification> listNotifications = new List<DocsPaVO.Notification.Notification>();
            try
            {
                listNotifications = BusinessLogic.ServiceNotifications.Notification.ReadNotifications(idPeople, idGroup);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ReadNotifications", e);
            }
            return listNotifications.ToArray();
        }

        /// <summary>
        /// Aggiorna le notifiche legate al system id del documento/fascicolo in base alle modifiche subite da quest'ultimo
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <param name="typeOperation">Elenco del tipo di operazioni di modifica effettuate sul documento/fascicolo</param>
        /// <param name="idObject">id del documento/fascicolo</param>
        /// <param name="domainObject">fascicolo/documento</param>
        [XmlInclude(typeof(DocsPaVO.Notification.TypeOperation[]))]
        [WebMethod]
        public void ModifyNotifications(InfoUtente infoUtente, TypeOperation[] typeOperation, string idObject, string domainObject)
        {
            try
            {
                BusinessLogic.ServiceNotifications.Notification.ModifyNotifications(infoUtente, typeOperation, idObject, domainObject);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ModifyNotifications", e);
            }
        }

        /// <summary>
        /// removes the notification with idNotification selected for delete from front end
        /// </summary>
        /// <returns></returns>
        [WebMethod]
        public bool RemoveNotifications(DocsPaVO.Notification.Notification[] notifications)
        {
            return BusinessLogic.ServiceNotifications.Notification.RemoveNotifications(new List<DocsPaVO.Notification.Notification>(notifications));
        }

        /// <summary>
        /// Return the number of notifications that are direct to:
        /// 1. the couple user-roles different by role in input.
        /// 2. user
        /// </summary>
        /// <returns></returns>
        [WebMethod]
        public int GetNumberNotifyOtherRoles(string idPeople, string idGroup)
        {
            int count = 0;
            try
            {
                count = BusinessLogic.ServiceNotifications.Notification.GetNumberNotifyOtherRoles(idPeople, idGroup);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetNumberNotifyOtherRoles", e);
            }
            return count;
        }

        /// <summary>
        /// Restituisce il dettaglio della trasmissione
        /// </summary>
        /// <param name="oggettoTrasmesso"></param>
        /// <param name="idTrasmSing">Id della trasmissione singola. Da questo si risale a tutto il dettaglio della trasmissione contenente la trasm singola</param>
        /// <returns></returns>
        [WebMethod()]
        public virtual DocsPaVO.trasmissione.Trasmissione GetTrasmissioneByIdTrasmSing(DocsPaVO.trasmissione.OggettoTrasm oggettoTrasmesso, string idTrasmSing, DocsPaVO.utente.Utente utente, DocsPaVO.utente.Ruolo ruolo)
        {
            return BusinessLogic.Trasmissioni.QueryTrasmManager.GetTrasmissioneByIdTrasmSing(oggettoTrasmesso, idTrasmSing, utente, ruolo);
        }

        /// <summary>
        /// Change the notification status from unread to read
        /// </summary>
        /// <returns></returns>
        [WebMethod]
        public bool ChangeStateReadNotification(DocsPaVO.Notification.Notification notify, bool isNotEnabledSetDataVistaGrd)
        {
            return BusinessLogic.ServiceNotifications.Notification.ChangeStateReadNotification(notify, isNotEnabledSetDataVistaGrd);
        }

        /// <summary>
        /// Remove the notification from the notification center and applies the multiplicity one all
        /// </summary>
        /// <returns></returns>
        [WebMethod]
        public bool CheckNotification(DocsPaVO.Notification.Notification notification, InfoUtente infoUser)
        {
            bool result = BusinessLogic.ServiceNotifications.Notification.CheckNotification(notification);

            //Emanuela 04-06-2014: traccio nel log il visto delle notifiche di rifiuto
            if (notification.TYPE_EVENT.Equals("REJECT_TRASM_DOCUMENT") || notification.TYPE_EVENT.Equals("REJECT_TRASM_FOLDER"))
            {
                string desc = "Vistata notifica di rifiuto. ";
                string method = string.Empty;
                if (notification.DOMAINOBJECT.Equals("DOCUMENTO"))
                {
                    desc = string.IsNullOrEmpty(notification.ITEMS.ITEM2) ? desc + "Id documento: " + notification.ID_OBJECT :
                        desc + "Numero Protocollo: " + BusinessLogic.ServiceNotifications.Notification.GetSignatureIntoNotification(notification.ITEMS.ITEM2);
                    method = "CHECK_REJECT_DOCUMENT";
                }
                else if (notification.DOMAINOBJECT.Equals("FASCICOLO"))
                {
                    desc = desc + "Id fascicolo: " + notification.ID_OBJECT;
                    method = "CHECK_REJECT_FOLDER";
                }
                BusinessLogic.UserLog.UserLog.WriteLog(infoUser.userId, infoUser.idPeople, infoUser.idGruppo, infoUser.idAmministrazione, method, notification.ID_OBJECT, desc, DocsPaVO.Logger.CodAzione.Esito.OK,
                               (infoUser != null && infoUser.delegato != null ? infoUser.delegato : null), "0", notification.ID_SPECIALIZED_OBJECT);
            }

            return result;
        }

        /// <summary>
        /// Restituisce l'id dei documenti che rispettano le condizioni impostate nel filtro in input
        /// </summary>
        /// <param name="idObject"></param>
        /// <param name="filter"></param>
        /// <returns></returns>
        [XmlInclude(typeof(DocsPaVO.Notification.NotificationsFilters))]
        [WebMethod]
        public List<string> GetDocumentByNotificationsFilters(string[] idObject, DocsPaVO.Notification.NotificationsFilters filter)
        {
            return BusinessLogic.ServiceNotifications.Notification.GetDocumentByNotificationsFilters(idObject, filter);
        }

        /// <summary>
        /// Prende l'id delle trasmissioni singole con workflow in attesa di accettazione/rifiuto
        /// </summary>
        /// <param name="idSpecializedObject"></param>
        /// <param name="idPeople"></param>
        /// <returns></returns>
        [WebMethod]
        public List<string> GetIdTransmPendingByNotificationsFilters(string[] idSpecializedObject, string idPeople)
        {
            return BusinessLogic.ServiceNotifications.Notification.GetIdTrasmPendingByNotificationsFilters(idSpecializedObject, idPeople);
        }

        /// <summary>
        /// Restituisce il numero di giorni oltre i quali la notifica viene segnalata come "vecchia"
        /// </summary>
        /// <param name="idAmm"></param>
        /// <returns></returns>
        [WebMethod]
        public string GetNoticeDaysNotification(string idAmm)
        {
            return BusinessLogic.ServiceNotifications.Notification.GetNoticeDaysNotification(idAmm);
        }

        /// <summary>
        /// Rimuove le notifiche di trasmissioni che non necessitano accettazione antecedenti la data specificata
        /// </summary>
        /// <param name="idObject"></param>
        /// <param name="filter"></param>
        /// <returns></returns>
        [WebMethod]
        public bool RemoveNotificationOfTransmissionNoWF(string idPeople, string idGroup, string date)
        {
            return BusinessLogic.ServiceNotifications.Notification.RemoveNotificationOfTransmissionNoWF(idPeople, idGroup, date);
        }

        /// <summary>
        /// Salva/Svuota la nota nella notifica
        /// </summary>
        /// <param name="idNotify"></param>
        /// <returns></returns>
        [WebMethod]
        public bool UpdateNoteNotification(string idNotify, string note)
        {
            return BusinessLogic.ServiceNotifications.Notification.UpdateNoteNotification(idNotify, note);
        }

        /// <summary>
        ///Return the list of assertions defined in administration.
        /// </summary>
        /// <param name="idObject"></param>
        /// <param name="filter"></param>
        /// <returns></returns>
        [WebMethod]
        public Assertion[] GetListAssertion(string idAmm)
        {
            List<Assertion> assertions = BusinessLogic.Amministrazione.AssertionEventManager.GetListAssertionsEvent(idAmm);
            return assertions.ToArray();
        }

        /// <summary>
        /// returns the list of configurable event types.
        /// </summary>
        /// <param name="idObject"></param>
        /// <param name="filter"></param>
        /// <returns></returns>
        [WebMethod]
        public string[] GetTypeConfigurableEvents(string idAmm)
        {
            List<string> typeEventConf = BusinessLogic.Amministrazione.AssertionEventManager.GetTypeConfigurableEvents(idAmm);
            return typeEventConf.ToArray();
        }

        /// <summary>
        /// Insert a new assertion event.
        /// </summary>
        /// <param name="idObject"></param>
        /// <param name="filter"></param>
        /// <returns></returns>
        [WebMethod]
        public int InsertAssertionEvent(Assertion newAssertion)
        {
            return BusinessLogic.Amministrazione.AssertionEventManager.InsertAssertionEvent(newAssertion);
        }

        /// <summary>
        /// Insert a new assertion event.
        /// </summary>
        /// <param name="idObject"></param>
        /// <param name="filter"></param>
        /// <returns></returns>
        [WebMethod]
        public string[] SearchAur(string typeAur, string code, string description, string idAmm)
        {
            return BusinessLogic.Amministrazione.AssertionEventManager.SearchAur(typeAur, code, description, idAmm).ToArray();
        }

        [WebMethod]
        public virtual DocsPaVO.documento.FileDocumento ExportNotificationCenter(DocsPaVO.utente.InfoUtente infoUtente, string exportType, string title, ArrayList campiSelezionati, List<DocsPaVO.Notification.Notification> ListNotify)
        {
            SetUserId(infoUtente);
            DocsPaVO.documento.FileDocumento file = null;
            try
            {
                BusinessLogic.ExportDati.ExportDatiManager manager = new BusinessLogic.ExportDati.ExportDatiManager();
                file = manager.ExportNotificationCenter(infoUtente, exportType, title, campiSelezionati, ListNotify);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ExportNotificationCenter", e);
                file = null;
            }
            return file;
        }

        [WebMethod]
        public virtual DocsPaVO.documento.FileDocumento ExportVisibilitaProcessiFirma(DocsPaVO.utente.InfoUtente infoUtente, string exportType, string title, ArrayList campiSelezionati, List<DocsPaVO.LibroFirma.ProcessoFirma> listaProcessiFirma)
        {
            SetUserId(infoUtente);
            DocsPaVO.documento.FileDocumento file = null;
            try
            {
                BusinessLogic.ExportDati.ExportDatiManager manager = new BusinessLogic.ExportDati.ExportDatiManager();
                file = manager.ExportVisibilitaProcessiFirma(infoUtente, exportType, title, campiSelezionati, listaProcessiFirma);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ExportVisibilitaProcessiFirma", e);
                file = null;
            }
            return file;
        }


        /// <summary>
        /// Rimuove le asserzioni.
        /// </summary>
        /// <param name="idObject"></param>
        /// <param name="filter"></param>
        /// <returns></returns>
        [WebMethod]
        public bool RemoveAssertions(List<Assertion> assertions)
        {
            return BusinessLogic.Amministrazione.AssertionEventManager.RemoveAssertions(assertions);
        }

        /// <summary>
        /// Update assertion event.
        /// </summary>
        /// <param name="idObject"></param>
        /// <param name="filter"></param>
        /// <returns></returns>
        [WebMethod]
        public int UpdateAssertionEvent(Assertion assertion)
        {
            return BusinessLogic.Amministrazione.AssertionEventManager.UpdateAssertionEvent(assertion);
        }
        #endregion

        #region ADL Role

        /// <summary>
        /// controlla se il documento  presente nella todolist del ruolo
        /// </summary>
        /// <param name="idProfile"></param>
        /// <param name="idRole"></param>
        /// <returns></returns>
        [WebMethod]
        public int isDocInADLRole(string idProfile, string idRole)
        {
            try
            {
                return BusinessLogic.Documenti.DocManager.IsDocInADLRole(idProfile, idRole);
            }
            catch (Exception e)
            {
                throw new ApplicationException("Errore in DocsPaWS.asmx  - metodo: isDocInADLRole", e);
            }
        }

        /// <summary>
        /// </summary>
        [WebMethod]
        public virtual bool DocumentoExecAddLavoroRole(string idProfile, string tipoProto, DocsPaVO.fascicolazione.Fascicolo fasc, DocsPaVO.utente.InfoUtente infoUtente, string idRegistro)
        {
            SetUserId(infoUtente);
            bool result = true; // Presume successo

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                BusinessLogic.Documenti.areaLavoroManager.execAddLavoroRoleMethod(idProfile, tipoProto, idRegistro, infoUtente, fasc);
#if TRACE_WS
				pt.WriteLogTracer("DocumentoExecAddLavoro");
#endif
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoExecAddLavoro", e);

                result = false;
            }

            return result;
        }

        /// <summary>
        /// controlla se il fascicolo  presente nella todolist del ruolo
        /// </summary>
        /// <param name="idProject"></param>
        /// <param name="idRole"></param>
        /// <returns></returns>
        [WebMethod]
        public int isFascInADLRole(string idProject, string idRole)
        {
            try
            {
                return BusinessLogic.Documenti.DocManager.IsFascInADLRole(idProject, idRole);
            }
            catch (Exception e)
            {
                throw new ApplicationException("Errore in DocsPaWS.asmx  - metodo: isFascInADLRole", e);
            }
        }

        #endregion

        #region fileinformation carta (identit del documento)
        [WebMethod]
        public virtual DocsPaVO.documento.FileInformation getFileInformation(DocsPaVO.documento.FileRequest fileRequest, DocsPaVO.utente.InfoUtente infoUtente)
        {
            return BusinessLogic.Documenti.FileManager.getFileFileInformation(fileRequest, infoUtente);
        }

        [WebMethod]
        public virtual void processFileInformation(DocsPaVO.documento.FileRequest fileRequest, DocsPaVO.utente.InfoUtente infoUtente)
        {
            BusinessLogic.Documenti.FileManager.processFileInformation(fileRequest, infoUtente);
        }

        [WebMethod]
        public virtual void processFileInformationCRL(DocsPaVO.documento.FileRequest fileRequest, DocsPaVO.utente.InfoUtente infoUtente)
        {
            BusinessLogic.Documenti.FileManager.processFileInformationCRL(fileRequest, infoUtente);
        }

        [WebMethod]
        public virtual List<DocsPaVO.documento.FileRequest> GetFileInfosToProcess(int numOfItems)
        {
            return new DocsPaDB.Query_DocsPAWS.Documenti().GetFileInfosToProcess(numOfItems);
        }
        #endregion

        #region stamparegistri

        /// <summary>
        /// WebMethod per prelevare le informazioni sulla configurazione della Stampa Registro
        /// retVal = valoreFrequenzaStampa_valoreDisabled
        /// </summary>
        /// <param name="idAmm"></param>
        /// <returns></returns>
        [WebMethod()]
        public string GetStampaRegistroValues(string idAmm)
        {
            string retval = string.Empty;

            try
            {
                retval = BusinessLogic.Conservazione.AmmConservazioneManager.GetStampaRegistroValues(idAmm);
            }
            catch (Exception e)
            {
                throw new ApplicationException("Errore in DocsPaWS.asmx - metodo: GetStampaRegistroValues", e);
            }

            return retval;

        }

        /// <summary>
        /// Webmethod per recuperare l'informazione sull'ora impostata per la stampa automatica.
        /// </summary>
        /// <param name="idAmm"></param>
        /// <returns></returns>
        [WebMethod()]
        public string GetStampaRegistroOraStampa(string idAmm)
        {
            string retVal = string.Empty;

            try
            {
                retVal = BusinessLogic.Conservazione.AmmConservazioneManager.GetStampaRegistroOraStampa(idAmm);
            }
            catch (Exception e)
            {
                throw new ApplicationException("Errore in DocsPaWS.asmx - metodo: GetStampaRegistroOraStampa", e);
            }

            return retVal;

        }

        /// <summary>
        /// WebMethod per il salvataggio delle informazioni sulla configurazione della Stampa Registro
        /// retVal = true/false
        /// </summary>
        /// <param name="idAmm"></param>
        /// <param name="disabled"></param>
        /// <param name="printFreq"></param>
        /// <returns></returns>
        [WebMethod()]
        public bool SaveStampaRegistroValues(string idAmm, string disabled, string printFreq, string printHour)
        {
            bool retval = false;

            try
            {
                retval = BusinessLogic.Conservazione.AmmConservazioneManager.SaveStampaRegistroValues(idAmm, disabled, printFreq, printHour);
            }
            catch (Exception e)
            {
                throw new ApplicationException("Errore in DocsPaWS.asmx - metodo: SaveStampaRegistroValues", e);
            }

            return retval;

        }

        #endregion

        #region MEV CS 1.5 - Gestione Alert Conservazione

        /// <summary>
        /// Verifica se il log selezionato  attivato o meno per l'amministrazione corrente
        /// </summary>
        /// <param name="idAmm"></param>
        /// <param name="codice"></param>
        /// <returns></returns>
        [WebMethod()]
        public bool IsLogAttivatoAlert(string idAmm, string codice)
        {
            try
            {
                return BusinessLogic.Conservazione.AmmConservazioneManager.IsLogAttivato(idAmm, codice);
            }
            catch (Exception ex)
            {
                throw new ApplicationException("Errore in DocsPaWS.asmx - Metodo: IsLogAttivatoAlert");

            }

        }

        /// <summary>
        /// Metodo per il salvataggio della configurazione degli alert della conservazione.
        /// </summary>
        /// <param name="idAmm"></param>
        /// <param name="param"></param>
        /// <returns></returns>
        [WebMethod()]
        public bool SaveAlertValues(string idAmm, DocsPaVO.amministrazione.AlertConservazione param)
        {
            bool retVal = false;
            try
            {
                retVal = BusinessLogic.Conservazione.AmmConservazioneManager.SaveGestioneAlert(idAmm, param);
            }
            catch (Exception ex)
            {
                retVal = false;
                throw new ApplicationException("Errore in DocsPaWS.asmx - metodo SaveAlertValues ", ex);
            }

            return retVal;
        }

        /// <summary>
        /// Metodo per prelevare le informazioni di configurazione degli alert della conservazione.
        /// </summary>
        /// <param name="idAmm"></param>
        /// <returns></returns>
        [WebMethod()]
        public DocsPaVO.amministrazione.AlertConservazione GetAlertValues(string idAmm)
        {
            DocsPaVO.amministrazione.AlertConservazione alertData = new DocsPaVO.amministrazione.AlertConservazione();
            try
            {
                alertData = BusinessLogic.Conservazione.AmmConservazioneManager.GetGestioneAlert(idAmm);
            }
            catch (Exception ex)
            {
                alertData = null;
                throw new ApplicationException("Errore in DocsPaWS.asmx - metodo GetGestioneAlert ", ex);
            }

            return alertData;
        }

        #endregion

        /// <summary>
        /// 
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <param name="WebMethodName"></param>
        /// <param name="ID_Oggetto"></param>
        /// <param name="Var_desc_Oggetto"></param>
        /// <param name="esitoOperazione"></param>
        /// <returns></returns>
        [WebMethod]
        public void WriteLog(DocsPaVO.utente.InfoUtente infoUtente, string WebMethodName, string ID_Oggetto, string Var_desc_Oggetto, bool esitoOperazione)
        {
            if (infoUtente != null)
            {
                if (esitoOperazione)
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, WebMethodName, ID_Oggetto, Var_desc_Oggetto, DocsPaVO.Logger.CodAzione.Esito.OK);
                else
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, WebMethodName, ID_Oggetto, Var_desc_Oggetto, DocsPaVO.Logger.CodAzione.Esito.KO);
            }
        }

        /// <summary>
        /// Disconnette gli utenti attualmente connessi in DocsPa 3.0 che usano la stessa login
        /// </summary>
        /// 		/// <remarks>
        /// Metodi per l'autenticazione e la disconnessione
        /// </remarks>
        /// <param name="idAmm">
        /// Identificativo univoco dell'amministrazione di appartenenza dell'utente connesso
        /// </param>
        /// <param name="userId">
        /// Identificativo alfabetico dell'utente connesso
        /// </param>
        /// <returns>
        /// Valore booleano: true se il logoff si  concluso correttamente, false se  avvenuto un errore
        /// </returns>
        /// <exception cref=">System.Exception">
        /// Eccezione generica sollevata in caso di qualsiasi errore
        /// </exception>
        [WebMethod(MessageName = "LogoffOtherSessions")]
        public virtual bool LogoffOtherSessions(string userId, string idAmm, string sessionId)
        {
            bool result = true; // Presume successo

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                BusinessLogic.Utenti.Login.logoffOtherSessions(userId, idAmm, sessionId);
#if TRACE_WS
				pt.WriteLogTracer("Logoff");
#endif
                BusinessLogic.UserLog.UserLog.WriteLog(userId, null, null, idAmm, "LOGOFF", null, null, DocsPaVO.Logger.CodAzione.Esito.OK, null);
            }
            catch (Exception e)
            {
                logger.Debug("Errore durante il Logoff.", e);
                result = false;
                BusinessLogic.UserLog.UserLog.WriteLog(userId, null, null, idAmm, null, sessionId, null, DocsPaVO.Logger.CodAzione.Esito.KO, null);
            }

            return result;
        }

        /// <summary>
        /// questo metodo ritorna una schedadocumento, settando la data vista sulle eventuali trasmisisoni del documento, cos facendo
        /// la trasmissione viene tolta dalla todolist
        /// </summary>
        [WebMethod]
        public virtual DocsPaVO.documento.SchedaDocumento GetDocumentListVersions(DocsPaVO.utente.InfoUtente infoutente, string idProfile, string docNumber)
        {
            SetUserId(infoutente);
            DocsPaVO.documento.SchedaDocumento schedaDocumento = null;
            string VarDescOggetto = string.Empty;

            try
            {
                //gestione tracer
#if TRACE_WS
				DocsPaUtils.LogsManagement.PerformaceTracer pt = new DocsPaUtils.LogsManagement.PerformaceTracer("TRACE_WS");
#endif
                schedaDocumento = BusinessLogic.Documenti.DocManager.GetListVersions(infoutente, idProfile, docNumber);
#if TRACE_WS
				pt.WriteLogTracer("DocumentoGetDettaglioDocumento");
#endif

            }
            catch (Exception e)
            {

                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetDocumentListVersions", e);
                schedaDocumento = null;
            }

            return schedaDocumento;
        }


        /// <summary>
        /// 
        /// </summary>
        /// <param name="massSignatureList"></param>
        /// <param name="infoUtente"></param>
        [WebMethod]
        public DocsPaVO.documento.MassSignature[] getMassiveSha256(DocsPaVO.documento.MassSignature[] massSignatureList, DocsPaVO.utente.InfoUtente infoUtente)
        {
            for (int i = 0; i < massSignatureList.Length; i++)
            {
                DocsPaVO.documento.MassSignature massSignature = massSignatureList[i];
                try
                {
                    massSignature = getSha256(massSignature, infoUtente);
                }
                catch (Exception e)
                {
                    logger.ErrorFormat("Errore calcolango lo sha256 massivo {0} {1}", e.Message, e.StackTrace);
                }
            }
            return massSignatureList;
        }
        /// <summary>
        /// 
        /// </summary>
        /// <param name="massSignatureList"></param>
        /// <param name="infoUtente"></param>
        [WebMethod]
        public DocsPaVO.documento.MassSignature[] signDocumentMassive(DocsPaVO.documento.MassSignature[] massSignatureList, DocsPaVO.utente.InfoUtente infoUtente)
        {

            foreach (DocsPaVO.documento.MassSignature massSignature in massSignatureList)
                massSignature.result = signDocument(massSignature, infoUtente).result;

            return massSignatureList;
        }

        /// <summary>
        /// Ricalcola l'hash (impronta) sha 256 per la firma esterna
        /// </summary>
        /// <param name="fileRequest"></param>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public DocsPaVO.documento.MassSignature getSha256(DocsPaVO.documento.MassSignature massSignature, DocsPaVO.utente.InfoUtente infoUtente)
        {
            DocsPaVO.documento.FileDocumento fd = null;

            if (!massSignature.signPades)
            {
                logger.Debug("MassSignature 1");
                fd = BusinessLogic.Documenti.FileManager.getFileFirmato(massSignature.fileRequest, infoUtente, false);
                if (massSignature.cosign)
                {
                    logger.Debug("MassSignature 2");
                    byte[] signatureFile = BusinessLogic.Documenti.DigitalSignature.PKCS_Utils.Pkcs.EmbedFileToPkcs(fd.content, null);
                    massSignature.base64Signature = Convert.ToBase64String(signatureFile);
                    massSignature.base64Sha256 = Convert.ToBase64String(BusinessLogic.Documenti.DigitalSignature.PKCS_Utils.Pkcs.getHashFromSignature(fd.content));
                }
                else
                {
                    logger.Debug("MassSignature 2");
                    massSignature.base64Sha256 = Convert.ToBase64String(BusinessLogic.Documenti.DigitalSignature.PKCS_Utils.Pkcs.getSha256(fd.content));
                }
            }
            else  //pades
            {
                logger.Debug("MassSignature 3");
                fd = BusinessLogic.Documenti.FileManager.getFileFirmato(massSignature.fileRequest, infoUtente, false);
                massSignature.base64Sha256 = Convert.ToBase64String(BusinessLogic.Documenti.DigitalSignature.Pades_Utils.Pades.SignPadesFile(fd.content, null));
            }
            logger.Debug("MassSignature 4");
            return massSignature;
        }

        /// <summary>
        /// firma un documento pkcs (creando un p7m) e memorizzandolo al posto di quello non firmato.
        /// </summary>
        /// <param name="fileRequest"></param>
        /// <param name="infoUtente"></param>
        /// <param name="base64signature"></param>
        /// <returns></returns>
        [WebMethod]
        public DocsPaVO.documento.MassSignature signDocument(DocsPaVO.documento.MassSignature massSignature, DocsPaVO.utente.InfoUtente infoUtente)
        {
            DocsPaVO.documento.FileDocumento fd = BusinessLogic.Documenti.FileManager.getFileFirmato(massSignature.fileRequest, infoUtente, false);
            byte[] content = fd.content;
            if (!massSignature.signPades)
            {


                if (massSignature.cosign)
                    content = BusinessLogic.Documenti.DigitalSignature.PKCS_Utils.Pkcs.extractSignedContent(content);

                byte[] signed = BusinessLogic.Documenti.DigitalSignature.PKCS_Utils.Pkcs.EmbedFileToPkcs(Convert.FromBase64String(massSignature.base64Signature), content);
                massSignature.result = BusinessLogic.Documenti.SignedFileManager.AppendDocumentoFirmato(Convert.ToBase64String(signed), massSignature.cosign, ref massSignature.fileRequest, infoUtente);
            }
            else
            {
                //fd = BusinessLogic.Documenti.FileManager.getFileFirmato(massSignature.fileRequest, infoUtente, false);
                byte[] signed = BusinessLogic.Documenti.DigitalSignature.Pades_Utils.Pades.SignPadesFile(content, Convert.FromBase64String(massSignature.base64Signature));
                massSignature.result = BusinessLogic.Documenti.SignedFileManager.AppendDocumentoFirmatoPades(signed, massSignature.cosign, ref massSignature.fileRequest, infoUtente);

            }

            if (massSignature.result)
            {
                string method = "DOC_SIGNATURE";
                string description = "Il documento  stato firmato digitalmente CADES";

                if (massSignature.signPades)
                {
                    method = "DOC_SIGNATURE_P";
                    description = "Il documento  stato firmato digitalmente PADES";
                }
                // Non viene settato nel FE
                //if (massSignature.fileRequest.inLibroFirma)
                if (BusinessLogic.LibroFirma.LibroFirmaManager.IsDocInLibroFirma(massSignature.fileRequest.docNumber))
                {
                    BusinessLogic.LibroFirma.LibroFirmaManager.AggiornaDataEsecuzioneElemento(massSignature.fileRequest.docNumber, DocsPaVO.LibroFirma.TipoStatoElemento.FIRMATO.ToString());
                    BusinessLogic.LibroFirma.LibroFirmaManager.SalvaStoricoIstanzaProcessoFirmaByDocnumber(massSignature.fileRequest.docNumber, description, infoUtente);
                }

                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente.userId, infoUtente.idPeople, infoUtente.idGruppo, infoUtente.idAmministrazione, method, massSignature.fileRequest.docNumber,
                    description, DocsPaVO.Logger.CodAzione.Esito.OK, (infoUtente != null && infoUtente.delegato != null ? infoUtente.delegato : null), "0");
            }
            else
            {
                if (massSignature.fileRequest.inLibroFirma)
                {
                    BusinessLogic.LibroFirma.LibroFirmaManager.AggiornaErroreEsitoFirma(massSignature.fileRequest.docNumber, "Errore durante la procedura di firma");
                }
            }

            return massSignature;
        }
        #region HSM Signature

        [WebMethod]
        public bool HSM_SetMementoForUser(InfoUtente infoUtente, String dominio, String alias)
        {
            return BusinessLogic.Utenti.UserManager.setMementoUtente(infoUtente, dominio, alias);
        }

        [WebMethod]
        public string[] HSM_GetMementoForUser(InfoUtente infoUtente)
        {
            return BusinessLogic.Utenti.UserManager.getMementoUtente(infoUtente);
        }

        [WebMethod]
        public string HSM_RequestCertificateJson(String AliasCertificato, String DominioCertificato)
        {
            return BusinessLogic.Documenti.FileManager.HSM_RequestCertificateJson(AliasCertificato, DominioCertificato);
        }

        [WebMethod]
        public bool HSM_RequestOTP(String AliasCertificato, String DominioCertificato)
        {
            return BusinessLogic.Documenti.FileManager.HSM_RequestOTP(AliasCertificato, DominioCertificato);
        }

        [WebMethod]
        public bool HSM_Sign(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.documento.FileRequest fr, bool cofirma, bool timestamp, String TipoFirma, String AliasCertificato, String DominioCertificato, String OtpFirma, String PinCertificato, bool ConvertPdf)
        {
            bool retValue = BusinessLogic.Documenti.FileManager.HSM_Sign(infoUtente, fr, cofirma, timestamp, TipoFirma, AliasCertificato, DominioCertificato, OtpFirma, PinCertificato, ConvertPdf);
            fr.inLibroFirma = BusinessLogic.LibroFirma.LibroFirmaManager.IsDocInLibroFirma(fr.docNumber);
            //Emanuela 03/02/2014 MEV FONDIMPRESA: se la firma al documento  andata a buon fine, occorre prevedere
            //l'invio  della notifica informativa
            if (retValue)
            {
                string method = "DOC_SIGNATURE";
                string description = "Il documento  stato firmato digitalmente HSM CADES";
                if (TipoFirma.ToString() == "PADES")
                {
                    method = "DOC_SIGNATURE_P";
                    description = "Il documento  stato firmato digitalmente HSM PADES";
                }
                if (fr.inLibroFirma)
                {
                    BusinessLogic.LibroFirma.LibroFirmaManager.AggiornaDataEsecuzioneElemento(fr.docNumber, DocsPaVO.LibroFirma.TipoStatoElemento.FIRMATO.ToString());
                    BusinessLogic.LibroFirma.LibroFirmaManager.SalvaStoricoIstanzaProcessoFirmaByDocnumber(fr.docNumber, description, infoUtente);
                }

                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente.userId, infoUtente.idPeople, infoUtente.idGruppo, infoUtente.idAmministrazione, method, fr.docNumber,
                    description, DocsPaVO.Logger.CodAzione.Esito.OK, (infoUtente != null && infoUtente.delegato != null ? infoUtente.delegato : null), "0");
            }
            else
            {
                if (fr.inLibroFirma)
                {
                    BusinessLogic.LibroFirma.LibroFirmaManager.AggiornaErroreEsitoFirma(fr.docNumber, "Errore durante la procedura di firma");
                }
            }

            return retValue;
        }

        [WebMethod]
        public bool HSM_SignConEsito(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.documento.FileRequest fr, bool cofirma, bool timestamp, String TipoFirma, String AliasCertificato, String DominioCertificato, String OtpFirma, String PinCertificato, bool ConvertPdf, out DocsPaVO.documento.FirmaResult firmaResult)
        {
            firmaResult = new DocsPaVO.documento.FirmaResult();
            bool retValue = BusinessLogic.Documenti.FileManager.HSM_Sign(infoUtente, fr, cofirma, timestamp, TipoFirma, AliasCertificato, DominioCertificato, OtpFirma, PinCertificato, ConvertPdf, out firmaResult);
            fr.inLibroFirma = BusinessLogic.LibroFirma.LibroFirmaManager.IsDocInLibroFirma(fr.docNumber);
            //Emanuela 03/02/2014 MEV FONDIMPRESA: se la firma al documento  andata a buon fine, occorre prevedere
            //l'invio  della notifica informativa
            if (retValue)
            {
                string method = "DOC_SIGNATURE";
                string description = "Il documento  stato firmato digitalmente HSM CADES";
                if (TipoFirma.ToString() == "PADES")
                {
                    method = "DOC_SIGNATURE_P";
                    description = "Il documento  stato firmato digitalmente HSM PADES";
                }
                if (fr.inLibroFirma)
                {
                    BusinessLogic.LibroFirma.LibroFirmaManager.AggiornaDataEsecuzioneElemento(fr.docNumber, DocsPaVO.LibroFirma.TipoStatoElemento.FIRMATO.ToString());
                    BusinessLogic.LibroFirma.LibroFirmaManager.SalvaStoricoIstanzaProcessoFirmaByDocnumber(fr.docNumber, description, infoUtente);
                }

                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente.userId, infoUtente.idPeople, infoUtente.idGruppo, infoUtente.idAmministrazione, method, fr.docNumber,
                    description, DocsPaVO.Logger.CodAzione.Esito.OK, (infoUtente != null && infoUtente.delegato != null ? infoUtente.delegato : null), "0");
            }
            else
            {
                if (fr.inLibroFirma)
                {
                    BusinessLogic.LibroFirma.LibroFirmaManager.AggiornaErroreEsitoFirma(fr.docNumber, "Errore durante la procedura di firma");
                }
            }

            return retValue;
        }

        [WebMethod]
        public string HSM_OpenMultiSignSession(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.documento.FileRequest[] fileRequestList, bool cofirma, bool timestamp, string TipoFirma)
        {
            return BusinessLogic.Documenti.FileManager.HSM_OpenMultiSignSession(infoUtente, fileRequestList, cofirma, timestamp, TipoFirma);
        }

        [WebMethod]
        public DocsPaVO.documento.FirmaResult[] HSM_SignMultiSignSession(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.documento.FileRequest[] fileRequestList, string MultiSignToken, String AliasCertificato, String DominioCertificato, String OtpFirma, String PinCertificato, bool cofirma)
        {
            return BusinessLogic.Documenti.FileManager.HSM_SignMultiSignSession(infoUtente, fileRequestList, MultiSignToken, AliasCertificato, DominioCertificato, OtpFirma, PinCertificato, cofirma);
        }

        /// <summary>
        /// Firma il file byte[] content, se la firma ha esito positivo 
        /// </summary>
        /// <param name="idInstanza"></param>
        /// <param name="infoUtente"></param>
        /// <param name="content"></param>
        /// <param name="cofirma"></param>
        /// <param name="timestamp"></param>
        /// <param name="TipoFirma"></param>
        /// <param name="AliasCertificato"></param>
        /// <param name="DominioCertificato"></param>
        /// <param name="OtpFirma"></param>
        /// <param name="PinCertificato"></param>
        /// <param name="ConvertPdf"></param>
        /// <returns>Firmato true/false</returns>
        [WebMethod]
        public bool HSM_SignContent(String idInstanza, DocsPaVO.utente.InfoUtente infoUtente, byte[] content, bool cofirma, bool timestamp, String TipoFirma, String AliasCertificato, String DominioCertificato, String OtpFirma, String PinCertificato, bool ConvertPdf)
        {
            string strBase64Signed = "";
            bool retValue = false;

            byte[] byteBase64Signed = BusinessLogic.Documenti.FileManager.HSM_SignContent(infoUtente, content, cofirma, timestamp, TipoFirma, AliasCertificato, DominioCertificato, OtpFirma, PinCertificato, ConvertPdf);

            if (byteBase64Signed != null)
            {
                retValue = true;

                FileManager fm = new FileManager();

                strBase64Signed = Convert.ToBase64String(byteBase64Signed);

                retValue = fm.uploadSignXml(idInstanza, byteBase64Signed, strBase64Signed, "", infoUtente);

                if (retValue)
                {
                    writeAppLog(infoUtente, idInstanza, "HSM_SignContent", "Generazione file firmato OK per l'istanza :" + idInstanza, true);

                    // Modifica Registro di Conservazione per la Firma Istanza
                    DocsPaVO.Conservazione.RegistroCons regCons = new DocsPaVO.Conservazione.RegistroCons();
                    regCons.idAmm = infoUtente.idAmministrazione;
                    regCons.idIstanza = idInstanza;
                    regCons.tipoOggetto = "I";
                    regCons.tipoAzione = "";
                    regCons.userId = infoUtente.userId;
                    regCons.codAzione = "HSM_SignContent";
                    regCons.descAzione = "Generazione file firmato OK per l'istanza: " + idInstanza;
                    regCons.esito = "1";
                    RegistroConservazione rc = new RegistroConservazione();
                    rc.inserimentoInRegistroCons(regCons, infoUtente);

                    // Istanza di conservazione in stato firmata, inizio del task dei verifica integrit del supporto remoto per il passaggio allo stato "Conservata"
                    // 26_10_2012 questa qui la spostiamo dopo la verifica di leggibilit.
                    // this.IniziaVerificaSupportoRemoto(utente, systemID);

                    DocsPaConsManager.UpdateStatoIstanzaConservazione(idInstanza, DocsPaConservazione.StatoIstanza.FIRMATA);
                }
                else
                {
                    writeAppLog(infoUtente, idInstanza, "HSM_SignContent", "Errore durante la generazione file firmato per l'istanza :" + idInstanza, false);

                    //Modifica per Registro in Conservazione Passaggio a stato "FIRMATA"
                    DocsPaVO.Conservazione.RegistroCons regCons2 = new DocsPaVO.Conservazione.RegistroCons();
                    regCons2.idAmm = infoUtente.idAmministrazione;
                    regCons2.idIstanza = idInstanza;
                    regCons2.tipoOggetto = "I";
                    regCons2.tipoAzione = "";
                    regCons2.userId = infoUtente.userId;
                    regCons2.codAzione = "HSM_SignContent";
                    regCons2.descAzione = "Generazione file firmato KO per l'istanza: " + idInstanza;
                    regCons2.esito = "0";
                    RegistroConservazione rc2 = new RegistroConservazione();
                    rc2.inserimentoInRegistroCons(regCons2, infoUtente);
                }
            }
            else
            {
                writeAppLog(infoUtente, idInstanza, "HSM_SignContent", "Errore file non firmato per l'istanza :" + idInstanza, false);
            }

            return retValue;
        }

        #endregion
        #region RemotePdfStamping

        [WebMethod]
        public bool RemotePdfStamp(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.documento.FileRequest fr, String StampText)
        {
            bool retValue = BusinessLogic.Documenti.FileManager.RemotePdfStamp(infoUtente, fr, StampText);
            return retValue;
        }

        [WebMethod]
        public bool RemotePdfStampWithParameters(DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.documento.FileRequest fr, int Page, int LeftX, int LeftY, int RightX, int RightY, String StampText)
        {
            bool retValue = BusinessLogic.Documenti.FileManager.RemotePdfStamp(infoUtente, fr, Page, LeftX, LeftY, RightX, RightY, StampText);
            return retValue;
        }

        #endregion

        #region Instance Access

        /// <summary>
        /// Restituisce la lista di tutte le istanze d'accesso
        /// </summary>
        /// <param name="idPeople"></param>
        /// <param name="idGroup"></param>
        /// <returns></returns>
        [WebMethod]
        public DocsPaVO.InstanceAccess.InstanceAccess[] GetInstanceAccess(string idPeople, string idGroup, DocsPaVO.utente.InfoUtente infoUtente)
        {
            List<DocsPaVO.InstanceAccess.InstanceAccess> listInstanceAccess = new List<DocsPaVO.InstanceAccess.InstanceAccess>();
            try
            {
                listInstanceAccess = BusinessLogic.InstanceAccess.InstanceAccessManager.GetInstanceAccess(idPeople, idGroup, infoUtente);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetInstanceAccess", e);
            }
            return listInstanceAccess.ToArray();
        }

        /// <summary>
        /// Ritorna l'istanza di accesso avente l'id specificato
        /// </summary>
        /// <param name="idInstanceAccess"></param>
        /// <param name="idAmm"></param>
        /// <returns></returns>
        [WebMethod]
        public DocsPaVO.InstanceAccess.InstanceAccess GetInstanceAccessById(string idInstanceAccess, DocsPaVO.utente.InfoUtente infoUtente)
        {
            DocsPaVO.InstanceAccess.InstanceAccess instanceAccess = null;
            try
            {
                instanceAccess = BusinessLogic.InstanceAccess.InstanceAccessManager.GetInstanceAccessById(idInstanceAccess, infoUtente);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetInstanceAccessById", e);
            }
            return instanceAccess;
        }


        /// <summary>
        /// Inserisce una nuova istanza d'accesso
        /// </summary>
        /// <param name="instanceAccess"></param>
        /// <returns></returns>
        [WebMethod]
        public DocsPaVO.InstanceAccess.InstanceAccess InsertInstanceAccess(DocsPaVO.InstanceAccess.InstanceAccess instanceAccess, DocsPaVO.utente.InfoUtente infoUtente)
        {
            DocsPaVO.InstanceAccess.InstanceAccess instance = null;
            try
            {
                instance = BusinessLogic.InstanceAccess.InstanceAccessManager.InsertInstanceAccess(instanceAccess, infoUtente);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: InsertInstanceAccess", e);
            }
            return instance;
        }

        /// <summary>
        /// Inserisce la lista di documenti relativi ad un'istanza d'accesso
        /// </summary>
        /// <param name="listInstanceAccessDocuments"></param>
        /// <returns></returns>
        [WebMethod]
        public bool InsertInstanceAccessDocuments(DocsPaVO.InstanceAccess.InstanceAccessDocument[] listInstanceAccessDocuments, DocsPaVO.utente.InfoUtente infoUtente)
        {
            bool result = false;
            try
            {
                result = BusinessLogic.InstanceAccess.InstanceAccessManager.InsertInstanceAccessDocuments(new List<DocsPaVO.InstanceAccess.InstanceAccessDocument>(listInstanceAccessDocuments), infoUtente);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: InsertInstanceAccessDocuments", e);
            }
            return result;
        }

        /// <summary>
        /// Aggiorna il tipo di richiesta per i documenti in input
        /// </summary>
        /// <param name="listInstanceAccessDocuments"></param>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public bool UpdateInstanceAccessDocuments(DocsPaVO.InstanceAccess.InstanceAccessDocument[] listInstanceAccessDocuments, DocsPaVO.utente.InfoUtente infoUtente)
        {
            bool result = false;
            try
            {
                result = BusinessLogic.InstanceAccess.InstanceAccessManager.UpdateInstanceAccessDocuments(new List<DocsPaVO.InstanceAccess.InstanceAccessDocument>(listInstanceAccessDocuments), infoUtente);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: InsertInstanceAccessDocuments", e);
            }
            return result;
        }

        /// <summary>
        /// Inserisce la lista degli allegati di un documento appartenente ad un'istanza d'accesso
        /// </summary>
        /// <param name="listInstanceAccessAttachments"></param>
        /// <returns></returns>
        [WebMethod]
        public bool InsertInstanceAccessAttachments(DocsPaVO.InstanceAccess.InstanceAccessAttachments[] listInstanceAccessAttachments, DocsPaVO.utente.InfoUtente infoUtente)
        {
            bool result = false;
            try
            {
                result = BusinessLogic.InstanceAccess.InstanceAccessManager.InsertInstanceAccessAttachments(new List<DocsPaVO.InstanceAccess.InstanceAccessAttachments>(listInstanceAccessAttachments), infoUtente);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: InsertInstanceAccessAttachments", e);
            }
            return result;
        }

        /// <summary>
        /// Rimuove la lista di documenti legati ad un'istanza di accesso
        /// </summary>
        /// <param name="listInstanceAccessDocuments"></param>
        /// <returns></returns>
        [WebMethod]
        public bool RemoveInstanceAccessDocuments(DocsPaVO.InstanceAccess.InstanceAccessDocument[] listInstanceAccessDocuments, DocsPaVO.utente.InfoUtente infoUtente)
        {
            bool result = false;
            try
            {
                result = BusinessLogic.InstanceAccess.InstanceAccessManager.RemoveInstanceAccessDocuments(new List<DocsPaVO.InstanceAccess.InstanceAccessDocument>(listInstanceAccessDocuments), infoUtente);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: RemoveInstanceAccessDocuments", e);
            }
            return result;
        }

        /// <summary>
        /// Rimuove la lista di allegati di un documento appartenente ad un'istanza di accesso
        /// </summary>
        /// <param name="listInstanceAccessAttachments"></param>
        /// <returns></returns>
        [WebMethod]
        public bool RemoveInstanceAccessAttachments(DocsPaVO.InstanceAccess.InstanceAccessAttachments[] listInstanceAccessAttachments, DocsPaVO.utente.InfoUtente infoUtente)
        {
            bool result = false;
            try
            {
                result = BusinessLogic.InstanceAccess.InstanceAccessManager.RemoveInstanceAccessAttachments(new List<DocsPaVO.InstanceAccess.InstanceAccessAttachments>(listInstanceAccessAttachments), infoUtente);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: RemoveInstanceAccessAttachments", e);
            }
            return result;
        }

        /// <summary>
        /// Crea il documento di dichiarazione di conformit per l'istanza di accesso
        /// </summary>
        /// <param name="instance"></param>
        /// <param name="infoUser"></param>
        /// <param name="role"></param>
        /// <returns></returns>
        [WebMethod]
        public InstanceAccess CreateDeclarationDocument(InstanceAccess instance, InfoUtente infoUser, Ruolo role)
        {
            DocsPaVO.InstanceAccess.InstanceAccess instanceAccess = null;
            try
            {
                instanceAccess = BusinessLogic.InstanceAccess.InstanceAccessManager.CreateDeclarationDocument(instance, infoUser, role);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: CreateDeclarationDocument", e);
            }
            return instanceAccess;

        }

        /// <summary>
        /// Aggiorna l'istanza d'accesso
        /// </summary>
        /// <param name="instanceAccess"></param>
        /// <returns></returns>
        [WebMethod]
        public DocsPaVO.InstanceAccess.InstanceAccess UpdateInstanceAccess(DocsPaVO.InstanceAccess.InstanceAccess instanceAccess, InfoUtente infoUtente)
        {
            DocsPaVO.InstanceAccess.InstanceAccess instance = null;
            try
            {
                instance = BusinessLogic.InstanceAccess.InstanceAccessManager.UpdateInstanceAccess(instanceAccess, infoUtente);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: UpdateInstanceAccess", e);
            }
            return instance;
        }

        /// <summary>
        /// Ritorna lo stato del download dell'istanza
        /// </summary>
        /// <param name="idInstanceAccess"></param>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public string GetStateDownloadInstanceAccess(string idInstanceAccess, DocsPaVO.utente.InfoUtente infoUtente)
        {
            string stateDownload = string.Empty;
            try
            {
                stateDownload = BusinessLogic.InstanceAccess.InstanceAccessManager.GetStateDownloadInstanceAccess(idInstanceAccess, infoUtente);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetStateDownloadInstanceAccess", e);
            }
            return stateDownload;
        }

        /// <summary>
        /// Preparazione del download dell'istanza di acesso
        /// </summary>
        [WebMethod]
        public void AsyncCreateDownload(InstanceAccess instanceAccess, DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.utente.Ruolo ruolo)
        {
            SetUserId(infoUtente);
            try
            {
                if (instanceAccess != null)
                {
                    asyncDelegateInstanceAccess mDelegate = new asyncDelegateInstanceAccess(CreateDownloadInstanceAccess);
                    IAsyncResult result = mDelegate.BeginInvoke(instanceAccess, infoUtente, ruolo, new AsyncCallback(asyncImport), null);
                }

            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AsyncPreparesDownload", e);
            }
        }

        /// <summary>
        /// Rimuove il file ZIP contenente il download dell'istanza
        /// </summary>
        [WebMethod]
        public void RemoveInstanceZip(InstanceAccess instanceAccess, DocsPaVO.utente.InfoUtente infoUtente)
        {
            try
            {
                BusinessLogic.InstanceAccess.InstanceAccessManager.RemoveInstanceZip(instanceAccess, infoUtente);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: RemoveInstanceZip", e);
            }
        }

        /// <summary>
        /// Ritorna il template associato alla dichiarazione di conformit
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public DocsPaVO.ProfilazioneDinamica.Templates GetTemplateInstanceAccess(DocsPaVO.utente.InfoUtente infoUtente)
        {
            DocsPaVO.ProfilazioneDinamica.Templates template = null;
            try
            {
                template = BusinessLogic.InstanceAccess.InstanceAccessManager.GetTemplate(infoUtente);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetTemplate", e);
            }
            return template;
        }


        private bool CreateDownloadInstanceAccess(InstanceAccess instanceAccess, DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.utente.Ruolo ruolo)
        {
            bool result = false;
            string idProfile = string.Empty;
            try
            {
                idProfile = BusinessLogic.InstanceAccess.InstanceAccessManager.GetIdProfileDownload(instanceAccess.ID_INSTANCE_ACCESS, infoUtente);
                if (string.IsNullOrEmpty(idProfile) || idProfile.Equals("0"))
                {
                    DocsPaVO.documento.SchedaDocumento newDoc = BusinessLogic.Documenti.DocManager.NewSchedaDocumento(infoUtente);
                    newDoc.tipoProto = "G";
                    newDoc.oggetto = new DocsPaVO.documento.Oggetto() { descrizione = "Preparazione download istanza ID: " + instanceAccess.ID_INSTANCE_ACCESS };
                    newDoc = BusinessLogic.Documenti.DocSave.addDocGrigia(newDoc, infoUtente, ruolo);
                    idProfile = newDoc.systemId;
                    BusinessLogic.InstanceAccess.InstanceAccessManager.UpdateIdProfileDownload(idProfile, instanceAccess.ID_INSTANCE_ACCESS, infoUtente);
                }
                result = BusinessLogic.InstanceAccess.InstanceAccessManager.CreateDownloadInstanceAccess(instanceAccess, infoUtente);
                if (result)
                {
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente.userId, infoUtente.idPeople, infoUtente.idGruppo, infoUtente.idAmministrazione, "CREATED_FILE_ZIP_INSTANCE_ACCESS",
                        idProfile, "Creato lo zip per l'istanza di accesso con ID: " + instanceAccess.ID_INSTANCE_ACCESS + ". Per effettuare il download accedere all'istanza dal Menu Gestione"
                        , DocsPaVO.Logger.CodAzione.Esito.OK, null, "1");
                }
                else
                {
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente.userId, infoUtente.idPeople, infoUtente.idGruppo, infoUtente.idAmministrazione, "FAILED_CREATING_FILE_ZIP_INSTANCE_ACCESS",
                       idProfile, "Errore durante la procedura di creazione dello zip per l'istanza di accesso con ID: " + instanceAccess.ID_INSTANCE_ACCESS, DocsPaVO.Logger.CodAzione.Esito.KO, null, "1");

                }
            }
            catch (Exception e)
            {
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente.userId, infoUtente.idPeople, infoUtente.idGruppo, infoUtente.idAmministrazione, "FAILED_CREATING_FILE_ZIP_INSTANCE_ACCESS",
                       idProfile, "Errore durante la procedura di creazione dello zip per l'istanza di accesso con ID: " + instanceAccess.ID_INSTANCE_ACCESS, DocsPaVO.Logger.CodAzione.Esito.KO, null, "1");

                logger.Debug("Errore in DocsPaWS.asmx  - metodo: CreateDownloadInstanceAccess", e);
            }
            return result;
        }

        private delegate bool asyncDelegateInstanceAccess(InstanceAccess instanceAccess, DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.utente.Ruolo ruolo);

        [WebMethod]
        public bool UpdateIsTypeInstance(DocsPaVO.ProfilazioneDinamica.Templates template, string idAmministrazione)
        {
            bool result = false;
            try
            {
                result = BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.UpdateIsTypeInstance(template, idAmministrazione);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: UpdateIsTypeInstance", e);
            }
            return result;
        }

        /// <summary>
        /// Aggiorna lo stato ENABLE dei documenti in input
        /// </summary>
        /// <param name="listInstanceAccessDocument"></param>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public bool UpdateInstanceAccessDocumentEnable(List<InstanceAccessDocument> listInstanceAccessDocument, DocsPaVO.utente.InfoUtente infoUtente)
        {
            bool result = false;
            try
            {
                result = BusinessLogic.InstanceAccess.InstanceAccessManager.UpdateInstanceAccessDocumentEnable(listInstanceAccessDocument, infoUtente);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: UpdateInstanceAccessDocumentEnable", e);
            }
            return result;
        }

        /// <summary>
        /// Aggiorna lo stato ENABLE degli allegati in input
        /// </summary>
        /// <param name="listInstanceAccessAttachments"></param>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public bool UpdateInstanceAccessAttachmentsEnable(List<InstanceAccessAttachments> listInstanceAccessAttachments, DocsPaVO.utente.InfoUtente infoUtente)
        {
            bool result = false;
            try
            {
                result = BusinessLogic.InstanceAccess.InstanceAccessManager.UpdateInstanceAccessAttachmentsEnable(listInstanceAccessAttachments, infoUtente);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: UpdateInstanceAccessAttachmentsEnable ", e);
            }
            return result;
        }

        /// <summary>
        /// Crea un predisposto contenente come allegati tutti i documenti dell'istanza di accesso
        /// </summary>
        /// <param name="instance"></param>
        /// <param name="totalFileSizeInstance"></param>
        /// <param name="infoUtente"></param>
        /// <param name="ruolo"></param>
        /// <returns></returns>
        [WebMethod]
        public DocsPaVO.documento.SchedaDocumento ForwardsInstanceAccess(DocsPaVO.InstanceAccess.InstanceAccess instance, DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.utente.Ruolo ruolo, out int totalFileSizeInstance)
        {
            DocsPaVO.documento.SchedaDocumento documento = null;
            totalFileSizeInstance = 0;
            try
            {
                documento = BusinessLogic.InstanceAccess.InstanceAccessManager.ForwardsInstanceAccess(instance, out totalFileSizeInstance, infoUtente, ruolo);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: ForwardsInstanceAccess ", e);
            }
            return documento;
        }

        #endregion

        //[WebMethod]
        //public virtual OrgRegistro AmmGetRFPreferitoRuolo(string idAmm, string idRuolo)
        //{
        //    OrgRegistro retValue = new OrgRegistro();

        //    try
        //    {
        //        retValue = BusinessLogic.Amministrazione.OrganigrammaManager.AmmGetRFPreferitoRuolo(idAmm, idRuolo);
        //    }
        //    catch (Exception e)
        //    {
        //        logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmGetRFPreferitoRuolo - ", e);

        //    }

        //    return retValue;
        //}

        //[WebMethod]
        //public virtual bool AmmSetRFPreferitoRuolo(string idRuolo, string idRF)
        //{
        //    bool retValue = false;

        //    try
        //    {
        //        retValue = BusinessLogic.Amministrazione.OrganigrammaManager.AmmSetRFPreferitoRuolo(idRuolo, idRF);
        //    }
        //    catch (Exception e)
        //    {
        //        logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmSetRFPreferitoRuolo - ", e);

        //    }

        //    return retValue;
        //}

        #region Autenticazione Sistemi Esterni

        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.amministrazione.SistemaEsterno))]
        public virtual ArrayList AmmGetSistemiEsterni(string idAmm)
        {
            return BusinessLogic.Amministrazione.SistemiEsterni.getSistemiEsterni(idAmm);
        }

        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.amministrazione.MetodoPIS))]
        public virtual ArrayList AmmGetPISMethods()
        {
            return BusinessLogic.Amministrazione.SistemiEsterni.getPISMethods();
        }

        [WebMethod]
        public virtual bool AmmModAllowedPISforExtSys(string methods, string idSysExt)
        {
            return BusinessLogic.Amministrazione.SistemiEsterni.ModificaMetodiPermessiSistemaEsterno(methods, idSysExt);
        }

        [WebMethod]
        public virtual bool AmmModDescTknTimeForExtSys(string desc, string tknTime, string idSysExt)
        {
            return BusinessLogic.Amministrazione.SistemiEsterni.ModificaDescTokenSistemaEsterno(desc, tknTime, idSysExt);
        }

        [WebMethod]
        public virtual DocsPaVO.utente.TipoRuolo AmmGetTipoRuoloByCode(string idAmm, string codice)
        {
            return BusinessLogic.Amministrazione.SistemiEsterni.getTipoRuoloByCode(idAmm, codice);
        }

        [WebMethod]
        public virtual bool AmmInsSysExtAfterAssoc(InfoUtente infut, string idAmm, string codUtente, string codRuolo, string descrizione)
        {
            return BusinessLogic.Amministrazione.SistemiEsterni.InsSysExtAfterAssoc(infut, idAmm, codUtente, codRuolo, descrizione);
        }

        [WebMethod]
        public virtual DocsPaVO.utente.UnitaOrganizzativa GetHubSistemiEsterni(string codice, string idAmm)
        {
            return BusinessLogic.Amministrazione.SistemiEsterni.getHubSistemaEsterno(codice, idAmm);
        }

        [WebMethod]
        public virtual string ctrlInserimentoSistemaEsterno(string idAmm, string codUtente, string codRuolo)
        {
            return BusinessLogic.Amministrazione.SistemiEsterni.ctrlInserimentoSistemaEsterno(idAmm, codUtente, codRuolo);
        }

        [WebMethod]
        public virtual bool setVisibilityHubSysExt(string idHub)
        {
            return BusinessLogic.Amministrazione.SistemiEsterni.setVisibilityHubSysExt(idHub);
        }

        [WebMethod]
        public virtual DocsPaVO.amministrazione.SistemaEsterno getSistemaEsternoByCodeApp(string idAmm, string codeApp)
        {
            return BusinessLogic.Amministrazione.SistemiEsterni.getSistemaEsterno(idAmm, codeApp);
        }

        [WebMethod]
        public virtual bool AcquireRightsFromExtSys(string idObject, string idRuolo, string idUtente, string idSE, string idUSE)
        {
            return BusinessLogic.Amministrazione.SistemiEsterni.cessioneProprieta(idObject, idRuolo, idUtente, idSE, idUSE);
        }

        [WebMethod]
        public virtual bool DeleteExternalSystem(DocsPaVO.amministrazione.SistemaEsterno ExtSys, InfoUtente infout)
        {
            return BusinessLogic.Amministrazione.SistemiEsterni.deleteExtSys(ExtSys, infout);
        }
        #endregion

        #region CS 1.5 - Requisito F03_01
        /// <summary>
        /// Metodo che recupera la dimensione massima delle istanze per l'amministrazione in termini di MB Ammessi
        /// </summary>
        /// <param name="idAmm"></param>
        /// <returns></returns>
        [WebMethod]
        //public virtual int getDimensioneMassimaIstanze_MB(string idAmm)
        public virtual int getDimensioneMassimaIstanze_Byte(string idAmm)
        {
            int result = 0;
            try
            {
                //result = BusinessLogic.Documenti.areaConservazioneManager.getDimensioneMassimaIstanze_MB(idAmm);
                result = BusinessLogic.Documenti.areaConservazioneManager.getDimensioneMassimaIstanze_Byte(idAmm);
            }
            catch (Exception e)
            {
                //logger.Debug("Errore in DocsPaWS.asmx  - metodo: getDimensioneMassimaIstanze_MB", e);
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getDimensioneMassimaIstanze_Byte", e);
                result = 0;
            }
            return result;
        }

        /// <summary>
        /// Metodo che recupera la dimensione massima delle istanze per l'amministrazione in termini di Numero di Documenti Ammessi
        /// </summary>
        /// <param name="idAmm"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual int getDimensioneMassimaIstanze_NumDoc(string idAmm)
        {
            int result = 0;
            try
            {
                result = BusinessLogic.Documenti.areaConservazioneManager.getDimensioneMassimaIstanze_NumDoc(idAmm);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getDimensioneMassimaIstanze_NumDoc", e);
                result = 0;
            }
            return result;
        }

        /// <summary>
        /// Metodo per reperire la percentuale di tolleranza sulla dimensione delle istanze da inviare in conservazione
        /// il suo valore di ritorno pu essere utilizzato come parametro di input per il webMethod isVincoloDimensioneIstanzaViolato
        /// </summary>
        /// <param name="idAmm"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual int getPercentualeTolleranzaDinesioneIstanze(string idAmm)
        {
            int result = 0;
            try
            {
                result = BusinessLogic.Documenti.areaConservazioneManager.getPercentualeTolleranzaDinesioneIstanze(idAmm);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getPercentualeTolleranzaDinesioneIstanze", e);
                result = 0;
            }
            return result;
        }

        /// <summary>
        /// Indica se il vincolo sul numero di documenti ammessi per l'istanza che si vuole costriure viene violato
        /// </summary>
        /// <param name="numDocInIstanza">Numero corrente di documenti che si vogliono inserire nell'istanza di conservazione</param>
        /// <param name="vincoloNumDocInStanza">Numero di documenti massimi consentiti in un'istanza di conservazione</param>
        /// <returns></returns>
        [WebMethod]
        public virtual bool isVincoloNumeroDocumentiIstanzaViolato(int numDocInIstanza, int vincoloNumDocInStanza)
        {
            bool result = false;
            try
            {
                result = BusinessLogic.Documenti.areaConservazioneManager.isVincoloNumeroDocumentiIstanzaViolato(numDocInIstanza, vincoloNumDocInStanza);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: isVincoloNumeroDocumentiIstanzaViolato", e);
                result = false;
            }
            return result;
        }

        /// <summary>
        /// Indica se il vincolo sulla dimensione massima dell'istanza di termini di MB ammessa per l'istanza che si vuole costriure viene violato
        /// </summary>
        /// <param name="DimensioneInIstanza">Dimensione (MB) corrente dei documenti che si vogliono inserire nell'istanza di conservazione</param>
        /// <param name="vincoloDimensioneInIStanza">Dimensione massima (MB) consentita in un'istanza di conservazione</param>
        /// <param name="percentualeTolleranza">percentuale di tolleranza per invio in istanza di conservazione</param>
        /// <returns></returns>
        [WebMethod]
        public virtual bool isVincoloDimensioneIstanzaViolato(int DimensioneInIstanza, int vincoloDimensioneInIStanza, int percentualeTolleranza)
        {
            bool result = false;
            try
            {
                result = BusinessLogic.Documenti.areaConservazioneManager.isVincoloDimensioneIstanzaViolato(DimensioneInIstanza, vincoloDimensioneInIStanza, percentualeTolleranza);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: isVincoloDimensioneIstanzaViolato", e);
                result = false;
            }
            return result;
        }


        /// <summary>
        /// webMethod per l'inserimento di documenti in Area conservazione con il controllo dei vincoli della dimensione istanze violato
        /// </summary>
        /// <param name="idProfile"></param>
        /// <param name="idProject"></param>
        /// <param name="docNumber"></param>
        /// <param name="infoUtente"></param>
        /// <param name="tipoOggetto"></param>
        /// <param name="numDocIstanzaViolato">indica se il vincolo sul numero dei documenti  stato violato</param>
        /// <param name="dimIstanzaViolato">indica se il vincolo sulla dimensione dell'istanza  stato violato</param>
        /// <returns></returns>
        [WebMethod]
        public virtual string DocumentoExecAddConservazione_WithConstraints(string idProfile, string idProject, string docNumber, DocsPaVO.utente.InfoUtente infoUtente, string tipoOggetto, bool numDocIstanzaViolato, bool dimIstanzaViolato, int vincoloDimIstanza, int vincoloNumDocIstanza, int sizeItem)
        {
            SetUserId(infoUtente);
            string result = String.Empty;
            try
            {
                result = BusinessLogic.Documenti.areaConservazioneManager.CreateAndAddDocInAreaConservazione_WithConstraint(infoUtente, idProfile, idProject, docNumber, tipoOggetto, string.Empty, numDocIstanzaViolato, dimIstanzaViolato, vincoloDimIstanza, vincoloNumDocIstanza, sizeItem);
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOCONSERVAZIONE", idProfile, string.Format("{0}{1}", "Invio in conservazione del doc: ", idProfile), DocsPaVO.Logger.CodAzione.Esito.OK);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoExecAddConservazione_WithConstraints", e);
                result = "-1";
            }

            if (string.IsNullOrEmpty(result))
                result = "-1";

            return result;
        }

        /// <summary>
        /// webMethod per l'inserimento Massivo di documenti in Area conservazione con il controllo dei vincoli della dimensione istanze violato
        /// </summary>
        /// <param name="idProfile"></param>
        /// <param name="idProject"></param>
        /// <param name="docNumber"></param>
        /// <param name="infoUtente"></param>
        /// <param name="tipoOggetto"></param>
        /// <param name="numDocIstanzaViolato">indica se il vincolo sul numero dei documenti  stato violato</param>
        /// <param name="dimIstanzaViolato">indica se il vincolo sulla dimensione dell'istanza  stato violato</param>
        /// <returns></returns>
        [WebMethod]
        public virtual string DocumentoExecAddConservazioneAM_WithConstraints(string idProfile, string idProject, string docNumber, DocsPaVO.utente.InfoUtente infoUtente, string tipoOggetto, bool numDocIstanzaViolato, bool dimIstanzaViolato, int vincoloDimIstanza, int vincoloNumDocIstanza, int sizeItem)
        {
            SetUserId(infoUtente);
            string result = String.Empty;
            try
            {
                // Da Cambiare
                result = BusinessLogic.Documenti.areaConservazioneManager.CreateAndAddDocInAreaConservazione_WithConstraint(infoUtente, idProfile, idProject, docNumber, tipoOggetto, string.Empty, numDocIstanzaViolato, dimIstanzaViolato, vincoloDimIstanza, vincoloNumDocIstanza, sizeItem);
                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente, "DOCUMENTOCONSERVAZIONE", idProfile, string.Format("{0}{1}", "Azione Massiva - Invio in conservazione del doc: ", idProfile), DocsPaVO.Logger.CodAzione.Esito.OK);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: DocumentoExecAddConservazioneAM_WithConstraints", e);
                result = "-1";
            }
            return result;
        }

        /// <summary>
        /// Metodo che ritorna la dimensione dell'xml dei metadati di un documento
        /// Restituisce la dimensione dell'equivalente file XML che rappresenta la serializzazione dell'oggetto 
        /// passato come parametro
        /// </summary>
        /// <param name="schDoc"></param>
        /// <returns></returns>
        [WebMethod]
        public int SerializeSchedaDoc(DocsPaVO.documento.SchedaDocumento schDoc)
        {
            int size_xml = 0;
            try
            {
                DocsPaConservazione.InfoDocXml DocXml = new DocsPaConservazione.InfoDocXml();
                size_xml = System.Convert.ToInt32(DocXml.serializeSchedaDoc(schDoc));
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: SerializeSchedaDoc", e);
            }
            return size_xml;
        }

        /// <summary>
        /// Metodo che ritorna la dimensione in Byte dell'istanza di conservazione
        /// </summary>
        /// <param name="idIstanza"></param>
        /// <returns></returns>
        [WebMethod]
        public int getDimensioneCorrenteIstanzaByte_ByIDIstanza(string idIstanza)
        {
            int dim = 0;
            try
            {
                dim = BusinessLogic.Documenti.areaConservazioneManager.getDimensioneIstanza_Byte(idIstanza);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getDimensioneCorrenteIstanzaByte_ByIDIstanza", e);
            }
            return dim;
        }

        /// <summary>
        /// Metodo che ritorna il numero di documenti dell'istanza di conservazione
        /// </summary>
        /// <param name="idIstanza"></param>
        /// <returns></returns>
        [WebMethod]
        public int getNumeroDocIstanza_ByIDIstanza(string idIstanza)
        {
            int numDoc = 0;
            try
            {
                numDoc = BusinessLogic.Documenti.areaConservazioneManager.getNumeroDocIstanza(idIstanza);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getNumeroDocIstanza_ByIDIstanza", e);
            }
            return numDoc;
        }

        #endregion

        [WebMethod]
        public string getSeRegistroObbl(string idAmm, string nome)
        {
            string retValue = string.Empty;
            retValue = BusinessLogic.Amministrazione.AmministraManager.getSeRegistroObbl(idAmm, nome);
            return retValue;
        }

        #region FATTURAZIONE ELETTRONICA

        /// <summary>
        /// Template fattura elettronica
        /// </summary>
        /// <returns>stream xml</returns>
        [WebMethod]
        public string GetTemplateFatturaXML(DocsPaVO.utente.InfoUtente infoUtente)
        {
            string retVal = string.Empty;

            try
            {
                retVal = BusinessLogic.Fatturazione.FatturazioneManager.GetXMLTemplateFattura(infoUtente.idAmministrazione);
            }
            catch (Exception exception)
            {
                logger.Debug("Errore nel metodo WS GetTemplateFatturaXML: ", exception);
            }

            return retVal;
        }

        /// <summary>
        /// Ricerca fattura elettronica da importare
        /// </summary>
        /// <returns>stream xml</returns>
        [WebMethod]
        public string GetFatturaXML(DocsPaVO.utente.InfoUtente infoUtente, string idFattura)
        {
            string retVal = string.Empty;

            try
            {
                retVal = BusinessLogic.Fatturazione.FatturazioneManager.GetFattura(infoUtente.idAmministrazione, idFattura);
            }
            catch (Exception exception)
            {
                logger.Debug("Errore nel metodo WS GetFatturaXML: ", exception);
            }

            return retVal;
        }

        /// <summary>
        /// Inserimento di una fattura 
        /// </summary>
        /// <param name="fattura"></param>
        /// <param name="infoUtente"></param>
        /// <param name="idGruppo"></param>
        /// <returns></returns>
        [WebMethod]
        public bool SendFattura(string fattura, DocsPaVO.utente.InfoUtente infoUtente, string idGruppo)
        {
            bool retVal = false;

            try
            {
                retVal = BusinessLogic.Fatturazione.FatturazioneManager.SendFattura(fattura, infoUtente, idGruppo);
            }
            catch (Exception exception)
            {
                logger.Debug("Errore nel metodo WS SendFattura: ", exception);
                retVal = false;
            }

            return retVal;
        }

        [WebMethod]
        public bool CheckIdFattura(string messageId)
        {
            bool retVal = false;

            try
            {
                retVal = BusinessLogic.Fatturazione.FatturazioneManager.CheckIdMailFattura(messageId);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore nel metodo WS CheckIdFattura: ", ex);
                retVal = false;
            }

            return retVal;
        }

        [WebMethod]
        public bool SaveIdFattura(string messageId)
        {
            bool retVal = false;

            try
            {
                retVal = BusinessLogic.Fatturazione.FatturazioneManager.InsertIdMailFattura(messageId);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore nel metodo WS SaveIdFattura: ", ex);
                retVal = false;
            }

            return retVal;
        }

        [WebMethod]
        public string GetIdFattura(string sdiId)
        {
            string retVal = string.Empty;

            try
            {
                retVal = BusinessLogic.Fatturazione.FatturazioneManager.GetIdDocFatturaFromNomefile(sdiId);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore nel metodo WS GetIdFattura: ", ex);
                retVal = string.Empty;
            }

            return retVal;
        }

        [WebMethod]
        public string CheckNumFattura(string numFattura, string idAmm)
        {
            return BusinessLogic.Fatturazione.FatturazioneManager.CheckNumFattura(numFattura, idAmm);
        }

        [WebMethod]
        public bool LogFattura(string numero, string dataCreazione, string idFornitore, string logFattura, string idProfile)
        {
            return BusinessLogic.Fatturazione.FatturazioneManager.LogFattura(numero, dataCreazione, idFornitore, logFattura, idProfile);
        }

        [WebMethod]
        public bool LogFatturaFirmata(string docNumber, string nomeFatt, string nomeAllegato, string logMessage)
        {
            return BusinessLogic.Fatturazione.FatturazioneManager.LogFatturaFirmata(docNumber, nomeFatt, nomeAllegato, logMessage);
        }

        [WebMethod]
        public string GetIdDocFatturaFromNomefile(string nomeFile)
        {
            return BusinessLogic.Fatturazione.FatturazioneManager.GetIdDocFatturaFromNomefile(nomeFile);
        }

        [WebMethod]
        public string CheckFatturaPassiva(string numero, string data, string partitaIva)
        {
            return BusinessLogic.Fatturazione.FatturazioneManager.CheckFatturaPassiva(numero, data, partitaIva);
        }

        [WebMethod]
        public string GetIdAutFatturaPassiva(string numAutorizzazione, string idCampo, string idTemplate)
        {
            string retval = null;
            ArrayList items = BusinessLogic.ProfilazioneDinamica.ProfilazioneDocumenti.getIdDocByAssTemplates(idCampo, numAutorizzazione, "DESC", idTemplate);
            if (items != null && items.Count > 0)
            {
                retval = items[0].ToString();
            }
            return retval;
        }

        [WebMethod]
        public List<DocsPaVO.Fatturazione.AssociazioneFatturaPassiva> InvioNotificheGetFatture(string stato)
        {
            return BusinessLogic.Fatturazione.FatturazioneManager.InvioNotificheGetFatture(stato);
        }

        [WebMethod]
        public bool InvioNotificheSetStatoInvio(string docnumber)
        {
            return BusinessLogic.Fatturazione.FatturazioneManager.InvioNotificheSetStatoInvio(docnumber);
        }

        [WebMethod]
        public string FatturazioneGetIdSdiByIdFattura(string id)
        {
            return BusinessLogic.Fatturazione.FatturazioneManager.GetIdSdiByIdFattura(id);
        }

        [WebMethod]
        public string FatturazioneGetIdSdiByDocnumber(string docnumber)
        {
            return BusinessLogic.Fatturazione.FatturazioneManager.GetIdSdiByDocnumber(docnumber);
        }

        [WebMethod]
        public bool FatturazioneSetIdSdi(string id, string sdiId, string docnumber)
        {
            return BusinessLogic.Fatturazione.FatturazioneManager.SetIdSdi(id, sdiId, docnumber);
        }

        [WebMethod]
        public List<string> FatturazioneGetFattureImport()
        {
            return BusinessLogic.Fatturazione.FatturazioneManager.ImportFatture_GetFatture();
        }

        [WebMethod]
        public void FatturazioneInvioAutomaticoFatture(InfoUtente infoUtente)
        {
            BusinessLogic.Fatturazione.FatturazioneManager.ImportFatture_InvioASDI(infoUtente);
        }

        #endregion

        [WebMethod]
        public DocsPaVO.documento.FileDocumento FatturazioneGetPreviewPdf(byte[] content)
        {
            return BusinessLogic.Fatturazione.FatturazioneManager.GetPreviewPdf(content);
        }

        #region INTEGRAZIONE PITRE-PARER

        [WebMethod]
        public bool checkConsolidation(ArrayList idList, InfoUtente infoUtente)
        {

            bool result = false;

            try
            {
                foreach (string id in idList)
                {
                    if (!BusinessLogic.Documenti.DocumentConsolidation.IsDocumentConsoldated(infoUtente, id, DocsPaVO.documento.DocumentConsolidationStateEnum.Step2))
                        return true;
                }
            }
            catch (Exception ex)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: checkConsolidation", ex);
            }
            return result;
        }

        [WebMethod]
        public string getStatoConservazione(string idDoc)
        {

            string retVal = string.Empty;

            try
            {
                BusinessLogic.Conservazione.ConservazioneManager manager = new BusinessLogic.Conservazione.ConservazioneManager();
                retVal = manager.getStatoConservazione(idDoc);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore in DocsPaWS.asmx - metodo: getStatoConservazione", ex);
                retVal = string.Empty;
            }

            return retVal;
        }

        [WebMethod]
        public string InsertDocInQueueCons(string idDoc, InfoUtente utente)
        {

            string retVal = string.Empty;

            try
            {
                BusinessLogic.Conservazione.ConservazioneManager manager = new BusinessLogic.Conservazione.ConservazioneManager();
                retVal = manager.insertDocInCons(idDoc, utente, string.Empty, string.Empty);

                // PER TEST
                //manager.VersamentoDoc(idDoc, utente, "pitre.versatore", "password1", "1.3", "https://parer-pre.regione.emilia-romagna.it/sacer/VersamentoSync");
            }
            catch (Exception ex)
            {
                logger.Debug("Errore in DocsPaWS.asmx - metodo: InsertDocInQueueCons", ex);
            }

            return retVal;
        }

        [WebMethod]
        public string recuperoStatoCons(string idDoc, InfoUtente utente)
        {

            string result = string.Empty;

            try
            {
                BusinessLogic.Conservazione.ConservazioneManager manager = new BusinessLogic.Conservazione.ConservazioneManager();
                result = manager.RecuperoDoc(idDoc, utente);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore in DocsPaWS.asmx - metodo: recuperoStatoCons", ex);
                result = string.Empty;
            }

            return result;
        }

        [WebMethod]
        public string GetRapportoVersamento(string idDoc, InfoUtente utente)
        {

            string retVal = string.Empty;

            try
            {
                BusinessLogic.Conservazione.ConservazioneManager manager = new BusinessLogic.Conservazione.ConservazioneManager();
                retVal = manager.GetRapportoVersamento(idDoc, utente);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore in DocsPaWS.asmx - metodo: GetRapportoVersamento", ex);
            }

            return retVal;
        }

        // MEV Policy e responsabile conservazione

        [WebMethod]
        public string GetIdRuoloRespConservazione(string idAmm)
        {
            string result = string.Empty;

            try
            {
                BusinessLogic.Conservazione.ConservazioneManager manager = new BusinessLogic.Conservazione.ConservazioneManager();
                result = manager.GetIdRuoloRespConservazione(idAmm);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore in DocsPaWS.asmx - metodo: GetRuoloRespConservazione", ex);
            }

            return result;
        }

        [WebMethod]
        public string GetIdUtenteRespConservazione(string idAmm)
        {
            string result = string.Empty;

            try
            {
                BusinessLogic.Conservazione.ConservazioneManager manager = new BusinessLogic.Conservazione.ConservazioneManager();
                result = manager.GetIdUtenteRespConservazione(idAmm);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore in DocsPaWS.asmx - metodo: GetRuoloRespConservazione", ex);
            }

            return result;
        }

        [WebMethod]
        public bool SaveRuoloRespConservazione(string idGroup, string idUser, string idAmm)
        {
            bool result = false;

            try
            {
                result = BusinessLogic.utenti.RegistriRepertorioPrintManager.SaveRuoloRespConservazione(idGroup, idUser, idAmm);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore in DocsPaWS.asmx - metodo: SaveRuoloRespConservazione", ex);
            }

            return result;
        }

        [WebMethod]
        public DocsPaVO.Conservazione.PARER.Mailbox GetMailStruttura(string idAmm)
        {
            DocsPaVO.Conservazione.PARER.Mailbox result = new DocsPaVO.Conservazione.PARER.Mailbox();

            try
            {
                BusinessLogic.Conservazione.ConservazioneManager cons = new BusinessLogic.Conservazione.ConservazioneManager();
                result = cons.GetMailStruttura(idAmm);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore in DocsPaWS.asmx - metodo: GetMailStruttura", ex);
                result = null;
            }

            return result;
        }

        [WebMethod]
        public bool SetMailStruttura(string idAmm, DocsPaVO.Conservazione.PARER.Mailbox mail)
        {
            bool result = false;

            try
            {
                BusinessLogic.Conservazione.ConservazioneManager cons = new BusinessLogic.Conservazione.ConservazioneManager();
                result = cons.SetMailStruttura(idAmm, mail);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore in DocsPaWS.asmx - metodo: SetMailStruttura", ex);
            }

            return result;
        }

        [WebMethod]
        public bool GetStatoAttivazione(string idAmm)
        {
            bool result = false;

            try
            {
                BusinessLogic.Conservazione.ConservazioneManager cons = new BusinessLogic.Conservazione.ConservazioneManager();
                result = cons.GetStatoAttivazione(idAmm);
            }
            catch(Exception ex)
            {
                logger.Debug("Errore in DocsPaWS.asmx - metodo: GetStatoAttivazione", ex);
            }

            return result;
        }

        [WebMethod]
        public bool SetStatoAttivazione(string idAmm, string stato)
        {
            bool result = false;

            try
            {
                BusinessLogic.Conservazione.ConservazioneManager cons = new BusinessLogic.Conservazione.ConservazioneManager();
                result = cons.SetStatoAttivazione(idAmm, stato);
            }
            catch(Exception ex)
            {
                logger.Debug("Errore in DocsPaWS.asmx - metodo: SetStatoAttivazione", ex);
            }

            return result;
        }

        #endregion

        [WebMethod]
        public virtual DocsPaVO.amministrazione.EsitoOperazione AmmVerificaUtenteRespStampaRep(string userId, string roleId, string idAmm)
        {
            SetUserId(userId);
            DocsPaVO.amministrazione.EsitoOperazione esito = new DocsPaVO.amministrazione.EsitoOperazione();

            try
            {
                esito = BusinessLogic.Amministrazione.OrganigrammaManager.AmmVerificaUtenteRespStampaRep(userId, roleId, idAmm);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore in DocsPaWS.asmx - metodo: AmmVerificaUtenteRespStampaRep - ", ex);
                esito.Codice = 1;
                esito.Descrizione = "Si  verificato un errore";
            }

            return esito;
        }

        [WebMethod]
        [return: XmlArray()]
        [return: XmlArrayItem(typeof(DocsPaVO.Conservazione.PARER.PolicyPARER))]
        [XmlInclude(typeof(DocsPaVO.Conservazione.PARER.PolicyPARER))]
        public virtual ArrayList GetListaPolicyPARER(string idAmm, string tipo)
        {
            ArrayList result = new ArrayList();

            try
            {
                result = BusinessLogic.Conservazione.PARER.PolicyPARERManager.getListaPolicy(idAmm, tipo);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore in DocsPaWS.asmx - metodo: GetListaPolicyPARER - ", ex);
                result = null;
            }

            return result;
        }

        [WebMethod]
        public DocsPaVO.Conservazione.PARER.PolicyPARER GetPolicyPARERById(string idPolicy)
        {
            DocsPaVO.Conservazione.PARER.PolicyPARER result = new DocsPaVO.Conservazione.PARER.PolicyPARER();

            try
            {
                result = BusinessLogic.Conservazione.PARER.PolicyPARERManager.GetPolicyById(idPolicy);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore in DocsPaWS.asmx - metodo: GetPolicyPARERById - ", ex);
                result = null;
            }

            return result;
        }

        [WebMethod]
        public DocsPaVO.Conservazione.PARER.EsecuzionePolicy GetInfoEsecuzionePolicy(string idPolicy)
        {
            DocsPaVO.Conservazione.PARER.EsecuzionePolicy result = new DocsPaVO.Conservazione.PARER.EsecuzionePolicy();

            try
            {
                result = BusinessLogic.Conservazione.PARER.PolicyPARERManager.GetInfoEsecuzionePolicy(idPolicy);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore in DocsPaWS.asmx - metodo: GetInfoEsecuzionePolicy");
                result = null;
            }

            return result;
        }

        /// <summary>
        /// Metodo per l'inserimento di una nuova policy PARER
        /// </summary>
        /// <param name="policy"></param>
        /// <returns></returns>
        [WebMethod]
        public bool InsertNewPolicyPARER(DocsPaVO.Conservazione.PARER.PolicyPARER policy, InfoUtente utente)
        {
            bool result = false;

            try
            {
                result = BusinessLogic.Conservazione.PARER.PolicyPARERManager.InsertNewPolicy(policy);


                if (result)
                {
                    string tipo = string.Empty;
                    if (policy.tipo.Equals("D"))
                        tipo = "Documenti";
                    if (policy.tipo.Equals("S"))
                        tipo = "Stampe";
                    BusinessLogic.UserLog.UserLog.WriteLog(utente, "AMMPOLICYPARERNEW", policy.id, string.Format("Creazione nuova Policy {2} {0} da parte dell'utente {1}", policy.codice, utente.userId, tipo), DocsPaVO.Logger.CodAzione.Esito.OK);
                }
                else
                {
                    string tipo = string.Empty;
                    if (policy.tipo.Equals("D"))
                        tipo = "Documenti";
                    if (policy.tipo.Equals("S"))
                        tipo = "Stampe";
                    BusinessLogic.UserLog.UserLog.WriteLog(utente, "AMMPOLICYPARERNEW", "", string.Format("Creazione nuova Policy {2} {0} da parte dell'utente {1}", policy.codice, utente.userId, tipo), DocsPaVO.Logger.CodAzione.Esito.KO);
                }

            }
            catch (Exception ex)
            {
                logger.Debug("Errore in DocsPaWS.asmx - metodo: InsertNewPolicyPARER - ", ex);
                result = false;
            }

            return result;
        }

        /// <summary>
        /// Metodo per l'aggiornamento di una Policy PARER esistente
        /// </summary>
        /// <param name="policy"></param>
        /// <returns></returns>
        [WebMethod]
        public bool UpdatePolicyPARER(DocsPaVO.Conservazione.PARER.PolicyPARER policy, InfoUtente utente)
        {
            bool result = false;

            try
            {
                result = BusinessLogic.Conservazione.PARER.PolicyPARERManager.UpdatePolicy(policy);


                if (result)
                {
                    string tipo = string.Empty;
                    if (policy.tipo.Equals("D"))
                        tipo = "Documenti";
                    if (policy.tipo.Equals("S"))
                        tipo = "Stampe";
                    BusinessLogic.UserLog.UserLog.WriteLog(utente, "AMMPOLICYPARERMOD", policy.id, string.Format("Modifica Policy {2} {0} da parte dell'utente {1}", policy.codice, utente.userId, tipo), DocsPaVO.Logger.CodAzione.Esito.OK);
                }
                else
                {
                    string tipo = string.Empty;
                    if (policy.tipo.Equals("D"))
                        tipo = "Documenti";
                    if (policy.tipo.Equals("S"))
                        tipo = "Stampe";
                    BusinessLogic.UserLog.UserLog.WriteLog(utente, "AMMPOLICYPARERMOD", policy.id, string.Format("Modifica Policy {2} {0} da parte dell'utente {1}", policy.codice, utente.userId, tipo), DocsPaVO.Logger.CodAzione.Esito.KO);
                }

            }
            catch (Exception ex)
            {
                logger.Debug("Errore in DocsPaWS.asmx . metodo: UpdatePolicyPARER - ", ex);
                result = false;
            }

            return result;
        }

        /// <summary>
        /// Metodo per l'eliminazione di una Policy PARER
        /// </summary>
        /// <param name="idPolicy"></param>
        /// <returns></returns>
        [WebMethod]
        public bool DeletePolicyPARER(string idPolicy, InfoUtente utente)
        {
            bool result = false;

            try
            {
                DocsPaVO.Conservazione.PARER.PolicyPARER policy = BusinessLogic.Conservazione.PARER.PolicyPARERManager.GetPolicyById(idPolicy);
                string codPolicy = policy.codice;
                result = BusinessLogic.Conservazione.PARER.PolicyPARERManager.DeletePolicy(idPolicy);

                if (result)
                {
                    string tipo = string.Empty;
                    if (policy.tipo.Equals("D"))
                        tipo = "Documenti";
                    if (policy.tipo.Equals("S"))
                        tipo = "Stampe";
                    BusinessLogic.UserLog.UserLog.WriteLog(utente, "AMMPOLICYPARERDEL", idPolicy, string.Format("Eliminazione Policy {2} {0} da parte dell'utente {1}", codPolicy, utente.userId, tipo), DocsPaVO.Logger.CodAzione.Esito.OK);
                }
                else
                {
                    string tipo = string.Empty;
                    if (policy.tipo.Equals("D"))
                        tipo = "Documenti";
                    if (policy.tipo.Equals("S"))
                        tipo = "Stampe";
                    BusinessLogic.UserLog.UserLog.WriteLog(utente, "AMMPOLICYPARERDEL", idPolicy, string.Format("Eliminazione Policy {2} {0} da parte dell'utente {1}", codPolicy, utente.userId, tipo), DocsPaVO.Logger.CodAzione.Esito.KO);
                }

            }
            catch (Exception ex)
            {
                logger.Debug("Errore in DocsPaWS.asmx - metodo: DeletePolicyPARER - ", ex);
            }

            return result;
        }

        /// <summary>
        /// Metodo per l'aggiornamento dello stato di attivazione delle policy
        /// </summary>
        /// <param name="lista"></param>
        /// <returns></returns>
        [WebMethod]
        public bool UpdateStatoPolicy(ArrayList lista, InfoUtente utente)
        {
            bool result = false;

            try
            {
                result = BusinessLogic.Conservazione.PARER.PolicyPARERManager.UpdateStatoPolicy(lista, utente);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore in DocsPaWS.asmx - metodo: UpdateStatoPolicy - ", ex);
            }

            return result;
        }

        [WebMethod]
        public string GetCountDocumentiFromPolicy(DocsPaVO.Conservazione.PARER.PolicyPARER policy, string idAmm)
        {
            string result = string.Empty;

            try
            {
                result = BusinessLogic.Conservazione.PARER.PolicyPARERManager.GetCountDocumentiFromPolicy(policy, idAmm);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore in DocsPaWS.asmx - metodo: GetCountDocumentiFromPolicy - ", ex);
            }

            return result;
        }

        [WebMethod]
        public DocsPaVO.Conservazione.PARER.Report.ReportSingolaAmmResponse GetDataReportSingolaAmm(DocsPaVO.Conservazione.PARER.Report.ReportSingolaAmmRequest request)
        {
            DocsPaVO.Conservazione.PARER.Report.ReportSingolaAmmResponse response = new DocsPaVO.Conservazione.PARER.Report.ReportSingolaAmmResponse();

            try
            {
                response = BusinessLogic.Conservazione.PARER.ReportManager.GetDataReportSingolaAmm(request);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore in DocsPaWS.asmx - metodo: GetDataReportSingolaAmm - ", ex);
            }

            return response;
        }

        [WebMethod()]
        [XmlInclude(typeof(DocsPaVO.fascicolazione.Fascicolo))]
        public DocsPaVO.fascicolazione.Fascicolo[] GetFascicoloDaCodiceNoSecurityConservazione(string codiceFasc, string idAmm, string idTitolario, bool soloGenerali, bool isRicFasc, string idRegistro)
        {
            try
            {
                Fascicolo[] result = null;
                result = BusinessLogic.Fascicoli.FascicoloManager.GetFascicoloDaCodiceNoSecurityConservazione(codiceFasc, idAmm, idTitolario, soloGenerali, isRicFasc, idRegistro);

                return result;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetFascicoloDaCodiceNoSecurityConservazione", e);
                return null;
            }
        }

        [WebMethod]
        public DocsPaVO.documento.FileDocumento ExportDettaglioPolicyPARER(string[] idPolicy, string formato, string tipo)
        {

            DocsPaVO.documento.FileDocumento result = new DocsPaVO.documento.FileDocumento();

            try
            {
                result = BusinessLogic.Conservazione.PARER.PolicyPARERManager.ExportPolicy(idPolicy, formato, tipo);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore in DocsPaWS.asmx - metodo: ExportDettaglioPolicyPARER", ex);
                result = null;
            }

            return result;
        }

        [WebMethod]
        public string CreateReportDocsRejected()
        {
            string result = string.Empty;

            try
            {
                result = BusinessLogic.Conservazione.PARER.PolicyPARERManager.CreateReportDocsRejected();
            }
            catch (Exception ex)
            {
                logger.Debug("Errore in DocsPaWS.asmx - metodo: CreateReportDocsRejected", ex);
                result = ex.ToString();
            }

            return result;
        }

        [WebMethod]
        public string CreateReportDocsFailed()
        {
            string result = string.Empty;

            try
            {
                result = BusinessLogic.Conservazione.PARER.PolicyPARERManager.CreateReportDocsFailed();
            }
            catch (Exception ex)
            {
                logger.Debug("Erroe in DocsPaWS.asmx - metodo: CreateReportDocsFailed", ex);
                result = ex.ToString();
            }

            return result;
        }

        [WebMethod]
        public DocsPaVO.Conservazione.PARER.Report.ReportMonitoraggioPolicyResponse ReportMonitoraggioPolicy(DocsPaVO.Conservazione.PARER.Report.ReportMonitoraggioPolicyRequest request)
        {
            return BusinessLogic.Conservazione.PARER.ReportManager.ReportMonitoraggioPolicy(request);
        }


        #region Libro Firma

        /// <summary>
        /// Metodo per l'estrazione degli eventi di Notifica
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public DocsPaVO.LibroFirma.AnagraficaEventi[] GetEventNotification(DocsPaVO.utente.InfoUtente infoUtente)
        {
            List<DocsPaVO.LibroFirma.AnagraficaEventi> listEventTypes = new List<DocsPaVO.LibroFirma.AnagraficaEventi>();
            try
            {
                listEventTypes = BusinessLogic.LibroFirma.LibroFirmaManager.GetEventNotification(infoUtente);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetEventNotification", e);
            }
            return listEventTypes.ToArray();
        }

        /// <summary>
        /// Metodo per l'estrazione dei tipi ruolo
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public DocsPaVO.utente.TipoRuolo[] GetTypeRole(DocsPaVO.utente.InfoUtente infoUtente)
        {
            List<DocsPaVO.utente.TipoRuolo> listTypeRole = new List<DocsPaVO.utente.TipoRuolo>();
            try
            {
                listTypeRole = BusinessLogic.LibroFirma.LibroFirmaManager.GetTypeRole(infoUtente.idAmministrazione);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetTypeRole", e);
            }
            return listTypeRole.ToArray();
        }

        /// <summary>
        /// Metodo per l'estrazione degli eventi
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public DocsPaVO.LibroFirma.AnagraficaEventi[] GetEventTypes(string eventType, DocsPaVO.utente.InfoUtente infoUtente)
        {
            List<DocsPaVO.LibroFirma.AnagraficaEventi> listEventTypes = new List<DocsPaVO.LibroFirma.AnagraficaEventi>();
            try
            {
                listEventTypes = BusinessLogic.LibroFirma.LibroFirmaManager.GetEventTypes(eventType, infoUtente);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetEventTypes", e);
            }
            return listEventTypes.ToArray();
        }


        /// <summary>
        /// Estrae gli elementi in libro firma per la coppia ruolo-utente
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public DocsPaVO.LibroFirma.ElementoInLibroFirma[] GetElementiLibroFirma(DocsPaVO.utente.InfoUtente infoUtente)
        {
            List<DocsPaVO.LibroFirma.ElementoInLibroFirma> listaElementi = new List<DocsPaVO.LibroFirma.ElementoInLibroFirma>();
            try
            {
                listaElementi = BusinessLogic.LibroFirma.LibroFirmaManager.GetElementiLibroFirma(infoUtente);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetElementiLibroFirma", e);
            }
            return listaElementi.ToArray();
        }


        /// <summary>
        /// Metodo per l'estrazione dei processi di firma visibili al ruolo
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public DocsPaVO.LibroFirma.ProcessoFirma[] GetProcessesSignatureVisibleRole(bool asProponente, bool asMonitoratore, DocsPaVO.utente.InfoUtente infoUtente)
        {
            List<DocsPaVO.LibroFirma.ProcessoFirma> listaProcessiDiFirma = new List<DocsPaVO.LibroFirma.ProcessoFirma>();
            try
            {
                listaProcessiDiFirma = BusinessLogic.LibroFirma.LibroFirmaManager.GetProcessesSignatureVisibleRole(asProponente, asMonitoratore, infoUtente);
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: GetProcessesSignatureVisibleRole", e);
            }
            return listaProcessiDiFirma.ToArray();
        }

        /// <summary>
        /// Metodo per l'estrazione degli schemi di processi di firma
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public DocsPaVO.LibroFirma.ProcessoFirma[] GetProcessiDiFirma(DocsPaVO.utente.InfoUtente infoUtente)
        {
            List<DocsPaVO.LibroFirma.ProcessoFirma> listaProcessiDiFirma = new List<DocsPaVO.LibroFirma.ProcessoFirma>();
            try
            {
                listaProcessiDiFirma = BusinessLogic.LibroFirma.LibroFirmaManager.GetProcessiDiFirma(infoUtente);
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: GetProcessiDiFirma", e);
            }
            return listaProcessiDiFirma.ToArray();
        }

        [WebMethod]
        public DocsPaVO.LibroFirma.ProcessoFirma[] GetProcessiDiFirmaByIdAmm(string idAmministrazione)
        {
            List<DocsPaVO.LibroFirma.ProcessoFirma> listaProcessiDiFirma = new List<DocsPaVO.LibroFirma.ProcessoFirma>();
            try
            {
                listaProcessiDiFirma = BusinessLogic.LibroFirma.LibroFirmaManager.GetProcessiDiFirmaByIdAmm(idAmministrazione);
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: GetProcessiDiFirmaByIdAmm", e);
            }
            return listaProcessiDiFirma.ToArray();
        }

        /// <summary>
        /// Estrazione dei processi di firma in cui  coinvolto il ruolo in input
        /// </summary>
        /// <param name="idRuoloCoinvolto"></param>
        /// <returns></returns>
        [WebMethod]
        public DocsPaVO.LibroFirma.ProcessoFirma[] GetProcessiDiFirmaByRuoloTitolare(string idRuoloCoinvolto)
        {
            List<DocsPaVO.LibroFirma.ProcessoFirma> listaProcessiDiFirma = new List<DocsPaVO.LibroFirma.ProcessoFirma>();
            try
            {
                listaProcessiDiFirma = BusinessLogic.LibroFirma.LibroFirmaManager.GetProcessiDiFirmaByRuoloTitolare(idRuoloCoinvolto);
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: GetProcessiDiFirmaByRuoloTitolare", e);
            }
            return listaProcessiDiFirma.ToArray();
        }

        /// <summary>
        /// Estrazione dei processi di firma in cui  coinvolto il ruolo in input
        /// </summary>
        /// <param name="idRuoloCoinvolto"></param>
        /// <returns></returns>
        [WebMethod]
        public int GetCountProcessiDiFirmaByRuoloTitolare(string idRuoloCoinvolto)
        {
            try
            {
                return BusinessLogic.LibroFirma.LibroFirmaManager.GetCountProcessiDiFirmaByRuoloTitolare(idRuoloCoinvolto);
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: GetCountProcessiDiFirmaByRuoloTitolare", e);
                return 0;
            }
        }

        /// <summary>
        /// Estrazione dei processi di firma in cui  coinvolto l'utente in input
        /// </summary>
        /// <param name="idUtenteCoinvolto"></param>
        /// <returns></returns>
        [WebMethod]
        public DocsPaVO.LibroFirma.ProcessoFirma[] GetProcessiDiFirmaByUtenteTitolare(string idUtenteCoinvolto, string idRuoloCoinvolto)
        {
            List<DocsPaVO.LibroFirma.ProcessoFirma> listaProcessiDiFirma = new List<DocsPaVO.LibroFirma.ProcessoFirma>();
            try
            {
                listaProcessiDiFirma = BusinessLogic.LibroFirma.LibroFirmaManager.GetProcessiDiFirmaByUtenteTitolare(idUtenteCoinvolto, idRuoloCoinvolto);
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: GetProcessiDiFirmaByUtenteTitolare", e);
            }
            return listaProcessiDiFirma.ToArray();
        }

        [WebMethod]
        public int GetCountProcessiDiFirmaByUtenteTitolare(string idUtenteCoinvolto, string idRuoloCoinvolto)
        {
            try
            {
                return BusinessLogic.LibroFirma.LibroFirmaManager.GetCountProcessiDiFirmaByUtenteTitolare(idUtenteCoinvolto, idRuoloCoinvolto);
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: GetCountProcessiDiFirmaByUtenteTitolare", e);
                return 0;
            }
        }

        /// <summary>
        /// Estrazione dei processi di firma in cui  coinvolto il ruolo in input
        /// </summary>
        /// <param name="idRuoloCoinvolto"></param>
        /// <returns></returns>
        [WebMethod]
        public DocsPaVO.LibroFirma.IstanzaProcessoDiFirma[] GetIstanzeProcessiDiFirmaByRuoloCoinvolto(string idRuoloCoinvolto)
        {
            List<DocsPaVO.LibroFirma.IstanzaProcessoDiFirma> listaProcessiDiFirma = new List<DocsPaVO.LibroFirma.IstanzaProcessoDiFirma>();
            try
            {
                listaProcessiDiFirma = BusinessLogic.LibroFirma.LibroFirmaManager.GetIstanzaProcessiDiFirmaByRuoloTitolare(idRuoloCoinvolto);
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: GetIstanzeProcessiDiFirmaByRuoloCoinvolto", e);
            }
            return listaProcessiDiFirma.ToArray();
        }

        #region AMMINISTRAZIONE LF

        [WebMethod]
        public DocsPaVO.LibroFirma.ProcessoFirma[] GetProcessiDiFirmaByTitolarePaging(string idRuoloTitolare, string idUtenteTitolare, int numPage, int pageSize, out int numTotPage, out int nRec)
        {
            List<DocsPaVO.LibroFirma.ProcessoFirma> listaProcessiDiFirma = new List<DocsPaVO.LibroFirma.ProcessoFirma>();
            numTotPage = 0;
            nRec = 0;
            try
            {
                listaProcessiDiFirma = BusinessLogic.LibroFirma.LibroFirmaManager.GetProcessiDiFirmaByTitolarePaging(idRuoloTitolare, idUtenteTitolare, numPage, pageSize, out numTotPage, out nRec);
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: GetProcessiDiFirmaByTitolarePaging ", e);
            }
            return listaProcessiDiFirma.ToArray();
        }

        [WebMethod]
        public int GetCountProcessiDiFirmaByTitolare(string idRuoloTitolare, string idUtenteTitolare)
        {
            int result = 0;
            try
            {
                result = BusinessLogic.LibroFirma.LibroFirmaManager.GetCountProcessiDiFirmaByTitolare(idRuoloTitolare, idUtenteTitolare);
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: GetCountProcessiDiFirmaByTitolare", e);
            }
            return result;
        }

        [WebMethod]
        public DocsPaVO.LibroFirma.IstanzaProcessoDiFirma[] GetIstanzeProcessiDiFirmaByTitolarePaging(string idRuoloTitolare, string idUtenteTitolare, int numPage, int pageSize, out int numTotPage, out int nRec)
        {
            List<DocsPaVO.LibroFirma.IstanzaProcessoDiFirma> listaProcessiDiFirma = new List<DocsPaVO.LibroFirma.IstanzaProcessoDiFirma>();
            numTotPage = 0;
            nRec = 0;
            try
            {
                listaProcessiDiFirma = BusinessLogic.LibroFirma.LibroFirmaManager.GetIstanzaProcessiDiFirmaByTitolarePaging(idRuoloTitolare, idUtenteTitolare, numPage, pageSize, out numTotPage, out nRec);
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: GetIstanzeProcessiDiFirmaByTitolare", e);
            }
            return listaProcessiDiFirma.ToArray();
        }

        [WebMethod]
        public int GetCountIstanzaProcessiDiFirmaByTitolare(string idRuoloTitolare, string idUtenteTitolare)
        {
            int result = 0;
            try
            {
                result = BusinessLogic.LibroFirma.LibroFirmaManager.GetCountIstanzaProcessiDiFirmaByTitolare(idRuoloTitolare, idUtenteTitolare);
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: GetCountIstanzaProcessiDiFirmaByTitolare", e);
            }
            return result;
        }

        [WebMethod]
        public List<string> GetIdRuoliProcessiUltimoUtente(string idPeople)
        {
            try
            {
                return BusinessLogic.LibroFirma.LibroFirmaManager.GetIdRuoliProcessiUltimoUtente(idPeople);
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: GetIdRuoliProcessiUltimoUtente", e);
            }
            return null;
        }

        [WebMethod()]
        public DocsPaVO.documento.FileDocumento GetReportProcessiFirma(string idRuolo, string idUtente, string formato)
        {
            DocsPaVO.documento.FileDocumento retVal = new DocsPaVO.documento.FileDocumento();

            try
            {
                retVal = BusinessLogic.LibroFirma.LibroFirmaManager.GetReportProcessiFirma(idRuolo, idUtente, formato);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetReportProcessiFirma", ex);
                retVal = null;
            }

            return retVal;
        }
        #endregion

        [WebMethod]
        public int GetCountIstanzeProcessiDiFirmaByRuoloCoinvolto(string idRuoloCoinvolto)
        {
            try
            {
                return BusinessLogic.LibroFirma.LibroFirmaManager.GetCountIstanzaProcessiDiFirmaByRuoloTitolare(idRuoloCoinvolto);
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: GetCountIstanzaProcessiDiFirmaByRuoloTitolare", e);
                return 0;
            }
        }


        /// <summary>
        /// Estrazione dei processi di firma in cui  coinvolto l'utente in input
        /// </summary>
        /// <param name="idRuoloCoinvolto"></param>
        /// <returns></returns>
        [WebMethod]
        public DocsPaVO.LibroFirma.IstanzaProcessoDiFirma[] GetIstanzeProcessiDiFirmaByUtenteCoinvolto(string idUtenteCoinvolto, string idRuoloCoinvolto)
        {
            List<DocsPaVO.LibroFirma.IstanzaProcessoDiFirma> listaProcessiDiFirma = new List<DocsPaVO.LibroFirma.IstanzaProcessoDiFirma>();
            try
            {
                listaProcessiDiFirma = BusinessLogic.LibroFirma.LibroFirmaManager.GetIstanzaProcessiDiFirmaByUtenteTitolare(idUtenteCoinvolto, idRuoloCoinvolto);
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: GetIstanzeProcessiDiFirmaByUtenteCoinvolto", e);
            }
            return listaProcessiDiFirma.ToArray();
        }

        [WebMethod]
        public int GetCountIstanzeProcessiDiFirmaByUtenteCoinvolto(string idUtenteCoinvolto, string idRuoloCoinvolto)
        {
            try
            {
                return BusinessLogic.LibroFirma.LibroFirmaManager.GetCountIstanzaProcessiDiFirmaByUtenteTitolare(idUtenteCoinvolto, idRuoloCoinvolto);
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: GetCountIstanzaProcessiDiFirmaByUtenteTitolare", e);
                return 0;
            }
        }

        /// <summary>
        /// Sbarro un processo per non permetto il suo avvio
        /// </summary>
        /// <param name="idRuolo"></param>
        /// <param name="idUtente"></param>
        /// <returns>bool value</returns>
        [WebMethod]
        public bool TickPasso(string[] idPassi, string tipoTick)
        {
            bool retVal = false;
            try
            {
                retVal = BusinessLogic.LibroFirma.LibroFirmaManager.TickPasso(idPassi, tipoTick);
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: TickPasso", e);
            }
            return retVal;
        }

        /// <summary>
        /// Sbarro un processo per non permetto il suo avvio
        /// </summary>
        /// <param name="idRuolo"></param>
        /// <param name="idUtente"></param>
        /// <returns>bool value</returns>
        [WebMethod]
        public bool TickIstanze(DocsPaVO.LibroFirma.IstanzaProcessoDiFirma[] istanzeProcessi, string tipoTick, DocsPaVO.utente.InfoUtente infoUtente)
        {
            bool result = false;
            string msg = string.Empty;
            string varMetodo = string.Empty;
            try
            {
                string noteInterruzione = (tipoTick == "R" ? "Interrotto processo per modifica da amministrazione di un ruolo coinvolto." : "Interrotto processo per modifica da amministrazione di un utente coinvolto.");
                result = BusinessLogic.LibroFirma.LibroFirmaManager.InterruptionSignatureProcessByAdministrator(istanzeProcessi, noteInterruzione, infoUtente);
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: TickIstanze", e);
            }
            return result;
        }

        [WebMethod]
        public bool InvalidaPassiCorrelatiTitolare(string idRuolo, string idPeople, string tipoTick, DocsPaVO.utente.InfoUtente infoUtente)
        {
            bool result = false;
            try
            {
                result = BusinessLogic.LibroFirma.LibroFirmaManager.InvalidaPassiCorrelatiTitolare(idRuolo, idPeople, tipoTick, infoUtente);
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: InvalidaPassiCorrelatiByUtenteCoinvolto", e);
            }
            return result;
        }

        [WebMethod]
        public bool AmmSostituisciUtentePassiCorrelati(string idRuolo, string idOldPeople, string idNewPeople)
        {
            bool result = false;
            try
            {
                result = BusinessLogic.LibroFirma.LibroFirmaManager.AmmSostituisciUtentePassiCorrelati(idRuolo, idOldPeople, idNewPeople);
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: InvalidaPassiCorrelatiByUtenteCoinvolto", e);
            }
            return result;
        }

        [WebMethod]
        public bool AmmStoricizzaRuoloPassiCorrelati(string idRuoloOld, string idRuoloNew)
        {
            bool result = false;
            try
            {
                result = BusinessLogic.LibroFirma.LibroFirmaManager.AmmStoricizzaRuoloPassiCorrelati(idRuoloOld, idRuoloNew);
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: AmmStoricizzaRuoloPassiCorrelati", e);
            }
            return result;
        }

        [WebMethod]
        public string GetDescDiagrammiByIdProcesso(string idProcesso)
        {
            string result = string.Empty;
            try
            {
                result = BusinessLogic.LibroFirma.LibroFirmaManager.GetDescDiagrammiByIdProcesso(idProcesso);
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: GetDescDiagrammiByIdProcesso", e);
            }
            return result;
        }
        /// <summary>
        /// Verifica se il documento  in Libro firma
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public bool IsDocInLibroFirma(string docNumber)
        {
            bool retVal = false;
            try
            {
                retVal = BusinessLogic.LibroFirma.LibroFirmaManager.IsDocInLibroFirma(docNumber);
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: IsDocInLibroFirma", e);
            }
            return retVal;
        }

        [WebMethod]
        public bool IsModelloDiFirma(string idProcesso)
        {
            bool retVal = false;
            try
            {
                retVal = BusinessLogic.LibroFirma.LibroFirmaManager.IsModelloDiFirma(idProcesso);
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: IsModelloDiFirma", e);
            }
            return retVal;
        }

        /// <summary>
        /// Verifica se il documento o uno dei suoi allegati  in libro firma
        /// </summary>
        /// <param name="docNumber"></param>
        /// <returns></returns>
        [WebMethod]
        public bool IsDocOrAllInLibroFirma(string docNumber)
        {
            bool retVal = false;
            try
            {
                retVal = BusinessLogic.LibroFirma.LibroFirmaManager.IsDocOrAllInLibroFirma(docNumber);
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: IsDocOrAllInLibroFirma", e);
            }
            return retVal;
        }

        /// <summary>
        /// Verifica se almeno uno degli allegati del documento  in Libro Firma
        /// </summary>
        /// <param name="idDocumentoPrincipale"></param>
        /// <returns></returns>
        [WebMethod]
        public bool CheckAllegatiInLibroFirma(string idDocumentoPrincipale)
        {
            bool retVal = false;
            try
            {
                retVal = BusinessLogic.LibroFirma.LibroFirmaManager.CheckAllegatiInLibroFirma(idDocumentoPrincipale);
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: CheckAllegatiInLibroFirma", e);
            }
            return retVal;
        }

        /// <summary>
        /// Creazione del processo di firma
        /// </summary>
        /// <param name="processoDiFirma"></param>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public DocsPaVO.LibroFirma.ProcessoFirma InsertProcessoDiFirma(DocsPaVO.LibroFirma.ProcessoFirma processoDiFirma, DocsPaVO.utente.InfoUtente infoUtente, out DocsPaVO.LibroFirma.ResultProcessoFirma resultCreazioneProcesso)
        {
            resultCreazioneProcesso = DocsPaVO.LibroFirma.ResultProcessoFirma.OK;
            try
            {
                return BusinessLogic.LibroFirma.LibroFirmaManager.InsertProcessoDiFirma(processoDiFirma, infoUtente, out resultCreazioneProcesso);
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: InsertProcessiDiFirma", e);
                return null;
            }
        }

        /// <summary>
        /// Estrae il processo di firma avviato per il documento  in input
        /// </summary>
        /// <param name="docnumber"></param>
        /// <param name="infoutente"></param>
        /// <returns></returns>
        [WebMethod]
        [XmlInclude(typeof(DocsPaVO.LibroFirma.StatoPasso))]
        public List<DocsPaVO.LibroFirma.IstanzaProcessoDiFirma> GetIstanzaProcessoDiFirmaByDocnumber(string docnumber, DocsPaVO.utente.InfoUtente infoUtente)
        {
            try
            {
                return BusinessLogic.LibroFirma.LibroFirmaManager.GetIstanzaProcessoDiFirmaByDocnumber(docnumber, infoUtente);
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: GetIstanzaProcessoDiFirmaByDocnumber", e);
                return null;
            }
        }

        /// <summary>
        /// Metodo per l'estrazione dell'istanze di processo create a partire dallo schema di processo definito
        /// </summary>
        /// <param name="idProcesso"></param>
        /// <param name="infoutente"></param>
        /// <returns></returns>
        [WebMethod]
        [XmlInclude(typeof(DocsPaVO.LibroFirma.StatoPasso))]
        public List<DocsPaVO.LibroFirma.IstanzaProcessoDiFirma> GetIstanzaProcessoDiFirmaByIdProcesso(string idProcesso, DocsPaVO.utente.InfoUtente infoUtente)
        {
            try
            {
                return BusinessLogic.LibroFirma.LibroFirmaManager.GetIstanzaProcessoDiFirmaByIdProcesso(idProcesso, infoUtente);
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: GetIstanzaProcessoDiFirmaByIdProcesso", e);
                return null;
            }
        }

        /// <summary>
        /// Metodo per l'estrazione del dettaglio dell'istanza di processo di firma
        /// </summary>
        /// <param name="idIstanzaProcesso"></param>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public DocsPaVO.LibroFirma.IstanzaProcessoDiFirma GetIstanzaProcessoDiFirmaByIdIstanzaProcesso(string idIstanzaProcesso, DocsPaVO.utente.InfoUtente infoUtente)
        {
            try
            {
                return BusinessLogic.LibroFirma.LibroFirmaManager.GetIstanzaProcessoDiFirmaByIdIstanzaProcesso(idIstanzaProcesso, infoUtente);
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: GetIstanzaProcessoDiFirmaByIdIstanzaProcesso", e);
                return null;
            }
        }

        [WebMethod]
        public DocsPaVO.LibroFirma.PassoFirma InserisciPassoDiFirma(DocsPaVO.LibroFirma.PassoFirma passo, DocsPaVO.utente.InfoUtente infoUtente)
        {
            try
            {
                return BusinessLogic.LibroFirma.LibroFirmaManager.InserisciPassoDiFirma(passo, infoUtente);
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: InserisciPassoDiFirma", e);
                return null;
            }
        }

        [WebMethod]
        public DocsPaVO.LibroFirma.ProcessoFirma GetProcessoDiFirma(string idProcesso, DocsPaVO.utente.InfoUtente infoUtente)
        {
            try
            {
                return BusinessLogic.LibroFirma.LibroFirmaManager.GetProcessoDiFirmaById(idProcesso, infoUtente);
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: GetProcessoDiFirma", e);
                return null;
            }
        }


        /// <summary>
        /// Inserisce le visibilita dei ruoli sui processi
        /// </summary>
        /// <param name="visibilita"></param>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public bool InsertVisibilitaProcesso(List<DocsPaVO.LibroFirma.VisibilitaProcessoRuolo> visibilita, DocsPaVO.utente.InfoUtente infoUtente)
        {
            try
            {
                return BusinessLogic.LibroFirma.LibroFirmaManager.InsertVisibilitaProcesso(visibilita, infoUtente);
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: InsertVisibilitaProcesso", e);
                return false;
            }
        }

        /// <summary>
        /// Estrae i corrispondenti aventi visibilit sul processo
        /// </summary>
        /// <param name="idProcesso"></param>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public DocsPaVO.LibroFirma.VisibilitaProcessoRuolo[] GetVisibilitaProcesso(string idProcesso, List<DocsPaVO.LibroFirma.FiltroProcessoFirma> filtroRicerca, DocsPaVO.utente.InfoUtente infoUtente)
        {
            List<DocsPaVO.LibroFirma.VisibilitaProcessoRuolo> listaCorr = new List<DocsPaVO.LibroFirma.VisibilitaProcessoRuolo>();
            try
            {
                listaCorr = BusinessLogic.LibroFirma.LibroFirmaManager.GetVisibilitaProcesso(idProcesso, filtroRicerca, infoUtente);
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: GetProcessiDiFirma", e);
            }
            return listaCorr.ToArray();
        }


        /// <summary>
        /// Aggiorna un processo di firma
        /// </summary>
        /// <param name="processoDiFirma"></param>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public DocsPaVO.LibroFirma.ProcessoFirma AggiornaProcessoDiFirma(DocsPaVO.LibroFirma.ProcessoFirma processoDiFirma, DocsPaVO.utente.InfoUtente infoUtente)
        {
            try
            {
                return BusinessLogic.LibroFirma.LibroFirmaManager.AggiornaProcessoDiFirma(processoDiFirma, infoUtente);
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: AggiornaProcessoDiFirma", e);
                return null;
            }
        }

        /// <summary>
        /// Aggiorna il passo di firma
        /// </summary>
        /// <param name="passo"></param>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public bool AggiornaPassoDiFirma(DocsPaVO.LibroFirma.PassoFirma passo, int oldNumeroSequenza, DocsPaVO.utente.InfoUtente infoUtente)
        {
            try
            {
                return BusinessLogic.LibroFirma.LibroFirmaManager.AggiornaPassoDiFirma(passo, oldNumeroSequenza, infoUtente);
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: AggiornaPassoDiFirma", e);
                return false;
            }
        }

        [WebMethod]
        public bool UpdateIstanzaProcessoDiFirma(DocsPaVO.LibroFirma.IstanzaProcessoDiFirma istanzaProcesso, DocsPaVO.utente.InfoUtente infoUtente)
        {
            try
            {
                return BusinessLogic.LibroFirma.LibroFirmaManager.UpdateIstanzaProcessoDiFirma(istanzaProcesso, infoUtente);
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: UpdateIstanzaProcessoDiFirma", e);
                return false;
            }
        }

        /// <summary>
        /// Rimozione del paddo di firma
        /// </summary>
        /// <param name="idPasso"></param>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public bool RimuoviPassoDiFirma(DocsPaVO.LibroFirma.PassoFirma passo, DocsPaVO.utente.InfoUtente infoUtente)
        {
            try
            {
                return BusinessLogic.LibroFirma.LibroFirmaManager.RimuoviPassoDiFirma(passo, infoUtente);
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: RimuoviPassoDiFirma", e);
                return false;
            }
        }

        /// <summary>
        /// Rimuove la visibilit del processo per il corrispondente selezionato
        /// </summary>
        /// <param name="idProcesso"></param>
        /// <param name="idGruppo"></param>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public bool RimuoviVisibilitaProcesso(string idProcesso, string idGruppo, DocsPaVO.utente.InfoUtente infoUtente)
        {
            try
            {
                return BusinessLogic.LibroFirma.LibroFirmaManager.RimuoviVisibilitaProcesso(idProcesso, idGruppo, infoUtente);
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: RimuoviVisibilitaProcesso", e);
                return false;
            }
        }

        /// <summary>
        /// Aggiorna il tipo di visibilita che ha il ruolo sul processo di firma
        /// </summary>
        /// <param name="idProcesso"></param>
        /// <param name="idGruppo"></param>
        /// <param name="tipoVisibilita"></param>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public bool UpdateTipoVisibilitaProcesso(string idProcesso, string idGruppo, DocsPaVO.LibroFirma.TipoVisibilita tipoVisibilita, DocsPaVO.utente.InfoUtente infoUtente)
        {
            try
            {
                return BusinessLogic.LibroFirma.LibroFirmaManager.UpdateTipoVisibilitaProcesso(idProcesso, idGruppo, tipoVisibilita, infoUtente);
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: RimuoviVisibilitaProcesso", e);
                return false;
            }
        }

        /// <summary>
        /// Rimozione del processo di firma
        /// </summary>
        /// <param name="processo"></param>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public bool RimuoviProcessoDiFirma(DocsPaVO.LibroFirma.ProcessoFirma processo, DocsPaVO.utente.InfoUtente infoUtente)
        {
            try
            {
                return BusinessLogic.LibroFirma.LibroFirmaManager.RimuoviProcessoDiFirma(processo, infoUtente);
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: RimuoviProcessoDiFirma", e);
                return false;
            }
        }


        [WebMethod()]
        public Utente[] getUserInRoleByIdGruppo(string idGruppo)
        {
            try
            {
                Utente[] result = null;

                result = BusinessLogic.Utenti.UserManager.getUserInRoleByIdGruppo(idGruppo);

                return result;
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: getUserInRoleByIdGruppo", e);

                throw e;
            }
        }

        /// <summary>
        /// Aggiorna stato dell'elemento in libro firma
        /// </summary>
        /// <param name="idElementi"></param>
        /// <param name="nuovoStato"></param>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public bool AggiornaStatoElementiInLibroFirma(List<DocsPaVO.LibroFirma.ElementoInLibroFirma> elementi, string nuovoStato, DocsPaVO.utente.Ruolo ruolo, DocsPaVO.utente.InfoUtente infoUtente, out string message)
        {
            try
            {
                return BusinessLogic.LibroFirma.LibroFirmaManager.AggiornaStatoElementiInLibroFirma(elementi, nuovoStato, ruolo, infoUtente, out message);
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: AggiornaStatoElementiInLibroFirma", e);
                message = string.Empty;
                return false;
            }
        }

        [WebMethod]
        public bool AggiornaStatoElementoInLibroFirma(DocsPaVO.LibroFirma.ElementoInLibroFirma elemento, string nuovoStato, DocsPaVO.utente.Ruolo ruolo, DocsPaVO.utente.InfoUtente infoUtente, out string message)
        {
            try
            {
                return BusinessLogic.LibroFirma.LibroFirmaManager.AggiornaStatoElementoInLibroFirma(elemento, nuovoStato, ruolo, infoUtente, out message);
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: AggiornaStatoElementoInLibroFirma", e);
                message = string.Empty;
                return false;
            }
        }

        [WebMethod]
        public bool InserimentoInLibroFirma(DocsPaVO.LibroFirma.ElementoInLibroFirma elemento, DocsPaVO.utente.InfoUtente infoUtente)
        {
            try
            {
                return BusinessLogic.LibroFirma.LibroFirmaManager.InserimentoInLibroFirma(elemento, infoUtente);
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: InserimentoInLibroFirma", e);
                return false;
            }
        }
        /// <summary>
        /// Avvio del processo di firma per un file
        /// </summary>
        /// <param name="processoDiFirma"></param>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public bool StartProcessoDiFirma(DocsPaVO.LibroFirma.ProcessoFirma processoDiFirma, DocsPaVO.documento.FileRequest file, DocsPaVO.utente.InfoUtente infoUtente, string modalita, string note, DocsPaVO.LibroFirma.OpzioniNotifica opzioniNotifiche, out DocsPaVO.LibroFirma.ResultProcessoFirma resultAvvioProcesso)
        {
            bool result;
            resultAvvioProcesso = DocsPaVO.LibroFirma.ResultProcessoFirma.OK;
            try
            {
                result = BusinessLogic.LibroFirma.LibroFirmaManager.StartProcessoDiFirma(processoDiFirma, file, infoUtente, modalita, note, opzioniNotifiche, out resultAvvioProcesso);
                if (result)
                {
                    string method = "AVVIATO_PROCESSO_DI_FIRMA_DOCUMENTO";
                    string description = "Avviato processo di firma per la versione " + file.version;
                    if (file.GetType().Equals(typeof(DocsPaVO.documento.Allegato)))
                    {
                        method = "AVVIATO_PROCESSO_DI_FIRMA_ALLEGATO";
                    }

                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente.userId, infoUtente.idPeople, infoUtente.idGruppo, infoUtente.idAmministrazione, method, file.docNumber,
                        description, DocsPaVO.Logger.CodAzione.Esito.OK, (infoUtente != null && infoUtente.delegato != null ? infoUtente.delegato : null), "1");
                }
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: StartProcessoDiFirma", e);
                return false;
            }
            return result;
        }

        [WebMethod]
        public bool SalvaModificaStatoStartSignatureProcess(DocsPaVO.LibroFirma.ProcessoFirma processoDiFirma, DocsPaVO.documento.FileRequest file,
            DocsPaVO.utente.InfoUtente infoUtente, string modalita, string note, DocsPaVO.LibroFirma.OpzioniNotifica opzioniNotifiche,
            string idStato, DocsPaVO.DiagrammaStato.DiagrammaStato diagramma, string dataScadenza,
            out DocsPaVO.LibroFirma.ResultProcessoFirma resultAvvioProcesso)
        {
            bool result;
            resultAvvioProcesso = DocsPaVO.LibroFirma.ResultProcessoFirma.OK;
            try
            {
                SetUserId(infoUtente);
                DocsPaVO.DiagrammaStato.Stato[] stati = (DocsPaVO.DiagrammaStato.Stato[])diagramma.STATI.ToArray(typeof(DocsPaVO.DiagrammaStato.Stato));
                DocsPaVO.DiagrammaStato.Stato stato = stati.Where(e => e.SYSTEM_ID.ToString() == idStato).First();

                result = BusinessLogic.DiagrammiStato.DiagrammiStato.SalvaModificaStatoAvviaProcesso(file.docNumber, idStato, diagramma, infoUtente.userId, infoUtente, dataScadenza,
                                    processoDiFirma, modalita, note, opzioniNotifiche, out resultAvvioProcesso);

                BusinessLogic.UserLog.UserLog.WriteLog(infoUtente.userId, infoUtente.idPeople, infoUtente.idGruppo, infoUtente.idAmministrazione, "DOC_CAMBIO_STATO", file.docNumber, String.Format("Stato passato a  {0}", stato.DESCRIZIONE.ToUpper()), DocsPaVO.Logger.CodAzione.Esito.OK,
                    infoUtente.delegato, "1");
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: SalvaModificaStatoStartSignatureProcess", e);
                return false;
            }
            return result;
        }


        [WebMethod]
        public List<DocsPaVO.documento.FirmaResult> StartProcessoDiFirmaMassive(DocsPaVO.LibroFirma.ProcessoFirma processoDiFirma, List<DocsPaVO.documento.FileRequest> fileRequest, DocsPaVO.utente.InfoUtente infoUtente, string modalita, string note, DocsPaVO.LibroFirma.OpzioniNotifica opzioniNotifiche)
        {
            List<DocsPaVO.documento.FirmaResult> firmaResult = new List<DocsPaVO.documento.FirmaResult>();
            DocsPaVO.LibroFirma.ResultProcessoFirma resultAvvioProcess = DocsPaVO.LibroFirma.ResultProcessoFirma.OK;
            try
            {
                foreach (DocsPaVO.documento.FileRequest file in fileRequest)
                {
                    if (BusinessLogic.LibroFirma.LibroFirmaManager.StartProcessoDiFirma(processoDiFirma, file, infoUtente, modalita, note, opzioniNotifiche, out resultAvvioProcess))
                    {
                        firmaResult.Add(new DocsPaVO.documento.FirmaResult() { fileRequest = file });

                        string method = "AVVIATO_PROCESSO_DI_FIRMA_DOCUMENTO";
                        string description = "Avviato processo di firma per la versione " + file.version;
                        if (file.GetType().Equals(typeof(DocsPaVO.documento.Allegato)))
                        {
                            method = "AVVIATO_PROCESSO_DI_FIRMA_ALLEGATO";
                        }

                        BusinessLogic.UserLog.UserLog.WriteLog(infoUtente.userId, infoUtente.idPeople, infoUtente.idGruppo, infoUtente.idAmministrazione, method, file.docNumber,
                            description, DocsPaVO.Logger.CodAzione.Esito.OK, (infoUtente != null && infoUtente.delegato != null ? infoUtente.delegato : null), "1");
                    }
                    else
                    {
                        firmaResult.Add(new DocsPaVO.documento.FirmaResult() { fileRequest = file, errore = resultAvvioProcess.ToString() });
                    }
                }
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: StartProcessoDiFirmaMassive", e);
                return null;
            }
            return firmaResult;
        }

        [WebMethod]
        [XmlInclude(typeof(DocsPaVO.LibroFirma.FiltroProcessoFirma))]
        public DocsPaVO.LibroFirma.ProcessoFirma[] GetProcessiFirmaByFilter(List<DocsPaVO.LibroFirma.FiltroProcessoFirma> filtro, DocsPaVO.utente.InfoUtente infoUtente)
        {
            {
                List<DocsPaVO.LibroFirma.ProcessoFirma> listaProcessi = new List<DocsPaVO.LibroFirma.ProcessoFirma>();
                try
                {
                    listaProcessi = BusinessLogic.LibroFirma.LibroFirmaManager.GetProcessiDiFirmaByFilter(filtro, infoUtente);
                }
                catch (Exception e)
                {
                    logger.Error("Errore in DocsPaWS.asmx  - metodo: GetProcessiFirmaByFilter", e);
                }
                return listaProcessi.ToArray();
            }
        }

        [WebMethod]
        [XmlInclude(typeof(DocsPaVO.LibroFirma.FiltroElementiLibroFirma))]
        public DocsPaVO.LibroFirma.ElementoInLibroFirma[] GetElementiLibroFirmaByFilter(DocsPaVO.LibroFirma.FiltroElementiLibroFirma filtro, DocsPaVO.utente.InfoUtente infoUtente)
        {
            {
                List<DocsPaVO.LibroFirma.ElementoInLibroFirma> listaElementi = new List<DocsPaVO.LibroFirma.ElementoInLibroFirma>();
                try
                {

                }
                catch (Exception e)
                {
                    logger.Error("Errore in DocsPaWS.asmx  - metodo: GetElementiLibroFirmaByFilter", e);
                }
                return listaElementi.ToArray();
            }
        }


        [WebMethod]
        [XmlInclude(typeof(DocsPaVO.LibroFirma.FiltroIstanzeProcessoFirma))]
        public DocsPaVO.LibroFirma.IstanzaProcessoDiFirma[] GetIstanzaProcessiDiFirmaByFilter(List<DocsPaVO.LibroFirma.FiltroIstanzeProcessoFirma> filtro, DocsPaVO.utente.InfoUtente infoUtente, int numPage, int pageSize, out int numTotPage, out int nRec, out DataSet istanzeProcessi)
        {
            istanzeProcessi = null;
            numTotPage = 0;
            nRec = 0;
            List<DocsPaVO.LibroFirma.IstanzaProcessoDiFirma> listaIstanze = new List<DocsPaVO.LibroFirma.IstanzaProcessoDiFirma>();
            try
            {
                listaIstanze = BusinessLogic.LibroFirma.LibroFirmaManager.GetIstanzaProcessiDiFirmaByFilter(filtro, numPage, pageSize, out numTotPage, out nRec, infoUtente, out istanzeProcessi);
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: GetElementiLibroFirmaByFilter", e);
            }
            return listaIstanze.ToArray();
        }

        /// <summary>
        /// Estrae i  processi di firma avviati e non ancora conclusi per il documento principale ed i suoi allegati
        /// </summary>
        /// <param name="idMainDocument"></param>
        /// <returns></returns>
        [WebMethod]
        [XmlInclude(typeof(DocsPaVO.LibroFirma.FiltroIstanzeProcessoFirma))]
        public DocsPaVO.LibroFirma.IstanzaProcessoDiFirma[] GetInfoProcessesStartedForDocument(string idMainDocument)
        {
            {
                List<DocsPaVO.LibroFirma.IstanzaProcessoDiFirma> listaIstanze = new List<DocsPaVO.LibroFirma.IstanzaProcessoDiFirma>();
                try
                {
                    listaIstanze = BusinessLogic.LibroFirma.LibroFirmaManager.GetInfoProcessesStartedForDocument(idMainDocument);
                }
                catch (Exception e)
                {
                    logger.Error("Errore in DocsPaWS.asmx  - metodo: GetInfoProcessesStartedForDocument", e);
                }
                return listaIstanze.ToArray();
            }
        }

        /// <summary>
        /// Verifica se la versione del documento  stato firmata elettronicamente
        /// </summary>
        /// <param name="docnumber"></param>
        /// <param name="versionId"></param>
        /// <returns></returns>
        [WebMethod]
        public bool IsElectronicallySigned(string docnumber, string versionId)
        {
            try
            {
                return BusinessLogic.LibroFirma.LibroFirmaManager.IsElectronicallySigned(docnumber, versionId);
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: IsElectronicallySigned", e);
                return false;
            }
        }

        /// <summary>
        /// Verifica se esiste un ruolo legato al ruolo in input per i tipi ruoli specificati
        /// </summary>
        /// <param name="typeRole"></param>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public List<DocsPaVO.utente.TipoRuolo> CheckExistsRoleSupByTypeRoles(List<DocsPaVO.utente.TipoRuolo> typeRole, DocsPaVO.utente.InfoUtente infoUtente)
        {
            try
            {
                return BusinessLogic.LibroFirma.LibroFirmaManager.CheckExistsRoleSupByTypeRoles(typeRole, infoUtente);
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: CheckExistsRoleSupByTypeRoles", e);
                return null;
            }
        }

        [WebMethod]
        public string[] GetElementiInLibroFirmaByDestinatario(DocsPaVO.utente.Corrispondente corr, DocsPaVO.utente.InfoUtente infoUtente)
        {
            try
            {
                return BusinessLogic.LibroFirma.LibroFirmaManager.GetElementiInLibroFirmaByDestinatario(corr, infoUtente).ToArray();
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: GetElementiInLibroFirmaByDestinatario", e);
                return null;
            }
        }

        [WebMethod]
        public bool IsTitolareElementoInLF(string docNumber, DocsPaVO.utente.InfoUtente infoUtente)
        {
            try
            {
                return BusinessLogic.LibroFirma.LibroFirmaManager.IsTitolare(docNumber, infoUtente);
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: GetElementiInLibroFirmaByDestinatario", e);
                return false;
            }
        }

        [WebMethod]
        public bool IsTitolarePassoInAttesa(string docNumber, DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.LibroFirma.Azione azione)
        {
            try
            {
                return BusinessLogic.LibroFirma.LibroFirmaManager.IsTitolarePassoInAttesa(docNumber, infoUtente, azione);
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: IsTitolarePassoInAttesa", e);
                return false;
            }
        }

        [WebMethod]
        public string GetTypeSignatureToBeEntered(DocsPaVO.documento.FileRequest fileReq, DocsPaVO.utente.InfoUtente infoUtente)
        {
            try
            {
                return BusinessLogic.LibroFirma.LibroFirmaManager.GetTypeSignatureToBeEntered(fileReq, infoUtente);
            }
            catch (Exception e)
            {
                logger.Error("Errore in BusinessLogic.LibroFirma.LibroFirmaManager  - metodo: GetTypeSignatureToBeEntered ", e);
                return null;
            }
        }


        [WebMethod]
        public DocsPaVO.LibroFirma.IstanzaPassoDiFirma GetIstanzaPassoFirmaInAttesaByDocnumber(string docnumber)
        {
            try
            {
                return BusinessLogic.LibroFirma.LibroFirmaManager.GetIstanzaPassoFirmaInAttesaByDocnumber(docnumber);
            }
            catch (Exception e)
            {
                logger.Error("Errore in BusinessLogic.LibroFirma.LibroFirmaManager  - metodo: GetIstanzaPassoFirmaInAttesaByDocnumber ", e);
                return null;
            }
        }

        [WebMethod]
        public bool PutElectronicSignature(DocsPaVO.documento.FileRequest approvingFile, DocsPaVO.utente.InfoUtente infoUtente, bool isAdvancementProcess, out string message)
        {
            bool retVal = false;
            message = string.Empty;
            try
            {
                if (BusinessLogic.LibroFirma.LibroFirmaManager.PutElectronicSignature(approvingFile, infoUtente, isAdvancementProcess, out message))
                {

                    string method2 = "DOC_VERIFIED";
                    string description2 = "Il documento  stato firmato elettronicamente";
                    if (isAdvancementProcess)
                    {
                        method2 = "DOC_STEP_OVER";
                        description2 = "Eseguito passo avanzamento iter";
                    }

                    if (approvingFile.inLibroFirma)
                    {
                        BusinessLogic.LibroFirma.LibroFirmaManager.AggiornaDataEsecuzioneElemento(approvingFile.docNumber, DocsPaVO.LibroFirma.TipoStatoElemento.FIRMATO.ToString());
                        BusinessLogic.LibroFirma.LibroFirmaManager.SalvaStoricoIstanzaProcessoFirmaByDocnumber(approvingFile.docNumber, description2, infoUtente);
                    }
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente.userId, infoUtente.idPeople, infoUtente.idGruppo, infoUtente.idAmministrazione, method2, approvingFile.docNumber,
                        description2, DocsPaVO.Logger.CodAzione.Esito.OK, (infoUtente != null && infoUtente.delegato != null ? infoUtente.delegato : null), "0");

                    retVal = true;
                }
                else if (approvingFile.inLibroFirma)
                {
                    BusinessLogic.LibroFirma.LibroFirmaManager.AggiornaErroreEsitoFirma(approvingFile.docNumber, message);
                }
            }
            catch (Exception ex)
            {
                retVal = false;
            }

            return retVal;
        }

        [WebMethod]
        public bool AggiornaDataEsecuzioneElemento(string docnumber, string stato)
        {
            try
            {
                return BusinessLogic.LibroFirma.LibroFirmaManager.AggiornaDataEsecuzioneElemento(docnumber, stato);
            }
            catch (Exception e)
            {
                return false;
            }
        }

        [WebMethod]
        public List<DocsPaVO.documento.FirmaResult> PutElectronicSignatureMassive(List<DocsPaVO.documento.FileRequest> approvingFiles, DocsPaVO.utente.InfoUtente infoUtente, bool isAdvancementProcess)
        {
            //bool retVal = false;
            List<DocsPaVO.documento.FirmaResult> firmaResult = new List<DocsPaVO.documento.FirmaResult>();
            string message = string.Empty;
            try
            {
                foreach (DocsPaVO.documento.FileRequest fileReq in approvingFiles)
                {
                    if (BusinessLogic.LibroFirma.LibroFirmaManager.PutElectronicSignature(fileReq, infoUtente, isAdvancementProcess, out message))
                    {

                        string method2 = "DOC_VERIFIED";
                        string description2 = "Il documento  stato firmato elettronicamente";
                        if (isAdvancementProcess)
                        {
                            description2 = "Eseguito passo avanzamento iter";
                            method2 = "DOC_STEP_OVER";
                        }
                        if (fileReq.inLibroFirma)
                        {
                            BusinessLogic.LibroFirma.LibroFirmaManager.AggiornaDataEsecuzioneElemento(fileReq.docNumber, DocsPaVO.LibroFirma.TipoStatoElemento.FIRMATO.ToString());
                            BusinessLogic.LibroFirma.LibroFirmaManager.SalvaStoricoIstanzaProcessoFirmaByDocnumber(fileReq.docNumber, description2, infoUtente);
                        }

                        BusinessLogic.UserLog.UserLog.WriteLog(infoUtente.userId, infoUtente.idPeople, infoUtente.idGruppo, infoUtente.idAmministrazione, method2, fileReq.docNumber,
                            description2, DocsPaVO.Logger.CodAzione.Esito.OK, (infoUtente != null && infoUtente.delegato != null ? infoUtente.delegato : null), "0");
                        firmaResult.Add(new DocsPaVO.documento.FirmaResult() { fileRequest = fileReq });
                    }
                    else if (fileReq.inLibroFirma)
                    {
                        BusinessLogic.LibroFirma.LibroFirmaManager.AggiornaErroreEsitoFirma(fileReq.docNumber, message);
                        //string method2 = "DOC_VERIFIED";
                        //string description2 = "Il documento  stato firmato elettronicamente";
                        //if (isAdvancementProcess)
                        //{
                        //    description2 = "Eseguito passo avanzamento iter";
                        //    method2 = "DOC_STEP_OVER";
                        //}

                        //BusinessLogic.UserLog.UserLog.WriteLog(infoUtente.userId, infoUtente.idPeople, infoUtente.idGruppo, infoUtente.idAmministrazione, method2, fileReq.docNumber,
                        //    description2, DocsPaVO.Logger.CodAzione.Esito.KO, (infoUtente != null && infoUtente.delegato != null ? infoUtente.delegato : null), "0");
                        //firmaResult.Add(new DocsPaVO.documento.FirmaResult() { fileRequest = fileReq, errore = message});
                    }
                }
            }
            catch (Exception ex)
            {
                return null;
            }

            return firmaResult;
        }

        [WebMethod]
        public List<DocsPaVO.LibroFirma.FirmaElettronica> GetElectronicSignatureDocument(string docnumber, string versionId, DocsPaVO.utente.InfoUtente infoUtente)
        {
            try
            {
                return BusinessLogic.Documenti.FileManager.GetElectronicSignatureDocument(docnumber, versionId, infoUtente);
            }
            catch (Exception ex)
            {
                return null;
            }
        }

        /// <summary>
        /// Rifiuta la trasmissione e interrompe il processo di firma
        /// </summary>
        /// <param name="elemento"></param>
        /// <param name="ruolo"></param>
        /// <param name="infoUtente"></param>
        /// <param name="errore"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual bool InterruptionSignatureProcessByHolder(DocsPaVO.LibroFirma.ElementoInLibroFirma elemento, DocsPaVO.utente.Ruolo ruolo, DocsPaVO.utente.InfoUtente infoUtente, out string errore)
        {
            bool result = false;
            errore = string.Empty;
            string msg = string.Empty;
            string varMetodo = string.Empty;
            try
            {
                result = BusinessLogic.LibroFirma.LibroFirmaManager.InterruptionSignatureProcessByHolder(elemento, ruolo, infoUtente, out errore);

                //Se  andato a buon fine ed  un allegato
                if (result && (!string.IsNullOrEmpty(elemento.InfoDocumento.IdDocumentoPrincipale)) && (elemento.InfoDocumento.IdDocumentoPrincipale != elemento.InfoDocumento.Docnumber))
                {
                    BusinessLogic.LibroFirma.LibroFirmaManager.StopPassoWait(elemento.InfoDocumento.IdDocumentoPrincipale, infoUtente);

                }
                //if(result)
                //{
                //    msg = "Interruzione del processo di firma per il file " +  elemento.InfoDocumento.Docnumber;
                //    varMetodo = string.IsNullOrEmpty(elemento.InfoDocumento.IdDocumentoPrincipale) ? "INTERROTTO_PROCESSO_DOCUMENTO_DAL_TITOLARE" : "INTERROTTO_PROCESSO_ALLEGATO_DAL_TITOLARE";
                //    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente.userId, infoUtente.idPeople, ruolo.idGruppo, infoUtente.idAmministrazione, varMetodo, elemento.InfoDocumento.Docnumber, msg, DocsPaVO.Logger.CodAzione.Esito.OK, infoUtente.delegato, "1", null);
                //}
            }
            catch (Exception e)
            {

            }
            return result;
        }

        [WebMethod]
        public virtual bool InterruptionSignatureProcessByProponent(DocsPaVO.LibroFirma.IstanzaProcessoDiFirma istanza, string noteInterruzione, DocsPaVO.utente.Ruolo ruolo, DocsPaVO.utente.InfoUtente infoUtente, string idDocPrincipale)
        {
            bool result = false;
            string msg = string.Empty;
            string varMetodo = string.Empty;
            try
            {
                result = BusinessLogic.LibroFirma.LibroFirmaManager.InterruptionSignatureProcessByProponent(istanza, noteInterruzione, ruolo, infoUtente);

                //Se  andato a buon fine ed  un allegato
                if (result && (istanza.docAll.Equals("A")))
                {
                    BusinessLogic.LibroFirma.LibroFirmaManager.StopPassoWait(idDocPrincipale, infoUtente);
                }
            }
            catch (Exception e)
            {

            }
            return result;
        }

        /// <summary>
        /// Respinge gli elementi nel libro firma selezionati interrompendone il processo di firma
        /// </summary>
        /// <param name="elements"></param>
        /// <param name="ruolo"></param>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public virtual void RejectElementsSignatureProcess(List<DocsPaVO.LibroFirma.ElementoInLibroFirma> elements, DocsPaVO.utente.Ruolo ruolo, DocsPaVO.utente.InfoUtente infoUtente)
        {
            string msg = string.Empty;
            bool result = false;
            string varMetodo = string.Empty;
            try
            {
                foreach (DocsPaVO.LibroFirma.ElementoInLibroFirma e in elements)
                {
                    result = BusinessLogic.LibroFirma.LibroFirmaManager.RejectElementsSignatureProcess(e, ruolo, infoUtente);

                    //Se  andato a buon fine ed  un allegato
                    if (result && (!string.IsNullOrEmpty(e.InfoDocumento.IdDocumentoPrincipale)) && (e.InfoDocumento.IdDocumentoPrincipale != e.InfoDocumento.Docnumber))
                    {
                        BusinessLogic.LibroFirma.LibroFirmaManager.StopPassoWait(e.InfoDocumento.IdDocumentoPrincipale, infoUtente);
                    }
                }
            }
            catch (Exception e)
            {

            }
        }

        /// <summary>
        /// 
        /// </summary>
        /// <param name="processoBase"></param>
        /// <param name="nomeNuovoProcesso"></param>
        /// <param name="utente"></param>
        /// <param name="resultCreazioneProcesso"></param>
        /// <returns></returns>
        [WebMethod]
        public DocsPaVO.LibroFirma.ProcessoFirma DuplicaProcessoFirma(string idProcessoOld, string nomeNuovoProcesso, bool copiaVisibilita, DocsPaVO.utente.InfoUtente utente, out DocsPaVO.LibroFirma.ResultProcessoFirma resultCreazioneProcesso)
        {
            resultCreazioneProcesso = DocsPaVO.LibroFirma.ResultProcessoFirma.OK;
            try
            {
                return BusinessLogic.LibroFirma.LibroFirmaManager.DuplicaProcessoFirma(idProcessoOld, nomeNuovoProcesso, copiaVisibilita, utente, out resultCreazioneProcesso);
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: DuplicaProcessoFirma", e);
                return null;
            }
        }

        [WebMethod]
        public List<DocsPaVO.areaLavoro.ResultAddAreaLavoro> AddMassiveObjectInADL(List<DocsPaVO.areaLavoro.WorkingArea> listAreaLavoro, DocsPaVO.utente.InfoUtente infoUtente)
        {
            List<DocsPaVO.areaLavoro.ResultAddAreaLavoro> results = new List<DocsPaVO.areaLavoro.ResultAddAreaLavoro>();
            try
            {
                results = BusinessLogic.Documenti.areaLavoroManager.AddMassiveObjectInADL(listAreaLavoro, infoUtente);
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: AddMassiveObjectInADL", e);
            }
            return results;
        }

        /// <summary>
        /// Estrae il numero totale di elementi presenti in libro firma dell'utente-ruolo
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public int CountElementiInLibroFirma (DocsPaVO.utente.InfoUtente infoUtente)
        {
            int count = 0;
            try
            {
                count = BusinessLogic.LibroFirma.LibroFirmaManager.CountElementiInLibroFirma(infoUtente);
            }
            catch(Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: CountElementiInLibroFirma", e);
            }
            return count;
        }
        #endregion

        #region TASK

        /// <summary>
        /// Estrazione della lista dei TASK ricevuti
        /// </summary>
        /// <param name="incluteCompletedTasks"></param>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public DocsPaVO.Task.Task[] GetListaTaskRicevuti(bool incluteCompletedTasks, DocsPaVO.utente.InfoUtente infoUtente)
        {
            List<DocsPaVO.Task.Task> listaTask = new List<DocsPaVO.Task.Task>();
            try
            {
                listaTask = BusinessLogic.Task.TaskManager.GetListaTaskRicevuti(incluteCompletedTasks, infoUtente);
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: GetListaTaskRicevuti", e);
            }
            return listaTask.ToArray();
        }

        /// <summary>
        /// Metodo per la rimozione del TASK(Rimuove un task)
        /// </summary>
        /// <param name="idTask"></param>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public bool RimuoviTask(string idTask, DocsPaVO.utente.InfoUtente infoUtente)
        {
            try
            {
                return BusinessLogic.Task.TaskManager.RimuoviTask(idTask, infoUtente);
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: RimuoviTask", e);
                return false;
            }
        }

        /// <summary>
        /// Chiude il task impostando la data di chiusura
        /// </summary>
        /// <param name="task"></param>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public bool ChiudiTask(DocsPaVO.Task.Task task, DocsPaVO.utente.InfoUtente infoUtente)
        {
            try
            {
                return BusinessLogic.Task.TaskManager.ChiudiTask(task, infoUtente);
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: ChiudiTask", e);
                return false;
            }
        }
        /// <summary>
        /// Metodo per l'annullamento del TASK(Rimuove un task mandando una notifica al destinatario)
        /// </summary>
        /// <param name="task"></param>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public bool AnnullaTask(DocsPaVO.Task.Task task, DocsPaVO.utente.InfoUtente infoUtente)
        {
            bool result = false;
            string msg = string.Empty;
            string idObj = string.Empty;
            string methodName = string.Empty;
            try
            {
                result = BusinessLogic.Task.TaskManager.RimuoviTask(task.ID_TASK, infoUtente);
                if (result)
                {
                    if (!string.IsNullOrEmpty(task.ID_PROFILE))
                    {
                        methodName = "CANCEL_TASK_DOCUMENT";
                        msg = "Annullamento del task. Id documento: " + task.ID_PROFILE;
                        idObj = task.ID_PROFILE;
                    }
                    else
                    {
                        methodName = "CANCEL_TASK_FOLDER";
                        msg = "Annullamento del task. Id fascicolo: " + task.ID_PROJECT;
                        idObj = task.ID_PROJECT;
                    }
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente.userId, infoUtente.idPeople, infoUtente.idGruppo, infoUtente.idAmministrazione, methodName, idObj, msg, DocsPaVO.Logger.CodAzione.Esito.OK, infoUtente.delegato, "1", task.ID_TRASM_SINGOLA);
                }
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: RimuoviTask", e);
                return false;
            }
            return result;
        }

        /// <summary>
        /// Riapre la lavorazione del task
        /// </summary>
        /// <param name="task"></param>
        /// <param name="infoUtente"></param>
        /// <param name="ruolo"></param>
        /// <returns></returns>
        [WebMethod]
        public bool RiapriLavorazione(DocsPaVO.Task.Task task, DocsPaVO.utente.InfoUtente infoUtente, DocsPaVO.utente.Ruolo ruolo)
        {
            bool result = false;
            string msg = string.Empty;
            string idObj = string.Empty;
            string methodName = string.Empty;
            try
            {
                result = BusinessLogic.Task.TaskManager.RiapriLavorazione(task, infoUtente, ruolo);

                if (!string.IsNullOrEmpty(task.ID_PROFILE))
                {
                    methodName = "RIAPERTURA_LAVORAZIONE_TASK_DOCUMENT";
                    msg = "Riaperta la lavorazione del task. Id documento: " + task.ID_PROFILE;
                    idObj = task.ID_PROFILE;
                }
                else
                {
                    methodName = "RIAPERTURA_LAVORAZIONE_TASK_FOLDER";
                    msg = "Riaperta la lavorazione del task. Id fascicolo: " + task.ID_PROJECT;
                    idObj = task.ID_PROJECT;
                }

                if (result)
                {

                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente.userId, infoUtente.idPeople, infoUtente.idGruppo, infoUtente.idAmministrazione, methodName, idObj, msg, DocsPaVO.Logger.CodAzione.Esito.OK, infoUtente.delegato, "1", task.ID_TRASM_SINGOLA);
                }
                else
                {
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente.userId, infoUtente.idPeople, infoUtente.idGruppo, infoUtente.idAmministrazione, methodName, idObj, msg, DocsPaVO.Logger.CodAzione.Esito.KO, infoUtente.delegato, "1", task.ID_TRASM_SINGOLA);
                }

            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: RiapriLavorazione", e);
                return false;
            }
            return result;
        }

        /// <summary>
        /// Metodo per la chiusura del TASK(Non rimuove effettivamente il task sul DB ma imposta una data di chiusura del TASK)
        /// </summary>
        /// <param name="task"></param>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public bool ChiudiLavorazioneTask(DocsPaVO.Task.Task task, string note, DocsPaVO.utente.InfoUtente infoUtente)
        {
            bool result = false;
            string msg = string.Empty;
            string idObj = string.Empty;
            string methodName = string.Empty;
            try
            {
                result = BusinessLogic.Task.TaskManager.ChiudiLavorazioneTask(task, note, infoUtente);
                if (result)
                {
                    if (!string.IsNullOrEmpty(task.ID_PROFILE))
                    {
                        methodName = "CLOSE_TASK_DOCUMENT";
                        if (string.IsNullOrEmpty(task.ID_PROFILE_REVIEW))
                        {
                            msg = "Chiusura del task. Id documento: " + task.ID_PROFILE;
                            idObj = task.ID_PROFILE;
                        }
                        else
                        {
                            msg = "Chiusura del task. Id contributo: " + task.ID_PROFILE_REVIEW;
                            idObj = task.ID_PROFILE_REVIEW;
                        }
                    }
                    else
                    {
                        if (string.IsNullOrEmpty(task.ID_PROFILE_REVIEW))
                        {
                            methodName = "CLOSE_TASK_FOLDER";
                            msg = "Chiusura del task. Id fascicolo: " + task.ID_PROJECT;
                            idObj = task.ID_PROJECT;
                        }
                        else
                        {
                            methodName = "CLOSE_TASK_DOCUMENT";
                            msg = "Chiusura del task. Id contributo: " + task.ID_PROFILE_REVIEW;
                            idObj = task.ID_PROFILE_REVIEW;
                        }

                    }
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente.userId, infoUtente.idPeople, infoUtente.idGruppo, infoUtente.idAmministrazione, methodName, idObj, msg, DocsPaVO.Logger.CodAzione.Esito.OK, infoUtente.delegato, "1", task.ID_TRASM_SINGOLA);
                }
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: CloseTask", e);
                return false;
            }
            return result;
        }

        /// <summary>
        /// Associa il nuovo documento creato al task di origine
        /// </summary>
        /// <param name="idTask"></param>
        /// <param name="docnumber"></param>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public bool AssociaContributoAlTask(DocsPaVO.Task.Task task, DocsPaVO.documento.SchedaDocumento schedaDoc, DocsPaVO.utente.InfoUtente infoUtente)
        {
            bool result = false;
            try
            {
                result = BusinessLogic.Task.TaskManager.AssociaContributoAlTask(task, schedaDoc, infoUtente);
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: AssociaContributoAlTask", e);
                return false;
            }
            return result;
        }

        /// <summary>
        /// Estrazione della lista dei TASK assegnati
        /// </summary>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public DocsPaVO.Task.Task[] GetListaTaskAssegnati(DocsPaVO.utente.InfoUtente infoUtente)
        {
            List<DocsPaVO.Task.Task> listaTask = new List<DocsPaVO.Task.Task>();
            try
            {
                listaTask = BusinessLogic.Task.TaskManager.GetListaTaskAssegnati(infoUtente);
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: GetListaTaskAssegnati", e);
            }
            return listaTask.ToArray();
        }

        [WebMethod]
        public DocsPaVO.Task.Task GetTaskByTrasmSingola(string idTrasmSingola, DocsPaVO.utente.InfoUtente infoUtente)
        {
            DocsPaVO.Task.Task task = new DocsPaVO.Task.Task();
            try
            {
                task = BusinessLogic.Task.TaskManager.GetTaskByTrasmSingola(idTrasmSingola, infoUtente);
            }
            catch (Exception e)
            {
                logger.Error("Errore in DocsPaWS.asmx  - metodo: GetTaskByTrasmSingola", e);
            }
            return task;
        }
        #endregion

        #region Bigfile

        [WebMethod()]
        [XmlInclude(typeof(DocsPaVO.UploadFiles.FileInUpload))]
        public DocsPaVO.UploadFiles.FileInUpload[] GetUploadedFiles(InfoUtente infoUtente)
        {
            try
            {
                //if (incomplete == null) incomplete = false;

                List<DocsPaVO.UploadFiles.FileInUpload> result = null;
                result = BusinessLogic.UploadFiles.UploadFilesManager.GetListFilesUploaded(infoUtente);

                return result.ToArray();
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetFascicoloDaCodiceNoSecurityConservazione", e);
                return null;
            }
        }

        [WebMethod()]
        public bool PutFileFromUploadManager(ref DocsPaVO.documento.FileRequest fileRequest, DocsPaVO.documento.FileDocumento fileDocument, string fileName, string fileDescription, InfoUtente infoUtente)
        {
            bool retVal = false;
            try
            {
                retVal = BusinessLogic.UploadFiles.UploadFilesManager.PutFileFromUploadManager(ref fileRequest, fileDocument, fileName, fileDescription, infoUtente);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: PutFileFromUploadManager", e);
                retVal = false;
            }

            return retVal;
        }

        [WebMethod()]
        public bool PutFileFromUploadManagerLight(ref DocsPaVO.documento.FileRequest fileRequest, DocsPaVO.documento.FileDocumento fileDocument, string repositoryId, InfoUtente infoUtente)
        {
            bool retVal = false;
            try
            {
                retVal = BusinessLogic.UploadFiles.UploadFilesManager.PutFileFromUploadManagerLight(ref fileRequest, fileDocument, repositoryId, infoUtente);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: PutFileFromUploadManager", e);
                retVal = false;
            }

            return retVal;
        }

        [WebMethod()]
        public bool DeletePersonalFile(DocsPaVO.documento.FileDocumento fileDocument, string repositoryId, InfoUtente infoUtente)
        {
            bool retVal = false;
            try
            {
                retVal = BusinessLogic.UploadFiles.UploadFilesManager.DeletePersonalFile(fileDocument, repositoryId, infoUtente);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: PutFileFromUploadManager", e);
                retVal = false;
            }

            return retVal;
        }
        #endregion

        /*
        /// <summary>
        /// Salva nel db il contenuto della session serizlizzato
        /// </summary>
        /// <param name="sessId"></param>
        /// <param name="serializzedSessList"></param>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public bool StoreSession(string sessId, List<string> serializzedSessList, InfoUtente infoUtente)
        {
            try
            {
                return BusinessLogic.Application.DB_SessionManager.StoreSession(sessId, serializzedSessList, infoUtente);
            }
            catch (Exception e)
            {
                return false;
            }
        }
        
        /// <summary>
        /// Salva nel db il contenuto della session serizlizzato
        /// </summary>
        /// <param name="sessId"></param>
        /// <returns></returns>
        [WebMethod]
        public string[] GetSession(string sessId)
        {
            List<string> retVal = new List<string>();

            try
            {
                retVal = BusinessLogic.Application.DB_SessionManager.GetSession(sessId);
                if (retVal != null)
                    BusinessLogic.Application.DB_SessionManager.DeleteSession(sessId);
            }
            catch (Exception e)
            {
                retVal = null;
            }

            return retVal.ToArray();
        }
        */

        private bool writeAppLog(DocsPaVO.utente.InfoUtente infoUtente, string idConservazione, string operazione, string description, bool success)
        {
            DocsPaVO.Logger.CodAzione.Esito logResponse = DocsPaVO.Logger.CodAzione.Esito.KO;
            if (success)
                logResponse = DocsPaVO.Logger.CodAzione.Esito.OK;


            bool retval = BusinessLogic.UserLog.UserLog.WriteLog(infoUtente,
                    operazione,
                    idConservazione,
                    description,
                    logResponse);

            return retval;

        }

        #region DesktopApps

        [WebMethod()]
        public DocsPaVO.DesktopApps.DesktopApp GetDesktopApp(string AppName, InfoUtente infoUtente)
        {
            DocsPaVO.DesktopApps.DesktopApp retVal = null;
            try
            {
                retVal = BusinessLogic.DesktopApps.DesktopAppsManager.GetDesktopApp(AppName, infoUtente);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetDesktopApp", e);
            }

            return retVal;
        }
        #endregion

        #region FASCICOLAZIONE OBBLIGATORIA TIPI DOCUMENTO

        [WebMethod]
        public List<DocsPaVO.documento.FascicolazioneTipiDocumento> GetFascicolazioneTipiDocumento(string idAmm, DocsPaVO.utente.InfoUtente infoutente)
        {
            return BusinessLogic.Amministrazione.AmministraManager.GetFascicolazioneTipiDocumento(idAmm, infoutente);
        }
        [WebMethod]
        public bool SetFascicolazioneTipiDocumento(List<DocsPaVO.documento.FascicolazioneTipiDocumento> listTipiDoc, string idAmm, DocsPaVO.utente.InfoUtente infoutente)
        {
            return BusinessLogic.Amministrazione.AmministraManager.SetFascicolazioneTipiDocumento(listTipiDoc, idAmm, infoutente);
        }

        #endregion

        #region Strutture Sottofascicoli

        /// <summary>
        /// Returns the list of structure by idamministrazione
        /// </summary>
        /// <param name="idamministrazione"></param>
        /// <returns></returns>
        [WebMethod]
        public DataTable GetStruttureSottofascicoli(string idamministrazione)
        {
            DataTable result = null;

            try
            {
                result = BusinessLogic.Amministrazione.StruttureSottofascicoliManager.getStruttureSottofascicoli(idamministrazione);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore in DocsPaWS.asmx - metodo: GetStruttureSottofascicoli", ex);
            }

            return result;
        }

        /// <summary>
        /// Ritorna la struttura dei sottofascicoli
        /// </summary>
        /// <param name="idamm"></param>
        /// <param name="idfascicolo"></param>
        /// <param name="idtitolario"></param>
        /// <param name="idtemplate"></param>
        /// <returns></returns>
        [WebMethod]
        public DataTable GetStruttureSottofascicoliById(string idamm, int idfascicolo, int idtitolario, int idtemplate)
        {
            DataTable result = null;

            try
            {
                result = BusinessLogic.Amministrazione.StruttureSottofascicoliManager.getStruttureSottofascicoli(idamm, idfascicolo, idtitolario, idtemplate);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore in DocsPaWS.asmx - metodo: GetStruttureSottofascicoli", ex);
            }

            return result;
        }

        /// <summary>
        /// 
        /// </summary>
        /// <param name="id"></param>
        /// <param name="data"></param>
        /// <param name="name"></param>
        [WebMethod]
        public EsitoOperazione SaveStrutturaSottofascicoli(int id, DataTable data, string name, string idAmm)
        {
            EsitoOperazione result = new EsitoOperazione() { Codice = 0, Descrizione = "Esito positivo" };

            try
            {
                BusinessLogic.Amministrazione.StruttureSottofascicoliManager.saveStrutturaSottofascicoli(id, data, name, idAmm);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore in DocsPaWS.asmx - metodo: SaveStrutturaSottofascicoli", ex);
                result.Codice = -1;
                result.Descrizione = ex.Message;
            }

            return result;
        }

        /// <summary>
        /// 
        /// </summary>
        /// <param name="idtemplate"></param>
        /// <param name="idtipofascicolo"></param>
        /// <param name="idtitolario"></param>
        /// <returns></returns>
        [WebMethod]
        public EsitoOperazione DeleteStrutturaSottofascicoli(int idtemplate, int idtipofascicolo, int idtitolario, string idAmm)
        {
            EsitoOperazione result = new EsitoOperazione() { Codice = 0, Descrizione = "Esito positivo" };

            try
            {
                DataTable relation = BusinessLogic.Amministrazione.StruttureSottofascicoliManager.getTemplateStrutturaRelation(idtemplate, idtipofascicolo, idtitolario);
                if (relation.Rows.Count > 0)
                    throw new Exception("Impossibile cancellare l'elemento perch risulta collegato");

                BusinessLogic.Amministrazione.StruttureSottofascicoliManager.DeleteStrutturaSottofascicoli(idtemplate, idAmm);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore in DocsPaWS.asmx - metodo: SaveStrutturaSottofascicoli", ex);
                result.Codice = -1;
                result.Descrizione = ex.Message;
            }

            return result;
        }

        /// <summary>
        /// 
        /// </summary>
        /// <param name="idtipofascicolo"></param>
        /// <param name="idtitolario"></param>
        /// <param name="idtemplate"></param>
        /// <returns></returns>
        [WebMethod]
        public EsitoOperazione SaveStrutturaTemplateRelation(int idtipofascicolo, int idtitolario, int idtemplate)
        {
            EsitoOperazione result = new EsitoOperazione() { Codice = 0, Descrizione = "Esito positivo" };

            try
            {
                BusinessLogic.Amministrazione.StruttureSottofascicoliManager.saveStrutturaSottofascicoli(idtipofascicolo, idtitolario, idtemplate);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore in DocsPaWS.asmx - metodo: SaveStrutturaSottofascicoli", ex);
                result.Codice = -1;
                result.Descrizione = ex.Message;
            }

            return result;
        }

        /// <summary>
        /// 
        /// </summary>
        /// <param name="strutturaid"></param>
        /// <param name="nodename"></param>
        /// <param name="idamm"></param>
        /// <param name="numfascicoli"></param>
        /// <returns></returns>
        [WebMethod]
        public bool IsNodoStrutturaInFascicoliEmpty(string strutturaid, string nodename, string idamm, out int numfascicoli)
        {
            bool result = false;
            numfascicoli = 0;

            try
            {
                result = BusinessLogic.Amministrazione.StruttureSottofascicoliManager.IsNodoStrutturaInFascicoliEmpty(strutturaid, nodename, out numfascicoli, idamm);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore in DocsPaWS.asmx - metodo: SaveStrutturaSottofascicoli", ex);
            }

            return result;
        }

        /// <summary>
        /// 
        /// </summary>
        /// <param name="name"></param>
        /// <param name="id_template"></param>
        /// <param name="info"></param>
        /// <returns></returns>
        [WebMethod]
        public EsitoOperazione RemoveStrutturaFromFascicolo(string name, string id_template, InfoUtente info)
        {
            EsitoOperazione result = null;

            try
            {
                Folder[] folders = BusinessLogic.Amministrazione.StruttureSottofascicoliManager.GetFoldersByStrutturaTemplate(name, id_template);
                foreach (Folder item in folders)
                    BusinessLogic.Fascicoli.FolderManager.delFolder(item, info);

                result = new EsitoOperazione() { Codice = 0, Descrizione = "Esito positivo" };
            }
            catch (Exception ex)
            {
                logger.Error(ex);
                result = new EsitoOperazione() { Codice = -1, Descrizione = ex.Message };
            }

            return result;
        }

        /// <summary>
        /// Propaga una modifica aggiuntiva, fatta in amministrazione su una struttura di fascicoli,
        /// a tutti i fascicoli che hanno come template quello passato come parametro
        /// </summary>
        /// <param name="parentname"></param>
        /// <param name="name"></param>
        /// <param name="idtemplate"></param>
        /// <param name="info"></param>
        /// <param name="ruolo"></param>
        /// <returns></returns>
        [WebMethod]
        public EsitoOperazione AddStrutturaToFascicolo(string parentname, string name, string idtemplate, InfoUtente info, Ruolo ruolo, string idamm)
        {
            EsitoOperazione result = null;
            ResultCreazioneFolder result_folder = new ResultCreazioneFolder();

            try
            {
                Folder[] folders = BusinessLogic.Amministrazione.StruttureSottofascicoliManager.GetFoldersByStrutturaTemplate(parentname, idtemplate, idamm);
                foreach (Folder item in folders)
                {
                    Fascicolo fasc = BusinessLogic.Fascicoli.FascicoloManager.getFascicoloByIdNoSecurity(item.idFascicolo);
                    fasc.creatoreFascicolo = BusinessLogic.Fascicoli.FascicoloManager.GetCreatoreFascicolo(fasc.systemID);
                    if (!string.IsNullOrEmpty(fasc.creatoreFascicolo.idCorrGlob_Ruolo))
                    {
                        Ruolo ru = getRuoloById(fasc.creatoreFascicolo.idCorrGlob_Ruolo);

                        // Viene passato perch info fa riferimento all'utente amministratore quindi senza gruppo
                        info.idGruppo = ru.idGruppo;

                        BusinessLogic.Fascicoli.FolderManager.newFolder(
                            new Folder() { descrizione = name, idFascicolo = item.idFascicolo, idParent = item.systemID },
                            info, ru, out result_folder);
                    }
                }

                result = new EsitoOperazione() { Codice = 0, Descrizione = "Esito positivo" };
            }
            catch (Exception ex)
            {
                logger.Error(ex);
                result = new EsitoOperazione() { Codice = -1, Descrizione = ex.Message };
            }

            return result;
        }

        /// <summary>
        /// Il metodo propaga la modifica del nome di un folder di struttura
        /// su tutti i fascicoli a cui quella struttura  applicata
        /// a meno che il folder contenga documenti
        /// </summary>
        /// <param name="oldname"></param>
        /// <param name="newname"></param>
        /// <param name="idtemplate"></param>
        /// <param name="idamm"></param>
        /// <returns></returns>
        [WebMethod]
        public EsitoOperazione RenameStrutturaToFascicolo(string oldname, string newname, string idtemplate, string idamm)
        {
            EsitoOperazione esito = null;
            try
            {
                Folder[] folders = BusinessLogic.Amministrazione.StruttureSottofascicoliManager.GetFoldersByStrutturaTemplate(oldname, idtemplate, idamm);
                foreach (Folder item in folders)
                {
                    if (!BusinessLogic.Fascicoli.FolderManager.FolderHasDocuments(item))
                        BusinessLogic.Fascicoli.FolderManager.RenameFolder(item.systemID, newname);
                }

                esito = new EsitoOperazione() { Codice = 0, Descrizione = "Esito positivo" };
            }
            catch (Exception ex)
            {
                logger.Error(ex);
                esito = new EsitoOperazione() { Codice = -1, Descrizione = ex.Message };
            }

            return esito;
        }

        #endregion

        #region Tipo firma
        /// <summary>
        /// 
        /// </summary>
        /// <param name="fileRequest"></param>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public Boolean IsPdfPades(DocsPaVO.documento.FileRequest fileRequest, DocsPaVO.utente.InfoUtente infoUtente)
        {
            Boolean isPades = false;
            try
            {
                isPades = BusinessLogic.Documenti.FileManager.IsPdfPades(fileRequest, infoUtente);
            }
            catch (Exception ex)
            {
                logger.Debug("IsPdfPades", ex);

            }

            return isPades;
        }

        /// <summary>
        /// 
        /// </summary>
        /// <param name="numOfItems"></param>
        /// <returns></returns>
        [WebMethod]
        public List<DocsPaVO.documento.FileRequest> GetSignTypesToProcess(int numOfItems)
        {
            return new DocsPaDB.Query_DocsPAWS.Documenti().GetSignTypesToProcess(numOfItems);
        }

        /// <summary>
        /// 
        /// </summary>
        /// <param name="fileRequest"></param>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public bool processFileToSetSignType(DocsPaVO.documento.FileRequest fileRequest, DocsPaVO.utente.InfoUtente infoUtente)
        {
            return BusinessLogic.Documenti.FileManager.processFileToSetSignType(fileRequest, infoUtente);
        }

        #endregion

        #region Integrazione RGS

        /// <summary>
        /// Restituisce la lista dei possibili messaggi con cui spedire a RGS il prossimo protocollo.
        /// </summary>
        /// <param name="schedaDocumento"></param>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public List<DocsPaVO.FlussoAutomatico.Messaggio> GetMessaggiSuccessiviFlussoProcedurale(DocsPaVO.documento.SchedaDocumento schedaDocumento, InfoUtente infoUtente)
        {
            return BusinessLogic.FlussoAutomatico.FlussoAutomaticoManager.GetMessaggiSuccessiviFlussoProcedurale(schedaDocumento);
        }

        /// <summary>
        /// Restituisce l'intero flusso di protocollazione automatica in cui il documento in input  coinvolto.
        /// </summary>
        /// <param name="schedaDoc"></param>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public List<DocsPaVO.FlussoAutomatico.Flusso> GetListaFlussoDocumento(DocsPaVO.documento.SchedaDocumento schedaDoc, InfoUtente infoUtente)
        {
            return BusinessLogic.FlussoAutomatico.FlussoAutomaticoManager.GetListaFlussoDocumento(schedaDoc);
        }

        /// <summary>
        /// Inserisce un nuovo contesto procedurale
        /// </summary>
        /// <param name="contesto"></param>
        /// <returns></returns>
        [WebMethod]
        public bool InsertContestoProcedurale(DocsPaVO.FlussoAutomatico.ContestoProcedurale contesto, InfoUtente infoUtente)
        {
            return BusinessLogic.FlussoAutomatico.FlussoAutomaticoManager.InsertContestoProcedurale(contesto);
        }

        [WebMethod]
        public List<DocsPaVO.FlussoAutomatico.ContestoProcedurale> GetListContestoProcedurale(InfoUtente infoUtente)
        {
            return BusinessLogic.FlussoAutomatico.FlussoAutomaticoManager.GetListContestoProcedurale();
        }

        [WebMethod]
        public bool UpdateAssociazioneTemplateContestoProcedurale(string idTipoAtto, string idContestoProcedurale, InfoUtente infoUente)
        {
            return BusinessLogic.FlussoAutomatico.FlussoAutomaticoManager.UpdateAssociazioneTemplateContestoProcedurale(idTipoAtto, idContestoProcedurale);
        }
        #endregion

        [WebMethod]
        public List<string> GetListaCapComuni(string prefixCap, string comune)
        {
            return BusinessLogic.Rubrica.DPA3_RubricaSearchAgent.GetListaCapComuni(prefixCap, comune);
        }

        [WebMethod]
        public List<string> GetListaComuni(string prefixComune)
        {
            return BusinessLogic.Rubrica.DPA3_RubricaSearchAgent.GetListaComuni(prefixComune);
        }

        [WebMethod]
        public InfoComune GetCapComuni(string cap, string comune)
        {
            return BusinessLogic.Rubrica.DPA3_RubricaSearchAgent.GetCapComuni(cap, comune);
        }

        [WebMethod]
        public InfoComune GetProvinciaComune(string comune)
        {
            return BusinessLogic.Rubrica.DPA3_RubricaSearchAgent.GetProvinciaComune(comune);
        }

        /// <summary>
        /// Verifica se, per l'amministrazione,  abilitata la trasmissione automatica del documento
        /// </summary>
        /// <param name="idAmm"></param>
        /// <returns></returns>
        [WebMethod]
        public bool IsEnabledTrasmissioneAutomaticaAmm(string idAmm)
        {
            return BusinessLogic.Amministrazione.AmministraManager.IsEnabledTrasmissioneAutomaticaAmm(idAmm);
        }

        /// <summary>
        /// Restituisce la label per il tipo documento specificato.
        /// </summary>
        /// <param name="typeId"></param>
        /// <returns></returns>
        [WebMethod]
        public string GetLabelTipoDocumento(string typeId)
        {
            return BusinessLogic.Documenti.DocManager.GetLabelTipoDocumento(typeId);
        }

        /// <summary>
        /// Restituisce la descrizione per il tipo documento specificato
        /// </summary>
        /// <param name="typeId"></param>
        /// <returns></returns>
        [WebMethod]
        public string GetDescrizioneTipoDocumento(string typeId)
        {
            return BusinessLogic.Documenti.DocManager.GetDescrizioneTipoDocumento(typeId);
        }

        /// <summary>
        /// Restituisce la dimensione totale dei file delle ultime versioni del documento principale ed allegati
        /// </summary>
        /// <param name="idDocumento"></param>
        /// <returns></returns>
        [WebMethod]
        public int TotalFileSizeDocument(string idDocumento)
        {
            return BusinessLogic.Documenti.DocManager.TotalFileSizeDocument(idDocumento);
        }


        /// <summary>
        /// Restituisce i tipi di procedimento definiti nell'amministrazione
        /// </summary>
        /// <param name="idAmm"></param>
        /// <returns></returns>
        [WebMethod]
        public string[] GetTipiProcedimentoAmministrazione(string idAmm)
        {
            return BusinessLogic.Procedimenti.ProcedimentiManager.GetTipiProcedimentoAmministrazione(idAmm);
        }

        /// <summary>
        /// 
        /// </summary>
        /// <param name="request"></param>
        /// <returns></returns>
        [WebMethod]
        public DocsPaVO.Procedimento.Report.ReportProcedimentoResponse GetReportProcedimento(DocsPaVO.Procedimento.Report.ReportProcedimentoRequest request)
        {
            return BusinessLogic.Procedimenti.ProcedimentiManager.GetProcedimentiReport(request);
        }

        [WebMethod]
        public string FattElAttiveDaImport(string idDoc, InfoUtente infoUt)
        {
            return BusinessLogic.Amministrazione.SistemiEsterni.FattElAttiveDaImport(idDoc, infoUt);
        }

        /// <summary>
        /// 
        /// </summary>
        /// <param name="userId"></param>
        /// <param name="idAmm"></param>
        /// <returns></returns>
        [WebMethod]
        public InfoUtenteAmministratore GetDatiAmministratore(string userId, string idAmm)
        {
            return BusinessLogic.Amministrazione.AmministraManager.GetDatiAmministratore(userId, idAmm);
        }

        /// <summary>
        /// Restituisce il tipo firma dell'ultima versione del documento
        /// </summary>
        /// <param name="docnumber"></param>
        /// <returns></returns>
        [WebMethod]
        public string GetTipoFirmaDocumento(string docnumber)
        {
            return BusinessLogic.Documenti.DocManager.GetTipoFirmaDocumento(docnumber);
        }

        #region Descrizione Fascicolo
        /// <summary>
        /// Inserisce la descrizione nell'elenco delle descrizioni dei fascicoli
        /// </summary>
        /// <param name="descFasc"></param>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public bool InsertDescrizioneFascicolo(DescrizioneFascicolo descFasc, DocsPaVO.utente.InfoUtente infoUtente, out DocsPaVO.fascicolazione.ResultDescrizioniFascicolo resultInsertDescrizioniFascicolo)
        {
            resultInsertDescrizioniFascicolo = ResultDescrizioniFascicolo.OK;
            return BusinessLogic.Fascicoli.FascicoloManager.InsertDescrizioneFascicolo(descFasc, infoUtente, out resultInsertDescrizioniFascicolo);
        }

        /// <summary>
        /// Estrae l'elendo delle dscrizioni dei fascicoli
        /// </summary>
        /// <param name="filters"></param>
        /// <param name="infoUtente"></param>
        /// <param name="numPage"></param>
        /// <param name="pageSize"></param>
        /// <param name="numTotPage"></param>
        /// <param name="nRec"></param>
        /// <returns></returns>
        [WebMethod]
        public List<DescrizioneFascicolo> GetListDescrizioniFascicolo(List<DocsPaVO.fascicolazione.FiltroDescrizioniFascicolo> filters, DocsPaVO.utente.InfoUtente infoUtente, int numPage, int pageSize, out int numTotPage, out int nRec)
        {
            List<DescrizioneFascicolo> descFascList = new List<DescrizioneFascicolo>();
            numTotPage = 0;
            nRec = 0;

            descFascList = BusinessLogic.Fascicoli.FascicoloManager.GetListDescrizioniFascicolo(filters, infoUtente, numPage, pageSize, out numTotPage, out nRec);

            return descFascList;
        }

        /// <summary>
        /// Aggiorna la descrizione nell'elenco delle descrizioni dei fascicoli
        /// </summary>
        /// <param name="descFasc"></param>
        /// <param name="infoUtente"></param>
        /// <param name="resultUpdateDescrizioniFascicolo"></param>
        /// <returns></returns>
        [WebMethod]
        public bool AggiornaDescrizioneFascicolo(DescrizioneFascicolo descFasc, DocsPaVO.utente.InfoUtente infoUtente, out DocsPaVO.fascicolazione.ResultDescrizioniFascicolo resultUpdateDescrizioniFascicolo)
        {
            resultUpdateDescrizioniFascicolo = ResultDescrizioniFascicolo.OK;
            return BusinessLogic.Fascicoli.FascicoloManager.AggiornaDescrizioneFascicolo(descFasc, infoUtente, out resultUpdateDescrizioniFascicolo);
        }

        /// <summary>
        /// Elimina la descrizione dall'elenco delle descrizioni dei fascicoli
        /// </summary>
        /// <param name="systemId"></param>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public bool EliminaDescrizioneFascicolo(string systemId, DocsPaVO.utente.InfoUtente infoUtente)
        {
            return BusinessLogic.Fascicoli.FascicoloManager.EliminaDescrizioneFascicolo(systemId, infoUtente);
        }
        #endregion

        [WebMethod]
        public DocsPaVO.RegistroAccessi.RegistroAccessiReportResponse RegistroAccessiPubblicazione(DocsPaVO.RegistroAccessi.RegistroAccessiReportRequest request)
        {
            return BusinessLogic.RegistroAccessi.RegistroAccessiManager.PubblicaRegistroAccessi(request);
        }

        [WebMethod]
        public bool AmmSbloccoCasella(string email, string idRegistro)
        {
            return BusinessLogic.Amministrazione.AmministraManager.SbloccoCasella(email, idRegistro);
        }

        #region PROCESSI AUTOMATICI LIBRO FIRMA
        /// <summary>
        /// Torna true se l'evento in input pu essere un evento di passo automatico
        /// </summary>
        /// <param name="codiceEvento"></param>
        /// <returns></returns>
        [WebMethod]
        public bool IsEventoAutomatico(string codiceEvento)
        {
            return BusinessLogic.LibroFirma.LibroFirmaManager.IsEventoAutomatico(codiceEvento);
        }


        [WebMethod]
        public CasellaRegistro GetCasellaRegistroByIdMail(string idMail)
        {
            return BusinessLogic.LibroFirma.LibroFirmaManager.GetCasellaRegistroByIdMail(idMail);
        }

        [WebMethod]
        public Utente GetUtenteAutomatico(string idAmministrazione)
        {
            return BusinessLogic.Utenti.UserManager.GetUtenteAutomatico(idAmministrazione);
        }

        /// <summary>
        /// Ritenta l'esecuzione dei passi dei processi automatici in input che sono nello stato "IN_ERROR"
        /// </summary>
        /// <param name="istanzeProcessi"></param>
        /// <param name="infoUtente"></param>
        [WebMethod]
        public bool RitentaIstanzeProcessiInErrore(List<DocsPaVO.LibroFirma.IstanzaProcessoDiFirma> istanzeProcessi, DocsPaVO.utente.InfoUtente infoUtente)
        {
            return BusinessLogic.LibroFirma.LibroFirmaManager.RitentaIstanzeProcessiInErrore(istanzeProcessi, infoUtente);
        }

        /// <summary>
        /// Restituisce, per gli id delle istanze in ingresso, le istanze in errore
        /// </summary>
        /// <param name="idIstanzeProcessi"></param>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public List<DocsPaVO.LibroFirma.IstanzaProcessoDiFirma> GetIstanzeProcessiInErrore(List<string> idIstanzeProcessi, DocsPaVO.utente.InfoUtente infoUtente)
        {
            return BusinessLogic.LibroFirma.LibroFirmaManager.GetIstanzeProcessiInErrore(idIstanzeProcessi, infoUtente);
        }

        /// <summary>
        /// Verifica l'esistenza di passi di firma in cui sono coinvolti il ruolo ed i registri visibili al ruolo non inclusi nella lista in input e che verranno quindi rimmossi tra le visibilita del ruolo
        /// </summary>
        /// <param name="rightRuoloMailReg"></param>
        /// <param name="idRuoloInUO"></param>
        /// <param name="idGruppo"></param>
        /// <returns></returns>
        [WebMethod]
        public bool AmmExistsPassiFirmaByRuoloTitolareAndRegistro(DocsPaVO.amministrazione.RightRuoloMailRegistro[] rightRuoloMailReg, string idRuoloInUO, string idGruppo)
        {
            return BusinessLogic.LibroFirma.LibroFirmaManager.ExistsPassiFirmaByRuoloTitolareAndRegistro(rightRuoloMailReg, idRuoloInUO, idGruppo);
        }

        /// <summary>
        /// Verifica l'esistenza di passi di firma per il registro e la casella di posta indicata
        /// </summary>
        /// <param name="idRegistro"></param>
        /// <param name="emailRegistro"></param>
        /// <returns></returns>
        [WebMethod]
        public bool AmmExistsPassiFirmaByIdRegistroAndEmailRegistro(string idRegistro, string emailRegistro)
        {
            return BusinessLogic.LibroFirma.LibroFirmaManager.ExistsPassiFirmaByIdRegistroAndEmailRegistro(idRegistro, emailRegistro);
        }

        /// <summary>
        /// Invalida i processi di firma in cui sono presenti passi che hanno associato il registro e la casella in input
        /// </summary>
        /// <param name="idRegistro"></param>
        /// <param name="emailRegistro"></param>
        /// <returns></returns>
        [WebMethod]
        public bool AmmInvalidaProcessiFirmaByIdRegistroAndEmailRegistro(string idRegistro, string emailRegistro, DocsPaVO.utente.InfoUtente infoUtente)
        {
            return BusinessLogic.LibroFirma.LibroFirmaManager.InvalidaProcessiFirmaByIdRegistroAndEmailRegistro(idRegistro, emailRegistro, infoUtente);
        }

        /// <summary>
        /// Invalida i processi di firma per cui sono state modificate le impostazioni di registro nel ruolo
        /// </summary>
        /// <param name="rightRuoloMailReg"></param>
        /// <param name="idRuoloInUO"></param>
        /// <param name="idGruppo"></param>
        /// <returns></returns>
        [WebMethod]
        public bool AmmInvalidaProcessiRegistriCoinvolti(DocsPaVO.amministrazione.RightRuoloMailRegistro[] rightRuoloMailReg, string idRuoloInUO, string idGruppo, DocsPaVO.utente.InfoUtente infoUtente)
        {
            return BusinessLogic.LibroFirma.LibroFirmaManager.InvalidaProcessiRegistriCoinvolti(rightRuoloMailReg, idRuoloInUO, idGruppo, infoUtente);
        }

        #endregion

        [WebMethod]
        public bool ExistsTrasmPendenteConWorkflowDocumento(string idProfile, string idRuoloInUO, string idPeople, DocsPaVO.utente.InfoUtente infoUtente)
        {
            return BusinessLogic.Documenti.DocManager.ExistsTrasmPendenteConWorkflowDocumento(idProfile, idRuoloInUO, idPeople);
        }

        [WebMethod]
        public bool ExistsTrasmPendenteSenzaWorkflowDocumento(string idProfile, string idRuoloInUO, string idPeople, DocsPaVO.utente.InfoUtente infoUtente)
        {
            return BusinessLogic.Documenti.DocManager.ExistsTrasmPendenteSenzaWorkflowDocumento(idProfile, idRuoloInUO, idPeople);
        }

        [WebMethod]
        public bool ExistsTrasmPendenteConWorkflowFascicolo(string idProject, string idRuoloInUO, string idPeople, DocsPaVO.utente.InfoUtente infoUtente)
        {
            return BusinessLogic.Fascicoli.FascicoloManager.ExistsTrasmPendenteConWorkflowFascicolo(idProject, idRuoloInUO, idPeople);
        }

        [WebMethod]
        public bool ExistsTrasmPendenteSenzaWorkflowFascicolo(string idProject, string idRuoloInUO, string idPeople, DocsPaVO.utente.InfoUtente infoUtente)
        {
            return BusinessLogic.Fascicoli.FascicoloManager.ExistsTrasmPendenteSenzaWorkflowFascicolo(idProject, idRuoloInUO, idPeople);
        }

        /// <summary>
        /// Restituisce tutte le trasmissioni con workflow pendenti per la coppia utente/ruolo
        /// </summary>
        /// <param name="idDocOrFasc"></param>
        /// <param name="docOrFasc"></param>
        /// <param name="idRuoloInUO"></param>
        /// <param name="idPeople"></param>
        /// <param name="pagingContext"></param>
        /// <returns></returns>
        [WebMethod]
        public List<DocsPaVO.trasmissione.InfoTrasmissione> GetTrasmissioniPendentiConWorkflow(string idDocOrFasc, string docOrFasc, string idRuoloInUO, string idPeople, ref DocsPaVO.ricerche.SearchPagingContext pagingContext, out List<string> idTrasmsSingola)
        {
            idTrasmsSingola = new List<string>();
            return BusinessLogic.Trasmissioni.TrasmManager.GetTrasmissioniPendentiConWorkflow(idDocOrFasc, docOrFasc, idRuoloInUO, idPeople, out idTrasmsSingola, ref pagingContext);
        }

        /// <summary>
        /// Accetta massivamente le trasmissioni
        /// </summary>
        /// <param name="idTrasmSingole"></param>
        /// <param name="noteAccettazione"></param>
        /// <param name="ruolo"></param>
        /// <param name="infoUtente"></param>
        /// <returns></returns>
        [WebMethod]
        public bool AcceptTransmissions(List<string> idTrasmSingole, string noteAccettazione, DocsPaVO.utente.Ruolo ruolo, DocsPaVO.utente.InfoUtente infoUtente)
        {
            return BusinessLogic.Trasmissioni.TrasmManager.AcceptTransmissions(idTrasmSingole, noteAccettazione, ruolo, infoUtente);
        }

        [WebMethod]
        public bool AcceptMassiveTrasmDocument(string idProfile, DocsPaVO.utente.Ruolo ruolo, DocsPaVO.utente.InfoUtente infoUtente)
        {
            bool result = false;
            try
            {
                result = BusinessLogic.Trasmissioni.TrasmManager.AcceptMassiveTrasmDocument(idProfile, ruolo, infoUtente);

                if (result)
                {
                    string msg = "Accettazione massiva della trasmissione. Id documento: " + idProfile;
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente.userId, infoUtente.idPeople, ruolo.idGruppo, infoUtente.idAmministrazione, "ACCEPTTRASMDOCUMENT", idProfile, msg, DocsPaVO.Logger.CodAzione.Esito.OK, infoUtente.delegato, "1", null);
                }
            }
            catch(Exception e)
            {
                logger.Error("Errore in AcceptMassiveTrasmDocument: " + e);
                result = false;
            }
            return result;
        }

        [WebMethod]
        public bool ViewMassiveTrasmDocument(string idProfile, DocsPaVO.utente.Ruolo ruolo, DocsPaVO.utente.InfoUtente infoUtente)
        {
            bool result = false;
            try
            {
                result = BusinessLogic.Trasmissioni.TrasmManager.ViewMassiveTrasmDocument(idProfile, ruolo, infoUtente);

                if (result)
                {
                    string method = "CHECKTRASMDOCUMENT";
                    string desc = "Click sul tasto Visto del documento " + idProfile + " da parte dell'utente " + infoUtente.userId;
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente.userId, infoUtente.idPeople, infoUtente.idGruppo, infoUtente.idAmministrazione, method, idProfile, desc, DocsPaVO.Logger.CodAzione.Esito.OK, infoUtente.delegato, "1", null);                
                }
            }
            catch (Exception e)
            {
                logger.Error("Errore in ViewMassiveTrasmDocument: " + e);
                result = false;
            }
            return result;            
        }

        [WebMethod]
        public bool ViewMassiveTrasmFasc(string idProject, DocsPaVO.utente.Ruolo ruolo, DocsPaVO.utente.InfoUtente infoUtente)
        {
            bool result = false;
            try
            {
                result = BusinessLogic.Trasmissioni.TrasmManager.ViewMassiveTrasmFasc(idProject, ruolo, infoUtente);

                if (result)
                {
                    string method = "CHECKTRASMFOLDER";
                    string desc = "Click sul tasto Visto del fascicolo " + idProject + " da parte dell'utente " + infoUtente.userId;
                    
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente.userId, infoUtente.idPeople, infoUtente.idGruppo, infoUtente.idAmministrazione, method, idProject, desc, DocsPaVO.Logger.CodAzione.Esito.OK, infoUtente.delegato, "1", null);
                }
            }
            catch (Exception e)
            {
                logger.Error("Errore in ViewMassiveTrasmFasc: " + e);
                result = false;
            }
            return result;
        }

        [WebMethod]
        public bool AcceptMassiveTrasmFasc(string idProject, DocsPaVO.utente.Ruolo ruolo, DocsPaVO.utente.InfoUtente infoUtente)
        {
            bool result = false;
            try
            {
                result = BusinessLogic.Trasmissioni.TrasmManager.AcceptMassiveTrasmFasc(idProject, ruolo, infoUtente);

                if (result)
                {
                    string msg = "Accettazione massiva della trasmissione. Id fascicolo: " + idProject;
                    BusinessLogic.UserLog.UserLog.WriteLog(infoUtente.userId, infoUtente.idPeople, ruolo.idGruppo, infoUtente.idAmministrazione, "ACCEPTTRASMFOLDER", idProject, msg, DocsPaVO.Logger.CodAzione.Esito.OK, infoUtente.delegato, "1", null);
                }
            }
            catch (Exception e)
            {
                logger.Error("Errore in AcceptMassiveTrasmDocument: " + e);
                result = false;
            }
            return result;
        }


        [WebMethod]
        public bool UploadFileOnSharedFolder(byte[] fileStream, string fileName, InfoUtente infoUtente)
        {
            bool result = true;
            string docRootPath;
            string userPath;
            string userTempDedicatedFolder;
            string filePath;

            try
            {
                if(!(fileStream != null && fileStream.Length > 0)) { throw new ArgumentNullException("Contenuto del file vuoto"); }
                string _rootPath = DocsPaUtils.Configuration.InitConfigurationKeys.GetValue("0", "BE_TEMP_PATH");

                docRootPath = System.IO.Path.Combine(_rootPath, @"Import\Documents\");  //System.Configuration.ConfigurationManager.AppSettings["IMPORT_TEMP_FOLDER"];
                // docRootPath = System.Configuration.ConfigurationManager.AppSettings["IMPORT_TEMP_FOLDER"];

                // Cartella dedicata Utente
                userPath = System.IO.Path.Combine(docRootPath, infoUtente.idPeople);
                if (!System.IO.Directory.Exists(userPath))
                {
                    System.IO.Directory.CreateDirectory(userPath);
                }

                // cartella temporanea con data odierna
                userTempDedicatedFolder = System.IO.Path.Combine(userPath, DateTime.Now.ToString("yyyyMMdd"));
                if (!System.IO.Directory.Exists(userTempDedicatedFolder))
                {
                    System.IO.Directory.CreateDirectory(userTempDedicatedFolder);
                }
                fileName = System.IO.Path.GetFileName(fileName);
                // file
                filePath = System.IO.Path.Combine(userTempDedicatedFolder, fileName);
                if (System.IO.File.Exists(filePath))
                {
                    System.IO.File.Delete(filePath);
                }
                System.IO.File.WriteAllBytes(filePath, fileStream);
            }
            catch (Exception ex)
            {
                logger.Error(ex.Message, ex);
                result = false;
            }
            return result;
        }

        [WebMethod]
        public bool UploadAttachmentOnSharedFolder(byte[] fileStream, string fileName, InfoUtente infoUtente)
        {
            bool result = true;
            string docRootPath;
            string attachmentsFolder;
            string userPath;
            string userTempDedicatedFolder;
            string filePath;

            try
            {
                if (!(fileStream != null && fileStream.Length > 0)) { throw new ArgumentNullException("Contenuto del file vuoto"); }

                string _rootPath = DocsPaUtils.Configuration.InitConfigurationKeys.GetValue("0", "BE_TEMP_PATH");

                docRootPath = System.IO.Path.Combine(_rootPath, @"Import\Documents\");  //System.Configuration.ConfigurationManager.AppSettings["IMPORT_TEMP_FOLDER"];
                attachmentsFolder = "Attachments"; // System.Configuration.ConfigurationManager.AppSettings["IMPORT_TEMP_ATTACHMENT_FOLDER"];
                // Cartella dedicata Utente
                userPath = System.IO.Path.Combine(docRootPath, infoUtente.idPeople);
                if (!System.IO.Directory.Exists(userPath))
                {
                    System.IO.Directory.CreateDirectory(userPath);
                }

                // cartella temporanea con data odierna
                userTempDedicatedFolder = System.IO.Path.Combine(userPath, DateTime.Now.ToString("yyyyMMdd"));
                if (!System.IO.Directory.Exists(userTempDedicatedFolder))
                {
                    System.IO.Directory.CreateDirectory(userTempDedicatedFolder);
                }

                // cartella allegati
                userTempDedicatedFolder = System.IO.Path.Combine(userTempDedicatedFolder, attachmentsFolder);
                if (!System.IO.Directory.Exists(userTempDedicatedFolder))
                {
                    System.IO.Directory.CreateDirectory(userTempDedicatedFolder);
                }



                fileName = System.IO.Path.GetFileName(fileName);
                // file
                filePath = System.IO.Path.Combine(userTempDedicatedFolder, fileName);
                if (System.IO.File.Exists(filePath))
                {
                    System.IO.File.Delete(filePath);
                }
                System.IO.File.WriteAllBytes(filePath, fileStream);
            }
            catch (Exception ex)
            {
                logger.Error(ex.Message, ex);
                result = false;
            }
            return result;
        }

        #region Trasmissioni pendenti Utenti in Ruolo

        [WebMethod]
        public bool ExistsTrasmissioniPendentiConWorkflowUtente(string idRuoloInUO, string idPeople)
        {
            return BusinessLogic.Amministrazione.AmministraManager.ExistsTrasmissioniPendentiConWorkflowUtente(idRuoloInUO, idPeople);
        }

        [WebMethod()]
        public DocsPaVO.documento.FileDocumento GetReportTrasmissioniPendentiUtente(string idPeople, string idCorrGlobaliRuolo, string formato)
        {
            DocsPaVO.documento.FileDocumento retVal = new DocsPaVO.documento.FileDocumento();

            try
            {
                retVal = BusinessLogic.Amministrazione.AmministraManager.GetReportTrasmissioniPendentiUtente(idPeople, idCorrGlobaliRuolo, formato);
            }
            catch (Exception ex)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: GetReportTrasmissioniPendentiUtente", ex);
                retVal = null;
            }

            return retVal;
        }

        [WebMethod()]
        public DocsPaVO.amministrazione.EsitoOperazione AmmAccettaTrasmConWFUtente(string idPeople, string idCorrGlobaliRuolo)
        {
            DocsPaVO.amministrazione.EsitoOperazione esito = new DocsPaVO.amministrazione.EsitoOperazione();
            try
            {
                esito = BusinessLogic.Amministrazione.OrganigrammaManager.AmmAccettaTrasmConWFUtente(idPeople, idCorrGlobaliRuolo);
            }
            catch (Exception e)
            {
                logger.Debug("Errore in DocsPaWS.asmx  - metodo: AmmAccettaTrasmConWFUtente - ", e);
                esito.Codice = 1;
                esito.Descrizione = "si  verificato un errore";
            }

            return esito;
        }
        #endregion

    }
}

